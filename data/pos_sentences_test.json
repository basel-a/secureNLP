{"0": "Using a web shell as a primary backdoor gives Deep Panda several advantages .", "1": "Showimg.asp is an example of an early stage web shell used to build an initial foothold within a network .", "2": "The web shell supports 8 main commands , with most command execution via Transact - SQL using the xp_cmdshell function .", "3": "If unlabeled textbox1 is empty , the code will enumerate attached drives .", "4": "Upload the file chosen by the Choose File button and save it to a temporary table in the database file worktbl in chunks of 10240 bytes .", "5": "Login Checkbox Attempt to use the username , password , and domain from the User , Pass and Domain fields and LogonUserA ( ) Win32 API function to impersonate a specific user .", "6": "In short , system_web.aspx provides an adversary with a very stealthy means of near full control of the server on which it resides .", "7": "This stealth might be its most important attribute .", "8": "Once running it uses an elaborate way to detect the operating system version and then selects whether to use VBScript or Powershell based on the result ; VBScript for Windows XP and Powershell for newer versions of Windows .", "9": "By decoding this script we can determine its nature As you can see this powershell script simply extracts another VBScript and executes it .", "10": "This VBScript downloads the primary payload to the temporary directory and names it \" z1.exe \" .", "11": "The first binary payload that lands on the system is relatively simple and serves as a method of yet again detecting the operating system version and where to drop a secondary payload file .", "12": "Whilst this binary is not complicated by nature it has been designed to masquerade as a legitimate application and contains functionality to evade anti - virus .", "13": "Upon running this malware determines the operating system version , but only delineating between Windows XP , Visa and above .", "14": "By executing this file in a specific manner it will load the freshly dropped DLL file \u2013 affectively this is known as DLL hijacking .", "15": "Following this action another file , named ' wuauclt.dat ' , is written on to the disk under the same directory .", "16": "To complete the file drop wuauclt.exe is executed .", "17": "It primarily serves as a method of decoding one of the files dropped by the previous malware stage and creating a method to start the malware on system boot - up or user login .", "18": "The decoding routine is again overly complex but ultimately amounts to a simple subtraction and XOR , again both of these operations are performed by the number 3 , thus each byte is subtracted by 3 and then XOR'd with 3 Once this file has been decoded it is loaded into memory and executed .", "19": "The method of leaving the encoded file on disk and only decoding it in memory is to thwart poorly configured anti - virus or disk surface heuristic scanners .", "20": "This RAT allows the attacker to control the infected workstation and perform a vast array of administrative functions such as .", "21": "Once the RAT has been loaded on the infected machine it begins calling out to the command and control server ( \" phoning home \" ) and waits for the attackers to issue one of the above commands to the victim .", "22": "Information about the victim system is collected and posted off to the command and control server .", "23": "This information is encoded using a simple bitwise operation and then sent to the command and control server .", "24": "For command and control , these connect to a large network of hacked websites .", "25": "These sites host malware modules , victim information and issue commands to infected systems .", "26": "Once the victims were infected , Crouching Yeti selected different RATs for its operations .", "27": "These RATs communicated with Command and Control servers on compromised servers around the world , using a simple PHP backend .", "28": "Such modified self - extracting archives could have been uploaded directly to a compromised server , replacing the original file , or sent to the victim by email .", "29": "One example of this method was a hijacked SwissRanger camera driver ( libMesaSR version 1.0.14.706 ) that was used to drop the Sysmain backdoor to .", "30": "% APPDATA%\\sydmain.dll and set the Run registry value to load malicious DLL upon next system startup .", "31": "In a similar manner , as early as January 2014 , Havex version 038 appears to have been dropped by a legitimate ~40 MB software installer from the eWon web site .", "32": "\" Breaking the barrier between industrial applications and IT standards , the mission of eWON is to connect industrial machines securely to the Internet , enabling easy remote access and gathering all types of technical data originating from industrial machines ... Connecting machines across the Internet is our mission . \" Sometimes , the Havex loader was dropped from \" eCatcherSetup_v4.exe \" , so it seems that the site operators may have removed a previous file and the attackers replaced it with their trojanized installer , and so on .", "33": "The second method relies on a malicious XDP file containing the PDF / SWF exploit ( CVE-2011- 0611 ) and was most probably used in spear - phishing attacks .", "34": "This is a known the PDF obfuscation method and serves as an additional anti - detection layer .", "35": "The main functionality of this component is to download and load additional DLL modules into the memory .", "36": "These are stored on compromised websites that act as C&C servers .", "37": "In order to do that , the malware injects itself into the EXPLORER.EXE process , sends a GET / POST request to the PHP script on the compromised website , then reads the HTML document returned by the script , looking for a base64 encrypted data between the two \" havex \" strings in the comment tag < ! --havexhavex-- > and writes this data it to a % TEMP%\\<tmp>.xmd file ( filename is generated by GetTempFilename function ) .", "38": "For each file it finds , it decompresses the content , decrypts ( if encrypted ) and loads into the memory as the DLL .", "39": "In order to run on each system boot , malware copies itself to : < path>\\TMPprovider0XX.dll and creates the autorun registry key .", "40": "In some cases , these keys are written to the registry values .", "41": "Malware sends a GET request ( versions < 017 ) or POST request to the first available URL .", "42": "The modules perform a variety of different actions , including collecting information about the victim 's system and other machines in the local network , harvesting passwords , listing documents , etc .", "43": "In - depth analysis of the cryptography used by log files is presented in Appendix 2 This module is designed to collect detailed data about the OPC servers running in the local network and save them to a % TEMP%\\{rand}.yls file .", "44": "This module collects basic information about the system it 's running on , and saves it to the % TEMP%\\{rand}.yls file .", "45": "This module uses the embedded BrowserPasswordDecryptor 2.0 tool ( hxxp://securityxploded.com / browser - password - decryptor.php ) to dump login credentials stored by the password managers of various browsers .", "46": "Decrypted passwords are saved into the % TEMP%\\~tmp1237.txt file , which is then copied by the parent module into an encrypted * .tmp.yls file .", "47": "This module is designed to scan the local network and look for all hosts listening on ports related to OPC / SCADA software .", "48": "Information about these hosts is then saved to the % TEMP%\\~tracedscn.yls file .", "49": "It sends requests to the PHP script at the C&C ( compromised website ) and looks for specific data in the returned HTML code .", "50": "Based on the compilation times , we may assume that this loader was used to download and run modules before it was replaced by Havex .", "51": "This malware can be described as a classical RAT ( Remote Access Trojan ) , since it gives the attacker a wide range of opportunities to control and interact with the victim machine .", "52": "The autonomous part of Sysmain installs and registers itself to be persistent in the system .", "53": "Then it gathers general information about the victim system , like When ready , this data is submitted to one of the C&C - servers .", "54": "After that , it checks periodically for new commands from C&C ( pulling via HTTP ) .", "55": "Among others , there are commands to change the pubkey for C&C - communication or delete its traces in the registry .", "56": "It receives its commands from one of four static command - and - control servers .", "57": "The RAT gets its commands by sending a request to a PHP script on the C&C ( compromised server ) as usual , and looks for specific data in the returned HTML code .", "58": "Each time a command ( task ) is executed , the result of that command is stored in the registry under a subkey named \" done \" or \" doneEXT \" .", "59": "The results ( which are called \" answers \" by the authors ) are then POSTED to the C&C server .", "60": "Karagany is a simple backdoor that connects to the C&C and keeps waiting for commands .", "61": "It can download and run additional executables , load / delete modules , read file content , reboot the computer , update itself and remove all components .", "62": "Besides backdoor functionality , it also extracts credentials from Internet Explorer 's password manager to the prx.jpg file and injects a small DLL into the processes of web browsers .", "63": "This DLL keeps listening to outgoing network traffic and looking for basic access authentication details sent over unencrypted HTTP .", "64": "When executed , it copies itself to the folder under % APPDATA% and creates a .lnk file in the % STARTUP% directory .", "65": "After checking if a connection to the Internet is up , it sends an initial POST request to the C&C server .", "66": "A screenshot of the desktop is saved into the C:\\ProgramData\\Mail\\MailAg\\scs.jpg file .", "67": "Additionally , other system information - such as the date and time of capture , computer name , username , cpu architecture , os version , IP address , logon domain and logon server , desktop details ( height , width , depth , refresh rate ) and environmental variables - are logged in C:\\ProgramData\\Mail\\MailAg\\scs.txt file .", "68": "This module is used to list all files and documents with specified extensions , or which have names containing specified strings in the C:\\ProgramData\\Mail\\MailAg\\fls.txt file .", "69": "Besides the Havex version , the OS Version of the victim computer is also communicated to the C&C server .", "70": "Their RATs are flexible enough to perform surveillance and data exfiltration efficiently .", "71": "Seaduke victims are generally first infected with Cozyduke and , if the computer appears to be a target of interest , the operators will install Seaduke .", "72": "In the months that followed , the Duke group began to target victims with \u20ac \u0153Office Monkeys \u20ac \u200b- and \u20ac \u0153eFax \u20ac \u200b-themed emails , booby - trapped with a Cozyduke payload .", "73": "In July of 2014 , the group instructed Cozyduke - infected computers to install Backdoor . Miniduke onto a compromised network .", "74": "The attackers control Cozyduke via compromised websites , issuing instructions to infected machines by uploading \u20ac \u0153tasks \u20ac \u200b to a database file .", "75": "Cozyduke will periodically contact these websites to retrieve task information to be executed on the local machine .", "76": "One such task ( an encoded PowerShell script ) instructed Cozyduke to download and execute Seaduke from a compromised website .", "77": "Unlike Cozyduke , Seaduke operators upload \u20ac \u0153task \u20ac \u200b files directly to the command- and - control ( C&C ) server ; there is no database as such present .", "78": "They have the ability to retrieve detailed bot / system information , update bot configuration , upload files , download files , and self- delete the malware from the system .", "79": "The attackers ' modus operandi is to carry out spear phishing using a malicious Microsoft Office document as an attachment .", "80": "The attached documents exploit a well - known and rather aged vulnerability ( CVE-2012 - 0158 ) to drop a remote administration tool , or RAT for short , onto the targeted user 's computer .", "81": "Both include common cyber - espionage components such as code execution , file listing , document exfiltration and more .", "82": "We discovered more than 75 command and control servers , all used to administrate infected machines .", "83": "To drop the malware onto the targeted computer and to control the system , the attackers chose to carry out a spear phishing campaign .", "84": "As soon as the document is loaded , a network query is performed and notifies the attacker about the successful exploit and the availability of a newly infected machine .", "85": "Persistence is ensured by the creation of a shortcut file ( .lnk ) in the Start Menu folder .", "86": "The \" Cohhoc \" malware uses an obfuscation layer , to disguise the malware and to complicate the analysis .", "87": "The persistence mechanism is realized by the creation of a service .", "88": "Actually , the library is injected into the process of BitDefender ( seccenter.exe ) , ZoneAlarm ( svchost.exe ) or 360 ( 360tray.exe ) , which means that three popular security products are abused .", "89": "If the processes are not running on the infected system , the injection is performed into explorer.exe .", "90": "By : Gavin O GormanSymantec Employee Created 29 Jan 2015 Contributor : Nikolas Tsapkis On January 12 , 2015 , Dell Secureworks blogged about a tool ( Trojan . Skelky ) that allows attackers to \u20ac \u0153 use a password of their choosing to authenticate as any user .", "91": "For example , the adversary will register a domain that spoofs the name of the targeted organization and then host a spoofed login page on that site .", "92": "The page is used to steal legitimate credentials , but once users enter the credentials , they are often redirected to a new page that prompts them to download a \" Browser Patch \" or other similar type of file .", "93": "The downloaded file is actually the Stealer malware that exfiltrates stolen data to an FTP server .", "94": "EvilBunny has been seen spreading through a malicious PDF document , exploiting CVE- 2011 - 4369 on 20th of December 2011 .", "95": "The exploit would download the bunny dropper and install suspect # 4 on the infected system .", "96": "Searching for a sandbox environment , the malware takes a number of simple steps to verify .", "97": "Accessing the systems WMI ( Windows Management Interface ) the malware queries the installed AntiVirus software by issuing ' SELECT * FROM AntiVirusProduct ' .", "98": "This serves to avoid raising suspicion of a forensic analysts or tools .", "99": "As a means of persistence the dropper creates an entry under [ HKLM| HKCU]\\ ... \\CurrentVersion\\Run which points to the dropped netmgr.exe binary .", "100": "This ensures that netmgr.exe will be executed every time the system boots .", "101": "Furthermore , the dropper generates another entry in the Windows registry , under [ HKLM| HKCU]\\Software\\Microsoft\\IPSec .", "102": "This key will be requested by netmgr.exe later to locate the dropper binary and delete it .", "103": "The Lua scripts can call back into the C++ code to alter the malware behavior at runtime .", "104": "The malware seeks to keep a low profile on the infected machine , while executing the botmaster 's commands and Lua scripts .", "105": "Also , the malware will generate numerous files to help its execution and frequently reply back to the C&C with status messages .", "106": "Only few anti - analysis measures can be found in the binary .", "107": "Another evasion trick implemented by the malware is the partial obfuscation of API names .", "108": "Similar to its dropper , suspect # 4 enumerates the system 's installed AntiVirus product and checks firewall settings .", "109": "It will later either be exfiltrated to a C&C server directly or dumped to a local file on disk .", "110": "After start - up the malware aims to inject itself to an svchost.exe process .", "111": "For stealthiness the malware can either inject itself as a remote thread to a running svchost.exe process or perform the same procedure on a newly created one .", "112": "As a singular means of persistence the malware relies on the auto - start registry key created by its dropper under [ HKLM|HKCU]\\ ... \\CurrentVersion\\Run , which will start netmgr.exe on every system boot .", "113": "Also , the payload retrieves the dropper 's path from ' isakmpAutoNegociate ' under [ HKLM| HKCU]\\Software\\Microsoft\\IPSec , then deletes the binary and the ' isakmpAutoNegociate ' registry key .", "114": "After the configuration is retrieved from the resource section the malware will create a subkey for every parameter under [ HKLM|HKCU]\\Software\\Microsoft\\IPSec .", "115": "This key has initially been created by the dropper .", "116": "The worker threads are dedicated to receive commands and scripts through different ways .", "117": "Next to that , the main thread also runs sub threads to maintain log files the malware creates at during execution and to keep track of the overall system load the malware creates .", "118": "A dedicated thread is present for monitoring the CPU load the malware itself generates .", "119": "The hearer thread 's purpose is to receive instructions from the remote servers and provide them to the main thread .", "120": "Hearer 1 receives commands and Lua scripts directly via HTTP from one of the C&C servers .", "121": "If found , the thread will read its content in chunks representing different commands and paste these to net.cap3 .", "122": "No functionality could be found in the malware code to write to netdump.db , which leaves the conclusion that this file will be downloaded from a C&C server .", "123": "These mainly serve the purpose of controlling operation of the bot on the infected machine , such as restarting threads or setting configuration parameters .", "124": "The initial command , the status line and a current time stamp are encrypted and sent back to the C&C server .", "125": "Additionally , the same data is written to the Perflib_Perfdat_dmpbX.dat file which is regularly pushed to the C&C by the backfile thread .", "126": "These files survive restart or cleanup , so every time the malware boots it reads the current status from these logs and continues from the latest value .", "127": "After starting the Lua thread requests a value from Windows registry named ' EnableLua ' under SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System .", "128": "Like command execution , Lua script execution also returns a status message which is extended by a time stamp and forwarded to one of the C&C servers , as well as written to the backfile log in Perflib_Perfdat_dmpbX.dat .", "129": "Likewise , the Lua threads log their activity to Perflib_Perfdata_41X.dat/42X.dat .", "130": "G Data Red Paper February 2014 : Uroburos G Data Red Paper February 2014 : Uroburos G Data Security experts have analyzed a very complex and sophisticated piece of malware , designed to steal confidential data .", "131": "The rootkit is able to take control of an infected machine , execute arbitrary commands and hide system activities .", "132": "It can steal information ( most notably : files ) and it is also able to capture network traffic .", "133": "Uroburos is designed to work in peer - to - peer mode , meaning that infected machines communicate among each other , commanded by the remote attackers .", "134": "By commanding one infected machine that has Internet connection , the malware is able to infect further machines within the network , even the ones without Internet connection .", "135": "It can spy on each and every infected machine and manages to send the exfiltrated information back to the attackers , by relaying this exfiltrated data through infected machines to one machine with Internet connection .", "136": "The service is located in The driver is needed to A rootkit naturally tries to hide its activities from the user and so does Uroburos .", "137": "The purpose of this feature is to generate a snapshot of the network traffic .", "138": "\uf0b1 HTTP protocol the attackers can choose to use a website to exfiltrate data .", "139": "Finally , machine ( B ) is able to pass on all data received from machine ( A ) to the Internet .", "140": "EquationDrug is one of the main espionage platforms used by the Equation Group ] , a highly sophisticated threat actor that has been engaged in multiple CNE ( computer network exploitation ) operations dating back to 2001 , and perhaps as early as 1996 .", "141": "EquationDrug represents the main espionage platform from the # EquationAPT Group Tweet[3 ] It 's important to note that EquationDrug is not just a Trojan , but a full espionage platform , which includes a framework for conducting cyberespionage activities by deploying specific modules on the machines of selected victims .", "142": "The EquationDrug platform can be extended through plugins ( or modules ) .", "143": "It is pre - built with a default set of plugins supporting a number of basic cyberespionage functions .", "144": "These include common features such as file collection and the making of screenshots .", "145": "Sophistication is added by storing stolen data inside a custom - encrypted virtual file system before it is sent to the command and control servers .", "146": "Most of this information is carefully protected with obfuscation or encryption algorithms to prevent quick recognition , but anyone who breaks through this layer of encryption may discover some interesting internal strings , as demonstrated below .", "147": "Some code paths in EquationDrug modules lead to OS version checks including a test for Windows 95 , which is accepted as one of supported platforms .", "148": "This procedure will be called when CPU is running in ring-3 mode , so that a new executable ( loader process ) can be started via the traditional way .", "149": "Kernel mode stage 0 and rootkit ( Windows 2000 and above ) - msndsrv.sys MD5 c4f8671c1f00dab30f5f88d684af1927 Size 105 392 bytes Format PE32 Native Compiled 2008.01.23 14:12:33 ( GMT ) Location % System32%\\drivers\\msndsrv.sys This module can create log files in the following known locations .", "150": "The rootkit code in the driver hooks several Native API functions that lets it hide or protect registry keys , files and running processes .", "151": "The driver also maintains a persistent list of protected objects that is stored in the following registry values .", "152": "The module uses a unique algorithm for generating registry value names .", "153": "The module attempts to start the \" shell \" process in suspended mode .", "154": "Next , the module injects extra code into a newly started target process .", "155": "The injected code loads the payload DLL ( \" mscfg32.dll \" ) into the target process and waits for the parent process to exit .", "156": "Stage : DWORD | DateTimeLow : DWORD | DateTimeHigh : DWORD Basically , it logs the execution of every stage of the orchestrator and the time of execution .", "157": "The module checks the OS version and if it encounters an unsupported operating system the code generates an exception which terminates the application .", "158": "If the module runs on Win9x , it executes Win9x - specific function RegisterServiceProcess to hide from the Windows Task Manager application .", "159": "EquationDrug Plugins : Additional components Unilay . DLL This module provides a compatibility layer for accessing system API functions for Windows 9x .", "160": "InternalName : ATMDKDRV.SYS Creates a file storage \" \\SystemRoot\\fonts\\vgafixa1.fon \" .", "161": "The sniffer code is similar to the one used in the driver 's \" tdip.sys \" and \" mstcp32.sys \" and uses NT4 NDIS-4 , XP NDIS-5 interfaces , targeting incoming traffic on Ethernet and VPN ( ndiswanip ) interfaces .", "162": "When the module starts , it reads registry value [ HKLM\\System\\CurrentControlSet\\Services\\%driver name% ] Processes .", "163": "The injection of code into winlogon.exe and services.exe ensures that the newly started process will have SYSTEM user privileges .", "164": "FileVersion : 5.1.2600.2180 InternalName : tdip.sys This driver is a packet sniffer for incoming - only traffic on Ethernet and VPN ( ndiswanip ) interfaces or any used with ms_pschedmp as an alternative connection .", "165": "InternalName : msrtvd.sys This is a keylogger and clipboard monitoring tool .", "166": "These routines are able to collect key press chains and clipboard text data , add information about current Time , ProcessName , ForegroundWindowText , and UserName related to this event .", "167": "A dedicated thread ( \" dumper \" ) gathers the collected data , compresses the results with LZO appends it every 30 minutes to a file \" % system - wide TEMP%\\tm154o.da \" .", "168": "Most strings inside are encrypted by XOR with a pre - seeded random number generator .", "169": "Targeted computers The attackers focused on obtaining access to specific systems of interest in all of the compromised organizations .", "170": "Once the attackers had this access , they presumably then eavesdropped on email conversations and may have been in a position to potentially insert fraudulent emails as well .", "171": "Based on our analysis of a command - and - control ( C&C ) server used in an attack , the Butterfly operators demonstrate exceptional operational security , as they use encrypted virtual machines and multi - staged C&C servers to make it difficult to investigate their activities .", "172": "Bda9.tmp was then executed and went on to create a variant of Backdoor . Jiripbot with the file name LiveUpdate.exe .", "173": "Spreading In at least two incidents , the attackers appear to have taken advantage of internal systems to spread through a network once they gained initial access .", "174": "In one instance , the attackers used a Citrix profile management application to create a back door on a newly infected system .", "175": "In the second incident , the TeamViewer application was used to create copies of Backdoor . Jiripbot on the compromised computers .", "176": "In these cases , the attackers likely determined that the infected computers were not valuable targets and used shred.exe to securely remove the infections .", "177": "It hides activity by editing events logs , dumping passwords , securely deleting files , encrypting files , and performing basic network enumeration .", "178": "Hacktool . Eventlog Hacktool . Eventlog is another multipurpose tool , but its primary functionality is to parse event logs , dumping out ones of interest , and to delete entries .", "179": "The tool will also end processes and perform a secure self - delete .", "180": "Hacktool . Proxy . A Hacktool . Proxy . A creates a proxy connection that allows attackers to route traffic through an intermediary node onto their destination node .", "181": "Similarly , event logs are modified to remove any evidence of the attackers ' activity .", "182": "Using both techniques , the attackers can securely remove infections from computers that are of no interest , letting them avoid leaving any trace of activity .", "183": "It also looks for certain process names of running processes .", "184": "It checks that the hashed value of the registry subkey HKEY_LOCAL_MACHINE\\Microsoft\\WindowsNT\\ CurrentVersion\\ProductId is not equal to a number of hashed values .", "185": "This campaign infected victims with Sakula malware variants that were signed with stolen certificates .", "186": "When this file was executed , it caused the victim to view a website by using the ShellExecute ( ) API to open a URL .", "187": "[ 1 ] The Sakula malware in this campaign utilized the Dynamic Link Library ( DLL ) side - loading technique most commonly associated with PlugX activity .", "188": "In the aforementioned university - related incidents , a legitimate executable named MediaSoft.exe ( MD5 hash : d00b3169f45e74bb22a1cd684341b14a ) loaded a file na msi.dll ( MD5 hash : ae6f33f6cdc25dc4bda24b2bccff79fe ) , which , in turn , was used to load the Sakula executable ( MD5 hash : 0c2674c3a97c53082187d930efb645c2 ) .", "189": "All incidents in this campaign were similar in that they utilized malicious droppers masquerading as installers for legitimate software applications like Adobe Reader , Juniper VPN , and Microsoft ActiveX Control .", "190": "In addition , the droppers all directed victims to login pages for services specific to the target organization like webmail , document sharing , or corporate VPN .", "191": "In all cases except one , the victims were directed to legitimate login pages .", "192": "The one exception was a case in which victims were sent to a login page hosted on a domain that spoofed that of the legitimate one .", "193": "It is unclear whether redirecting victims to these login pages was part of credential - collection activity or merely meant to deceive victims into believing that the activity was legitimate .", "194": "It dropped the side - loaded Sakula malware just like in the other incidents ; however , in this instance , the Sakula payload was signed with a certificate assigned to a different organization , Career Credit Co. , Ltd.", "195": "The compromised devices are used to steal unencrypted network traffic and offer proxying services to the botnet operator .", "196": "In practice , these capabilities are used to steal HTTP Cookies on popular social network sites and perform fraudulent actions such as non - legitimate \" follows \" , \" views \" and \" likes \" on such sites .", "197": "Most of these threads are used to attempt find and infect other devices automatically .", "198": "Moose also has DNS hijacking capabilities and will kill the processes of other malware families competing for the limited resources offered by the infected embedded system .", "199": "Linux / Moose will periodically communicate with a set of command and control servers ( C&C ) that are hardcoded into the malware itself .", "200": "The randomly picked C&C server , henceforth the configuration C&C server , will provide configuration information that will affect the behavior of the malware .", "201": "First , analysis of the configuration indicated that the data that the bot is trying to steal is HTTP cookies from popular social networks .", "202": "For instance : upon launch , the malware checks whether the file /home / hik / start.sh exists on disk .", "203": "At this point the rogue DNS servers can point legitimate sites to phishing sites , inject malware in downloaded files , or perform man - in - the - middle attacks that would prevent upgrades to HTTPS by websites .", "204": "String obfuscation with C&C servers Before we move on to describe the individual components , there is one thing that is common between many of the components : The obfuscation that is applied to the strings sent through the network .", "205": "After configuration , three sets of threads are created that are related to the spreading mechanism : threads scanning random IP addresses , threads scanning closely related IP addresses , and threads created per network interface to scan these otherwise unreachable networks .", "206": "First , it checks going to see if it can connect on TCP port 10073 .", "207": "If it can perform a full TCP handshake , it will disconnect right away and considers that the host is already infected and will report it as such to the report C&C server .", "208": "It will attempt to bruteforce the login prompt ( if any ) with a username and password combination list it received from the configuration C&C server .", "209": "On a successful guess , it will report the intrusion to the report C&C server , then attempt to get a command prompt on the device .", "210": "First stage After the C&C reply , Moose continues with infection , executing commands on the victim device .", "211": "At this point , Moose has not yet infected its new victim .", "212": "It will then send a message to the report C&C server with what it has learned so far about the target victim .", "213": "Bit field about the infection state The report C&C server responds with obfuscated commands to execute on the victim .", "214": "# echo -n -e \" \\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x5c\\xe9\\x01\\x00\\x56\\x00\\ > \\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00 \" > > / dev / elan2 # chmod + x /dev / elan2 # /dev / elan2 Sys init : OK Status : OK No matter the method , by that point the victim has been infected : it will reach the configuration C&C server , obtain its configuration parameters , and start its nefarious activities .", "215": "This means that traffic intended for a certain specified address may be redirected to another , entirely unrelated address .", "216": "Scanning close to home As we mentioned earlier , the configuration C&C server returns the public IP address it saw when it was contacted by the infected router .", "217": "This can effectively bypass firewalls on the perimeter and allow the worm to spread further copies of itself .", "218": "This enables the worm to spread inside Local Area Networks ( LANs ) that are not normally accessible from the Internet due to the use of firewalls and network address translation ( NAT ) .", "219": "One of the first thing Linux / Moose does is to start listening on TCP port 10073 for incoming connections .", "220": "As was previously discussed , this server is used by the bot to assess whether a system is infected .", "221": "When some Linux / Moose scanner thread reaches an opened 10073 port , it will result in a TCP handshake without a data payload .", "222": "After the initial handshake , traffic is sent transparently back and forth between the client of the infected service and the specified host .", "223": "Linux / Moose is able to eavesdrop on traffic going through affected devices .", "224": "It creates a raw socket , sets the interface in promiscuous mode , then loops on a recvfrom as depicted below .", "225": "Once a match is found , the whole packet including its Ethernet , IP , TCP headers and payload is sent , obfuscated , to the report C&C server .", "226": "Moose is a combative animal .", "227": "Going through this list , it will send a kill signal to any process that matches any of the blacklisted strings .", "228": "The only difference between the two exchanges is that they update different variables in the client .", "229": "However almost all of the data is still sent by the C&C .", "230": "Bit field about the bot details The server replies with the configuration for the malware .", "231": "Once it has reached its target , the payload used was designed to work as an information stealer and reconnaissance tool .", "232": "its technical features the available commands ( classic ones , such as visiting a website using the infected bot , download and execute a command or a library , update and uninstall ) the plugins one can use : file stealer , ad - clicker , form grabber , \u2026 The command \" visiting a website \" using the infected bot could be used by the attackers as an entry point for blackmailing the infected user .", "233": "Feature : \" Anti - VM \" The flyer explains that the botnet wo n't work in a virtual machine .", "234": "To detect whether the malware is running in a virtual machine , the malware author checks if the following directories and the one file exist .", "235": "Feature : \" Process & registry persistence \" The malware persistence uses a registry key in order to be executed automatically in case the system is rebooted .", "236": "Feature : \" Download & Execute \" , the next Step This feature allows installing further malware on the affected PC in case the attackers decide the current machine is interesting enough .", "237": "It is designed to provide an effective ( almost \" invisible \" ) persistence mechanism , hidden storage and malicious command execution inside the Windows operating system .", "238": "When the computer starts , GrayFish hijacks the OS loading mechanisms by injecting its code into the boot record .", "239": "If an error happens during launch , the entire GrayFish platform self - destructs .", "240": "To store stolen information , as well as its own auxiliary information , GrayFish implements its own encrypted Virtual File System ( VFS ) inside the Windows registry .", "241": "The GrayFish implementation appears to have been designed to make it invisible to antivirus products .", "242": "When used together with the bootkit , all the modules as well as the stolen data are stored in encrypted form in the registry and dynamically decrypted and executed .", "243": "If it infects a computer without an internet connection , it will collect basic system information and save it onto the hidden area of the stick .", "244": "Later , when a stick containing hidden information is plugged into an internet - connected computer infected by Fanny , the data will be scooped up from the hidden area and sent to the C&C .", "245": "If the attackers want to run commands on the air - gapped networks , they can save these commands in the hidden area of the USB stick .", "246": "The compromised CD - ROM used \" autorun.inf \" to execute an installer that began by attempting to escalate privileges using two known EQUATION group exploits .", "247": "Next , it attempted to run the group 's DOUBLEFANTASY implant and install it onto the victim 's machine .", "248": "This is the ability to infect the hard drive firmware .", "249": "The plugin supports two main functions : reprogramming the HDD firmware with a custom payload from the EQUATION group , and providing an API into a set of hidden sectors ( or data storage ) of the hard drive .", "250": "Here are some web - based targeting examples from the Equation group : On March 2 , 2013 , a Kaspersky Lab user browsing an online forum was attacked with an exploit from one of the Equation group 's exploitation servers .", "251": "The forums in question appear to have been compromised by a specific PHP script that exploited only authenticated visitors .", "252": "The exploit site can choose to hit the visitor with an exploit depending on the username , meaning that the attackers are taking great care to infect only very specific targets on these forums .", "253": "This was taken to further extreme in GRAYFISH , which exclusively uses the registry to store all malware - related modules and data in encrypted format .", "254": "The GRAYFISH bootkit starts from the VBR , loads the operating system and hijacks the loading of the first driver in the kernel .", "255": "Finally , in terms of advanced features , GRAYFISH and EQUATIONDRUG include perhaps the most sophisticated persistence mechanism we 've ever seen : re - flashing the HDD firmware ."}