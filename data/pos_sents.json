{"0": "All three samples provided remote access to the attacker , via two Command and Control ( C2 ) servers .", "1": "One sample is typical of what is commonly referred to as a 'dropper ' because its primary purpose is to write a malicious component to disk and connect it to the targeted hosts operating system .", "2": "The malicious component in this case is what is commonly referred to as a Remote Access Tool ( RAT ) , this RAT is manifested as a Dynamic Link Library ( DLL ) installed as a service .", "3": "The second sample analyzed is a dual use tool that can function both as a post exploitation tool used to infect other systems , download additional tools , remove log data , and itself be used as a backdoor .", "4": "The third sample was a sophisticated implant that in addition to having multiple communication capabilities , and the ability to act as a relay for other infected hosts , utilized a kernel mode driver that can hide aspects of the tool from user-mode tools .", "5": "This third component is likely used for long-term implantation and intelligence gathering .", "6": "The executable 14c04f88dc97aef3e9b516ef208a2bf5 is commonly referred to as a 'dropper ' , which is designed with the purpose of extracting from itself a malicious payload and to initialize and install it into a targeted system .", "7": "In this case , the malicious payload is a Dynamic-Link Library ( DLL ) , which enables an attacker to have full control of the system .", "8": "The sample first resolves several library functions provided by Microsoft using the LoadLibrary ( ) and GetProcAddress ( ) Application Programming Interfaces ( APIs ) .", "9": "The imported function names are not encrypted ; however , the function name is minutely obfuscated by a simple single character substitution : The dropper invokes the SHGetSpecialFolderPath ( ) API supplying a Constant Special Item ID List ( CSIDL ) of 'CSIDLCOMMONDOCUMENTS ' to identify the destination folder for the malicious DLL payload .", "10": "'' The dropper attempts to write the malicious payload to one of the following names , using the first available name in this set : The dropper sets the creation and last written timestamp of the newly created file to the date 2007-03-07 00:00:00 ; this allows the newly created malicious DLL to blend in with other system files .", "11": "This is meant to prevent identification during disk forensics using a common investigative technique called a forensic analysis timeline .", "12": "The malicious DLL file that is dropped is hidden in a resource of the dropper binary .", "13": "When the dropper writes the file to disk , the first byte of the file is 'Z ' which prevents the file from executing or being detected as an executable by many defensive tools .", "14": "The dropper subsequently opens the dropped file and corrects the header by writing the 'M ' over the first byte , allowing the file to be executed .", "15": "The final step the dropper performs is to load the dropped DLL into its own process space ; it then resolves the export 'OpenINFOPerformanceData ' from the DLL and invokes it with the dropped DLL 's filename as parameter .", "16": "This export then implements the actual install logic to maintain persistence and invoke the main routine .", "17": "The use of the Chrome icon may indicate a possible attempt to socially engineer the intended victim into thinking the dropper was a legitimate file associated with Google .", "18": "This sample is a 'backdoor ' which is the DLL dropped by the dropper sample file with an MD5 of 14c04f88dc97aef3e9b516ef208a2bf5 .", "19": "It is instantiated when it is mapped into the process space of its dropped file , and its ' export named 'OpenINFOPerformanceData ' is called .", "20": "If the service is present , the malware replaces its previous instances or versions of this backdoor .", "21": "After attempting to disable the existing service , the malware tries to install itself as a service with that same name .", "22": "During installation , the sample attempts to use documented APIs such as OpenSCManager ( ) and CreateService ( ) to initialize itself as a persistent Windows service .", "23": "As a precaution , the sample writes settings directly to the Windows Registry to accomplish the same goal if installing the service with the documented APIs fails .", "24": "The registry change creates the following key : Following this , the subroutine will set the value of the 'ServiceDLL ' to the module handle of the DLL .", "25": "The next key to be changed is : HKEYLOCALMACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Svchost , which will have the 'msupdate ' key set to 'msupdate ' .", "26": "The export 'CollectW3PerfData ' is registered as the main function of the DLL .", "27": "If the installation of the new service is successful , the sample then starts the new service and exits .", "28": "If the installation fails , the sample spawns a new process using rundll32.exe , this executable will instantiate the DLL and can call a specific exported function .", "29": "The rundll32.exe is instantiated with a new NULL Security Identifier ( SID ) ( S-1-0-0 ) with permissions set to grant all access to the file .", "30": "This allows any user to have complete control over the machine , as rundll32.exe is frequently launched by tasks such as changing the time , wallpaper , or other system settings .", "31": "This means that after cleaning up the components dropped by the malware , the system remains vulnerable to local attacks by simply overwriting the legitimate rundll32.exe executable with a malicious version and await it 's automatic execution by the Operating System .", "32": "This may be an attempt to fool some automated dynamic analysis or anti-malware software into believing this is the legitimate ESET AV software .", "33": "After creating this window , the routine starts the main thread that eventually initiates calling out to the Command and Control ( C2 ) .", "34": "Once the proper API 's have been resolved , the sample then assigns a NULL SID to the rundll32.exe executable and sets the current process ' Window Station to '' winsta0 '' , which enables the sample to access the real user 's desktop if started as service .", "35": "The communication to the C2 is handled by a while ( ) loop , with each successive connection attempt causing the loop to invoke the Windows Sleep ( ) API for a time interval of 2 seconds , exponentially increasing in length up to 1024 seconds ( 17 minutes ) and then restarting back to 2 seconds .", "36": "Thus the sample will only attempt to connect directly using a raw socket to the C2 located at 1.9.5.38:443 .", "37": "The malicious sample sends an initial beacon to the C2 that includes the following information : The beacon is encrypted using an XOR/ADD loop using the statically defined key 0x1C and sent to the C2 .", "38": "The following python function can be used to decode the beacon stings : After sending the initial beacon , the routine loops receiving incoming commands and executes them in sequence .", "39": "This inbound payload is received unconditionally and regardless of command type into a fixed-size stack buffer of 408 bytes size .", "40": "The primary aim of this backdoor is remote desktop control functionality comparable to VNC or Remote Desktop over a custom protocol .", "41": "It allows the adversary to view the main desktop graphically and control the keyboard and mouse .", "42": "This remote control functionality is implemented as separate messages for mouse clicks , pressed keys , etc .", "43": "using command identifiers 0x20000002 to 0x20000019 .", "44": "The command 0x22000001 initiates continuous transmission of screen captures to the C2 .", "45": "The screen captures are created using a series of Microsoft Windows Graphic Device Interface ( GDI ) API calls culminating in a call to GetDIBits ( ) .", "46": "Command 0x20000001 exits the backdoor and 0x20000000 is issued to completely remove the backdoor from the system .", "47": "When command 0x23000004 is received , a temporary new user '' DomainUser '' with password '' Dom4 ! nU- serP4ss '' is created and added to the local Administrators group .", "48": "The backdoor is then started under that account and the user is deleted .", "49": "It would appear this technique is meant to obfuscate the activities of the malicious sample by masking the process creator 's user name to appear to be a generic domain user .", "50": "The backdoor functionality can be instantiated either directly from the command line or through commands issued over a network based protocol via the C2 .", "51": "If no arguments are given , a connection to the C2 is initiated to the stati- cally defined IP address .", "52": "The command line options support post exploitation capabilities such as changing file timestamps , forensic mitigation , privilege escalation , launching the executable , and specifying a specific C2 .", "53": "One interesting command line option allows the backdoor to filter the contents of specified files to remove content using a regular expression ( regex ) .", "54": "This command then modifies the creation , modification , and last access timestamps of the modified file to conceal the content modifications .", "55": "This activity is generally associated with log cleaning to com- plicate a forensic investigation .", "56": "There are three components to the protocol : Authentication is accomplished using a 32 byte packet , this packet consists of : An example authentication packet sent to the C2 is located in Appendix E. After sending the initial authentication packet , the sample verifies that the first four bytes of the response is equal to a statically defined value , in this sample the value is : 0x16030100 .", "57": "In addition , an 8 byte key is sent to the client which is then RC4 encrypted using the random number generated in step 2 from above as the password .", "58": "The first 16 bytes of this array are then used as the KEY and the second 16 bytes are used as the IV for setting up AES encryption which is then used to encrypt and decrypt any further communications .", "59": "The beacon for this sample is formatted as XML and consists of : An example of an unencrypted beacon : Command handling loop , this is a loop structure that will process and execute commands sent by the C2 .", "60": "The malware sends and receives a heartbeat/keepalive packet every 2 minutes .", "61": "Examples of implemented commands include download and upload files , installing new .NET assemblies , calling methods on those assemblies , connecting to new C2 servers and executing processes .", "62": "This sample is a sophisticated backdoor which implements several communications protocols and was developed in C++ .", "63": "This sample is a DLL which can be registered as a service and is used to drop a kernel driver and provide an interactive command line shell to the C2 .", "64": "It also is able to bypass User Account Control ( UAC ) to install itself by using the 'sysprep.exe ' Microsoft Windows executable provided by the targeted system .", "65": "After it copies itself , it will modify the creation time , last access time and last modification time to the current system time when the copy was made but with the year changed to 2005 .", "66": "Adds itself as a service name from the backdoor 's configuration under HKEYLOCAL MACHINE\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\ < service > '' This defaults to '' wuauserv '' , the legitimate Windows Update service , in the given binary 's default configuration .", "67": "Adds itself to list of services started by 'netsvc ' using the service name 'helpsvc ' .", "68": "If McAfee AV is installed , creates a copy of regsvr32.exe named Update.exe and then schedules the copy to be deleted on reboot using the well documented MoveFileExA API .", "69": "The sample is capable of 'dropping ' an embedded/encrypted kernel driver .", "70": "Barring the two aforementioned conditions , the sample decrypts the kernel driver to : Following the decryption and writing of the driver to disk , it is loaded using the ZwLoadDriver ( ) API .", "71": "The driv- er is encrypted with a simple four byte XOR key value of 0x2E885Df3 ; after decryption the file has the MD5 hash of dae6b9b3b8e39b08b10a51a6457444d8 .", "72": "If the current service name matches a set of pre-defined service names that legitimately exist in Windows , the backdoor then loads the original service 's DLL into the address space with LoadLibrary and invokes the ServiceMain export .", "73": "While there is code in the binary that allows downloading a list of C2 servers from an HTTP URL , the default configuration present specifies 202.86.190.3:80 as a C2 to use , this is the same Hong Kong C2 server as the one used by the post exploitation .NET", "74": "The malware has three distinct C2 protocols two of which can be transmitted over HTTP proxies and one can be bundled in two different 'dual ' modes ( see 3 .", "75": "The con- figuration contains the C2 protocol to be used or optionally a self-configuration mode in which the malware attempts the different C2 protocols in a pre-defined order .", "76": "Proprietary binary header ( optionally over an HTTP Proxy using CONNECT mechanism ) ; this protocol consists of 64 random bytes being sent to the C2 .", "77": "This one HTTP connection will be used for bi-directional communications , sending chunks of POST payload and receiving chunks of the response , interleaved .", "78": "The GET request serves as a down-stream channel while the POST request serves as a upstream channel .", "79": "Additionally , the malware contains a custom DNS client implementation that will use the system 's configured DNS server to tunnel C2 traffic over legitimate DNS .", "80": "After establishing any of the aforementioned channels for arbitrary binary data exchange , the malware will start sending and receiving compressed binary blobs via the channel of choice .", "81": "The main backdoor thread then reads commands from the chosen C2 protocol and passes them on to any of the following registered handler classes based upon a command ID .", "82": "This handler class for command ID 8 implements generic directory and file browsing using FindFirstFileW ( ) and FindNextFileW ( ) APIs , as well as reading and writing arbitrary files via C2 commands , thus enabling upload and download of arbitrary files .", "83": "This is typically seen in RATs for searching specific files to exfiltrate .", "84": "Additionally , this class implements launching of specified executable files via the CreateProcess ( ) API .", "85": "This handler class implements a generic TCP proxy .", "86": "It supports establishing TCP connections to other hosts and also listening for incoming connections .", "87": "The incoming connection contents are forwarded to the C2 and data from the C2 is passed on to connections .", "88": "The malware is capable of gathering various pieces of information from the system , triggered by a command ID 10 .", "89": "The capabilities include recovering authentication credentials from various system and client storage such as Mozilla Firefox , Internet Explorer , and Remote Access Service ( RAS ) .", "90": "This class also supports gathering intelligence on the infected system including identifying security tools by their process name , proxy accounts , and version numbers for the Operating System ( OS ) and Internet Explorer .", "91": "This handler class provides the attacker with the ability to manage system components including start / stop / delete system services , enumerate / alter registry keys , and manage running processes .", "92": "This class also provides the ability for the attacker to take a screen shot of the users desktop .", "93": "This handler class uses the command ID 5 and implements an interactive command line shell accessible from the C2 server , containing a series of built-in commands .", "94": "If the input is not in this list of built-in commands , the malware attempts to invoke cmd.exe in the background , launching a command or command line utility already present on the system .", "95": "The standard output channel of that command is provided back to the C2 .", "96": "This command results in the DLL deleting itself and terminating the backdoor process .", "97": "The driver begins by opening a named event in the BaseNamedObjects object directory with the name { 8CB2ff21-0166-4cf1-BD8F-E190BC7902DC } using the Windows API ZwOpenEvent ( ) .", "98": "If the event already exists , the driver fails to load , presumably to avoid a multiple instances of itself .", "99": "If the event does not exist , the driver then creates it using the Windows API ZwCreateEvent ( ) .", "100": "The second component of the entry point performs an anti-debugging technique , calling the function KdDisableDebugger ( ) , which allows the driver to disable usage of the built-in Windows kernel debugging facility that is used by popular kernel debuggers KD and WinDbg .", "101": "The final step of the entry point is to begin hooking the system , which is done by two helper functions - one is designed to hook the system call table , while the other hooks the network stack .", "102": "The network stack hooking first queries the OS version using RtlGetVersion ( ) or PsGetVersion ( ) .", "103": "In either case , the driver obtains the device object by using IoGetDeviceObjectPointer ( ) and hooks Major Function 14 the IRPMJDEVICECONTROL , as this is the function through which all Input Output ConTroLls ( IOCTLs ) are sent , such as the IOCTL for querying active IP connections .", "104": "The purpose of the hook is to scan the list of active connections returned to the user , and hide any such connection currently bound to a local TCP port in the range between 40000 and 45000 .", "105": "The hooking is performed by creating a new completion routine associated with any IRPMJDEVICECONTROL IRP that matches the IOCTL , attaching to the target process , performing several memory copies to hide the entry , and detaching .", "106": "The TCP hook works almost identically to the NSI hook , though instead hooking IOCTL 0x120003 ( IOCTL TCPQUERYINFORMATIONEX ) .", "107": "This hook also filters any connections listening on TCP ports in the range between 40000 and 45000 .", "108": "The unpacked kernel driver sample hooks these functions by reading the second DWORD at each of these exported functions .", "109": "The system call hook is then performed by first allocating a Memory Descriptor List ( MDL ) using the Windows API IoAllocateMdl ( ) , and associating the MDL to a non-paged buffer using MmBuildMdlForNonPagedPool ( ) .", "110": "Instead of hooking the entry in the table directly , which is easily detectable , the driver uses the LDASM open-source disassembly engine to analyze the function that is being pointed to by the table , and applying a Detours-style hook directly in the code .", "111": "It then checks for the values of the '' ServiceDll '' and '' Security '' keys , in the latter case it applies an XOR on the data with the value 127 .", "112": "The user-mode component of this malware is a service called '' msupdate '' , this driver is attempting to hide the service .", "113": "In the registry hooking code of the driver , a call is made to ObReferenceObjectByHandle ( ) .", "114": "This is particularly relevant in this case because the backdoor DLL sample with an MD5 of de7500fc1065a081180841f32f06a537 specifically avoids installing the kernel driver on a system running this tool .", "115": "While the various network hooking techniques used in the kernel driver may appear novel or well researched , upon close inspection it is actually a line-for-line copy of an existing post from the now-offline 'rootkit.com ' by a Chinese language developer .", "116": "com/showthread.php ? t=77467 perform system call hooking through MDLs .", "117": "Open source research of the 4 innocuous kernel APIs '' ZwSaveKey ZwQueryValueKey ZwEnumerateValueKey IoAllocateMdl '' , in concert leads directly to a Chinese website that has a cached rootkit performing similar hooks on the same 3 registry related APIs .", "118": "The dropped DLL ( MD5 : 47619fca20895abc83807321cbb80a3d ) itself contains functionality that is typical of a Remote Access Tool ( RAT ) which are commonly used by PRC based actors in data exfiltration attacks .", "119": "The post exploitation tool ( MD5 : 2dce7fc3f52a692d8a84a0c182519133 ) is a dual-use tool , it can be dropped and executed by a client-side exploit , or the adversary can launch it using a variety of command line options .", "120": "The sample utilizes the AES cryptographic algorithm to protect its C2 communications .", "121": "This DLL is a moderately sophisticated backdoor with several well designed communication mechanisms not typically seen in these types of implants .", "122": "This sample has multiple communication capabilities available that makes it far more versatile and stealthy .", "123": "It implements relatively well thought out protocols including HTTP and DNS .", "124": "The tool has the ability to automatically down select the most effective communication channel once it has been instantiated , which can help avoid detection from solutions like DNS blacklisting and RFC protocol enforcement .", "125": "The sample supports the ability to act as a generic proxy , this may be intended to proxy C2 traffic for other infected machines in order to minimize the number of systems communicating to the C2 , thus enhancing OPSEC .", "126": "The sample contains 'dead code ' which appears to be command and control server classes , this is likely an indicator that the C2 client which would communicate with this sample shares the same communications library which was compiled into this sample .", "127": "The kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the CCRootkit package publicly by Steven Lai ( a/k/a embedlinux ) .", "128": "This kernel mode rootkit implements several hooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL .", "129": "This driver attempts to hide a wide swath of TCP ports ( 40000-45000 ) for an unknown reason , however it is suspected that this may relate to the potential network relaying capability alluded to for the backdoor dll .", "130": "The kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the CCRootkit package publicly by Steven Lai ( a/k/a embedlinux ) .", "131": "This kernel mode rootkit implements several hooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL .", "132": "This driver attempts to hide a wide swath of TCP ports ( 40000-45000 ) for an unknown reason , however it is suspected that this may relate to the potential network relaying capability alluded to for the backdoor dll .", "133": "The compromised websites contained an iframe to direct site visitors to a threat actor-controlled IP address that dropped a Poison Ivy remote access tool ( RAT ) onto victims ' systems .", "134": "The group was able to compromise these websites and insert malicious iframes .", "135": "The threat group obfuscated the iframe on two of the compromised websites .", "136": "The iframes on these websites directed visitors to Java exploits hosted at 103.27.108.45 .", "137": "In turn , these exploits downloaded and decoded a payload hosted at : hxxp : //103.27.108.45/img/js.php .", "138": "It had the following properties : The backdoor also contained the below versioning info embedded in the RTVERSION of one of the PE resources : This versioning info attempted to masquerade as a Google Chrome file .", "139": "The Poison Ivy implant had the following configuration properties : The C2 domain quakegoogle.servequake [ . ] com resolved to 115.126.62.100 at the time of the SWCs .", "140": "Other domains resolving to the same IP include the following : Between August 30 , 2014 and September 16 , 2014 we also observed SOGU ( aka Kaba ) callback traffic sent to assign.ddnsking.com over port 443 .", "141": "The attackers were able to compromise the website and include code that loaded a malicious Javascript file from a remote server .", "142": "This Javascript file is a framework for reconnaissance that the attackers call '' Scanbox '' and includes some of the techniques we described in a previous blog post : The Scanbox framework first configures the remote C & C server that it will use and collects a small amount of information about the victim that is visiting the compromised website including : Resulting in something like this : Before sending the information to the C & C server , Scanbox encodes and encrypts the data with the following function : Producing the following request : If we decrypt the data it translates to : After the first request , the framework contains several plugins to extract different information from the victim .", "143": "While the user is browsing the compromised website , all keystrokes are being recorded and sent to the C & C periodically .", "144": "It will also send keystrokes when the user submits web forms that can potentially include passwords and other sensitive data .", "145": "This kind of attack pattern disguising as non - malicious real file in the host of its target , it sending a network heartbeat package every 60 seconds , and it also send data information via the Cookie field , all these features of this attack pattern are designed to evade the detection of security software and the interception of firewall on the targeted host .", "146": "The core step of APT - TOCS is downloading the script functionalities of Shellcode , which downloads a field of data into memory for operation by calling powershell.exe.The decrypted data is a field of executable Shellcode that is generated by Cobalt Strike ( An automatic attack testing platform ) .", "147": "2.1 Leading files and sample downloading APT - TOCS used \" powershell.exe \" to execute Shellcode scripts to realize remote control on targeted system .", "148": "The functionality of this part is : decrypting data with base64 encryption and getting module 1 , then writing to process powershell.exe , and executing and operating .", "149": "Judging from the module strings and the system functions , the module belongs to backdoor program that can send GET request to designated addresses and heartbeat packages by using Cookie fields with 60 seconds ' interval .", "150": "Here we can see both of them use Cookie to transmit that has been encrypted , and send requests actively every 60 seconds .", "151": "The data package is heartbeat .", "152": "3.4 Characteristics of Cobalt Strike Using Cobalt Strike attack can execute various operations in the targeted systems , such as downloading and uploading files , executing designated programs , injecting keyboard recorder , executing commands via PowerShell , importing PowerShell script , executing commands via CMD , accessing system passwords and so on .", "153": "With an automated test platform Cobalt Strike , the attack penetration can penetrate firewall , the approach the attackers used to control targeted host is covert and undetectable ; what 's more , it can attack various platforms , such as Windows , Linux , Mac etc . ; it 's formidable adversary to Trusted Computing , Cloud Detection , Sandbox Detection and so on .", "154": "The reason why the CERT Analysis Team of ANTIY classified APT - TOCS into APT incidents is that it 's a kind of targeted attack ( one of the features of APT attack ) , it has anti - detection functions and also it can conceal itself .", "155": "This implant connected to a C2 node that overlapped with prennera[.]com .", "156": "They steal data by configuring their implants to send data out of the network using a victim network 's mail server .", "157": "\u2022 Several of APT28 's malware samples contain counter- analysis capabilities including runtime checks to identify an analysis environment , obfuscated strings unpacked at runtime , and the inclusion of unused machine instructions to slow analysis .", "158": "APT28 uses spearphishing emails to target its victims , a common tactic in which the threat group crafts its emails to mention specific topics ( lures ) relevant to recipients .", "159": "Since 2011 , APT28 has used lures written in Georgian that are probably intended to target Georgian government agencies or citizens .", "160": "In one case , we identified an APT28 lure from mid-2013 that referenced MIA-related topics and employed malware that attempted to disguise its activity as legitimate MIA email traffic .", "161": "The lure consisted of a weaponized Excel file that presented a decoy document containing a list of Georgian driver 's license numbers .", "162": "The backdoor attempted to establish a connection to a Georgian MIA mail server and communicate via MIA email addresses ending with '' @ mia.ge.gov '' .", "163": "Once connected to the mail server , APT28 's backdoor sent an email message using a subject line related to driver's licenses ( in Georgian ) , and attached a file containing system reconnaissance information .", "164": "This tactic could allow APT28 to obtain data from the MIA 's network through a less-monitored route , limiting the MIA network security department 's abilities to detect the traffic .", "165": "In the second example of MIA targeting , an APT28 lure used an information technology-themed decoy document that included references to the Windows domain '' MIA Users\\Ortachala\u2026 '' ( Figure 1 ) .", "166": "The decoy document also contains metadata listing '' MIA '' as the company name and '' Beka Nozadze '' as an author , a possible reference to a system administrator in Tbilisi .", "167": "The text of the document purports to provide domain and user group setup information for internal Windows XP and Windows 7 systems .", "168": "APT28 possibly crafted this document to appear legitimate to all MIA system users and intended to breach the MIA network specifically using the embedded malware .", "169": "APT28 used a lure document that installed a SOURFACE downloader ( further discussed in the Malware section ) and contained a listing of birthdays for members of a working group between the Georgian MOD and the U.S. defense contractor .", "170": "Another one of APT28 's lures appeared to target a specific journalist covering issues in the Caucasus region .", "171": "In late 2013 , APT28 used a lure that contained a letter addressing a journalist by his first name and claiming to originate from a '' Chief Coordinator '' in Reason Magazine's '' Caucasian Issues Department '' - a division that does not appear to exist .", "172": "In the background , the decoy document installed a SOURFACE backdoor on the victim 's system .", "173": "We have seen APT28 register at least two domains mimicking the domains of legitimate organizations in the Caucasus , as shown in the table below .", "174": "One APT28 domain imitated a key Chechen-focused news website , while the other appeared to target members of the Armenian military by hosting a fake login page .", "175": "\u2022 More recently , in August 2014 APT28 used a lure ( Figure 3 ) about hostilities surrounding a Malaysia Airlines flight downed in Ukraine in a probable attempt to compromise the Polish government .", "176": "A SOURFACE sample employed in the same Malaysia Airlines lure was referenced by a Polish computer security company in a blog post .", "177": "APT28 has registered domains similar to those of legitimate Eastern European news sites and governments , listed in Table 2 .", "178": "In addition , APT28 used one domain for command and control sessions ( baltichost [ . ] org ) that was themed after the Baltic Host exercises .", "179": "Several of the domains APT28 registered imitated NATO domain names , including those of NATO Special Operations Headquarters and the NATO Future Forces Exhibition .", "180": "We identified an APT28 lure containing a decoy document with a list of British officers and U.S. and Canadian military attach\u00e9s in London .", "181": "Finally , APT28 used a lure that contained an apparent non-public listing of contact information for defense attach\u00e9s in the '' Ankara Military Attach\u00e9 Corps ( AMAC ) , '' which appears to be a professional organization of defense attach\u00e9s in Turkey .", "182": "Some of the APT28- registered domains imitated those of defense events held in Europe , such as the Farnborough Airshow 2014 , EuroNaval 2014 , EUROSATORY 2014 , and the Counter Terror Expo .", "183": "In September 2014 , APT28 registered a domain ( smigroup- online.co [ . ] uk ) that appeared to mimic that for the SMi Group , a company that plans events for the '' Defence , Security , Energy , Utilities , Finance and Pharmaceutical sectors .", "184": "Some of APT28 's more commonly used tools are the SOURFACE downloader , its second stage backdoor EVILTOSS , and a modular family of implants that we call CHOPSTICK .", "185": "However because we have observed the name '' Sofacy '' used to refer to APT28 malware generally ( to include the SOURFACE dropper , EVILTOSS , CHOPSTICK , and the credential harvester OLDBAIT ) , we are using the name SOURFACE to precisely refer to a specific downloader .", "186": "This downloader obtains a second-stage backdoor from a C2 server .", "187": "\u2022 EVILTOSS : This backdoor has been delivered through the SOURFACE downloader to gain system access for reconnaissance , monitoring , credential theft , and shellcode execution .", "188": "We have also noted that APT28 tailors implants to their target environments , configuring them to use local network resources such as email servers .", "189": "APT28 has attempted to obfuscate their code and implement counter-analysis techniques : \u2022 One of the latest samples of CORESHELL includes counter-reverse engineering tactics via unused machine instructions .", "190": "This would hinder static analysis of CORESHELL behavior by creating a large amount of unnecessary noise in the disassembly .", "191": "\u2022 A number of CORESHELL droppers also conduct runtime checks , attempting to determine if they are executing in an analysis environment , and if so , they do not trigger their payloads .", "192": "\u2022 Many samples across the SOURFACE/ CORESHELL , CHOPSTICK , and EVILTOSS malware families obfuscate strings that are decoded at runtime .", "193": "Two of the malware families ( SOURFACE/CORESHELL and EVILTOSS ) use the same decryption sequence and similar algorithms for string encoding and decoding .", "194": "These families encode their strings at compile time using a custom stream cipher .", "195": "\u2022 APT28 has employed RSA encryption to protect files and stolen information moved from the victim 's network to the controller .", "196": "We call SOURFACE ( samples are frequently named netids.dll ) a first stage downloader because its primary job is to retrieve a second stage payload from a C2 server .", "197": "Until 2013 , the SOURFACE downloader used hard-coded IP addresses for C2 communications , whereas the future CORESHELL samples use domains .", "198": "They may not share the same code structure , but they are related because one drops and installs the other .", "199": "The ecosystem surrounding the SOURFACE downloader frequently consists of a dropper , which installs SOURFACE .", "200": "The SOURFACE downloader then receives another dropper from its C2 server , and this second dropper installs a second stage backdoor , which is usually EVILTOSS .", "201": "However , it contains more capabilities , including the ability to provide access to the file system and registry , enumerate network resources , create processes , log keystrokes , access stored credentials , and execute shellcode .", "202": "The backdoor encrypts data that it uploads with an RSA public key .", "203": "EVILTOSS variants may use the Simple Mail Transfer Protocol ( SMTP ) to send stolen data in an attachment named '' detaluri . dat '' .", "204": "The backdoor attaches this file to a preformatted email and sends it out through a victim 's mail server .", "205": "The backdoor was installed alongside the NATO-themed decoy document depicted in Figure 8 .", "206": "The backdoor sent data via SMTP to natosmtp @ mail [ . ] ru and received its tasking via POP from natopop @ mail [ . ] ru .", "207": "During our research , we discovered that APT28 uses a backdoor developed using a modular framework .", "208": "Communications with a C2 server using HTTP .", "209": "Email sent through a specified mail server .", "210": "One CHOPSTICK v1 variant contained modules and functions for collecting keystroke logs , Microsoft Office documents , and PGP files .", "211": "The monitoring for new files of interest is performed by a '' Directory Observer '' module .", "212": "In one sample this information was intended to be sent via SMTP using a Georgian MIA mail server .", "213": "It used one of four embedded sender email addresses ( @ mia.gov.ge ) to send files via email to another email address on the same mail server .", "214": "One variant of CHOPSTICK focuses on apparent air gap / closed network capabilities by routing messages between local directories , the registry and USB drives .", "215": "They work together to gain access to their targets and steal data .", "216": "They may send spear phishing emails from a specific IP address or email address .", "217": "SOURFACE is a downloader that obtains a second stage backdoor from a C2 server .", "218": "CORESHELL uses two threads to communicate with its C2 server .", "219": "The first thread sends beacons that contain the process listing of the compromised host .", "220": "The second thread is responsible for downloading and executing stage two payloads .", "221": "Messages are sent using HTTP POST requests whose bodies contain encrypted and Base64 encoded data .", "222": "Commands from the controller to the CORESHELL implant are encrypted using another stream cipher but this time using an eight-byte key .", "223": "Commands are sent from the C2 server to the CORESHELL backdoor in HTTP responses to the POST requests .", "224": "If the command byte was 01 , 02 , or 03 the following bytes would be a DLL or EXE that would be written to disk and executed .", "225": "CHOPSTICK is a backdoor that uses a modularized , object-oriented framework written in C++ .", "226": "CHOPSTICK may communicate with external servers using SMTP or HTTP .", "227": "The first time CHOPSTICK is executed , it may encrypt and store configuration data in the Registry key HKU\\S-1-5-19Classes\\Software\\Microsoft\\MediaPlayer\\ { E6696105-E63E-4EF1-939E- 15DDD83B669A } \\chnnl .", "228": "The configuration block is encrypted using RC4 encryption .", "229": "CHOPSTICK collects detailed information from the host including the Windows version , CPU architecture , Windows Firewall state , User Account Control ( UAC ) configuration settings on Windows Vista and above and Internet Explorer settings .", "230": "It also tests for the installation of specific security products ( Table 9 ) and applications ( Table 10 ) .", "231": "After collecting host information , CHOPSTICK creates a hidden file that may be named % ALLUSERSPROFILE % \\edg6EF885E2.tmp for temporary storage and creates a Windows mailslot with the name '' checkmesv5555 '' .", "232": "Its usage of a Windows mailslot would potentially allow external binaries to write data to the '' checkmesv5555 '' mailslot , possibly allowing CHOPSTICK to encrypt and store output from other malware .", "233": "It creates a thread that records user activity on the host , capturing desktop screenshots in JPEG format , tracks current window focus , collects keystrokes , and scrapes window contents ( text , context menus , etc. ) .", "234": "User activity is captured once every 500 milliseconds and logged in an HTML-like format .", "235": "The thread writes user activity log messages to the '' checkmesv5555 '' mailslot in plain text .", "236": "CHOPSTICK reads messages from the mailslot , encrypts them using RC4 , and then stores the encrypted message in an edg6EF885E2.tmp temporary file .", "237": "After approximately 60 seconds of execution time , CHOPSTICK begins communicating with one of its C2 servers over HTTP .", "238": "After sending an initial HTTP GET request it uploads the file contents of edg6EF885E2 . tmp to the C2 server using HTTP POST requests .", "239": "Once the contents of edg6EF885E2.tmp are uploaded , CHOPSTICK deletes the file .", "240": "Figure 13 below contains an example of an HTTP POST request uploading a segment from edg6EF885E2.tmp .", "241": "CHOPSTICK uses a URL-safe Base64 encoding , using an alphabet that substitutes '' + '' and '' / '' for '' - '' and '' NN '' , respectively .", "242": "CHOPSTICK encrypts an 11-byte sequence in the '' ai= '' parameter .", "243": "The purpose of this parameter appears to be to uniquely identify the particular instance of the backdoor to the C2 server .", "244": "The message body of the POST request is also Base64 encoded .", "245": "After uploading edg6EF885E2.tmp , CHOPSTICK continues to query its C2 servers for commands using HTTP GET requests .", "246": "The malware contains code which allows it to load or memory-map external modules that export the following functions : SendRawPacket , GetRawPacket , InitializeExp , DestroyExp , IsActiveChannel , GetChannelInfo , SetChannelInfo , Run , GetModuleInfo , GiveMessage , and TakeMessage .", "247": "The modules that are included in an instance of CHOPSTICK may be reported to the C2 server as part of POST messages .", "248": "Once these characters are removed the decoded ( but still encrypted ) text looks like this : The first two words ( '' 72 11 '' and '' fd 22 '' ) are checksums that are used to validate the message .", "249": "OLDBAIT is a credential harvester that installs itself in % ALLUSERPROFILE % \\\\Application Data\\ Microsoft\\MediaPlayer\\updatewindws.exe .", "250": "Both the internal strings and logic are obfuscated and are unpacked at startup .", "251": "Credentials for the following applications are collected : Both email and HTTP can be used to send out the collected credentials .", "252": "APT29 tries to undermine the detection of the malware by adding layers of obfuscation and mimicking the behavior of legitimate users .", "253": "Likewise , the group appears to almost solely uses compromised servers for CnC to enhance the security of its operations and maintains a rapid development cycle for its malware by quickly modifying tools to undermine detection .", "254": "Each variant uses different methods to acquire CnC instructions , either by directly accessing a hard - coded website or accessing Twitter as an intermediary .", "255": "Using Twitter as an intermediary to deliver the second - stage CnC to HAMERTOSS allows APT29 to dynamically direct the tool .", "256": "Other tools use Twitter to relay instructions , including:2 MiniDuke behaves similarly to HAMMERTOSS by not only using Twitter for CnC , but also by downloading image files containing encrypted , appended content .", "257": "The data may include commands or login credentials to upload a victim 's data to a cloud storage service .", "258": "T he encrypted data in the image may include instructions to execute commands via PowerShell , execute a direct command or file , or save an executable to disk and execute it .", "259": "In several cases , the commands directed HAMMERTOSS to upload information from victim networks to accounts on cloud storage services using login credentials received in Stage 4 .", "260": "In our GitHub example , the decrypted data instructed the backdoor to obtain a list of running tasks reconnaissance on the victim network - and upload it to a specific account on a cloud storage service using the login credentials .", "261": "APT29 : AN ADAPTIVE AND DISCIPLINED THREAT GROUP HAMMERTOSS illustrates APT29 's ability to adapt quickly during operations to avoid detection and removal .", "262": "[ 1 ] A previous campaign using IXESHE malware was highlighted in 2012 ; the group used targeted emails with malicious PDF attachments to compromise East Asian governments , Taiwanese electronics manufacturers , and a telecommunications company .", "263": "For example , both malware families have been seen using the same ka4281x3.log and kb71271.log files , both families have been observed calling back to the same Command & Control servers and have been used to target similar victim populations with similar attack methodologies .", "264": "The first is a dropper which contains the backdoor binary ( the second component ) and the distraction file .", "265": "When executed , the dropper loads up a resource named \" BINARY \" from the resource section then creates the directory C:\\Documents and Settings\\User\\Application Data\\JAVA , then creates a temporary file C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\ka4281x3.log then creates C:\\Documents and Settings\\User\\Application Data\\JAVA\\JavaSvc.exe from the aforementioned BINARY resource .", "266": "Most Etumbot samples observed by ASERT drop decoy documents ( PDFs , Word Documents , and Excel Spreadsheets ) written in Traditional Chinese and usually pertaining to Cross - Strait or Taiwanese Government interests .", "267": "As the backdoor executes from our previous example , C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\ kb71271.log is created and contains the following registry file to make the malware persistent .", "268": "[ HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run ] \" JavaSvc\"=\"C:\\\\Documents and Settings\\\\User\\\\Application Data\\\\JAVA\\\\JavaSvc.exe \" The dropper then calls regedit with kb71271.log as a parameter to modify the registry .", "269": "kb71271.log is then deleted .", "270": "Next , C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\ka4281x3.log is created , filled with contents of the bait / distraction file , and then copied to C:\\DOCUME~1\\User\\LOCALS~1\\Temp\\~t3fcj1.doc , which is then opened .", "271": "The ka4281x3.log file is then deleted .", "272": "Returning to the first sample , once the dropper ( ff5a7a610746ab5492cc6ab284138852 ) installs the Etumbot backdoor ( 82d4850a02375a7447d2d0381b642a72 ) , an initial HTTP beacon is sent to the Command & Control server that requests an RC4 encryption key .", "273": "If the C&C is online , the decoded response payload will contain the RC4 key that is used to encrypt subsequent communication .", "274": "If the C&C is online and responds to the beacon , then the RC4 key is delivered to the bot in a string of base64 encoded characters .", "275": "Once the bot has received the encryption key , the bot sends a registration callback to the C&C /image/<encrypted data>.jpg containing the encrypted values of system information to include the NetBIOS name of the system , user name , IP address , if the system is using a proxy ( Yes / No ) , and a numeric value which may be some type of campaign code .", "276": "[ 7 ] Etumbot discovers the proxy settings of the local machine .", "277": "WINXPBOX|johnsmith|10.0.1.15|No Proxy|05147| Once the bot has registered with the C&C , it will send periodic pings to ask for new commands to execute .", "278": "When a READFILE command is received from the C&C , the bot makes an initial call to /manage / asp / item.asp?id=<encrypted computer name>&&mux=<encrypted total file size > and checks for the presence of \" I 'm Ready \" in the response from the C&C.", "279": "The data is sent back to the C&C via the URI /article/30441/Review.asp?id=<encoded computer name>&&date=<file chunk data > .", "280": "The bot expects a message of \" OK \" from the C&C after each response is sent and will terminate the upload and send an error message to the C&C in the case it is not seen .", "281": "Etumbot uses a technique to load strings into memory that has been called \" byte strings \" and also \" string stacking \" whereby character values are loaded into a specific memory location one byte at a time .", "282": "securezone[.]yesplusno[.]com [ 10 ] prishmobile[.]googlesale[.]net yahoopush[.]googlesale[.]net The IP address 98.188.111.244 has also been used as a C&C for multiple IXESHE samples , beginning in at least March 2013 and observed as recently as March 2014 with an Etumbot sample .", "283": "Before execution , the malware makes a couple of checks to avoid analysis , including checking for the presence of a debugger using IsDebuggerPresent as well as checking for the presence of VirtualBox by looking for the device name \\\\.\\VBoxMiniRdrDN .", "284": "The malware also checks for the presence of several anti virus solutions , as well for any processes including the word ' security ' .", "285": "Meanwhile , the malware begins calling home , whilst also keeping a log of its actions in a plaintext file that is created in the same folder as where the binary was executed from .", "286": "It appears as though the clue for the main functionality of this malware is in its name ( it downloads , and then executes ) files , as it offers little else for the attacker .", "287": "The basic information reported back by the malware would also certainly allow the attacker a way to triage infections to ensure they had reached their intended victim rather than a researcher .", "288": "The framework is notable for a number of reasons , including ( but not limited to ) its use of a cloud-based infrastructure for command-and-control and its use of the WebDAV protocol to send instructions and receive exfiltrated information from compromised systems .", "289": "Exploitation of vulnerabilities in this file format is leveraged to gain remote access to victim 's computers .", "290": "The framework , thus far , has been using the services of a cloud service provider based in Sweden , CloudMe.com , for its main command-and-control infrastructure .", "291": "The framework is designed in such a way that all post-infection communication ( i.e . target surveying , configuration updates , malware updates , and data exfiltration ) can be performed via the cloud service .", "292": "Most interaction between attackers and their infrastructure is performed via a convoluted network of router proxies and rented hosts .", "293": "They turned out to belong to a highly advanced and professional targeted attack framework , which utilized a complex series of techniques to survey potential targets .", "294": "In that particular case we had the actual phishing email , so we knew the apparent recipient \u2013 the CEO of a large Russian bank .", "295": "This document was presumably obtained by the attackers and repurposed for the attack .", "296": "First of all , we have the decoy documents which indicate an interest in : We also have a set of phishing mails , which were targeted at : The shellcode used is a pretty standard variant previously used by a number of campaigns typically operating out of China , but with some minor changes .", "297": "The malicious content is stored inside the document in encoded form , and the shellcode decodes and writes this to disk .", "298": "Upon successful execution this code drops a Word document and a Visual Basic script .", "299": "The Word document is displayed to the user to avoid arousing any suspicion while the script is executed in the background .", "300": "Unusual for many exploit campaigns , the names of the dropped files vary ; for example HyHa9AJ.vbs , ewRg.vbs , 0QHdN.vbs , etc .", "301": "\u2013 clearly randomized in order to avoid detection by name .", "302": "When the VBSript is run it drops two files to disk .", "303": "This data file turns out to be encrypted using AES-256 .", "304": "The files will be installed in several locations : These locations will vary some between operating system versions .", "305": "The VBScript then sets a startup key in the '' HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run '' registry path to execute the DLLs at boot time .", "306": "Regardless of whether the registry launches the DLL or when another malware executable starts the DLL directly , the DLL is launched using regsrv32.exe with the /s ( silent ) option .", "307": "The one above drops ctfmonrc.dll .", "308": "When executed it will rebuild the original dll ( 95Num3p3gm.dll , presumably ) , load it from memory and pass over execution .", "309": "The polymorphing mechanism also generates , and inserts , unique functions all of which make calls to different floating-point operations \u2013 all done just to obfuscate the actual decoding process .", "310": "The order , size , and locations of these segments vary from build to build but somewhere near the end of the large function there will be a call to a subfunction that loads the PE image into memory , followed by a call to free the PE image allocation from memory .", "311": "This configuration information is used to load the encrypted file into memory and decrypt it .", "312": "It is designed as a survey tool .", "313": "The PE file gathers system information including OS version , computer name , user name , user group membership , the process it is running in , locale ID 's , as well as system drive and volume information .", "314": "All of this is encrypted and then sent to cloud storage via WebDAV .", "315": "Additionally , once the resource is established , the malware can transfer files to and from the command and control servers using standard file IO commands .", "316": "This allows the attackers to uniquely identify every targeted attack and track how successful each phishing campaign is .", "317": "The survey is then uploaded to the server in a specified folder with the generated name .", "318": "Files are compressed using a modified LZMA-compression and encrypted using AES cipher-block-chaining ( CBC ) before being uploaded to the cloud server .", "319": "The binary also checks a separate folder on the cloud service designated to contain new configuration information .", "320": "If such a file is present on the server , the malware downloads the new configuration file then deletes it from the server .", "321": "The malware also checks configured subfolders for updates ; and if these are found they will be downloaded , decrypted and used as appropriate .", "322": "In this account there was hidden another encrypted configuration file which the malware downloaded and decrypted .", "323": "They are lightweight and intended to pull specific survey information from their target .", "324": "Instead , when they are executed they are passed a pointer to a function to use for sending data back home .", "325": "They are executed in memory only , and once they have completed the memory is freed .", "326": "921.bin retrieves several datapoints about the infected machine : Domain info ; a list of running processes with all loaded modules in each ; the list of installed software ; and a complete hardware profile of the target machine .", "327": "922.bin compiles a dirwalk \u2013 a complete listing of every file path \u2013 of each fixed drive .", "328": "All of this information is exfiltrated back via the same WebDAV connection .", "329": "As with other plugins , these are downloaded and deleted from the share in one go .", "330": "It seems that because the plugins exist in memory only , they are injected daily to ensure persistence on victim computers .", "331": "Our theory is that this malware is a more typical datastealer , and we have observed that after this type of file is planted on the account , encrypted data uploads from compromised users increase .", "332": "Victims of this attack will connect using the Windows WebDAV redirector , and the HTTP request user-agent string will reflect this .", "333": "Common across multiple accounts , multiple IP 's , and over time , is that the probable attackers have used a HTTP user-agent of '' davfs2/1.4.6 neon/0.29.6 '' .", "334": "It is believed that the attackers were able to compromise these devices based on poor configurations or default credentials .", "335": "tail- serves as a SOCKS proxy for the attackers .", "336": "Upon execution the binary uses its hardcoded key to decrypt the configuration section and retrieve the listening port to use for incoming connections .", "337": "This means that the attackers must maintain a list of where each of these implants are installed , as well as what port and key each is configured to use .", "338": "Once received the malware would attempt to connect to the domain name on the specified port and would start tunneling all traffic received from the SOCKSS port to the destination and vise-versa .", "339": "The communication between the attacker and the SOCKSS is encoded using the RC4 key .", "340": "We identified four IP addresses that connected to the proxy malware : This host belongs to a Bulgarian VPS service and would use the router proxy to connect to webdav.cloudme.com .", "341": "This host does all scanning of webdav shares for stolen user data , and also uploads new malware components .", "342": "Traffic from this IP had a very specific purpose : It unlocked routers for proxying in connection with the sending of phishing emails .", "343": "In the wild we observed this IP connect to our router on the malware management port and specify a SOCKSS proxy port to be opened .", "344": "Immediately after , the newly opened port would be connected to by another IP and used to send phishing emails with malicious attachments .", "345": "After a router SOCKSS port was opened by Unlocker , this IP would connect to the opened port and tunnel its email traffic through the router .", "346": "Mail proxies : Through our router monitoring we identified two mail proxies used by the attackers .", "347": "After being proxied though the router , each of these would authenticate with one of the dedicated mail proxies and send out phishing attacks .", "348": "The mail proxy would then relay the spearphishing mail as seen below .", "349": "This way the attack can be mistaken to come from legitimate businesses and trusted organizations .", "350": "In some cases the organization from which the phishing email originates would appear to be a known associate to the target .", "351": "The email shown above was one of a number of messages sent to targets in the oil industry .", "352": "One of the spearphishing mails we observed coming through the router network was this one , sent to an address under the gov.py ( Government of Paraguay ) domain .", "353": "Accessing the link from an Android User-Agent initiated a download of an Android installer package named WhatsAppUpdate.apk .", "354": "The apparent main purpose of this malware is to record phone call audio .", "355": "Recordings are stored as *.mp4 files , and uploaded to the attackers periodically .", "356": "The malware is able to collect a lot of other information , not all of which is actually used : Through the encrypted C & C protocol , the attackers can issue commands and binary updates to the malware .", "357": "The HTML source code reveals that the encoded portion is encapsulated in blog-index tags : The three accounts contain different configuration blocks pointing to C & C servers apparently located in Poland , Germany and Russia , respectively .", "358": "Using an IOS User-Agent triggered the download of a Debian installer package , WhatsAppUpdate.deb , also 1.2Mb in size .", "359": "This application impersonates a Cydia installer , and can only be installed on a jailbroken phone .", "360": "Once installed , it may collect These data are encrypted and uploaded to an FTP account which is taken from an encrypted configuration file named /usr/bin/cores .", "361": "The application impersonates a settings utility .", "362": "This collects : Collected data will be uploaded to a DynDNS domain currently hosted on a US webhosting service .", "363": "The encrypted files uploaded to the WebDAV shares come with their InitVectors stored at the end of the file .", "364": "The file creation times turned out to be hours after the files themselves were uploaded to the WebDAV share .", "365": "On at least two occasions during our surveillance of the Inception framework , the malware downloaded something unexpected and wholly different from what we have discussed until now .", "366": "These files were downloaded as encrypted *.bin files from the accounts carter0648 and frogs6352 .", "367": "When decrypted , these turned out to be dropper packages containing one dropper executable clearly created for the Inception framework , and one other , very different executable .", "368": "It is a downloader and remote shell program , designed to connect to a C & C server to interact with the attacker and/or download more malware .", "369": "The C & C server in this case is ict32.msname.org .", "370": "When connecting to this server , sccm.exe issues the following request : This C & C domain is used by many other malwares related to sccm.exe ; some of which share obvious connections to the Quarian malware family , a known APT intrusion tool .", "371": "Inception has the capacity to perform all steps needed for scouting out and exfiltrating data without resorting to traditional hosted command & control .", "372": "By using a well-understood APT tool and a known malicious C & C domain name , the attackers permit much clearer attribution .", "373": "Then there is the C & C domain used .", "374": "Not only is the initial DLL apparently polymorphed using some backend tool \u2013 the compile time stamps in the PE header are clearly forged , resources are removed so as not to give away any location information , and import tables are shuffled around , rendering import hashes ( aka imphashes ) useless .", "375": "The attackers utilize compromised embedded devices \u2013 typically routers- on the Internet as well as multiple dedicated hosting providers and VPN services to mask their identity from the cloud storage provider and others .", "376": "The same router botnet is used as a spreading and management platform for attacks on mobile devices as well .", "377": "Initially , cybercriminals used BlackEnergy custom plugins for launching DDoS attacks .", "378": "BlackEnergy2 was eventually seen downloading more crimeware plugins - a custom spam plugin and a banking information stealer custom plugin .", "379": "While another crimeware group continues to use BlackEnergy to launch DDoS attacks , the BE2 APT appears to have used this tool exclusively throughout 2014 at victim sites and included custom plugins and scripts of their own .", "380": "As described in Dmitry 's 2010 Black DDoS ' analysis , a configuration file is downloaded from the server by main.dll on an infected system .", "381": "The ' vsnet ' plugin was intended to spread and launch a payload ( BlackEnergy2 dropper itself at the moment ) in the local network by using PsExec , as well as gaining primary information on the user 's computer and network .", "382": "The server definitely delivered config files not only for Windows , but also for the ARM / MIPS platform .", "383": "Though unusual , the ARM module was delivered by the same server and it processed the same config file .", "384": "After decrypting the strings , it became clear that the Linux Hook main module communicated with the same CnC server as other Windows modules .", "385": "Why would the attackers need information on usb and bios characteristics ? It suggests that based on a specific USB and BIOS devices , the attackers may upload specific plugins to carry out additional actions .", "386": "The issued commands for the Linux plugins suggest the attackers controlled infected MIPS / ARM devices .", "387": "The BE2 attackers successfully spearphished an organization with an exploit for which there is no current CVE , and a metasploit module has been available This email message contained a ZIP archive with EXE file inside that did not appear to be an executable .", "388": "As the APT - specific BE2 now stores the downloaded plugins in encrypted files on the system ( not seen in older versions \u2013 all plugins were only in - memory ) , the administrators were able to collect BE2 files from the infected machines .", "389": "By all appearances , the attackers pushed the ' dstr ' module when they understood that they were revealed , and wanted to hide their presence on the machines .", "390": "And , they revealed that their Cisco routers with different IOS versions were hacked .", "391": "The script tries to download ciscoapi.tcl from a certain FTP server which served as a storage for BE2 files .", "392": "Starting in March 2014 and ending in July 2014 , Siemens \" ccprojectmgr.exe \" downloaded and executed a handful of different payloads hosted at 94.185.85.122/favicon.ico .", "393": "While BE dropper installs its driver under a randomly picked non - used Windows driver name , like % system32%\\drivers\\AliIde.sys .", "394": "BE2 also uses start menu locations for persistence .", "395": "LMS.exe will load any DLL file name dbghelp.dll that is found in the same path , hence the sideloading technique .", "396": "In turn , The malicious DLL loads a backdoor binary blob MD5 : 16E5A27BD55E0B4E595C9743F4C75611 ( ticrf.rat ) .", "397": "The malware connects back to the exploit domain pic.nicklockluckydog[.]org as well as the subdomain ssl.nicklockluckydog[.]org .", "398": "Thursday , 04 September 2014 23:55:00 ( UTC / GMT ) The Chinese are running a MITM attack on SSL encrypted traffic between Chinese universities and Google .", "399": "A reasonable assumption is therefore that the MITM is carried out on the 2001:252::/32 network , or where AS23910 ( 2001:da8:1::2 ) connects to AS23911 ( 2001:252:0:1::1 ) .", "400": "Again , this is a clear indication of an IP MITM taking place , since Google can not possibly send a response from the US to CERNET within 8ms regardless of how fast they are .", "401": "All evidence indicates that a MITM attack is being conducted against traffic between China 's nationwide education and research network CERNET and www.google.com .", "402": "The evidence we 've observed instead indicate that the MITM attack is performed either by performing IP hijacking or by simply reconfiguring a router to forward the HTTPS traffic to a transparent SSL proxy .", "403": "Some of the filenames used in the attacks included : At least one of them immediately reminded us of RedOctober , which used a very similarly named spearphish : '' Diplomatic Car for Sale.doc '' .", "404": "Instead , it writes an encrypted Visual Basic Script and runs it .", "405": "This VBScript drops a pair of files on disk - a loader and an encrypted payload .", "406": "The payload is always encrypted with a unique key , making it impossible to decrypt unless the DLL is available .", "407": "We observed several different spear-phishing documents that drop uniquely named payloads .", "408": "For instance , the '' qPd0aKJu.vbs '' file MD5 : E211C2BAD9A83A6A4247EC3959E2A730 drops the following files : The VBS also adds a registry key : HKEYCURRENTUSER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ setting the key '' bookstore '' to the value '' regsvr32 % path % \\ctfmonrn.dll /s '' , which ensures the malware runs every time at system boot .", "409": "Some of the DLL names we observed include : Some of the payload names include : The payload includes an encrypted configuration block which contains information about the C & C sever : The information from the config includes a WebDAV URL which is used for connections , a username and password , two folders on the WebDAV server used to store plugins/modules for the malware and where data from the victim should be uploaded .", "410": "The Cloud Atlas implants utilize a rather unusual C & C mechanism .", "411": "All the malware samples we 've seen communicate via HTTPS and WebDav with the same server '' cloudme.com '' , a cloud services provider .", "412": "Each malware set we have observed so far communicates with a different CloudMe account though .", "413": "The attackers upload data to the account , which is downloaded by the implant , decrypted and interpreted .", "414": "In turn , the malware uploads the replies back to the server via the same mechanism .", "415": "Here 's a look at one such account from CloudMe : The data from the account : The files stored in the randomly named folder were uploaded by the malware and contain various things , such as system information , running processes and current username .", "416": "The data is compressed with LZMA and encrypted with AES , however , the keys are stored in the malware body which makes it possible to decrypt the information from the C & C .", "417": "We previously observed only one other group using a similar method \u2013 ItaDuke \u2013 that connected to accounts on the cloud provider mydrive.ch .", "418": "Interestingly , some of the spear-phishing documents between Cloud Atlas and RedOctober seem to exploit the same theme and were used to target the same entity at different times .", "419": "Based on observations from KSN , some of the victims of RedOctober are also being targeted by CloudAtlas .", "420": "Most Chinese-speaking attackers simply relocate C & C servers to a different place , recompile the malware and carry on as if nothing happened .", "421": "In recent weeks , Unit 42 has been analyzing delivery documents used in spear - phishing attacks that drop a custom downloader used in cyber espionage attacks .", "422": "Instead of finding API function names based on their hashed values , this malware enumerates libraries ' export address table ( EAT ) and searches for the name of the API function the payload needs to load by using a character to offset array .", "423": "The embedded configuration contains nothing more than a URL that Cmstar uses as its command and control ( C2 ) location .", "424": "The encrypted strings within the Trojan include fields used within the HTTP requests that Cmstar will create to communicate with its C2 server , as well as additional strings used to interact with the registry .", "425": "The Cmstar sample associated with the MNKIT delivery document creates the following registry key to automatically execute at system startup .", "426": "HKCU\\Software\\Microsoft\\CTF\\LangBarAddIn Cmstar also decrypts a 752-byte piece of shellcode that carries out communications with the C2 server , specifically by sending HTTP POST requests to the following URL .", "427": "Cmstar 's HTTP POST requests sent to ' happy.launchtrue[.]com ' contain data that the Trojan gathers from the infected machine that has the following structure .", "428": "510@@1??1]]**0!!150316o== Helpfully , the malware author writes log messages to the ' DF64159.TMP ' file , used for debugging purposes throughout the execution of the Cmstar downloader .", "429": "As mentioned in the behavioral analysis section , the Cmstar downloader gathers system - specific information to send to the C2 server .", "430": "Unit 42 found that the string ' avp ' subjected to the algorithm above results in the value 0x1E00AFA , which suggests the Cmstar sample specifically looks for Kaspersky 's Anti - virus product ( avp.exe ) running on the compromised system .", "431": "The Cmstar tool has several interesting features , including a previously unseen method of manually creating its import address table using an API function name character to offset mapping techniques , and a hashing algorithm used to find antivirus processes on an infected system .", "432": "The important strings are as follows : Together with the output of IDA Pro , we can see that this malware uses the command line tool cmd.exe for adding several registry keys to Internet Explorer .", "433": "It also tries to retrieve possible AntiVirus information by using the COM interface ( dc12a687-737f-11cf-884d-00aa004b2e24 - > IWbemLocator - > SELECT * FROM AntiVirusProduct ) .", "434": "Furthermore , it makes use of the COM to launch an instance of Internet Explorer ( d30c1661-cdaf-11d0-8a3e-00c04fc9e26e - > IWebBrowser2 ) , supposedly to contact its C & C server .", "435": "As a result , we get the following network information : Also , we see that it downloads some kind of data ( Base64 encoded ) .", "436": "Once again , it creates several registry entries with the help of the command line tool and creates an instance of the Internet Explorer ( CoCreateInstance ( ) - > d30c1661-cdaf-11d0-8a3e- 00c04fc9e26e ) for contacting the C & C server .", "437": "This time , the network information is as follows : From the code we can see , that the sample has also the ability to encode / decode data from / to Base64 .", "438": "The dynamic analysis showed the malware sample contacted the C & C server , but was n't sending any URL parameters ( id1 , id2 ) .", "439": "The CozyDuke toolset , which we believe has been under active development since at least 2011 , consists of tools for infecting targeted hosts , establishing and maintaining backdoor access to the hosts , gathering information from them and gaining further access to other hosts inside the victim organization .", "440": "The CozyDuke toolset also includes multiple kinds of droppers for infecting hosts with CozyDuke or for executing additional tools from the CozyDuke toolset .", "441": "Finally , the CozyDuke toolset includes tools and scripts \u2013 some custom - written , others based on openly available tools \u2013 that are used for purposes such as gathering further information from infected hosts or for infecting additional hosts in the same target organization .", "442": "We have observed CozyDuke being spread via email , which usually contain a link to a compromised website hosting a ZIP file ( although in at least one case , the file was hosted on Dropbox ) .", "443": "These files contain an executable that , upon execution , will write to disk and execute CozyDuke , while at the same time presenting the user with a decoy to divert attention .", "444": "Secondly , we also have reason to believe CozyDuke has , in some instances , downloaded and executed droppers for DLL files reminiscent of OnionDuke .", "445": "Upon execution , it will write two files to disk .", "446": "This dropper will then proceed to write to disk the main CozyDuke components as well as an encrypted configuration file used by CozyDuke .", "447": "The main CozyDuke dropper , used for infecting hosts with CozyDuke , begins by checking whether the victim has an anti - virus product installed .", "448": "Newer versions of the dropper will perform additional checks to ensure the dropper is not being executed inside a virtual machine or a known malware analysis sandbox environment .", "449": "The dropper will then proceed to write the CozyDuke components to the specified location .", "450": "The dropper will additionally copy the system file rundll32.exe to the install location for CozyDuke .", "451": "Finally , the dropper will use the copy of rundll32.exe to load and execute the CozyDuke main component .", "452": "The main component is executed by the CozyDuke dropper using a copy of rundll32.exe .", "453": "The most important functionalities offered by the main component are establishment of persistence , gathering of basic system information , communication with the C&C server and the execution of additional tasks , modules or executables as commanded by the C&C server .", "454": "Firstly , CozyDuke may set itself to be executed at system startup by adding a registry value under any of the following registry keys : The name of the registry value will usually be the filename , ( without the extension ) of the CozyDuke main component .", "455": "CozyDuke may also register itself as a Windows service or scheduled task .", "456": "To achieve this , CozyDuke will \" hijack \" the registry entries for the COM object \" SharedTaskScheduler \" .", "457": "CozyDuke will modify the registry entries in such a way that any loading of the SharedTaskScheduler COM object will first load a special CozyDuke module that will ensure CozyDuke stays active on the victim host .", "458": "CozyDuke 's main method of communicating with its command and control server is using either HTTP or HTTPS .", "459": "In the cases we have observed , the configuration data for any single CozyDuke instance has included the details of either one or two C&C servers .", "460": "Tasks CozyDuke 's primary purpose is the execution of tasks .", "461": "These tasks usually involve the execution of modules or executables providing additional functionality .", "462": "For the purpose of managing tasks , the main component of CozyDuke implements 6 commands that the C&C server can specify .", "463": "The first consists of CozyDuke modules which are DLL files loaded in memory by the main component of CozyDuke for the purposes of extending CozyDuke 's functionality .", "464": "The second category consists of PE executable files that CozyDuke will write to disk and execute on the infected host .", "465": "In this case , however , instead of dropping CozyDuke , the executables may drop other executables , scripts or DLLs .", "466": "ScanBox performs keylogging of users when they visit a compromised website , without requiring malware to be deployed , and can collect a great deal of information which can be used to tailor future attacks In October we published some details of the ScanBox tool set .", "467": "For those who did n't read our last entry on the framework , nor the excellent work by Jaime Blasco2 which preceded it , ScanBox is a framework written in JavaScript and PHP which allows an attacker to perform reconnaissance and key logging of visitors to compromised websites without requiring any malware to be downloaded or installed .", "468": "In one cluster of ScanBox activity , instead of checking for specific files as per the method above , the attackers have implemented a different method of tracking files and drives present on the victim machine .", "469": "Whilst macanna.com[.]tw appears to be a legitimate site , it has also been observed as being a command and control destination for malware .", "470": "However one group of attackers using the ScanBox framework are now actively sending e - mails to potential victims , where the e - mails contain links to websites hosting ScanBox .", "471": "File Details Full File Path % APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx SHA256 9d838fd9d21778ed9dc02226302b486d70ed13d4b3d914a3b512ea07bf67e165 File Size 107,008 bytes Compile Time 2/4/2015 8:41:42 UTC The malware does not execute immediately after successful exploitation and instead just creates a Run key in the current user 's hive which will execute the next time the victim user accesses the system .", "472": "Registry Persistence Key HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Certificates Registry Key Value Rundll32.exe \" % APPDATA%\\Microsoft\\SystemCertificates\\Certificates.ocx\",Setup The ocx file is actually a DLL and provides the attacker the ability to upload , download , enumerate , delete , search , and execute files as well as list drivers on the system .", "473": "The binary is designed to be called from its one exported function , \" Setup \" ; the Run key will ensure that whenever the victim user logs into the system the backdoor will execute .", "474": "The binary is configured to communicate to \" www.microsoftservices.proxydns.com \" on port 80 using standard HTTP POST and GET requests .", "475": "Based upon some cursory analysis the backdoor will look for encrypted commands within HTML comments returned from the C2 using the following format : \" < ! ? * $ @COMMAND GOES HERE@$ * ? ! > \u037e\"however , the C2 was not active at the time of analysis so this could not be confirmed .", "476": "The backdoor may also make requests to the C2 over HTTP using the following parameters in the URI string \" query?sid= \" and \" result ? sid= \" .", "477": "On reboot explorer.exe was now happy to load the backdoor and get down to business ; this technique is known as dll search order hijacking or binary planting .", "478": "Interestingly the backdoor will also load the legitimate system32\\msacm32.drv file resolve functions and pass calls to it so it does n't break audio playback on the victim system .", "479": "The backdoor contains identical exports as well as an additional dummy function from the legitimate msacm32.drvcalled \" StartWork \" which can be used to reliably identify similar samples .", "480": "The backdoor routine exists inside the DllMain function so when explorer.exeloads the backdoor via LoadLibrary it will begin spawning malicious threads .", "481": "This report is for the world 's cyber defenders \u2013 never give up ! Since at least 2012 , Iranian actors have directly attacked , established persistence in , and extracted highly sensitive materials from the networks of government agencies and major critical infrastructure companies in the following countries : Canada , China , England , France , Germany , India , Israel , Kuwait , Mexico , Pakistan , Qatar , Saudi Arabia , South Korea , Turkey , United Arab Emirates , and the United States .", "482": "Operation Cleaver has , over the past several years , conducted a significant global surveillance and infiltration campaign .", "483": "To date it has successfully evaded detection by existing security technologies .", "484": "Famous examples of these efforts include industrial sabotage via Stuxnet ( 2009 - 2010 ) , and espionage with Duqu ( 2009 - 2011 ) as well as Flame ( 2012 ) .", "485": "Stuxnet was an eye-opening event for Iranian authorities , exposing them to the world of physical destruction via electronic means .", "486": "These attacks were debilitating and impacted the availability of online banking services .", "487": "In May 2014 , evidence emerged of a highly targeted waterhole attack that leveraged social media , dubbed Operation Newscaster , which was uncovered by iSight Partners .", "488": "\u2022 Assets ( both cyber and physical ) and logistics information were compromised at major airline operators , airports , and transportation companies .", "489": "\u2022 Confidential critical infrastructure documents were harvested from major educational institutions around the world .", "490": "\u2022 Initial compromise techniques include SQL injection , web attacks , and creative deception- based attacks \u2013 all of which have been implemented in the past by Chinese and Russian hacking teams .", "491": "\u2022 Pivoting and exploitation techniques leveraged existing public exploits for MS08-067 and Windows privilege escalations , and were coupled with automated , worm-like propagation mechanisms .", "492": "\u2022 Customized private tools with functions that include ARP poisoning , encryption , credential dumping , ASP.NET shells , web backdoors , process enumeration , WMI querying , HTTP and SMB communications , network interface sniffing , and keystroke logging .", "493": "\u2022 Private signing certificates of one victim were captured allowing the Operation Cleaver team to compromise the entirety of their organization .", "494": "The following is a breakdown by country of which industries were targeted and/or victimized : Cleaver 's level of access into each organization varied greatly , including completely compromised systems and networks , Active Directory domain controllers and credentials , compromised data repositories and stolen VPN credentials .", "495": "Compromised systems include Microsoft Windows web servers running IIS and ColdFusion , Apache with PHP , many variants of Microsoft Windows desktops and servers , and Linux servers .", "496": "Compromised network infrastructure included Cisco VPNs as well as Cisco switches and routers .", "497": "Within our investigation , we had no direct evidence of a successful compromise of specific Industrial Control Systems ( ICS ) or Supervisory Control and Data Acquisition ( SCADA ) networks , but Cleaver did exfiltrate extremely sensitive data from many critical infrastructure companies allowing them to directly affect the systems they run .", "498": "This data could enable them , or affiliated organizations , to target and potentially sabotage ICS and SCADA environments with ease .", "499": "The attackers targeted research efforts , student information , student housing , and financial aid systems .", "500": "The level of access seemed ubiquitous : Active Directory domains were fully compromised , along with entire Cisco Edge switches , routers , and internal networking infrastructure .", "501": "Fully compromised VPN credentials meant their entire remote access infrastructure and supply chain was under the control of the Cleaver team , allowing permanent persistence under compromised credentials .", "502": "They achieved complete access to airport gates and their security control systems , potentially allowing them to spoof gate credentials .", "503": "They gained access to PayPal and Go Daddy credentials allowing them to make fraudulent purchases and allowed unfettered access to the victim 's domains .", "504": "Over the course of multiple incident response engagements related to Operation Cleaver , we were able to identify a small set of IP addresses which were commonly used during the initial stages of an attack .", "505": "The IP address 78.109.194.114 served as a source for one of the primary attackers .", "506": "They were observed conducting SQL injections , controlling backdoors , as well as exfiltrating information using this address , and the address appears in multiple software configurations recovered from staging servers over a period of time .", "507": "The IP address 159.253.144.209 was a source for a secondary attacker in various compromises .", "508": "They were observed conducting SQL injection attacks .", "509": "The creator generates an ASPX web shell using user input as well as a collection of templates .", "510": "The web shell could then be installed via xpcmdshell , or any other method which would grant the attacker write access .", "511": "We originally located it on a staging server being utilized for multiple attacks as well as a tool for sharing data between members of the organization 's team .", "512": "When executed , and before any connection to an instance of the web shell is initiated , the shell client communicates with freegeoip.net in order to get the external IP address of the current user .", "513": "Net Crawler is a tool developed in C # that exhibits worm-like behavior in order to gather cached credentials from any and all accessible computers on an infected network .", "514": "Many versions were obfuscated with a legitimate tool for developers named SmartAssembly , which makes the recovery of some names implausible .", "515": "When executed , it will capture the user 's keystrokes and save them to a location which PVZ bot then exfiltrates .", "516": "This log was generated during the usage of the nbrute utility , which brute-forces network credentials and relies on NMAP to do so .", "517": "The operators of the blog IranRedLine.org , which comments on Iran 's nuclear weapons efforts , has mentioned in multiple posts having been the target of debilitating brute-force authentication attacks from IP addresses registered to the same Tarh Andishan team found in Cleaver .", "518": "The PVZ tool chain includes a variety of functionality , such as HTTP command and control communications with an ASPX server-side component , a denial of service tool they developed , and the public project named XYNTService used to run ordinary applications as services .", "519": "Nesha was seen in breaches involving SQL injection as well as other techniques .", "520": "Nesha often utilized web-based backdoors developed in ASPX , PHP as well as ColdFusion .", "521": "These tools are often support tools , either monitoring the activity of other tools or supplementing the function of other tools gathering information during the infiltration process .", "522": "SQL injection is a very common and simple attack method .", "523": "SQL injection payloads used by this organization have been double encoded .", "524": "Double encoding SQL injection payloads allows for bypassing of various anti-exploitation filters , such as those supplied by Web Application Firewalls ( WAFs ) .", "525": "The attackers would enable xpcmdshell : Then connect outbound via anonymous FTP : Using messaging methods such as email , attackers can social engineer users into downloading and executing software , which quietly installs malware alongside of the desired program .", "526": "In order to infect users , they combined the original Easy Resume Creator Pro product with malware by using a binder they developed internally named Binder1 .", "527": "The resulting executable masquerades as the desired software .", "528": "The purpose is deception , to make the binder indistinguishable from the desired application .", "529": "When executed , both applications are written to a temporary directory and executed .", "530": "This way it appears that the desired application was executed , but the malware was also executed silently .", "531": "In order to take advantage of this job opportunity , the victim needed to use the fake r\u00e9sum\u00e9 submission application supplied by the malicious recruiter .", "532": "Multiple domains were registered in order to make the download sites seem more realistic .", "533": "At this point , the r\u00e9sum\u00e9 submission application checks the Internet connection .", "534": "If it is unable to connect to the Internet , it will display a window to input proxy information .", "535": "When this information is entered , the results are cached in a location the dropped malware can access .", "536": "After an Internet connection is ensured , the malware ( TinyZbot ) is dropped and executed .", "537": "This clever scheme makes sure the malware can connect to the command and control server , and increases the chances that domain credentials are cached on the now infected machine .", "538": "Shortly after , the main application is launched .", "539": "The first r\u00e9sum\u00e9 submission form requests contact information .", "540": "This form , like the rest of the submission forms , only stores the submitted information while the application is running .", "541": "As the infected user is going through and filling out all this information , the malware is running in the background , logging their keystrokes , retrieving their stored passwords , etc .", "542": "When the victim hits submit , the r\u00e9sum\u00e9 submitter does a GET request to microsoft.com in order to make it seem like it is submitting something , then claims success .", "543": "Privilege escalation is a category of techniques that describe the process of going from a less privileged user on a compromised computer to a more privileged user .", "544": "This increase in privileges allows for the attacker to gain access to privleged areas of the operating system as well as to infect other computers on the target network .", "545": "PrivEsc is a compiled exploit , which leverages the vulnerability commonly referred to as KiTrap0D ( CVE-2010-0232 ) .", "546": "The exploit allows for escalation of privileges on unpatched Windows operating systems from an unprivileged user to kernel-level privilege .", "547": "Pivoting is the process of leveraging access from one compromised computer in order to gain access to additional systems on the target network .", "548": "This can involve launching attacks from the compromised computer , or simply abusing access once it has been gained .", "549": "A very common method of pivoting on a predominantly Windows operating system based network is to extract domain credentials which have been used on the compromised computer from a credential cache .", "550": "There are a few well-known tools which are capable of doing this given sufficient privileges on the infected host .", "551": "Two similar applications were developed by Operation Cleaver in order automate the execution of Mimikatz .", "552": "When executed , they determine which version of Mimikatz to use based on whether the computer 's version of Windows is 32-bit or 64-bit .", "553": "zhMimikatz executes the correct version of Mimikatz for the current system , and parses the results for any cached credentials .", "554": "The only external difference is that MimikatzWrapper also logs these results to res.txt in the executing directory .", "555": "This can make it useful for tools like the PVZ tool chain and Csext to execute with logged results : Once an attacker has credentials extracted from the cache , whether in hash form or in plaintext form , PsExec can be used to run commands on any other computer which accepts those domain credentials .", "556": "If this technique is combined with cached credential dumping , it can be used to jump from computer to computer on a compromised network .", "557": "Net Crawler utilizes a cached credential dumping technique along with PsExec in order to worm throughout a network , collecting any and all credentials that it can extract from credential caches .", "558": "It starts by first extracting cached credentials from the infected computer 's cache .", "559": "Once this is complete , it then continues to scan a set of configured IP addresses on the local subnet to determine which IP addresses have SMB related ports open .", "560": "Then an iterative methodology is applied to brute forcing each SMB enabled target with each credential that was extracted from the cache .", "561": "When a positive result has been achieved , it will create a copy of itself with a modified configuration stored as a PE resource , then send and execute the copy utilizing PsExec .", "562": "This copy repeats the behavior of the original , but with already discovered credentials as well as newly discovered ones on the newly infected host .", "563": "MS08-067 is a vulnerability in Microsoft Windows made popular by the Conficker worm which can be exploited by a specially crafted packet to the operating system 's RPC network interface .", "564": "Jasus is an ARP cache poisoner developed by the Operation Cleaver team .", "565": "The primary positive attribute of Jasus is its poor detection ratio by the antivirus industry .", "566": "It has the ability to dump stored and cached credentials , and conduct attacks like ARP cache poisoning in order to capture credentials being transmitted on the network .", "567": "It also has a remotely installable trojan named Abel , which enables some of its functionality on a remote target .", "568": "We observed the Operation Cleaver team using Cain & Abel for extracting credentials from caches and the network when they are confident that there is little to no antivirus protection on the infected target .", "569": "Exfiltration is the process of moving information to an external site .", "570": "In this context , it is the process of stealing information without being detected .", "571": "Operation Cleaver has a strong focus on stealing confidential/privileged information , and they have utilized a few methods in order to facilitate this objective .", "572": "Cleaver Operations observed in 2013 mainly utilized FTP servers with anonymous access enabled in order to pilfer large quantities of information .", "573": "This allowed them to use existing command line utilities available on their targets in order to upload information .", "574": "These FTP servers were also observed during the infection process , as infected computers were often instructed to download additional files from these FTP servers , including backdoors and pivoting tools .", "575": "The following IP addresses hosted FTP servers that were used in the infection of targets or in the exfiltration of information .", "576": "Its main functionality allows for a client and server communication channel , allowing for information to be transported over the network simply .", "577": "NetCat has an option when being compiled to enable or disable the ability for NetCat to execute a command after the connection is established .", "578": "This feature can be abused to enable a reverse connecting shell , which can be used to remotely control a target .", "579": "The Operation Cleaver team was observed attempting to use NetCat to exfiltrate information as well as use it as a reverse connecting shell .", "580": "Its main purpose is to create a channel that is capable of transporting information over the network .", "581": "The changes made in zhCat allow for this information to be transferred with inline obfuscation and/ or encryption .", "582": "This makes it more difficult to detect that privileged information is being exfiltrated .", "583": "This makes the traffic between zhCat instances look like benign HTTP traffic .", "584": "If we observe the network communications during this transfer , we can see the following HTTP POST request .", "585": "On the server side , we can see our message has been received : If stricter egress filtering is enabled , the attackers can use zhCat to also XOR encrypt the traffic with a shared key .", "586": "The following is the key used for XOR encryption : The \\n represents hex character 0x0A , which is a new line character .", "587": "An attacker could set up a server instance of zhCat with the following command in order to enable both HTTP and XOR obfuscation : The client instance could then be invoked with the following command : Once again , information can be supplied via standard input .", "588": "Upon inspecting the network traffic again , we see the following HTTP POST request .", "589": "On the server side , we can see this information being received : zhCat has a variety of other features such as port mirroring as well as traffic redirecting .", "590": "Operation Cleaver uses PLink to forward local RDP ports to remote SSH servers .", "591": "This allows them to easily connect to RDP servers inside the networks of their victims .", "592": "These RDP connections can be used to exfiltrate information visually , as well as to remotely control the computers hosting the RDP servers .", "593": "Early Cleaver operations abused SMTP in order to exfiltrate information .", "594": "The sending is performed by internally developed malware samples such as TinyZBot and Csext in order to exfiltrate information about the infected computer , as well as requested files and keystroke logging information .", "595": "Messages were sent using an open SMTP relay at BeyondSys.com with the sender email address dyanachear ( at ) beyondsys.com .", "596": "This allowed the attackers to use infrastructure that was not theirs to exfiltrate information .", "597": "The subject used is the following : The message used is the following : The files being exfiltrated are added to the email as attachments .", "598": "SOAP is a sub-protocol communicated via HTTP .", "599": "In relation to Operation Cleaver , it is used as the command and control protocol for TinyZBot , which was the preferred backdoor , and underwent long-term development .", "600": "HTTP communications are often used by botnets , but it is uncommon to use a sub-protocol such as SOAP .", "601": "It is likely that SOAP was used because it is simple to implement in C # , and has the added benefit of blending in with other benign HTTP traffic .", "602": "As part of TinyZBot 's command and control protocol , files can be exfiltrated over SOAP to the command and control server .", "603": "Persistence is the means of maintaining access to a compromised network .", "604": "There are limitless methods of persistence ; the following are techniques and tools for persistence used by Cleaver .", "605": "TinyZBot is a backdoor developed in C # .", "606": "The purpose of TinyZBot is to gather information from an infected computer as well as maintain and further access into a compromised network .", "607": "The following is a list of supported features : The command and control mechanism for TinyZBot utilizes SOAP communicating over HTTP .", "608": "SOAP traffic could easily be considered benign traffic , as it is not commonly seen in malware .", "609": "Since the first version of the SOAP-based command and control protocol was implemented , TinyZBot used what is referred to as a '' dynamic password '' .", "610": "For the command and control examples below , red text represents TCP data sent from the TinyZBot infection while blue text represents TCP data sent from the command and control server .", "611": "This is the first query done by a running TinyZBot instance , and needs to be done shortly before most other queries , in order to update the dynamic password .", "612": "Commands , updates and files to drop and execute are stored as files on the SOAP server , and access is restricted by the AppUsageID as well as the bot GUID .", "613": "This allows for commands to be sent to all bots for a campaign as well as individual control .", "614": "The TinyZBot queries the server in order to enumerate all files currently available to it .", "615": "In order to download the file and parse for commands to execute , the TinyZBot must request the file .", "616": "The file is downloaded Base64-encoded inside of the SOAP response .", "617": "The RUNCMD line requests that cmd.exe be executed , with the command ipconfig /all being redirected to a file in a directory designated for files to be uploaded .", "618": "The UPLOAD command requests that this file is then uploaded over SOAP to the command and control server .", "619": "The DELETE command then requests that the file be deleted from the infected system .", "620": "The following is a list of supported commands that TinyZBot responds to : Commands such as GETINFO are often run on newly infected systems , as they decide whether the infection has hit the correct target .", "621": "TinyZBot is commonly installed using some form of deception .", "622": "Recent versions use the resume- based methods reported in the Initial Compromise sections .", "623": "When early versions of TinyZBot were executed , they opened an image stored in the resource section of the executable and copied the malicious TinyZBot executable to the % AppData % directory .", "624": "The backdoor additionally replaced the original malicious executable with an appropriately named image file and padded the image file with null bytes in order to mirror the original file size .", "625": "It was limited to logging keystroke data , sending emails , and creating a link in the user 's startup folder for persistence .", "626": "Its method of exfiltrating the logged keystrokes relied upon a hardcoded email address stored in the binary .", "627": "The message was intended to look like common Viagra spam from China , but would be sent with the keystroke logging data as attachments , as well as system information .", "628": "The initial version did not provide any means of receiving commands and was obfuscated with SmartAssembly .", "629": "A command and control protocol was established , using HTTP and SOAP for the protocol .", "630": "The command and control server for this version was located at 173.192.144.68/ DefaultWS ( dot ) asmx .", "631": "An update mechanism was added , and could be regularly scheduled , so unassisted periodic update checks were automatically performed .", "632": "The email data exfiltration method also underwent modification to be activated at a scheduled interval .", "633": "The next day , April 25 , 2013 , a new version was compiled which allowed for self-deletion .", "634": "The AppUsageId ( at this point named AppType ) was an identifier used by this organization in order to differentiate between targets infected with TinyZBot , meaning they could effectively run multiple campaigns using the same command and control server and know which target was infected .", "635": "This also allowed for separate commands to be supplied to different targets without the need for per-bot commands .", "636": "The exfiltration email address was also changed to TerafficAnalyzer ( at ) yahoo.com .", "637": "SmartAssembly was reused again .", "638": "A method was added to detect what security related software is installed .", "639": "Avira antivirus was specifically targeted and disabled , due to its detection of the new keystroke logger module added in this version .", "640": "This keystroke logger source is publicly available and referred to as DeadkeyLogger .", "641": "The ability to extract Internet Explorer passwords was added .", "642": "Clipboard monitoring code was added , but not invoked .", "643": "The version compiled on June 23 , 2014 , added functionality which allowed screenshots of the desktop to be taken .", "644": "A bug fix is made to the keystroke logging method , and clipboard monitoring is enabled .", "645": "This was presumably done to limit antivirus detection of each individual file as well as allow for dynamic updating of specific modules .", "646": "FTP upload support was added , with hardcoded credentials of ano:1 .", "647": "This FTP upload functionality points to the command and control server , and is invoked by a command in the SOAP command and control channel .", "648": "These versions have the capability to install as a service .", "649": "This indicates that TinyZBot is not only being installed while impersonating a r\u00e9sum\u00e9 creation suite , but is also impersonating potential employers when distributed .", "650": "This dropper impersonated a tool to submit a r\u00e9sum\u00e9 to Teledyne .", "651": "While the user enters this information , their machine is infected with TinyZBot .", "652": "These versions began to include a new method of installing as a service .", "653": "This was likely to avoid detonation-based detection engines .", "654": "This allowed supplemental tools to keep TinyZBot running by enumerating every process and checking if the process ID and mutex prefix existed .", "655": "If no mutex and process pair was located , another TinyZBot instance would be started .", "656": "Multiple backdoors were used by this organization .", "657": "These are scripts or applications that allowed for command or code execution outside of the victim network .", "658": "Many of their backdoors were web applications , added to web servers , so commands can be executed from a browser or client able to communicate with them .", "659": "This group includes the results of the Shell Creator mentioned in the Attribution section , as well as ASPX backdoors used by Nesha .", "660": "A PHP shell was also observed , which also included attribution to Nesha in its hashed password .", "661": "An ASPX backdoor named Zh0uSh311 was located on live servers as well as recovered fro a staging server .", "662": "Its functionality breaks down into three fairly standard components : SQL queries , executing commands , and uploading files .", "663": "This organization utilized backdoors which masqueraded as varying versions of Notepad .", "664": "They replace the existing Notepad.exe on the infected machine , and when run they call out to a remote server and execute any shell code returned by the remote server .", "665": "The components are as follows : XYNTService was not developed by the Cleaver team , but instead is a publicly available project which executes an executable as a service .", "666": "The purpose of PVZ-In is to communicate with a command and control server .", "667": "The known command and control server is located at http : //kundenpflege . menrad ( dot ) de/js/jquery/default.aspx and the command and control protocol only uses HTTP .", "668": "The commands as well as infected computer information are transferred in the Content- Disposition HTTP header , making the traffic easy to pass over as benign .", "669": "When a command is received from the server , the results are stored in a central location on disk that the PVZ tools utilize .", "670": "Command functionality is limited to executing supplied commands , downloading and executing executables as well as self-updating .", "671": "PVZ-Out is the other half of the command and control channel , primarily uploading results of commands and keystroke logging data to a remote server .", "672": "The known command and control server for PVZ-Out is located at http : //www.gesunddurchsjahr ( dot ) de/tor/default.aspx .", "673": "Much like PVZ-In , this command and control channel communicates with the Content-Disposition HTTP header , but for file data , POST data is supplied .", "674": "Data uploaded is often compressed , which can make it more difficult to detect the exfiltration of sensitive information .", "675": "SYN Flooder is a simple network based denial of service tool .", "676": "It is a command line utility capable of being invoked by PVZ-In .", "677": "Logger Module observes the user 's actions and records them to a file .", "678": "The recorded actions include mouse clicks , active windows , keypresses , as well as clipboard data .", "679": "The resulting log is written out to a location where PVZ-Out can exfiltrate it to its command and control server .", "680": "The following command and control servers for Logger Module have been observed : WndTest is the evolution of the PVZ tool chain into a single executable .", "681": "The tool chain is minimized down to a command and control communications , keystroke logging , and clipboard monitoring .", "682": "The command and control still supports upgrading , downloading , and executing of applications , as well as executing batch scripts .", "683": "WndTest installs as a service and has been observed attempting to impersonate Adobe Report Service .", "684": "WndTest starts using PHP servers for its command and control server , some of which are listed as defaced sites .", "685": "We have seen wndTest communicate with the following servers : Csext is a backdoor application developed in C # which runs as a service .", "686": "A recovered configuration is as follows : This configuration executes zhCat to connect back to srv01.microsoftwindowsupdate ( dot ) net ( a deceptive domain owned by this group with falsified Whois data attributing to Microsoft Investor Relations ) with XORed communication using the HTTP protocol on TCP port 443 .", "687": "This zhCat instance is running cmd.exe , effectively making it a reverse connecting shell .", "688": "This command runs at 00:29 in the morning , and is killed by taskkill at 00:35 .", "689": "This gives the attackers a predictable method to regain access to a compromised network if they ever lose access .", "690": "Csext also has email functionality similar to TinyZBot .", "691": "This email functionality is used to exfiltrate the results of commands from the command file which can also include requests like gathering user information .", "692": "We have seen Csext configured to communicate with the following servers : If after reviewing the Indicators of Compromise ( IOC ) listed in Appendix A , you believe your organization to be a victim of Operation Cleaver , we recommend you consider the following course of action : 1 .", "693": "Downloaders , injectors , infostealers Example md5s of files detected with Kaspersky 's Virus.Win32.Pioneer.dx and Symantec 's Infostealer.Nemim ! inf : To ensure only single instance of the module is running , the module verifies if system mutex named \u00ab132DF6E\u00bb exists .", "694": "The module implements a method to resist running in virtual environment .", "695": "It gets CPU name and identifier from the registry at HKLM\\HARDWARE\\DESCRIPTION\\ System\\CentralProcessor\\0 and collects IP and MAC addresses of local network adapters .", "696": "Then the module attempts to delete some other , prob- ably older , components which might be present on the system .", "697": "The list of deleted files includes the following : The next is step is to check if current directory has a file named \u00abU\u00bb .", "698": "If \u00abU\u00bb file is older than 180 days , the module wipes the file .", "699": "If not , it triggers a special variable that makes module dormant and dis- ables further communication with C & C server .", "700": "The module connects to autolace.twilightparadox.com ( or automachine . servequake.com ) and issues a HTTP GET request with hardcoded User\u00adAgent string : The server response should contain \u00abDEXT87\u00bb string which is used to rec- ognize valid response .", "701": "If the real C & C IP address is not valid the module may try to send identical request again but using a different HTTP path : If the C & C IP address is valid , the module issues another HTTP request : The server response can be one of the following : Where < DATASIZE > is a decimal integer that represents length of < DATA > field in bytes\u037e < DATA > is a binary data separated from < DATASIZE > field by semicolon .", "702": "Please note , that after receiving < DATA > , it is XORed with byte value 0x55 and saved to a disk in a file named \u00abctfmon.exe\u00bb ( current directory is used ) .", "703": "This module is relatively large ( 455Kb ) and comes as a part of WinRar SFX file that drops and starts the module from % APPDATA % \\Microsoft\\Display\\DmaUp3 . exe .", "704": "The main purpose of the module is to collect various secrets stored on a local system .", "705": "From the very beginning this module checks if \u00abbdagent.exe\u00bb process is running on current system .", "706": "If it is running , it uses simple AV heuristics evasion technique .", "707": "The code starts a thread that simulates keystrokes of ESC keyboard key and then shows a system modal message box .", "708": "Right after that keystroke generation thread is terminated and the module continues normal execution as if \u00abbdagent.exe\u00bb was not running .", "709": "Next the module makes sure only one instance of current code is running by checking if system mutex object named \u00ab920111215\u00bb exists .", "710": "After that , the mod- ule collects information about current system which includes the following : If the module reveals that current System default codepage is 0412 ( Korean ) it terminates .", "711": "So far , the attackers can steal logins and pass- words but to understand where they are from they must guess the string which produced given hash .", "712": "When IntelliForms information is stolen the malware tries to check the list of known login page URLs to recover the originating webpage address .", "713": "Here is the list of URLs that are checked by the malware : The list of targeted services includes some local services specifically popular in : The module uses several simple XOR\u00adbased algorithms to encrypt embedded string data .", "714": "In addition it makes use of the following Mozilla Firefox libraries depending on Firefox version : When stealing secrets from Firefox and Chrome it uses built\u00adin SQLite library code .", "715": "After stealing secrets from local system the malware executes some kind of embedded script .", "716": "It is logging all actions to inform the operator what exactly was executed by this variant of the malware .", "717": "The result of this execution is appended to the stolen data and uploaded to the C & C server .", "718": "The module uploads all collected information to one of the following URLs via POST request : It 's the first time we see .pn", "719": "The malware uses fixed User\u00adAgent string : The data is uploaded as a POST request binary in the following format : where < UserId > is hardcoded identifier ( i.e .", "720": ": If the server reply contains a keyword \u00abminmei\u00bb it continues sending additional in- formation .", "721": "A quote from Wikipedia : \u00abBorn in Yokohama Chinatown , Japan ( though she is of partial Chinese descent ) as Linn Minmei , Minmay moved in with her uncle Shaochin ( \u5c11\u6c5f ) and aunt Feic- hun ( \u6167\u4e2d ) on South Ataria Island in hopes of finding the path to fulfill her dream of becoming a star.\u00bb The trojan iterates through running processes and looks for security software basing on executable filenames from the list below .", "722": "If the process is found it keeps a record of the software name using short AV Identifier string from the fol- lowing table of rules The malware uses a trick to evade running on a VMware .", "723": "First , it checks if cur- rent process is running in WOW64 environment .", "724": "Another method to detect VM en- vironment is to check local network adapter 's IP address .", "725": "If VM is detected the process instantly terminates .", "726": "Next the malware submits collected information to the C & C server using HTTP GET request and the following URL format : http : // < C2DOMAIN > /bin/readi.php ? a1= % STEPID % & a2= % HOSTID % & a3= % SYSINFO % & a4= % AVSOFTID % , where % C2DOMAIN % is one of the following C & C domains : % STEPID % is special text string indicating stage of malware operation .", "727": "Igfxext.exe can download a file and drop it to % APPDATA % \\microsoft\\dis- play\\ctfmon.exe ( md5= e8bfb82b0dd5cef46116d61f62c25060 ) .", "728": "After execution , the downloaded file drops SMAGENT.EXE ( md5 0306f9ae- 7786570139f78e78bc940597 ) to % APPDATA % \\MICROSOFT\\DISPLAY and ex- ecutes it .", "729": "This component is a virus , and is used to selectively infiltrate into other computers via USB or network shares .", "730": "These files are all legitimate files that have been infected by another Darkhotel component .", "731": "All of these infected files drop a 63kb self injecting compo- nent .", "732": "The igfxext.exe component is dropped to disk and run .", "733": "It spawns an- other suspended process with its own igfxext.exe image , but decrypts a smaller 32kb executable ( cf1319d94f33380622ba000b7d8ad6e9 , Trojan\u00adDownloader .", "734": "The running process overwrites the igfxext.exe image in the suspended process with this smaller chunk of code .", "735": "This smaller code section maintains similar functionality to the '' worm '' compo- nent : Host package files detected as '' Virus.Win32.Pioneer.dx '' are infected legitimate files , that do not have any self\u00adpropagation routines .", "736": "This sample is started by code running within svchost.exe on WinXP SP3 .", "737": "It drops a keylogger .", "738": "The debug path inside : The dropper above maintains , drops and installs this kernel mode keylogger : Likely , it was developed as a part of a mid\u00adto\u00adlate 2009 project : This driver package is built to look like a legitimate low level Microsoft system device .", "739": "It is installed as a system kernel driver '' Ndiskpro '' service , described as a '' Microcode Update Device '' .", "740": "It is somewhat surprising that there is no rootkit functionality hiding this service : When loaded , the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff , and retrieves keystroke data directly from port 0x60 , the motherboard keyboard con- troller itself .", "741": "This component then encrypts and writes the retrieved values ondisk to a ran- domly named .tmp , file like ffffz07131101.tmp .", "742": "This file is located in the same directory as the original dropper , which maintains persistence across reboots with a simple addition to the HKCU run key .", "743": "This keylogger module encrypts and stores gathered data in a log file , as men- tioned previously .", "744": "The actor 's offensive activity can be tied to specific hotel and business center Wi\u2011Fi and physical connections , some of it is also tied to p2p/file sharing networks , and they have been known to spear-phish targets as well .", "745": "The following list presents a set of characteristics for the crew : When unsuspecting guests , including situationally aware corporate executives and high-tech entrepreneurs , travel to a variety of hotels and connect to the internet , they are infected with a rare APT Trojan posing as any one of several major software releases .", "746": "This first stage of malware helps the attackers to identify more significant victims , leading to the selective download of more advanced stealing tools .", "747": "At the hotels , these installs are selectively distributed to targeted individuals .", "748": "Addition- ally , seeding p2p networks with widely spread malware and 0-day spear-phishing attacks demonstrate that the Darkhotel APT maintains an effective toolset and a long-running operation behind the questionable hospitality it shows its guests .", "749": "The Darkhotel APT 's precise malware spread was observed in several hotels' networks , where visitors connecting to the hotel 's Wi-Fi were prompted to install software updates to popular software packages .", "750": "Of course , these packages were really installers for Darkhotel APT 's backdoors , added to legitimate installers from Adobe and Google .", "751": "Digitally signed Darkhotel backdoors were installed alongside the legitimate packages .", "752": "The most interesting thing about this delivery method is that the hotels require guests to use their last name and room number to login , yet only a few guests received the Darkhotel package .", "753": "As a part of an ongoing investigation , our research led us to embedded iframes within hotel networks that redirected individuals ' web browsers to phony install- ers .", "754": "The attackers were also very careful to immediately delete all traces of their tools as soon as an attack was carried out successfully .", "755": "The attackers set up the environment and hit their individual targets with precision .", "756": "As soon as their target 's stay was over and the attack-frame was closed , the attackers deleted their iframe placement and backdoored executables from the hotel network .", "757": "The attackers successfully de- leted traces of their work from earlier attacks in another hotel , but their offensive techniques were the same .", "758": "But the attackers also maintain truly precise targeting information over the victim 's visit , much like they would know a victim 's email address and content interests in a spearphishing attack .", "759": "This data enables the attackers to present the malicious iframe precisely to that individual target .", "760": "An example of the Darkhotel APT 's indiscriminate malware spreading is dem- onstrated by the way it seeds Japanese p2p sharing sites , where the malware is delivered as a part of a large ( approximately 900mb ) rar archive .", "761": "The archive is also spread over bittorrent , as detailed below .", "762": "Darkhotel uses this method to distribute their Karba Trojan .", "763": "This Darkhotel package was downloaded over 30,000 times in less than six months .", "764": "But what looks like the AxDecrypt.exe decryptor is bound to both the true decryptor and the dropper for the Darkhotel Catch.exe Karba Trojan .", "765": "When a user downloads the torrent and decrypts the zip files , the trojan surrepti- tiously is installed and run on the victim system .", "766": "Catch.exe , detected as Backdoor.Win32.Agent.dgrn , communicates with the fol- lowing Darkhotel command and control servers : Other examples of this Darkhotel backdoor bound within a shared torrent include adult content Japanese anime and more .", "767": "The associated Darkhotel backdoor was hosted on bittorrent , emule , etc , under a variety of comic names .", "768": "Related Darkhotel command and control server domains include : Darkhotel campaigns involving typical spear-phished Tapaoux implants publicly appeared in bits and pieces several times over the past five years .", "769": "This spear-phishing activity continues into 2014 .", "770": "The attacks follow the typical spear-phishing process and in the past couple of months , exploited systems retrieved downloader executables from web servers like Over the past few years the group has emailed links that redirect targets ' brows- ers to Internet Explorer 0-day exploits .", "771": "Sometimes the attachment itself includes an Adobe 0-day exploit .", "772": "In the past few years , they deployed 0-day spear-phishing attacks targeting Adobe products and Microsoft Internet Explorer , including cve\u00ad2010\u00ad0188 .", "773": "The crew spear-phished a set of target systems connected to the Internet through Chinese ISPs , and developed capabilities within the 0-day exploits to handle hardened Windows 8.1 systems .", "774": "It 's interesting that the Flash objects were embedded in Korean documents titled '' List of the latest Japanese AV wind and how to use torrents.docx '' ( loose English translation ) .", "775": "The dropped downloader ( d8137ded710d83e2339a97ee78494c34 ) delivered malcode similar to the '' Information Stealer '' component functionality summarized below , and detailed in Appendix D .", "776": "These weak encryption keys , when broken , could allow an attacker to use the certificates fraudulently to spoof content , perform phishing attacks , or perform man\u00adin\u00adthe\u00admiddle attacks against all Web browser users including users of Internet Explorer .", "777": "One of the most interesting components that we discovered as a part of this cam- paign was the use of a digitally\u00adsigned advanced keylogger .", "778": "This keylogger is dropped by code running within svchost.exe on WinXP SP3 , which maintains an interesting debug string : It probably was developed as a part of a mid-to-late 2009 project : e : \\project\\2009\\x\\totalsource\\32bit\\ndiskpro\\src\\ioman.c This driver package is built to resemble a legitimate low-level Microsoft system device .", "779": "It is installed as a system kernel driver '' Ndiskpro '' service , described as a '' Microcode Update Device '' .", "780": "It is slightly surprising that no rootkit functionality hides this service : When loaded , the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff , and retrieves keystroke data directly from port 0x60 , the motherboard keyboard con- troller itself .", "781": "This component then encrypts and writes the retrieved values ondisk to a randomly named .tmp , file like ffffz07131101.tmp .", "782": "This file is located in the same directory as the original dropper , which maintains persistence across reboots with a simple addition to the HKCU run key .", "783": "This keylogger module encrypts and stores gathered data in a log file , as men- tioned previously .", "784": "These tools are dropped by hotel installers spoofing legiti- mate software installers , bound within torrent bundles , or dropped by exploits or hypertext linked from spear-phishing emails .", "785": "More advanced tools , like the keylogger decribed above , are later downloaded to the victim system by one of these implants .", "786": "In a recent case , word docs embed- ded with 0-day flash swf files either dropped these backdoors or downloaded and executed backdoors from remote web servers .", "787": "These tools pull down the keylog- ger , steal information from the system , or download other tools .", "788": "The most interesting behaviors of these components include This module is quite small ( 27Kb ) and comes as a part of WinRar SFX file that drops and starts the module from % APPDATA % \\Microsoft\\Crypto\\DES64v7\\msieckc.exe .", "789": "This module is designed to update malicious components through recurring checks at the C & C server .", "790": "It is also capable of removing some older components , the names of which are hardcoded in the body of the malware .", "791": "The module adds autorun registry settings to enable an automatic start during system boot .", "792": "One of the most interesting functions of this executable is its unusual delay and persistence .", "793": "So , if some other critical malicious component was removed during this period , current module backs up and restores access to the system within 6 months .", "794": "The component gathers system information and sends it to the Darkhotel com- mand and control servers as detailed in Appendix D. This module is relatively large ( 455Kb ) and comes as a part of a WinRar SFX file that drops and starts the module from % APPDATA % \\Microsoft\\Display\\DmaUp3 . exe .", "795": "The main purpose of the module is to collect various secrets stored on a lo- cal system and upload them to Darkhotel command and control servers : This module is designed to terminate itself on Windows with the system de- fault codepage set to Korean .", "796": "It was built as MFC framework application with a lot of extra calls that should have complicated the analysis of the sample .", "797": "It mim- ics a GUI desktop application but it does not create any visible windows or dialogs to interact with local users .", "798": "The Trojan collects data about the system and anti\u00ad malware software installed on it , and uploads that data to Darkhotel command and control servers .", "799": "It is bound to a variety of other software packages that vary in name , but the host package is consistently detected as '' Virus.Win32 .", "800": "It drops the igfxext.exe '' selective infector '' component to disk and runs it .", "801": "This component is a virus , and is used to selectively infiltrate into other comput- ers via USB or network shares .", "802": "First , the virus retrieves all available disks and starting from disk number 4 ( D : \\ ) to disk number 20 ( Z : \\ ) , finds executable files and infects them .", "803": "The code simply brute forces the list of mapped removable drives .", "804": "During its infection routine , the infector changes the entrypoint of executable files , creates an .rdat section , and inserts a small loader in the section , then puts its main payload in the overlay .", "805": "Every infected file has functionality described in Trojan\u00adDropper & Injector section , so it can collect information about the comput- er , send it to the C2 and download other Darkhotel components as commanded .", "806": "Again , further technical details are provided in Appendix D. Almost every backdoor in this set maintains an internal campaign code or id , used in initial c2 communications as described above .", "807": "Because the operators very actively build up new command and control serv- ers , it is difficult to sinkhole enough domains to get an accurate overall picture of victim system location based on this data .", "808": "Many of these c2s maintain a common directory path that serves a ddrlog .", "809": "A description of the detailed connectback URL values and their xor/base64 encoding scheme is included in the '' Interesting Malware Trojan.Win32.Karba.e '' technical notes in Appendix D. The Darkhotel c2 maintain these directory structures to store and serve ddrlog content : The following structures appear to be common across servers , but do not pro- duce ddrlog and do not maintain an /error/ directory : Two ddrlog files report entries starting January 1 , 2009 at 9:16 a.m. All of the logs maintain a significant number of entries , almost 50,000 , with a simple stamp '' B '' or '' L '' .", "810": "Typical main page : For begatrendstone.com , we have the following directory structure : The group encrypts victim data on their servers with single user/passkey combi- nations across multiple victims .", "811": "New victim systems appear to be systematically vetted .", "812": "The attackers maintain a web interface to vet these new victim systems .", "813": "The attackers first and foremost list and sort victim systems according to their latest c2 check\u00adin .", "814": "This is becoming more and more common on the APT scene , where targeted attacks are used to compromise high profile victims and botnet style operations are used for massive surveillance or performing other tasks such as launching DDoS attacks on hostile parties or simply upgrading victims to more sophisticated espionage tools .", "815": "Both backdoors were dropped from malicious documents built utilizing the \" Tran Duy Linh \" exploit kit , which exploited CVE-2012 - 0158 .", "816": "From October 2012 to May 2014 , FireEye observed APT12 utilizing RIPTIDE , a proxy - aware backdoor that communicates via HTTP to a hard - coded command and control ( C2 ) server .", "817": "We suspect this change was a direct result of the Arbor blog post in order to decrease detection of RIPTIDE by security vendors .", "818": "On Sunday August 24 , 2014 we observed a spear phish email sent to a Taiwanese government ministry .", "819": "The exploit document dropped the HIGHTIDE backdoor with the following properties .", "820": "FireEye observed APT12 deliver these exploit documents via phishing emails in multiple cases .", "821": "Based on past APT12 activity , we expect the threat group to continue to utilize phishing as a malware delivery method .", "822": "When the file is opened , it drops HIGHTIDE in the form of an executable file onto the infected system .", "823": "The RIPTIDE exploit document drops its executable file into the C:\\Documents and Settings\\{user}\\Application Data\\Location folder while the HIGHTIDE exploit document drops its executable file into the C:\\DOCUMENTS and SETTINGS\\ { user}\\LOCAL SETTINGS\\Temp\\ folder .", "824": "On Monday August 25 , 2014 we observed a different spear phish email sent from lilywang823@gmail.com to a technology company located in Taiwan .", "825": "This spear phish contained a malicious Word document that exploited CVE-2012 - 0158 .", "826": "Similar to the newly discovered HIGHTIDE samples documented above , this malicious document dropped a backdoor to C:\\DOCUMENTS and SETTINGS\\{user}\\LOCAL SETTINGS\\Temp\\word.exe .", "827": "On August 25 , 2014 , we observed another round of spear phishing emails targeting a high - technology company in Japan .", "828": "Attached to this email was another malicious document that was designed to exploit CVE-2012 - 0158 .", "829": "This malicious Word document had an MD5 of 499bec15ac83f2c8998f03917b63652e and dropped a backdoor to C:\\DOCUMENTS and SETTINGS\\{user}\\LOCAL SETTINGS\\Temp\\word.exe .", "830": "Similar to RIPTIDE and HIGHTIDE , the WATERSPOUT backdoor is an HTTP - based backdoor that communicates with its C2 server .", "831": "These compromises were discovered following the identification of malicious JavaScript that had been added to legitimate code on the impacted websites .", "832": "This code meant that visitors were potentially subjected to exploit and malicious Java Applets designed to install malware on their systems .", "833": "Alliance for True Democracy \u20ac \" Hong Kong Over the last two days , Volexity has observed malicious code being served up from the website of the Alliance for True Democracy ( ATD ) in Hong Kong ( www.atd.hk ) .", "834": "While examining the ATD website , Volexity also observed that the site had a password protected backdoor webshell placed on it .", "835": "Attackers will often upload new webshells or add simple China Chopper style modifications to legitimate existing files in an attempt to maintain persistence to these systems .", "836": "Like the ATD website , at the time of this writing the DPHK websites are also serving up malicious code , so please browse with caution .", "837": "It is also worth noting that this is not the first time that the DPHK website has been used in a strategic web compromise .", "838": "Back in May 2011 , Kaspersky Lab reported the website was being leveraged to target users with Flash Exploits .", "839": "During the course of investigating activity related to the ATD and DPHK websites , Volexity also observed that the website of the political coalition and pan - democratic organization People Power in Hong Kong ( www.peoplepower.hk ) had been compromised as well .", "840": "These pages load scripts that conduct profiling of the system for various software , plugins , and other related information , as well as load Java exploits designed to install malware on the target system .", "841": "If successful , the exploits will install either a 32-bit or 64-bit version of the malware .", "842": "At the time of this writing , the People Power website is still serving up malicious code .", "843": "This system hosted a JavaScript file , which in turned loads a malicious Java Applet .", "844": "jduhf873jdu7.blog.163.com The PlugX sample connects to the blog and parses the page for a command for where to connect to next .", "845": "In the case of this post , it appears that at least two different attackers were involved in compromising and placing malicious code on Pro - Democratic websites in Hong Kong .", "846": "This report will focus on the server - client variant ( or simply , the \" server variant \" ) of Derusbi , which acts as a server on a victim 's machine and waits for commands from a controlling client .", "847": "What makes the server variant interesting is the device driver that the variant installs .", "848": "The server variant utilizes a device driver in order to hook into the Windows firewall by either using largely undocumented Windows Firewall hooking techniques found in Windows XP and older or by using the documented Windows Filtering Platform found in Windows Vista and later .", "849": "The driver , after hooking the firewall using either of the two mentioned interfaces , will inspect incoming network packets .", "850": "This allows an attacker to hide their communication within a cluster of network sessions originating from a single IP such as would be the case for a client performing multiple HTTP requests against a web server .", "851": "When loaded into memory via a LoadLibrary or equivalent function call , the server variant will determine the name of the host binary ( presumably svchost.exe ) as well as its own DLL 's name .", "852": "The binary then spawns a new thread that contains the main server variant code in order to allow the DllEntryPoint routine to return to the calling function .", "853": "The server variant then attempts to determine if it has suitable access rights within the system in order to operation .", "854": "The check for access rights effectively checks to see if the server variant process is running under the NT Authority .", "855": "The DllRegisterServer function , among other tasks , will attempt to install the server variant as a server on the victim 's machine .", "856": "The mainLoop function begins by loading the unique infection ID for the victim 's machine from the registry ( under the key value located at HKLM\\SOFTWARE\\Microsoft\\Rpc\\Security ) .", "857": "The mainLoop attempts to get the privileges for SeDebugPrivilege , SeLoadDriverPrivilege , SeShutdownPrivilege , and SeTcbPrivilege in order to perform the necessary operations to load the driver portion of the server variant .", "858": "With a new PCC_SOCK object allocates , DerusbiThread::DerusbiThread selects a port between 40,000 and 45,000 to use as a listening port .", "859": "DerusbiThread::DerusbiThread binds to the specified port and opens the port as a listener .", "860": "The device driver inspects incoming network traffic from any client connecting to the victim machine , determines if an appropriate handshake packet occurs at the beginning of a new TCP session , and then makes the decision to reroute the network traffic to the Derusbi malware or let the traffic continue unaltered to its original service .", "861": "The Derusbi server variant will select an available , random port between the range of 40,000 and 45,000 on the victim 's machine upon which to listen .", "862": "After selecting the port , the server variant will wait for incoming connections and instruct the driver to redirect appropriate TCP sessions to the listening port .", "863": "After sending the server information via the VictimInfoPacket , the server variant spins off a CommLoop thread for the connection and returns to waiting for new connections from clients to appear .", "864": "CommLoop routes packets to the appropriate command handler object by locating the dwPacketIdentifierCode within each of the registered command handlers that matches the incoming packets dwPktType .", "865": "Given the set of commands it can receive , Dino 's main goal seems to be the exfiltration of files from its targets .", "866": "Roughly , Dino can be described as an elaborate backdoor built in a modular fashion .", "867": "Among its technical innovations , there is a custom file system to execute commands in a stealthy fashion , and a complex task scheduling module working in a similar way to the \" cron \" Unix command .", "868": "This is used in particular by the PSM module to save the content of Dino modules in an encrypted file .", "869": "\" ComServer \" : These keys contain the command and control ( C&C ) servers ' URLs .", "870": "\" BD_Keys \" and \" CC_Keys \" contain cryptographic keys to encrypt the network communications with C&C servers .", "871": "One command of particular interest is \" search \" , which allows the operators to look for files very precisely .", "872": "The result is reported to the C&C server .", "873": "Dino contains a custom file system named \" ramFS \" by its developers .", "874": "It provides a complex data structure to store files in memory , each of them bearing a name corresponding to filenames used by usual file systems .", "875": "Several commands can be executed in the context of ramFS , as listed in the following Table .", "876": "In the case of Dino , ramFS serves as protected storage for one specific file containing the instructions to remove the malware from the machine .", "877": "The cleaner file contains the string \" INSTALL A \" wusvcd \" U \" which , once executed , will uninstall the malware from the machine \u2013 \" wusvcd \" being the name used to register Dino on the machine .", "878": "Hence , ramFS serves as a protected container for files to be executed on the machine , offering a disposable execution environment to the operators and leaving very few traces on the system .", "879": "The commands \" cronadd \" , \" cronlist \" and \" crondel \" serve respectively to add , list , and remove scheduled tasks registered in the CRONTAB module .", "880": "At the very beginning of Dino execution , the current process name is checked against process names used by some sandboxes .", "881": "The purpose of the downloader is to download and execute additional malware on the victim 's system .", "882": "In most observed cases , the downloader will attempt to connect to a compromised website to download an encrypted malicious payload which the downloader will decrypt and execute .", "883": "This second component , internally called \" OneDriveSolution \" , is especially interesting because it relies on Microsoft 's cloud storage service OneDrive as its command and control channel .", "884": "If successful , OneDriveSolution will then proceed to copy data from the victim 's computer to the OneDrive account .", "885": "It will also search the OneDrive account for files containing commands for the malware to execute .", "886": "All of the CloudDuke \" solutions \" use the same loader , a piece of code whose primary purpose is to decrypt the embedded , encrypted solution , load it in memory and execute it .", "887": "In most cases , executing these executables will have resulted in two additional files being written to the victim 's hard disk .", "888": "The purpose of the downloader is to download and execute additional malware on the victim 's system .", "889": "In most observed cases , the downloader will attempt to connect to a compromised website to download an encrypted malicious payload which the downloader will decrypt and execute .", "890": "If successful , OneDriveSolution will then proceed to copy data from the victim 's computer to the OneDrive account .", "891": "It will also search the OneDrive account for files containing commands for the malware to execute .", "892": "All of the CloudDuke \" solutions \" use the same loader , a piece of code whose primary purpose is to decrypt the embedded , encrypted solution , load it in memory and execute it .", "893": "In most cases , executing these executables will have resulted in two additional files being written to the victim 's hard disk .", "894": "Some of the strings in Duqu 2.0 are obfuscated by XOR - based encryption .", "895": "The analyzed main module of Duqu 2.0 and also the old Duqu sample reads configuration information from a special file .", "896": "We 've identified a characteristic logging function that is present in both Duqu and Duqu 2.0 , and is used extensively in the networking ( mainly HTTP handling ) part of the code .", "897": "The malware can transmit information through HTTP traffic .", "898": "It is most likely that one or more infected computers can be proxy points towards the attacker , meaning that other infected computers communicate with these proxies .", "899": "These proxies can act as HTTP or HTTPS servers .", "900": "The analyzed malware consists of a dropper and an implant , which invades Windows processes to steal data from instant messengers , softphones , browsers and office applications .", "901": "The implant is able to hook APIs of interest in dedicated remote processes , to steal data on the fly .", "902": "The dropper operates straight forward ; it fetches the encrypted DLL from its own binary from outside its resource section , decrypts it and hides it in the file system .", "903": "Then it goes on to load the DLL using Windows regsvr32.exe .", "904": "To achieve this it spawns a dedicated process with the command line ' \" regsvr32.exe \" /s /n /i \" % APPDATA%\\%DLLNAME% \" ' .", "905": "After infection the dropper executes a separate command line through spawning a cmd.exe process , which is instructed to wait for 1 second before deleting the dropper binary on disk .", "906": "This way the malware reduces forensic artefacts , staying behind after infection .", "907": "Babar 's implant is a 32-bit DLL written in C++ , which upon start injects itself to running processes and invades desktop applications by applying a global Windows hooks .", "908": "The implant is capable of logging keystrokes , capture screen shots , spy on installed softphones and instant messengers next to a list of simpler espionage tricks .", "909": "Babar operates through multiple instances , by injecting its DLL to a maximum of three desktop processes .", "910": "Apart from that , Babar comes with a userland rootkit component which applies global Windows hooks to invade all processes on its desktop .", "911": "This way Babar can install API hooks for various APIs via Windows Detours technique to actively steal data from arbitrary processes .", "912": "Babar also implements an obfuscation technique to hide certain API names .", "913": "The startup routine of the Babar implant will create a registry key under ' [ HKU]\\ .. \\CurrentVersion\\Run ' to assure persistence .", "914": "At system boot time the regsvr32.exe process will start , load the Babar DLL and thus ' deploy ' the malware to various legitimate processes .", "915": "As opposed to persistence , Babar also implements functionality to uninstall itself from the affected system .", "916": "The function stub will then go on to load the Babar DLL through LoadLibraryA and execute one of its exports , as indicated in the shared memory .", "917": "For inter process communication Babar uses named pipes .", "918": "At the same time , the main instance creates six named pipes using the very same GUID .", "919": "The spying activities are performed either through the Babar instance locally or via a global Windows hook invading all processes running in the same desktop .", "920": "Instance - local capabilities are basic spying on window names or snooping on the clipboard data , while the global hooks manage to steal information directly from Windows API calls .", "921": "The malware creates an invisible window , with no other purpose than to receive window messages .", "922": "The snooped keystroke data is passed to a thread , which performs encryption and dumps the data to a log file .", "923": "Babar is able to sniff all keystrokes happening on the same desktop as its invisible window .", "924": "The Babar implant applies global Windows hooks to load its DLL into the process space of other processes .", "925": "A global Windows hook is installed into the Windows event chain .", "926": "Once in the context of a desired target process , the malware goes on to hook specific APIs of interest .", "927": "The respective trampolines steal data going in or out of the hooked APIs on the fly .", "928": "The data , like all stolen information , is handled by a separate thread which compresses and encrypts it before dumping it to a file on disk .", "929": "For grabbing audio streams Babar includes code from the OpenCORE AMR library [ 8 ] .", "930": "The analyzed sample of Babar has two hard coded C&C server addresses which are included in its configuration data .", "931": "Both servers were used to push spied information onto the remote site .", "932": "The malware is capable of the following cyber - espionage operations .", "933": "The malware is distributed via social engineering techniques , which includes spear - phishing emails and infections via Web by a fake Blog website .", "934": "During this investigation , we also discovered many other the files installing this cyber - espionage tool in what appears to be a dedicated a spear phishing campaign .", "935": "In years past , Iranian actors primarily committed politically-motivated website defacement and DDoS attacks .", "936": "More recently , however , suspected Iranian actors have destroyed data on thousands of computers with the Shamoon virus , and they have penetrated the Navy Marine Corps Intranet ( NMCI ) , which is used by the U.S. Navy worldwide .", "937": "We have seen this group leverage varied social engineering tactics as a means to lure their targets into infecting themselves with malware .", "938": "During that time period , the Chinese hacking community engaged in website defacements and denial of service attacks in conjunction with incidents such as the accidental bombing of the Chinese embassy in Belgrade in 1999 , the collision of a U.S. spy plane and a Chinese military plane in 2001 , and the Japanese Prime Minister 's controversial visit to the Yasukuni shrine in 2005 .", "939": "However , the '' Shamoon '' attacks , which wiped computers in Saudi Arabia and Qatar , indicate an improvement in capabilities .", "940": "We have observed the Ajax Security Team use a variety of vectors to lure targets into installing malicious software and/or revealing login credentials .", "941": "These attack vectors include sending email , private messages via social media , fake login pages , and the propagation of anti-censorship software that has been infected with malware .", "942": "During our investigation , we discovered that these attackers sent targeted emails , as well as private messages through social media .", "943": "For example , the attackers targeted companies in the DIB using a fake conference page as a lure to trick targets into installing malicious software .", "944": "The attackers registered the domain '' aeroconf2014 [ . ] org '' in order to impersonate the IEEE Aerospace conference - the conference 's actual domain is aeroconf.org-and sent out an email with the following information : The email encouraged users to visit a fake conference website owned by the attackers : Upon visiting the website , visitors were notified that they must install '' proxy '' software in order to access it , which is actually malware .", "945": "The attackers have also used phishing attacks , in which they set up Web pages to emulate various services that require security credentials .", "946": "The attackers tailored these login pages for specific targets in the DIB and spoofed a variety of services such as Outlook Web Access and VPN login pages .", "947": "If users attempt to login through these fake Web pages , the attackers collect their login credentials .", "948": "In 2012 , researchers found that an anti-censorship tool that is primarily used by Internet users in Iran was bundled with malware and redistributed .", "949": "Our investigation found that malware-laden versions of legitimate anti-censorship software , such as Psiphon and Ultrasurf , were distributed to users Iran and Persian speaking people around the world .", "950": "They deliver this malware as a malicious executable ( dropper ) .", "951": "The executable is a CAB extractor that drops the implant IntelRS.exe .", "952": "This implant , in turn , drops various other components into C : \\ Documents and Settings\\ { USER } \\Application Data\\IntelRapidStart\\ .", "953": "The following files are written to disk in this location : The IntelRS.exe is written in .NET", "954": "and is aptly named '' Stealer '' , as it has various data collection modules .", "955": "It drops and launches AppTransferWiz.dll via the following command : 110 is an ordinal that corresponds to '' StartBypass '' export in AppTransferWiz.dll .", "956": "Data exfiltration is conducted over FTP by AppTransferWiz.dll , which acts as an FTP client .", "957": "There is code to exfiltrate data over HTTP POST as well , but it is unused .", "958": "We also found incomplete code that would perform SFTP and SMTP exfiltration , which could be completed in a future version .", "959": "Once the state is set , IntelRS.exe proceeds to collect data from various areas in the system as described below : IntelRS.exe loads a Delphi component called DelphiNative.DLL , which implements some additional data theft functionality for the following : The Stealer component uses common techniques to acquire credential data .", "960": "For instance , it loads vaultcli.DLL and uses various APIs shown below to acquire RDP accounts from the Windows vault .", "961": "Harvested data is encrypted and written to disk on the local host .", "962": "Analysis of the malware indicates that the data is encrypted via a Rijndael cipher implementation ; more specifically it uses AES which is a specific set of configurations of Rijndael .", "963": "Many of the malicious executables ( droppers ) that we collected were bundled with legitimate installers for VPN or proxy software .", "964": "Examples include : \u2022 6dc7cc33a3cdcfee6c4edb6c085b869d was bundled with an installer for Ultrasurf Proxy software .", "965": "\u2022 3d26442f06b34df3d5921f89bf680ee9 was bundled with an installer for Gerdoovpn virtual private network software .", "966": "\u2022 3efd971db6fbae08e96535478888cff9 was bundled with an installer for the Psiphon proxy .", "967": "\u2022 288c91d6c0197e99b92c06496921bf2f was bundled with an installer for Proxifier software .", "968": "These droppers were also designed to visually spoof the appearance of the above applications .", "969": "These droppers contained icons used in the legitimate installers for these programs .", "970": "Upon executing the 'Stealer Builder ' the user is presented with an option to load the 'Builder ' or to 'Decrypt ' logs generated from a victim and exfiltrated to a command-and-control ( CnC ) server under the groups ' control .", "971": "The Builder option enables an attacker to configure a new Stealer backdoor .", "972": "The user can configure the new backdoor to connect to a specific CnC server with a personalized username and password .", "973": "The attacker can bind the backdoor to a legitimate application of his or her choosing , or they can cloak it with an icon designed to make the backdoor appear as though it is a legitimate file .", "974": "This sample ( MD5 1823b77b9ee6296a8b997ffb64d32d21 ) was configured to exfiltrate data to ultrasms [ . ] ir .", "975": "The first cluster contains the domain used in the Aerospace Conference attack as well as the domains used in phishing attacks designed to capture user credentials : The website used in the Aerospace Conference attack was aeroconf2014 [ .", "976": "The majority of the samples we analyzed connect to intel-update [ . ] com and update-mirror [ . ] com , which were registered by james.mateo @ aim [ .", "977": "We also observed crossover with a sample that connected to both intel- update [ . ] com and ultrasms [ . ] ir , which was registered by lvlr98 @ gmail [ .", "978": "This sample is a Stealer variant that connects to the aforementioned intel-update [ . ] com as well as plugin-adobe [ . ] com .", "979": "Other domains seen resolving to IP address nearby include the following : Aside from the sample connecting to plugin- adobe [ . ] com , we have not discovered any malware connecting to these domains .", "980": "During our investigation , we were able to recover information on 77 victims from one CnC server that we discovered while analyzing malware samples that were disguised as anti-censorship tools .", "981": "As such , we believe that attackers disguised malware as anti-censorship tools in order to target the users of such tools inside Iran as well as Iranian dissidents outside the country .", "982": "This was also the email address used to register the domain aerospace2014 [ . ] org , which was used in spear phishing attacks against companies in the U.S. and is linked with malware activity directed at users of anti-censorship tools in Iran .", "983": "For example , the Ajax Security Team could just be using anti-censorship tools as a lure because they are popular in Iran , in order to engage in activities that would be considered traditional cybercrime .", "984": "Aggressive ad libraries also leak the user 's private information .", "985": "By leveraging all these vulnerabilities , an attacker can conduct more targeted attacks , which we call '' Sidewinder Targeted Attacks .", "986": "'' In this paper we explain the security risks from such attacks , in which an attacker can intercept and use private information uploaded from ad libraries to precisely locate targeted areas such as a CEO 's office or specific conference rooms .", "987": "Here , we explain how attackers can invoke Android services for tasks including taking photos , calling phone numbers , sending SMS , reading from/ writing to the clipboard , etc .", "988": "Furthermore , the attackers can exploit several Android vulnerabilities to get valuable private information or to launch more advanced attacks .", "989": "The attacker can hijack the network where the targeted victim resides .", "990": "To minimize detection chances , the attacker can choose to take action on important targets only , ignoring all other devices .", "991": "In later sections , we discuss attacking ( '' warhead '' ) and targeting ( '' homing '' ) components in detail and show how a combination of these components can launch powerful and precise attacks on target devices .", "992": "Table 1 proposes different attacks that an attacker can launch remotely on target devices through vulnerable ad libraries .", "993": "The left panel enables the attacker to command the victim 's device , including uploading local files , taking pictures , recording audio/video , manipulating the clipboard , sending SMS , dialing numbers , implanting bootkit , or installing the attacker 's apps uploaded to Google Play , etc .", "994": "The right panel lists all information stolen from the victim 's device .", "995": "In this screenshot , the victim's installed app list , clipboard , a photo taken from the back camera , an audio clip , and a video clip have been uploaded , with the GPS location intercepted from the ad library .", "996": "The panel also pins down the GPS location of the victim's device onto a Google Map widget .", "997": "As noted by Google : '' Use of this method in a WebView containing untrusted content could allow an attacker to manipulate the host application in unintended ways , executing Java code with the permissions of the host application .", "998": "'' In particular , if an app running on Android API 16 or below uses the JavaScript binding method addJavascriptInterface and loads the content in the WebView over HTTP , an attacker over the network could hijack the HTTP traffic ( e.g. , through WiFi or DNS hijacking ) to inject malicious content into the WebView and to control the host application .", "999": "Listing 1 is a sample Javascript snippet to execute shell command .", "1000": "If an app containing such vulnerability has sensitive Android permissions such as access to the camera , a remote attacker could exploit it to perform sensitive tasks such as taking photos or recording video , over the Internet , without consent .", "1001": "However , if an ad library uses the @ JavascriptInterface annotation to expose security-sensitive interfaces , and uses HTTP to load content in the WebView , it is vulnerable to attacks where an attacker over the network could inject malicious content into the WebView to misuse the interfaces exposed through the JS binding annotation .", "1002": "Given that this ad library loads ads using HTTP , if the host app has the corresponding permissions ( e.g. , CALL PHONE ) , attackers over the network can abuse these interfaces to do malicious things ( e.g. , utilizing the makeCall interface to dial phone numbers without the user 's consent ) .", "1003": "If the attackers can hijack the communication channels and inject malicious DEX files , they can then control the behaviors of the victim apps .", "1004": "After getting local access , the attacker can upload private and sensitive files from the victim 's device , or modify files that the host app can write to ( e.g. , the directory of the host app and SD Card with FAT file system ) .", "1005": "To launch more sophisticated attacks like sending SMS or taking pictures , the attackers may use Java reflection to call other APIs from the Javascript bridge .", "1006": "One direct threat posed by JBOH is to use the JBOH shell ( Listing 1 ) to download exe- cutables and use them to root the device .", "1007": "Thus , as long as attackers can get the JBOH shell , they have the tools to obtain root on most Android phone models .", "1008": "Even if the attackers ca n't obtain root , they can attempt ptrace to control the host app .", "1009": "A simple call does the job , as shown in Listing 2 To make calls from the Javascript bridge without user consent , we can invoke the telephony service to dial numbers directly via binder , as shown in Listing 3 , where phone is the remote Android telephony service and the number 2 represents the second remote call .", "1010": "As shown in Listing 5 , an attacker can load executables compiled from JNI code .", "1011": "Once loaded , the code can obtain context as described in Listing 4 , or call DexClassLoaderload to inject new classes from the attackers ' DEX files to register callbacks to take pictures/ record videos .", "1012": "With the Android context , an attacker can monitor or tamper with the clipboard .", "1013": "Malicious apps can steal the passwords if they can read the contents on clipboard .", "1014": "Any UID has the capability to manipulate clipboard via the API calls in Listing 6 : Using these APIs , the attackers can monitor changes to a clipboard and transfer the clipboard contents to some remote server .", "1015": "They can also alter the clipboard content to achieve phishing goals .", "1016": "For example , the user may copy a link to visit and the background malicious service can change that link to a phishing site .", "1017": "For example , the attackers can manipulate Android home screen icons using two normal permissions : launcher READ SETTINGS and WRITE SETTINGS permissions .", "1018": "As a proof-of-concept attack scenario , a malicious app with these two permissions can query/insert/ alter the system icon settings and modify legitimate icons of some security- sensitive apps , such as banking apps , to a phishing website .", "1019": "With both the GET ACCOUNTS and the USE CREDENTIALS permissions , Android pro- cesses can get secret tokens of services ( e.g. , Google services ) from the AccountManager and use them to authenticate to these services .", "1020": "We verified that Android apps with these two permissions can authenticate themselves with the user 's Google account , allowing access to Google Play and the ability send app installation requests .", "1021": "Through the Javascript bridge , attackers can install apps of choice ( e.g. , an attacker 's phishing app ) to any devices registered in user 's account in the background without user consent .", "1022": "Combined with the launcher modification attack introduced earlier , the attackers can redirect other app icons ( e.g. , bank or email app icons ) to the phishing app and steal the user 's login credentials .", "1023": "In this section , we explain the risks of victims ' devices being tracked and targeted through ad traffic .", "1024": "Though ad libraries may not have the incentive to abuse users ' private and sensitive data , this is not the case with the attackers eavesdropping or hijacking the HTTP traffic .", "1025": "We successfully launched Man-in-the- Middle ( MITM ) attacks and intercepted the data uploaded to the remote server .", "1026": "However , with this information , an attacker can precisely locate the victim and acquire the device 's specifications .", "1027": "Unfortunately , several well-known attacks can be used to achieve large-scale monitoring , including DNS hijacking , BGP hijacking , and ARP hijacking in IDC .", "1028": "In this context , DNS hijacking is done to subvert the resolution of Domain Name System ( DNS ) queries through modifying the behavior of DNS servers so that they serve fake DNS information .", "1029": "Attackers successfully compromised many DNS servers , including the ones from Google and Godaddy .", "1030": "By DNS hijacking , attackers can effectively access all the traffic to ad servers .", "1031": "BGP hijacking takes over groups of IP addresses , corrupting Internet routing tables by breaking BGP sessions or injecting fake BGP information .", "1032": "This enables attackers to monitor all traffic to specific IPs .", "1033": "ARP hijacking ( or spoofing ) in IDC is done to hijack the traffic to the ad server in the IDC where the ad server locates through fake ARP packets .", "1034": "Attackers may rent servers close to the target servers , and use fake ARP packets to direct all the traffic to go through the hijacking servers first for monitoring and hijacking .", "1035": "ARP hijacking is a well-known approach used in network attacks .", "1036": "Using the large-scale traffic intercepted from the above methods , attackers can iden- tify potential victims based on information leakage such as GPS location described in Sec- tion 4.2 .", "1037": "After that , they can inject exploits only into the targeted traffic to launch further attacks .", "1038": "Attackers keep a low profile by allowing all other irrelevant network traffic to pass without being modified .", "1039": "In the current golden age of Android ad libraries , Sidewinder Targeted Attacks can target victims using info leakage and other vulnerabilities of ad libraries to get valuable , sensitive information .", "1040": "They also need to be cautious about which privileged interfaces are exposed to the ad providers , in case of malicious ads or attackers hijacking the communication channels .", "1041": "As seen , the malware uses a number of RATs to control its victims or track their activity .", "1042": "Stolen data was packed and sent encrypted over HTTP random ports .", "1043": "From what we have seen so far , the malware is being delivered as a Microsoft Office Word ( .doc ) email attachment , containing a malicious macro called AutoOpen .", "1044": "The malware is in plain view , modifying commonplace registry entries , such as the startup configurations , and not covering its tracks .", "1045": "Hikit consists of at least two generations of malware that provides basic RAT functionality .", "1046": "The first generation of Hikit ( referred to as '' Gen 1 '' ) operates as a server and requires an externally exposed network interface in order for an attacker to access the victim machine .", "1047": "The second generation of Hikit ( referred to as '' Gen 2 '' ) uses the more traditional client model and beacons out to an attacker 's C2 server .", "1048": "While the communication models shifted dramatically between Gen 1 and Gen 2 , both generations of Hikit retain the same basic RAT function consisting of remote command shell , file management , network proxy and port forwarding .", "1049": "Both Gen 1 and Gen 2 sub-families of Hikit consist of a main DLL ( referred to as '' the DLL '' ) that contains the RAT functionality ; a kernel driver ( referred to as '' the Driver '' ) with Gen 2 also employs an additional component : a loader executable .", "1050": "The Gen 1 Driver listens to network traffic arriving at the local network interface and waits for a specific trigger string .", "1051": "The Gen 2 Driver is a simpler system driver that acts as a rootkit to hide processes , registry keys and network connections associated with Gen 2 activity on the victim 's system .", "1052": "In Gen 1.2 , the communication between the infected machine and the attacker is encrypted using an XOR mask .", "1053": "The DLL will send a legitimate SSL certificate as a means to disrupt heuristic IDS sensors that look for encrypted traffic .", "1054": "The Driver intercepts any and all network communication that traverses the Windows network stack and potentially removes the data from the network stack under very specific conditions .", "1055": "The purpose of this behavior is to allow the DLL to interact with the network without utilizes the WinSock API which could potentially reveal the presence of Hikit .", "1056": "The Gen 2 sub-family , beginning with Gen 2.0 Beta , employs a Windows device driver ( '' the Driver '' ) to hide aspects of the DLL 's functionality from normal system processes .", "1057": "It does not attempt to obfuscate its functionality from static analysis and it hooks a minimum number of kernel API functions in order to hide different pieces of information .", "1058": "The Driver expose an IOCTL interface that supports the following OIDs : The Driver is capable of hiding processes ( by PID , not name ) , system modules , services , network connections , listening ports , directories ( and by extension , files ) , as well as registry keys and values .", "1059": "In order to hide these items , the Driver hooks various Windows Kernel API calls .", "1060": "The following table maps the items the Driver can hide to the API function that the Driver hooks : In order to hide services , the Driver will access the memory of the services.exe process , locate the linked list of services and remove the service entry that the Driver wishes to hide .", "1061": "This is a surprisingly invasive method to obfuscate a process .", "1062": "Upon activation , the Driver will expose its interface by calling IoCreateDevice with the name \\Device\\agony ( for Gen 2.0 Beta samples ) , \\Device\\HTTPS ( for Gen 2.1 samples ) , \\Device\\advcachemgr ( for Gen 2.2 samples ) or \\Device\\diskdump ( for Gen 2.3 samples ) .", "1063": "The Driver also creates a symbolic link to the device using the same name but under the \\DosDevices\\ tree .", "1064": "The Hikit family has supported roughly the same set of commands since the first known samples of Gen 1.0 .", "1065": "The RAT supports the following commands : The shell command activates a remote shell on the victim 's computer .", "1066": "The file command provides an attacker with a variety of disk access options such as listing directories , changing the current directory , and uploading and downloading files .", "1067": "The proxy ( or socks5 ) command allows an attacker to utilize a Hikit-infected machine as a proxy .", "1068": "Gen 2 samples rely on a configuration in order to know where the C2 server exists along with other operational aspects such as the name of its service and operational times .", "1069": "The DLL operates as a service , requiring an attacker is install the DLL as a service at some point prior to activation .", "1070": "Ultimately , both exports generate a new thread of the same function ( '' mainThread '' ) .", "1071": "The difference between the two exports is that DllRegisterServer can take an optional command line argument of the letter '' u '' which will instruct the main thread to uninstall the Gen 1 system from a victim 's computer .", "1072": "If the uninstall argument exists , mainThread will simply remove the Driver from the victim 's machine and terminate .", "1073": "When the DLL activates , either by a call to DllEntryPoint or by calling DllRegisterServer without the u parameter , mainThread begins by verifying the version of the Driver installed on the victim 's machine .", "1074": "it does n't match the specified version ) , the DLL installs the version of the Driver found within the DLL 's resource section ( under the BIN resource tree ) .", "1075": "With the Driver version verified ( or forcibly corrected by installing the appropriate Driver ) , the DLL will instruct the Driver to use a specified string ( for Gen 1.0 and Gen 1.1 samples ) or a DWORD ( for Gen 1.2 samples ) as the acknowledgment value to send to a connecting client who requests the appropriate URL .", "1076": "Following this , the DLL will then attempt to install the correct version of the Driver prior to terminating .", "1077": "It is possible that the second Driver version check is a last ditch effort to ensure the correct Driver is installed .", "1078": "When the Driver establishes a new channel , the DLL generates a runtime data structure before generating a new thread ( '' HikitThreadFunc '' ) which will service any request coming from the new channel .", "1079": "The dwHikitVersion field allows the client and the DLL to ensure that they have a compatible communication scheme in place prior to executing commands .", "1080": "The Gen 2 sub-family , like Gen 1.2 , uses a DLL for the core of its RAT functionality .", "1081": "In order for the DLL to load , Gen 2 ( starting with Gen 2.1 ) uses a loader application ( referred to simply as '' the Loader '' ) .", "1082": "Despite the different models , both variants of the Loader load the embedded DLL in the exact same way .", "1083": "Both versions of the Loader begin by loading the embedded DLL from the Loader 's resources ( item 102 under the Group Icons resource tree ) , decrypting and decompressing the image into memory , then manually loading the DLL into memory using a custom loading routine .", "1084": "LoadEmbeddedImage copies the compressed embedded DLL into a newly allocated heap buffer and then calls the function decodeBuffer ( using the EncodingKey value ) to decrypt the embedded DLL .", "1085": "With the embedded DLL now decompressed into a heap buffer , LoadEmbeddedImage calls ImageLoaderData : :LoadDll to manually load the DLL into memory .", "1086": "ImageLoaderData : :LoadDll interprets the PE/COFF header of the DLL image , loads the image into the appropriate memory configuration , performs the necessary relocation operations , and calls the DllMain ( DLL 's entry point ) function .", "1087": "After loading the embedded DLL image into memory , the Loader will either call the DLL's StartServer or MatrixMain function depending on the type of Loader .", "1088": "The standalone Loaders use the MatrixMain function while the DLL Loaders will call the StartServer function .", "1089": "The Loaders , upon unloading , will call the StopServer function in order to shut down the embedded DLL .", "1090": "MatrixMain and StartServer both ultimately generate a new thread ( using the POSIX API function beginthreadex instead of the more common CreateThread ) that contains the main loop of the Gen 2 RAT functionality .", "1091": "The prototype for MatrixMain is as follows : where Arguments parameter can be : If the i parameter is given , the DLL will install itself as a service on the victim 's machine .", "1092": "The DLL will create a new service ( e.g .", "1093": "The DLL 's RAT functionality provides basic features such as network port forwarding ( proxying ) , file transfer , and remote command shell .", "1094": "The RAT functionality provides an attacker with the ability to establish a phantom network within a victim 's infrastructure by having individual instances of Gen 2 DLL listen for incoming connections on local ports ( presumably , NAT 'd ports ) and accept commands from the inbound connection .", "1095": "This allows an attacker to establish several Gen2 infections within a victim's infrastructure and if outbound connectivity is prohibited for any of the infected machines , the attacker can route commands to the pseudo-isolated infections through accessible infected machines providing a high level of persistence to the malware .", "1096": "Each Gen 2 infection can support up to 10 listening ports .", "1097": "The communication between the Gen 2 malware and the C2 ( or other Gen 2 malware , in the case of the internal routing functionality ) is encrypted using a simple DWORD XOR scheme .", "1098": "In order to provide some level of stealth , the RAT will install a rootkit on 32-bit versions of Windows .", "1099": "To activate the rootkit , the RAT functionality code creates a service with the driver in the % TEMP % directory as the executable for the service .", "1100": "The RAT functionality code then activates the service and opens a handle to device driver 's interface ( e.g .", "1101": "With the handle open to the rootkit driver , the RAT functionality code deletes the service in order to reduce the visible footprint of the new driver .", "1102": "To further reduce the footprint of the driver , the RAT functionality code also uses the cloaking functionality of the rootkit to hide the DLL 's PID , any references to the GUID { 4AE26357-79A3-466D-A6D9- FC38BFB67DEA } , the DLL 's service names ( e.g . '' NetDDESrv '' and '' Network DDE Service '' ) and the service entry as well .", "1103": "Additionally , the code also attempts to hide a service named '' Hitx '' .", "1104": "The console is a text based application that takes a Gen 1.0 or Gen 1.2 infection 's IP address and proceeds to connect and authenticate with the infected server .", "1105": "Once connected , the operator has the basic Hikit functionalities available to them via commands such as file and shell .", "1106": "From a system objects perspective , Gen 2 samples produce up to three named events .", "1107": "In May 2013 , DarkSeoul malware was used to attack several South Korean financial institutions ; and in June , DarkSeoul DDoS attacks were launched against the South Korean government 's DNS server .", "1108": "The malware used in these attacks sought out and exfiltrated data , based on keyword searches .", "1109": "While the malware was clearly intended to search for and exfiltrate certain types of data , its true impact on the targets was never revealed .", "1110": "The impact of the March 20 attacks included disruption of service at financial institutions and data deletion .", "1111": "The malware used in the March 20 , 2013 attacks were wiper malware .", "1112": "The malware attempted to disable AhnLab and Hauri AV antivirus products then proceeded to overwrite the master boot record ( MBR ) .", "1113": "The attack was capable of wiping both Linux and Windows machines .", "1114": "IssueMakersLab found that these actors consistently used the same 16-digit password for file compression , the same stage 1 C2 protocol , the same collection keywords and encryption keys , and the same development path .", "1115": "According to South Korea 's Korea Internet and Security Agency , the North Korean IP address 175.45.178.xx was found scanning South Korean routes the month before the attacks , and the same IP was reportedly logged as accessing one of the targets 13 times .", "1116": "AlienVault suspected the Chinese exploit kit GonDad was used to spread the malware , and the Korean domains serving the malware were registered using a Chinese email address .", "1117": "While the method for initial compromise of the update server is not noted in detail , CrowdStrike 's report cites '' collateral information '' that suggests targeted email attacks were used to gain initial entry , and policy servers were then compromised .", "1118": "The upload server vector included a time-based logic bomb that allowed the wiper to target a large number of systems , on a set time and date , with full permissions on all of the targeted systems .", "1119": "According to CrowdStrike , the wiper malware was dropped on the systems as AgentBase.exe .", "1120": "The wiper used the Windows utility 'taskkill ' to kill the processes pasvc.exe and clisvc.exe , which are the main processes for the Ahnlab and Hauri antivirus applications .", "1121": "The wiper then performed system reconnaissance , gathering drive information and operating system version .", "1122": "Depending on the OS used , the wiper recursively deleted files on the file system , deleting the Windows folder last .", "1123": "It then overwrote the MBR with the strings '' HASTATI '' , '' PRINCPES '' , '' PRINCIPES '' , or '' PR ! NCPES '' .", "1124": "According to CrowdStrike , a third malware component downloaded an IRC RAT from various compromised websites .", "1125": "This RAT is detected by Symantec as Backdoor.Prioxer .", "1126": "When executed it creates the following files in the affected user 's % Temp % directory : After determining the location of user profile directories on the affected computer , the malware searches these directories for configuration files and directories that may be associated with the connection manager clients mRemote and SecureCRT .", "1127": "If an mRemote installation is located , the dropper reads the configuration file and checks if there's a NODE that is defined with '' Username=root '' , '' Protocol=SSH '' , and a password that is not blank .", "1128": "If those conditions are satisfied it extracts the information .", "1129": "If a SecureCRT installation is located , the dropper extracts information from sessions that have Username=root , Protocol=SSH and a saved password .", "1130": "After extracting these connection and server details , the dropper uses the previously dropped alg .", "1131": "exe and conime.exe to attempt to connect remote servers , upload and run the bash script ~pr1.tmp .", "1132": "The bash script initially checks which UNIX it is running on ( of HP-UX , SunOS , Linux , or AIX ) and then attempts to wipe the /kernel , /usr /etc and /home directories , thus rendering the machine inoperative .", "1133": "When the AgentBase.exe component is executed , it first attempts to stop the following processes , presumably in order to evade detection : It then enumerates all physical drives and overwrites the first 512 bytes with the string : '' princpes '' , effectively destroying the MBR ( master boot record ) of the affected drive .", "1134": "It continues to look for removable and fixed drives , locates the root directory on these drives , and then attempts to delete all files and folders in this directory .", "1135": "Finally , the affected computer is shut down and rebooted , although if the wiping mechanisms were successful then the machine will not be able to boot .", "1136": "Now we have landed into the second level shellcode , but it is obfuscated to evade static analysis .", "1137": "It 's very time - consuming to understand the functionality of the dll as it decrypts and builds its own runtime import table to hinder the analysis .", "1138": "Finally we can see it 's connecting to webdav.cloudme.com and cleartext credentials in following screenshot .", "1139": "Malware tries to communicate with the user account created at the WebDAV C&C to exfiltrate system and user information .", "1140": "File name : varies MD5 : a3cbf6179d437909eb532b7319b3dafe Compilation timestamp : 2012.10.02 10:51:50 ( GMT ) Compiler : Microsoft Visual Studio 2010 File format : PE32 DLL Exports : _ LowLevelKeyboardProc@12 Creates the log file : % TEMP%\\~DFD3O8.tmp .", "1141": "-------------------------------------------------------------------------------- New Session : % fully qualified computer name% % timestamp% -------------------------------------------------------------------------------- It then creates a hidden console window and registers its only export _ LowLevelKeyboardProc@12 as a hook procedure for low - level keyboard input events ( WH_KEYBOARD_LL hook ) .", "1142": "The low - level keyboard hook procedure intercepts WM_KEYDOWN , WM_KEYUP and WM _ SYSKEYDOWN system messages and writes information about each keystroke to the log file .", "1143": "It collects most of the available information about the system , transmits it to the C&C server and executes the commands it receives back .", "1144": "The retrieved information is compressed using bzip2 , encrypted with AES and then encoded using Base64 before being transmitted to the C&C server .", "1145": "When there is a file waiting for upload ( usually , this is file that contains the results of the previously received and executed command ) , it is read from disk and uploaded to the server instead of the system information .", "1146": "The module uses Wininet API functions for issuing HTTP POST requests to the server .", "1147": "The module transmits the collected information in the body of the POST request and gets new commands from the server 's response .", "1148": "The configuration is an INI file that controls the further behavior of the module .", "1149": "After taking a look at recent Korplug ( PlugX ) detections , we identified two larger scale campaigns employing this well-known Remote Access Trojan .", "1150": "For example , the Korplug RAT ( a.k.a .PlugX ) is a well-known toolkit associated with Chinese APT groups and used in a large number of targeted attacks since 2012 .", "1151": "Among these , we were able to discover several successful infections where the employed Korplug samples were connecting to the same C & C domain .", "1152": "Other Korplug samples were connecting to a different domain name resolving to the same IPs as notebookhk.net : Taking these C & Cs as a starting point , we were able to locate a number of victims infected through various exploit-laden spear-phishing documents and cunningly-named archives .", "1153": "extension is shown below : Some of the above-mentioned files also contained decoy documents : In all of the cases , three binary files were dropped ( apart from decoy documents ) that led to the Korplug trojan being loading into memory .", "1154": "The Korplug RAT is known to use this side-loading trick by abusing legitimate digitally signed executables and is a way to stay under the radar , since a trusted application with a valid signature among startup items is less likely to raise suspicion .", "1155": "The maliciously crafted documents are RTF files that successfully exploit the CVE-2012-0158 vulnerability in Microsoft Word .", "1156": "One of these 'alternative RATs ' was connecting to a domain also used by the Korplug samples .", "1157": "A curious Remote Access Trojan , as research points to a Chinese connection but the commands it listens to are in Spanish ( translation in English ) : The malware can manage processes and services on the infected machine , transfer files to and from the C & C server , run shell commands , and so on .", "1158": "It is written in Delphi and connects to www.dicemention.com .", "1159": "This malware , written in C , and contains several functions for harvesting files off the victim 's hard drive according to criteria set in the configuration file .", "1160": "Apart from doing a recursive sweep of all logical fixed and remote drives , it also continually monitors any attached removable media or network shares by listening to DBTDEVICEARRIVAL events .", "1161": "In addition to collecting files , the malware attempts to gather saved passwords , history of visited URLs , account information and proxy information from the following applications : The C & C domains used by this malware are : Some samples of this file stealer detected in these campaigns also contain the signature by '' Nanning weiwu Technology co. , ltd '' \u2013 another indicator that the infections are related .", "1162": "Most targeted attacks against organizations originate as spear-phish campaigns or watering hole style web driveby attacks .", "1163": "Traditional malvertizing has been an effective but indiscriminate method cyber crime gangs use to compromise endpoints to perpetrate ad fraud , identity fraud , and banking credential theft .", "1164": "Since these attacks were blocked by Invincea prior to compromise of the machine or network , we can not confirm the specific IP the perpetrators are after \u2013 only the Tactics , Techniques , and Protocols ( TTPs ) used which we describe herein , similar to methods used to provide backdoor access and command and control over compromised networks .", "1165": "Threat actors create a corporate front , advertise on commonly visited sites , then later switch out the landing pages for their ads to pages that host exploit kits , or simply create a temporary redirection from their usual content to the malicious landing page .", "1166": "In the campaign described here , Operation DeathClick , traditional malvertising has been armed with a micro-targeting system using IP address ranges , geographically narrowed down to zip codes , and interests of the user ( recorded in cookies ) to target specific companies , company types , and user interests/preferences .", "1167": "And now , with the advent of real-time ad bidding , these threat actors have weaponized ad delivery networks to target victims based on : Real-time ad bidding allows advertisers , and by extension , adversaries , to micro-target ad delivery on an extremely granular basis .", "1168": "Now advanced threat actors are able to target an organization directly via micro-targeted malvertising , based solely on their corporate network IP range .", "1169": "Those ad windows can and are being used to deliver malware if the bidding price is right .", "1170": "Recently , multiple US Defense/Aerospace contractors were targeted by a malvertising campaign .", "1171": "But in a two week period , these organizations were hit with dozens of micro-targeted malvertising attacks , each of which would have provided a beachhead for the threat actors from which to compromise the network , if successful .", "1172": "In each instance , the attacks were carried out by targeting these Defense contractors directly via real-time ad bidding .", "1173": "As soon as the page loaded , a malicious ad delivered a backdoor Trojan via a Java-based exploit .", "1174": "The malware delivered came from a compromised Polish website , and would have installed a generic backdoor Trojan .", "1175": "Figure 2 shows an event tree of the exploit and malware delivered from an ad by visiting Fleaflicker.com .", "1176": "The event tree in Figure 2 taken from Invincea 's Threat Management Console shows the exploited Java process dropped a file called fvJcrgR0.exe , and that it likely came from Pubmatic , an ad delivery network that allows for real time bidding to deliver ads .", "1177": "In this instance , the Pubmatic server redirected to a Web server in Poland that dropped the malware .", "1178": "By clicking the VirusTotal link , the analyst will see the following VirusTotal report in Figure 5 : From the VirusTotal report in Figure 5 , you will see that this malware is a Trojan backdoor that would likely be used to download additional malware or to provide remote persistent access to the attacker .", "1179": "This event on September 14 ( Figure 8 ) shows that delivery.first-impression.com redirected directly to an IP address , not a domain name to deliver its malicious payload .", "1180": "When they replied to an email , a new ad was loaded on a page that attempted to exploit Java .", "1181": "The event tree in Figure 10 notes that this was likely a spear-phish attack .", "1182": "The timeline will show that when the user replied to an email , the ads on the Earthlink page refreshed , dropping the exploit code via Java .", "1183": "We observed in Operation DeathClick that real-time ad bidding networks are being used by criminal enterprise to target companies with malicious content in order to gain persistent remote access .", "1184": "A small fraction is malicious content linking to landing pages that infect users .", "1185": "But what if the landing pages that are supposed to be ads are actually malicious PHP pages with embedded malware ? The bidding and ad placements work the same , but instead of seeing a flashy ad banner , the highest bidder for the placement serves malware .", "1186": "But it is very simple to replace the redirection code to switch from a legitimate ad banner to a drop site that hosts an exploit kit , typically based on Java , Flash , Silverlight , or all three .", "1187": "As we have detailed here , they can also be mis-appropriated unwittingly by malvertisers using these same tools and techniques to target companies with malware for persistent remote access in addition to traditional click fraud , phishing , and identity theft .", "1188": "So how do they get money to spend on these malicious campaigns ? Invincea recently saw a malvertiser win a bid and delivered a Java exploit .", "1189": "This exploit copied a fully functional version of Chrome into the Java cache directory , and that version of Chrome launched in the background and proceeded to visit websites and click on specific ad banners .", "1190": "By paying 65 cents to install a background web browser that does nothing but click fraud , the malvertiser is able to reap hundreds if not thousands of dollars in advertising referral income .", "1191": "In this instance , the host was almost converted to a click-fraud bot .", "1192": "But the malware delivery could have been intended for data exfiltration , banking Trojans , or any other more insidious purpose .", "1193": "Invincea has witnessed a rash of exploit kits and landing pages hosted on : In most instances , the landing pages are preconfigured with the exploit kit .", "1194": "Figures 17 through 21 in the following are screenshots from Invincea 's Threat Management console from various RTB-based malvertising incidents with highlighted URLs for malvertising delivered via RTB ad bidding .", "1195": "In September and October of 2014 , Invincea saw a sharp spike of malvertising delivering CryptoWall ransomware attacks via Real Time Ad Bidding .", "1196": "We observed Real Time Ad bidding platforms , including OpenX , GoogleAds , Yahoo , AOL , and first-impression.com , fall victim to the ransomware malvertising scheme by unwittingly delivering the CryptoWall 2.0 ransomware ads .", "1197": "Ransomware is a particularly pernicious form of malware that fully encrypts the victim 's disk and data files , including remote storage , then demands payment of anywhere from $ 300 to $ 1000 in return for the decryption key .", "1198": "Based on analysis of Invincea logs in would-be victims targeted by these ads , we have insight into the attacker that is delivering the malicious ads .", "1199": "Legitimate ad copy is stolen , 3rd party ad networks used to distribute malware , and popular ad- supported websites displaying the malicious ads that exploit unsuspecting visitors with drive-by web exploits .", "1200": "Merely visiting any ad-supported site may result in a CryptoWall ransomware infection .", "1201": "Cryptowall 2.0 utilizes the TOR network to hide its communications , but it quickly encrypts all local files on the disk , and demands bitcoin payment to unlock the files .", "1202": "In addition , you can see the ransom note being written to disk on an infected machine in the audit logs in Figure 24 .", "1203": "Items highlighted in the URL below is userid , and the winning bid price to place malvertising of Cryptowall on sports.yahoo.com , which is 60 cents .", "1204": "Operation DeathClick is an active campaign to micro-target companies via malvertising in order to compromise their networks .", "1205": "Unfortunately , the micro-targeting malvertising technique evades almost all network controls and traditional endpoint anti-virus solutions .", "1206": "For half the price of a candy bar , attackers have the unprecedented ability to deliver malware to you through your web browser simply because of your IP address space and your industry vertical .", "1207": "Most of the attacks featured here were not detected by standard Anti-Virus because the malware hashes constantly change .", "1208": "[ 2 ] This campaign , which began on July 7 , 2015 , appears to be targeted at government organizations and think - tanks located in democratic countries [ 3 ] , and utilizes compromised , legitimate websites for spear phishing and command and control activity .", "1209": "The current CozyCar campaign includes spear phishing emails that deliver the payload from either by a link to a .zip file on a compromised website or by direct delivery as an attachment to the phish .", "1210": "GET /webscriptsecurity / view/4/player.swf HTTP/1.1 Accept : text / html , application / xhtml+xml,*/ * Accept - Language : en_US User - Agent : Mozilla/5.0 ( compatible ; MSIE 8.0 ; Windows NT 5.1 ; Trident/4.0 ; .NET CLR 1.1.4322 ; .NET CLR 2.0.50727 ) Host : extranet.qualityplanning[.]com Connection : Keep - Alive GET /webscriptsecurity / view/4/player.swf HTTP/1.1 Accept : text / html , application / xhtml+xml,*/ * Accept - Language : en_US User - Agent : Mozilla/5.0 ( compatible ; MSIE 8.0 ; Windows NT 5.1 ; Trident/4.0 ; .NET CLR 1.1.4322 ; .NET CLR 2.0.50727 ) Host : extranet.qualityplanning[.]com Connection : Keep - Alive The secondary dropper then cleans up after itself with a simple vbs script ( md5:0d132ee171768dc30d14590ed2dbadd1 ) that leaves only the decoy multimedia file behind .", "1211": "Analysis of the secondary dll file ( name matches [ A - Z0 - 9]{1}\\.tmp ) indicates that its primary function is to serve as a cleanup mechanism for the dropped binary .", "1212": "To obtain tasks , the Trojan will issue an HTTPS request to the C2 server ( \" host_scripts \" in the configuration ) that resembles the following example beacon .", "1213": "Once the C2 and Trojan have synchronized and can decrypt their network communications the C2 server will begin responding to beacons from the Trojan with JSON blobs .", "1214": "Unit 42 analyzed the Trojan 's command handler and found several commands , as seen in Table 2 , which allows the threat actors to carry out a full range of activities on the system .", "1215": "We have since seen multiple cases where this exploit is used to deliver malware and one was particularly interesting as it contained a new variant of MiniDuke ( also known as Win32/SandyEva ) .", "1216": "Some of the characteristics of MiniDuke - such as its small size ( 20 KB ) , its crafty use of assembly programming , and the use of zero-day exploits for distribution - made it an intriguing threat .", "1217": "Although the backdoor is still quite similar to its previous versions , some important changes were made since last year , the most notable being the introduction of a secondary component written in JScript to contact a C & C server via Twitter .", "1218": "The functionality of the shellcode which is executed by triggering the vulnerability is rather simple and straightforward .", "1219": "After decrypting itself and obtaining the addresses of some functions exported by kernel32.dll , it decrypts and drops the payload in the % TEMP % directory in a file named '' a.l '' which is subsequently loaded by calling kernel32 ! LoadLibraryA .", "1220": "An interesting thing about the shellcode is that before transferring control to any API function it checks the first bytes of the function in order to detect hooks and debugger breakpoints which may be set by security software and monitoring tools .", "1221": "If either of those conditions is met the malware assumes it is run for the first time and it proceeds with its installation onto the system .", "1222": "MiniDuke gathers information about the system and encrypts its configuration based on that information , a method also used by OSX/Flashback ( this process is called watermarking by Bitdefender ) .", "1223": "The end result is that it is impossible to retrieve the configuration of an encrypted payload if analyzing it on a different computer .", "1224": "The information collected on infection has not changed since the previous version and consists of the following values : Once the encrypted version of the malware is created , it is written into a file in the % ALLUSERSPROFILE % \\Application Data directory .", "1225": "The name of the file is randomly picked from the following values ( you can find this listing and those of the next screenshots on the VirusRadar description : The filename extension is also picked randomly from the following list : To persist on the infected system after reboots , the malware creates a hidden .LNK file in the '' Startup '' directory pointing to the modified main module .", "1226": "file is randomly drawn from the following values : The .LNKfile", "1227": "is created using a COM object with the IShellLinkA interface and contains the following command : '' C : \\Windows\\system32\\rundll32.exe % pathtomainmodule % , exportfunction '' Which gives something like : '' C : \\Windows\\system32\\rundll32.exe C : \\DOCUME~1\\ALLUSE~1\\APPLIC~1\\data.cat , IlqUenn '' .", "1228": "When the malware is loaded by rundll32.exe and the current directory is n't % TEMP % , the malware starts with gathering the same system information as described in the '' Installation '' section to decrypt configuration information .", "1229": "If the configuration data is decrypted correctly , MiniDuke retrieves the Twitter page of @ FloydLSchwartz in search of URLs by which to reach C & C server .", "1230": "As the next step , MiniDuke gathers the following information from the infected systems : This information is then sent to the C & C server along with the request to download a payload .", "1231": "The final URL used to communicate with the C & C server looks like this : < urlstart > /create.php ? < rndparam > = < systeminfo > Those tokens are derived as follows : An example of such a URL is given below : The payload is downloaded in the file named '' fdbywu '' using the urlmon ! URLDownloadToFileA API : The downloaded payload is a fake GIF8 file containing encrypted executable .", "1232": "The malware processes the downloaded file in the same way as previous samples of MiniDuke : it verifies the integrity of the file using RSA-2048 , then decrypts it , stores in a file and finally executes it .", "1233": "The RSA-2048 public key to verify integrity of the executable inside the GIF file is the same as in the previous version of MiniDuke .", "1234": "The TwitterJS module is extracted by creating a copy of the Windows DLL cryptdll.dll , injecting a block of code into it and redirecting the exported functions to this code .", "1235": "This file is then stored in an Alternate Data Stream ( ADS ) in NTUSER.DAT in the % USERPROFILE % folder .", "1236": "Finally this DLL is registered as the Open command when a drive is open , which has the effect of starting the bot every time the user opens a disk drive .", "1237": "Below you can find the content of the init.cmd script used by MiniDuke to install TwitterJS module onto the system .", "1238": "Prior to executing it , MiniDuke applies a light encoding to the script : The next images show the result of two separate obfuscations , we can see that the variables have different values .", "1239": "This is probably done to thwart security systems that scan at the entry points of the JScript engine .", "1240": "The purpose of this script is to use Twitter to find a C & C and retrieve JScript code to execute .", "1241": "Here 's an example of a targeted spear-phishing e-mail directed at Uyghur activists in March 2014 .", "1242": "The e-mail has two attachments , a non-malicious JPG file and a 373 KB Microsoft Word .DOC file .", "1243": "If run on a vulnerable version of Microsoft Office , it drops the main module as '' net.exe '' ( detected by Kaspersky Lab products as Trojan-Dropper.Win32.Agent.lifr ) , which in turn installs a number of other files .", "1244": "The main C & C module is dumped into '' % SystemRoot % \\system32\\Windowsupdataney.dll '' , ( detected by Kaspersky as Trojan- Spy.Win32.TravNet.qfr ) .", "1245": "It is registered as a service ( named '' Windowsupdata '' ) through a Windows Batch file named '' DOT.BAT '' ( detected by Kaspersky Lab products as Trojan.BAT.Tiny.b ) : To make sure the malware is n't running multiple times , it uses the mutex '' SD2013 Is Running ! '' to mark its presence in the system .", "1246": "Other known mutexes used by older and current variants include : The malware configuration file is written to the '' SYSTEM '' folder ( as opposed to SYSTEM32 ) and has a slightly new format compared to '' older '' NetTraveler samples : For the record , here 's what an older NetTraveler config file looks like : Obviously , the developers behind NetTraveler have taken steps to try to hide the malware 's configuration .", "1247": "The algorithm is as follows : Once decrypted , the new config looks like this : One can easily see the command-and-control ( C & C ) server in the screenshot above , which is '' uyghurinfo [ . ] com '' .", "1248": "Aumlib , which for years has been used in targeted attacks , now encodes certain HTTP communications .", "1249": "And a new version of Ixeshe , which has been in service since 2009 to attack targets in East Asia , uses new network traffic patterns , possibly to evade traditional network security systems .", "1250": "About four months after The New York Times publicized an attack on its network , the attackers behind the intrusion deployed updated versions of their Backdoor.APT.Aumlib and Backdoor.APT.Ixeshe malware families .", "1251": "Older variants of this malware family generated the following POST request : Data sent via this POST request transmitted in clear text in the following structure : A recently observed malware sample ( hash value 832f5e01be536da71d5b3f7e41938cfb ) appears to be a modified variant of Aumlib .", "1252": ") The POST body is now encoded .", "1253": "The sample cb3dcde34fd9ff0e19381d99b02f9692 connected to documents [ . ] myPicture [ . ] info and www [ . ] documents [ . ] myPicture [ . ] info and as expected generated the a POST request to /bbs/info.asp .", "1254": "Although the network traffic is encoded with a custom Base64 alphabet , the URI pattern has been largely consistent : We analyzed a recent sample that appears to have targeted entities in Taiwan , a target consistent with previous Ixeshe activity .", "1255": "This sample ( aa873ed803ca800ce92a39d9a683c644 ) exhibited network traffic that does not match the earlier pattern and therefore may evade existing network traffic signatures designed to detect Ixeshe related infections .", "1256": "The Base64-encoded data still contains information including the victim 's hostname and IP address but also a '' mark '' or '' campaign tag/code '' that the threat actors use to keep track of their various attacks .", "1257": "Recently , research was published identifying a Tor exit node , located in Russia , that was consistently and maliciously modifying any uncompressed Windows executables downloaded through it .", "1258": "By using a separate wrapper , the malicious actors are able to bypass any integrity checks the original binary might contain .", "1259": "This executable is a dropper containing a PE resource that pretends to be an embedded GIF image file .", "1260": "The dropper will proceed to decrypt this DLL , write it to disk and execute it .", "1261": "Once executed , the DLL file ( SHA1 : b491c14d8cfb48636f6095b7b16555e9a575d57f , detected as Backdoor : W32/OnionDuke.B ) will decrypt an embedded configuration ( shown below ) and attempt to connect to hardcoded C & C URLs specified in the configuration data .", "1262": "From these C & Cs the malware may receive instructions to download and execute additional malicious components .", "1263": "We have , for instance , observed components dedicated to stealing login credentials from the victim machine and components dedicated to gathering further information on the compromised system like the presence of antivirus software or a firewall .", "1264": "Some of these components have been observed being downloaded and executed by the original backdoor process but for other components , we have yet to identify the infection vector .", "1265": "Most of these components do n't embed their own C & C information but rather communicate with their controllers through the original backdoor process .", "1266": "This DLL file ( SHA1 d433f281cf56015941a1c2cb87066ca62ea1db37 , detected as Backdoor : W32/OnionDuke.A ) contains among its configuration data a different hardcoded C & C domain , overpict.com and also evidence suggesting that this component may abuse Twitter as an additional C & C channel .", "1267": "This is significant because the domains leveldelta.com and grouptumbler.com have previously been identified as C & C domains used by MiniDuke .", "1268": "Based on compilation timestamps and discovery dates of samples we have observed , we believe the OnionDuke operators have been infecting downloaded executables at least since the end of October 2013 .", "1269": "We also have evidence suggesting that , at least since February of 2014 , OnionDuke has not only been spread by modifying downloaded executables but also by infecting executables in .torrent files containing pirated software .", "1270": "The ThreatConnect Intelligence Research Team ( TCIRT ) recently observed a targeted cross-site scripting ( XSS ) '' drive-by '' attack that leveraged a single content delivery network resource to distribute a malicious Java applet via nearly all of the major official Government of Afghanistan websites .", "1271": "This class file downloads and decodes an XOR 0xC8 encoded Windows PE executable payload from [ http : ] //mfa.gov [ . ] af/content/images/icon35.png , hosted on the official Afghan Ministry of Foreign Affairs site , which was also affected by the gop-script XSS .", "1272": "This applet has the same class path , and downloads an XOR 0xFF encoded payload executable from the URL [ https : ] //amco- triton.co [ . ] jp/js/dl/in.jpg .", "1273": "Additional indicators and context associated with this particular Java driveby activity can be found in the ThreatConnect Common Community Incident 20140815A : The XOR 0xC8 encoded payload downloaded from [ http : ] //mfa.gov [ . ] af/content/images/icon35.png decodes into the Windows PE executable SHA1 : This executable is a self-extracting ( SFX ) Microsoft Cabinet executable that is digitally signed with a valid certificate from '' OnAndOn Information System Co. , Ltd. '' , serial number '' 1F F7 D8 64 18 1C 55 5E 70 CF DD 3A 59 34 C4 7D '' .", "1274": "This executable drops the following files : Malicious DLL that loads into the above dllhost.exe , using a similar DLL sideloading technique to that most commonly associated with the PlugX backdoor .", "1275": "This backdoor connects to the faux Oracle Java themed command and control ( C2 ) domain oracle0876634.javaplug-in [ . ] com .", "1276": "By exploiting and co-opting Afghan network infrastructure that is used by multiple ministerial level websites , Chinese intelligence services would be able to widely distribute malicious payloads to a variety of global targets using Afghanistan 's government websites as a topical and trusted distribution platform , exploiting a single hidden entry point .", "1277": "This being a variant of a typical '' watering-hole '' attack , the attackers will most likely infect victims outside the Afghan government who happened to be browsing any one of the CDN client systems , specifically , partner states involved in the planned troop reduction .", "1278": "APT3 ( also known as UPS ) , the actors responsible for Operation Clandestine Fox has quietly continued to send waves of spearphishing messages over the past few months .", "1279": "CVE-2014-6332 was disclosed publicly on 2014-11-11 and is a Windows OLE Automation Array Remote Code Execution vulnerability .", "1280": "CVE-2014- 4113 is a privilege escalation vulnerability that was disclosed publicly on 2014-10-14 .", "1281": "The webpage contained both CVE-2014-6332 exploit code and a VBScript that invoked PowerShell on the affected users ' system to download the below payload : The CVE-2014-6332 exploit code seen in this incident is derived from the code published at http : //www.exploit-db.com/exploits/35230/ , which has also been incorporated in the Metasploit project .", "1282": "After the exploit or script executes , the system downloads install.exe , which has the following metadata : The file install.exe attempts to write two files ( doc.exe and test.exe ) to the hard-coded path '' C : \\Users\\Public '' , which fails on Windows XP because that path is not present by default .", "1283": "The first dropped file , doc.exe , contains the CVE-2014-4113 exploit and then attempts to execute test.exe with the elevated privileges .", "1284": "This CVE is a local kernel vulnerability that , with successful exploitation , would give any user SYSTEM access on the machine .", "1285": "The malware component , test.exe , uses the Windows command '' cmd.exe '' /C whoami '' to verify it is running with the elevated privileges of '' System '' and creates persistence by creating the following scheduled task : When executed , the malware first establishes a SOCKS5 connection to 192.157.198.103 using TCP port 1913 .", "1286": "The malware sends the SOCKS5 connection request '' 05 01 00 '' and verifies the server response starts with '' 05 00 '' .", "1287": "The malware then requests a connection to 192.184.60.229 on TCP port 81 using the command '' 05 01 00 01 c0 b8 3c e5 00 51 '' and verifies that the first two bytes from the server are '' 05 00 '' ( c0 b8 3c e5 is the IP address and 00 51 is the port in network byte order ) .", "1288": "Once the connection to the server is established , the malware expects a message containing at least three bytes from the server .", "1289": "The following commands are supported by the malware : On October 28 , we observed APT3 sending out spearphishing messages containing a compressed executable attachment .", "1290": "The deflated exe was a variant of the same downloader described above and connected to 198.55.115.71 over port 1913 via SOCKS5 proxy .", "1291": "The secondary payload in that case was detected as Backdoor.APT.CookieCutter ( aka Pirpi ) and also named newnotepad.exe ( MD5 8849538ef1c3471640230605c2623c67 ) and connected to the known APT3 domains : The 192.184.60.229 IP address seen in this current campaign also hosts securitywap [ .", "1292": "This IP has hosted other domains used by APT3 in past campaigns : As we discussed in our previous blog detailing previous APT3 activity , the walterclean [ . ] com served as a Plugx/Kaba command and control server .", "1293": "Although APT3 is well known for employing zero-day exploits in their attacks , recent activity has demonstrated that they will also attack targets with known exploits or social engineering .", "1294": "The exploit is sent to the targeted organizations through emails with a malicious Ichitaro document file attached , which Symantec products detect as Bloodhound.Exploit.557 .", "1295": "Payloads from the exploit may include Backdoor.Emdivi , Backdoor.Korplug , and Backdoor.ZXshell ; however , all payloads aim to steal confidential information from the compromised computer .", "1296": "Opening the malicious attachment with Ichitaro will drop the payload and display the document .", "1297": "In this campaign , variants of Backdoor.Emdivi are persistently used as a payload .", "1298": "All attacks arrive on the target computers as an attachment to email messages .", "1299": "Mostly the attachments are in a simple executable format with a fake icon .", "1300": "This group 's primary goal is to steal confidential information from targeted organizations .", "1301": "The emails include password-protected .zip files containing the malware .", "1302": "This is merely to trick the recipient into believing the email is from a legitimate and trustworthy source .", "1303": "The email also requests that the recipient open the attachment on a Windows computer .", "1304": "The malicious payload is Backdoor.Emdivi , a threat that opens a back door on the compromised computer .", "1305": "Emdivi allows the remote attacker executing the commands to send the results back to the command-and-control ( C & C ) server through HTTP .", "1306": "The malware adds extra words to the version number and then , based on this , generates a hash , which it uses as an encryption key .", "1307": "Type T employs techniques to protect itself from security vendors or network administrators .", "1308": "Important parts of Type T , such as the C & C server address it contacts and its protection mechanisms , are encrypted .", "1309": "Type T also detects the presence of automatic analysis systems or debuggers , such as the following : Type S , on the other hand , was used only twice in the attack campaign .", "1310": "Type S is a .NET", "1311": "application based on the same source code and shared C & C infrastructure as Type T .", "1312": "Once infected , Emdivi connects to hardcoded C & C servers using the HTTP protocol .", "1313": "Instead , the attacker somehow penetrated the cloud service itself and turned the websites into C & C servers for Backdoor.Emdivi .", "1314": "The attackers sent a Microsoft Word file containing a maliciously crafted SWF file that exploited the vulnerability .", "1315": "Once successfully exploited , the file installed Backdoor.Emdivi .", "1316": "file containing an Adobe Flash zero-day exploit that is used to install a back door .", "1317": "As of this blog post , visitors to at least three nonprofit institutions - two of which focus on matters of national security and public policy - were redirected to an exploit server hosting the zero-day exploit .", "1318": "The group behind this campaign appears to have sufficient resources ( such as access to zero-day exploits ) and a determination to infect visitors to foreign and public policy websites .", "1319": "The threat actors likely sought to infect users to these sites for follow-on data theft , including information related to defense and public policy matters .", "1320": "Visitors to the Peter G. Peterson Institute for International Economics ( www.piie [ . ] com ) were redirected to an exploit server hosting this Flash zero-day through a hidden iframe .", "1321": "We subsequently found that the American Research Center in Egypt ( www.arce [ . ] org ) and the Smith Richardson Foundation ( www.srf [ . ] org ) also redirected visitors the exploit server .", "1322": "To bypass Windows ' Address Space Layout Randomization ( ASLR ) protections , this exploit targets computers with any of the following configurations : Users can mitigate the threat by upgrading from Windows XP and updating Java and Office .", "1323": "The vulnerability permits an attacker to overwrite the vftable pointer of a Flash object to redirect code execution .", "1324": "The attack uses only known ASLR bypasses .", "1325": "For Windows XP , the attackers build a return-oriented programming ( ROP ) chain of MSVCRT ( Visual C runtime ) gadgets with hard-coded base addresses for English ( '' en '' ) and Chinese ( '' zh-cn '' and '' zh-tw '' ) .", "1326": "On Windows 7 , the attackers use a hard-coded ROP chain for MSVCR71.dll ( Visual C++ runtime ) if the user has Java 1.6 , and a hard-coded ROP chain for HXDS.dll ( Help Data Services Module ) if the user has Microsoft Office 2007 or 2010 .", "1327": "The shellcode is downloaded in ActionScript as a GIF image .", "1328": "Once ROP marks the shellcode as executable using Windows ' VirtualProtect function , it downloads an executable via the InternetOpenURLA and InternetReadFile functions .", "1329": "Then it writes the file to disk with CreateFileA and WriteFile functions .", "1330": "Finally , it runs the file using the WinExec function .", "1331": "Once the exploit succeeds , a PlugX/Kaba remote access tool ( RAT ) payload with the MD5 hash 507aed81e3106da8c50efb3a045c5e2b is installed on the compromised endpoint .", "1332": "This PlugX payload was configured with the following command-and-control ( CnC ) domains : Sample callback traffic was as follows : Both java.ns1 [ .", "1333": "Further research uncovered a number of older malware samples connecting to the same domain wmi.ns01 [ . ] us .", "1334": "The Poison Ivy variants that connected to the domain wmi.ns01 [ . ] us had the following unique configuration properties : We found a related Poison Ivy sample ( MD5 8936c87a08ffa56d19fdb87588e35952 ) with the same '' java7 '' password , which was dropped by an Adobe Flash exploit ( CVE-2012-0779 ) .", "1335": "In this previous incident , visitors to the Center for Defense Information website ( www.cdi [ .", "1336": "] org - also an organization involved in defense matters - were redirected to an exploit server at 159.54.62.92 .", "1337": "This exploit , in turn , dropped the Poison Ivy variant .", "1338": "In addition to using the same password '' java7 , '' this variant was configured with the mutex with the similar pattern of '' YFds* & ^ff '' and connected to a CnC server at windows.ddns [ . ] us .", "1339": "During another earlier compromise of the same www.cdi.org website , visitors were redirected to a Java exploit test.jar ( MD5 7d810e3564c4eb95bcb3d11ce191208e ) .", "1340": "This jar file exploited CVE-2012-0507 and dropped a Poison Ivy payload with the hash ( MD5 52aa791a524b61b129344f10b4712f52 ) .", "1341": "This Poison Ivy variant connected to a CnC server at ids.ns01 [ . ] us .", "1342": "The Poison Ivy sample referenced above ( MD5 fd69793bd63c44bbb22f9c4d46873252 ) was delivered via an exploit chain that began with a redirect from the Center for European Policy Studies ( www.ceps [ . ] be ) .", "1343": "In this case , visitors were redirected from www.ceps [ . ] be to a Java exploit hosted on shop.fujifilm [ . ] be .", "1344": "In what is certainly not a coincidence , we also observed www.arce [ . ] org ( one of the sites redirecting to the current Flash exploit ) also redirect visitors to the Java exploit on shop.fujifilm [ . ] be in 2013 .", "1345": "This actor also has early access to a number of zero-day exploits , including Flash and Java , and deploys a variety of malware families on compromised systems .", "1346": "In recent weeks , attackers have launched a series of Distributed Denial of Service attacks ( DDoS ) against websites promoting democracy in Hong Kong .", "1347": "According to the Wall Street Journal , websites belonging to Next Media 's Apple Daily publication have suffered from an ongoing DDoS attack that '' brought down its email system for hours '' .", "1348": "According to other reports , Next Media 's network has suffered a '' total failure '' as a result of these attacks .", "1349": "FireEye has identified a number of binaries coded to receive instructions from a set of command and control ( C2 ) servers instructing participating bots to attack Next Media-owned websites and the HKGolden forum .", "1350": "Each sample we identified is signed with digital certificates that have also been used by APT actors to sign binaries in previous intrusion operations : These binaries are W32 Cabinet self-extracting files that drop a variant of an older DDoS tool known as KernelBot .", "1351": "Structurally , all of these samples are similar in that they drop three files : The KernelBot implants receive targeting instructions from C2 servers hard-coded directly into the sample .", "1352": "For example , c3d6450075d618b1edba17ee723eb3ca drops a KernelBot variant that connects to both www.sapporo-digital-photoclub [ . ] com and wakayamasatei [ . ] com .", "1353": "The following snippet of python code can be used to decode this command : FireEye has observed two different single-byte XOR keys used to encode configuration files issued by the DDOS C2 servers in this campaign .", "1354": "The encoded configuration file shown above decodes to : During the course of our research , we 've observed more than 30 different unique configuration files issued by the C2 servers listed above .", "1355": "These configurations issued commands to attack the following domains and IPs : All of the above IPs host Next Media or Apple daily websites , with the exception of 58.64.139.10 and 124.217.214.149 .", "1356": "For approximately 14 hours between October 23rd and 24th , the attackers pushed a configuration update to four controls servers that instructed bots under their control to flood 124.217.214.149 with UDP traffic .", "1357": "On Oct. 23 , 2014 , two of the active controls began instructing participating bots to cease attacks .", "1358": "By Oct. 24 , 2014 , all five of the known active control servers were issuing commands to cease the attacks .", "1359": "This PlugX variant connected to a Google Code project at code.google [ . ] com/p/udom/ , where it decoded a command that configured its C2 server .", "1360": "This sample is detected as Backdoor.APT.Preshin and connected to luxscena [ . ] com for C2 .", "1361": "We detect this payload as Backdoor.APT.PISCES and it used hk.java-se [ . ] com for C2 .", "1362": "We also detect this payload as Backdoor.APT.PISCES and observed it connect to u.java-se [ . ] com .", "1363": "Both of these certificates are valid but can be detected and blocked via the following Yara signatures : These ongoing DDoS attacks and previous APT intrusion activity both target the hkgolden [ . ] com website .", "1364": "As noted above , this site has been targeted with a DDoS attack by a KernelBot network .", "1365": "On Oct. 24 , 2014 , after attacking their own infrastructure , the attackers issued new instructions to their botnet that ceased all attacks .", "1366": "On February 11 , FireEye identified a zero-day exploit ( CVE-2014-0322 ) being served up from the U.S. Veterans of Foreign Wars ' website ( vfw [ . ] org ) .", "1367": "Specifically , visitors to the VFW website were silently redirected through an iframe to the exploit at www. [ REDACTED ] .com/Data/img/img.html .", "1368": "It aborts exploitation if the user is browsing with a different version of IE or has installed Microsoft 's Experience Mitigation Toolkit ( EMET ) .", "1369": "The vulnerability allows the attacker to modify one byte of memory at an arbitrary address .", "1370": "The attacker uses the vulnerability to do the following : The attacker uses the Microsoft.XMLDOM ActiveX control to load a one-line XML string containing a file path to the EMET DLL .", "1371": "Because the vulnerability allows attackers to modify memory to an arbitrary address , the attacker can use it to bypass ASLR .", "1372": "Once the attacker 's code has full memory access through the corrupted Flash Vector object , the code searches through loaded libraries gadgets by machine code .", "1373": "The attacker then overwrites the vftable pointer of a flash.Media.Sound ( ) object in memory to point to the pivot and begin ROP .", "1374": "Subsequently , the malicious Flash code downloads a file containing the dropped malware payload .", "1375": "Then , when the shellcode is executed , the malware creates files '' sqlrenew.txt '' and '' stream.exe '' .", "1376": "The tail of the image file is decoded , and written to these files .", "1377": "'' sqlrenew.txt '' is then executed with the LoadLibraryA Windows API call .", "1378": "As documented above , this exploit dropped an XOR ( 0\u00d795 ) payload that executed a ZxShell backdoor ( MD5 : 8455bbb9a210ce603a1b646b0d951bce ) .", "1379": "The ZxShell backdoor is a widely used and publicly available tool used by multiple threat actors linked to cyber espionage operations .", "1380": "This particular variant called back to a command and control server located at newss [ . ] effers [ . ] com .", "1381": "] org via the previous resolutions to the following IP addresses : We previously observed Gh0stRat samples with the custom packet flag '' HTTPS '' calling back to book [ . ] flnet [ . ] org and icybin [ . ] flnet [ . ] org .", "1382": "We also observed another '' HTTPS '' Gh0st variant connecting to a related command and control server at me [ . ] scieron [ . ] com .", "1383": "You may recall that dll [ . ] freshdns [ . ] org , ali [ . ] blankchair [ . ] com and cht [ . ] blankchair [ . ] com were all linked to both Operation DeputyDog and Operation Ephemeral Hydra .", "1384": "They build ROP chains and shellcode the same way , both choose to corrupt a Flash Vector object , have some identical functions with common typos , and even share the same name .", "1385": "These actors have previously targeted a number of different industries , including : The proven ability to successfully deploy a number of different private and public RATs using zero-day exploits against high-profile targets likely indicates that this actor ( s ) will continue to operate in the mid to long-term .", "1386": "With many pieces of malware the initial communications that it sends out to its command and control server ( known as beaconing or phoning home ) usually include pieces of information about the victim system .", "1387": "The randomly generated values noted above are actually used to encrypt several pieces of information that are extracted from the system , and even the key itself is included .", "1388": "The first set of commands force the malware to behave as a simple downloader .", "1389": "Once the payload text has been decrypted the malware treats this as a binary executable file , which is then written to the disk and executed .", "1390": "( A screenshot showing the structure of the command and control routines within OrcaRAT ) The command and control structure is fairly simplistic but provides the operator with access to the victim machine 's filesystem and command line , and as such allows the attacker to perform various tasks such as executing arbitrary commands or uploading and downloading files from the compromised system .", "1391": "After a command and control message is received , OrcaRAT sends an HTTP POST message back to the command and control server .", "1392": "Given the information above we can reasonably assume that this malware was most likely designed as a first stage implant .", "1393": "Table 4 Table 5 The malware dropped was configured to use good.myftp[.]org as the C2 URL , and the IP resolution was 223.25.233.248 .", "1394": "Table 7 As this post and previous cited research show , APT groups such as Nitro will continue to evolve their techniques within the kill chain to avoid detection .", "1395": "However , they also demonstrate the value of tracking these threats over time , as this allowed us to uncover and properly attribute the new IOCs because Nitro was still re - using old C2 infrastructure with their new malware .", "1396": "The attackers have everything they need to start looking for an entry point to the company 's network and establish one or several permanent backdoors into the environment .", "1397": "The attackers mostly rely on two techniques here to infect one or several computers , usually workstations , inside the target 's network : spear phishing and drive-by downloads .", "1398": "Spear phishing can be described as targeted e-mail phishing .", "1399": "In a spear phishing scheme , attackers send very few e-mails to targeted people .", "1400": "The trick is to target the right victim and provide it with the right content , so that they will click on a link leading to drive-by download of a malware , or open an attached file which will infect their computer .", "1401": "Some groups of attackers also use '' watering hole '' techniques to successfully compromise their targets .", "1402": "To build a watering hole attack , attackers do compromise the website of a third party , generally a supplier of the target , which is typically visited by a specific group of professionals and very likely by the target .", "1403": "Every visitor of the compromised third party is then infected .", "1404": "It just takes a few lines of code in the infecting script to only compromise visitors coming from the target IP ranges .", "1405": "Attackers have gained access to one or several machines inside the target 's corporate network .", "1406": "They need to install several different backdoors in order to be able to always access the network .", "1407": "As soon as the attackers are sure they have enough access , they start looking for two things : intellectual property ( or anything else they want to know or steal ) in alignment with predefined mission objectives , and a means of privilege escalation to facilitate lateral movement within the compromised environment .", "1408": "It generally does not take long before the attackers gain domain administrator privileges and dump all the Active Directory content .", "1409": "Data exfiltration is the last step before the attackers loop to the lateral moves step , in a never-ending circle of prolonged access and information theft .", "1410": "They generally create archive files containing the content they want to exfiltrate , which are then sent to the attackers by using a remote administration tool ( RAT ) or transfer protocols such as FTP and HTTP .", "1411": "The attackers loop to the access strengthening/lateral moves stage and generally keep stealing more information and stay inside the network for more data gathering .", "1412": "We discovered this malware sample in June 2014 , leading to a command & control ( c & c ) server still in activity .", "1413": "This one is also used by the group to infect workstations , collect system information , and install more malware on the infected computer .", "1414": "It acts as a first stage downloader and system data collector often used in the initial compromise of the Pitty Tiger campaigns , generally embedded in Microsoft Office documents .", "1415": "Thanks to server 's misconfigurations , we managed to get information from three c & c servers used by this group of attackers , which provided us with insight from the end of 2013 to the beginning of July 2014 .", "1416": "Pitty Tiger , like most other APT groups , use spear phishing e-mails extensively in order to gain an initial foothold within the targeted environment .", "1417": "We have been able to find a spear phishing e-mail crafted by the attackers .", "1418": "This e-mail spoofed the identity of an employee of a targeted company : The attached file is a Microsoft Office Word document triggering CVE-2014-1761 to infect the computer it is sent to : While this example looks very '' amateur '' for a spear phishing attempt , we suppose the group has conducted more advanced spear phishing campaigns , based on the fact that we found infected Word documents showing content stolen from victims of the group .", "1419": "These documents were infecting the system with Troj/ReRol.A malware , which we will detail later in this report .", "1420": "This could mean that the Pitty Tiger group is using stolen material as spear phishing content either to target other persons in the compromised company , or to target other persons in a competitor's company , or more generally to compromise another target .", "1421": "Pitty Tiger also seem to use fake Microsoft Office Excel content , yet we could only find empty content delivering once again the Troj/ReRol.A malware .", "1422": "Although we have not been able to find evidences of any attack aimed at exploiting vulnerabilities on the group 's targets servers , we have been able to record several vulnerability scanning launched from one c & c server straight to the targets .", "1423": "The attackers have been using different vulnerability scanners aimed at their targets .", "1424": "While some targets have been scanned with '' generic '' vulnerability scanning tools like HScan or Fluxay and port scanners like Nmap , some other targets have been scanned for very specific vulnerabilities , like a ZyWALL vulnerability or a FORTINET product .", "1425": "We have also been able to testify that the Pitty Tiger group has successfully collected information on some of their targets by exploiting the HeartBleed bug .", "1426": "This vulnerability which exists on some old versions of OpenSSL allows attackers to collect data from chunks of memory from the targeted machine .", "1427": "It allowed the Pitty Tiger group to get admin credentials from at least one target , for example .", "1428": "Running automated vulnerability scanners on whole ranges of IP addresses used by the targets or on several domains is a very noisy way to collect information and find server vulnerabilities .", "1429": "One of the favorite methods used by the Pitty Tiger group to infect users is to use a Microsoft Office Word document which exploits a specific vulnerability .", "1430": "The payload infecting the system is malware known as '' Troj/ReRol.A '' .", "1431": "We have been able to find one such document used by that group of attacker , exploiting CVE- 2012-0158 , an old critical vulnerability impacting Microsoft Office and corrected by Microsoft's MS12-027 fix in April 2012 .", "1432": "We also found one RTF document embedding CVE-2014-1761 , which is a more recent exploit .", "1433": "We discovered several different documents spreading this malware by triggering CVE-2012-0158 vulnerability , yet we could not share them in this report , since these documents contain information about victims of the Pitty Tiger group .", "1434": "When opened , it shows a single line written in Chinese language , which can be translated as '' Hello ! '' When successfully triggered , the exploit infects the host by dropping and executing a file named '' svohost.exe '' in the temporary folder of the currently logged-in user : This binary is '' Troj/ReRol.A '' according to Sophos naming convention .", "1435": "It immediately triggers alarms on our sandbox : The binary drops a copy of itself in the Application Data folder of the currently logged-in user : The malware initiates a communication to time.windows.com to check for connectivity , and then communicates with the c & c server at mac.avstore.com.tw .", "1436": "The variants we have seen did use that same User- Agent : The persistence mechanism used by the malware is the creation of a registry key named '' Shell '' containing the path to the malware on the infected system : The payload of this malware is used to collect information on the newly infected host , and send it back to the c & c server .", "1437": "It can also download and execute binaries .", "1438": "The data sent in the POST request has a 0x11 bytes header consisting of a fixed-value byte ( 0xc3 ) followed by a 0x10 bytes encryption key .", "1439": "The data following the header is encrypted using RC4 with the previous key .", "1440": "Here is an anonymized sample of communication showing information collected by the malware : This information is very useful for an attacker : it shows all software installed on the system , and running services .", "1441": "Once this data has been transferred to the c & c server , it responds by sending additional malware to execute on the machine .", "1442": "The malware , when running in our sandbox , triggers the following alarms : The binary drops two files in '' C : \\Windows\\System32 '' : The '' qmgrxp.exe '' binary is a simple copy of the original binary .", "1443": "It drops the '' packet64.dll '' , and injects it in '' explorer.exe '' .", "1444": "When executed , a mutex called '' PittyTiger '' is created .", "1445": "Persistence is achieved by adding the path to the binary to the WinlogonUserInit key : The '' packet64.dll '' is the main payload of the RAT .", "1446": "After being injected , it starts sending its Hello packet to its c & c server : All the requests sent to the c & c contains the string '' /FC001/ '' followed by the bot id .", "1447": "The data sent is simply encoded using base64 , there is no cipher at all .", "1448": "The hello packet , once decoded , looks like the following : Our sample had 3 c & c servers configured : The following commands are implemented : Regarding the controller part , we found two different versions : The interface handling both Pitty TIGER and CT connections is very interesting .", "1449": "This remote administration tool is often used by the Pitty Tiger group .", "1450": "Moreover , the same commands are implemented in both RATs .", "1451": "Unsurprisingly , when running in our sandbox , the RAT triggers the same alarms as PittyTiger : The binary drops two files in '' C : \\Program Files\\Internet Explorer '' : The '' ieupdate.exe '' is a simple binary to inject the DLL into '' explorer.exe '' .", "1452": "Persistence is achieved via the following registry key : After injection , the RAT sends a first login packet to its c & c : The RAT communication is performed through HTTP requests .", "1453": "The data is sent encrypted with RC4 , and base64-encoded .", "1454": "The Login packet contains the following string , after decoding and deciphering : It contains the computer name , the user name , the internal IP address , the OS version , the RAT internal version and the Language ID of the system .", "1455": "The RAT can then receive commands from its c & c .", "1456": "Usual RAT features are implemented : Regarding the configuration , our sample communicates with '' sop.avstore.com.tw '' , and contains the string '' Nov 13 2013 '' , which should be a version identifier .", "1457": "This is another remote administration tool often used by the Pitty Tiger crew .", "1458": "The binary we found is named 3200.exe , and triggers the following alarms in our sandbox : The '' release.tmp '' file is dropped on the system : The binary is also copied to the user 's '' Application Data '' directory , and injects the '' release.tmp '' file in '' explorer.exe '' .", "1459": "Persistence is achieved by adding the path to the binary to the Winlogon Shell key : The RAT embeds its own DNS server IP addresses to make the c & c domain names resolutions .", "1460": "These addresses are listed below : It starts resolving its domains after injection , and immediately sends requests .", "1461": "First requests are used to check for updates ( GET request on /httpdocs/update/update.ini ) .", "1462": "A Hello packet is then sent : The bot then repeatedly sends GET requests on '' /httpdocs/mm/ < botid > /ComMand.sec '' to retrieve remote commands .", "1463": "The communication protocol is quite simple : GET requests are used to receive data from the c & c , and POST requests to send data .", "1464": "In POST commands , the CGI name represents the command .", "1465": "The following features are implemented : The following CGI files can be requested by the bot : The configuration is stored locally in a file called '' schmup.sys '' .", "1466": "The file is ciphered using RC4 , using the MD5 hash of '' rEdstArs '' as the key .", "1467": "Our sample uses '' mca.avstore.com.tw '' , '' star.yamn.net '' and '' bz.kimoo.com.tw '' as c & c servers .", "1468": "Unlike others c & c binaries , the c & c part of this RAT does not have a graphical interface , but can be remotely requested to manage the bots .", "1469": "Furthermore , no authentication is required to send commands to the c & c ( but you need to know the configured password to interact with the bots ) .", "1470": "We do not currently know why this malware uses the same patterns to communicate .", "1471": "This is another remote administration tool used by the Pitty Tiger group .", "1472": "The binary we found was dropped by a malicious Word document .", "1473": "The following alarms are triggered in the sandbox : The shellcode contained in the Word file drops the following file , and executes it : This one drops in turn the following file : This tmp file is then copied to '' C : \\Windows\\system32\\Nwsapagentex.dll '' and registered as a service called '' Nwsapagent '' .", "1474": "Up to 5 c & c servers can be configured , but our sample only had one : '' ey.avstore.com.tw:53 '' .", "1475": "Moreover , the built malware we found in the same folder was configured to connect to a local IP address , probably for testing purposes .", "1476": "Six malware families have been identified as communicating with subdomains of skypetm.com.tw : Avstore.com.tw and skypetm.com.tw have 4 malware families in common , communicating to subdomains of both domains : Some domains registered by the group are very old .", "1477": "We suspect Pitty Tiger to use this compromise to spear phish other companies which are in commercial relation with this web development company .", "1478": "We also found a lot of vulnerability scanners launched by the attackers at different targets , yet there was no sign of compromise .", "1479": "According to the name of the files and the general feel of the archive , we do think it was extracted by the attackers to '' show '' someone what kind of data they could get from the compromise of that particular target .", "1480": "Interestingly enough , we saw a part of these documents appear on Virus-Total , with an additional '' gift '' from the attackers , a payload dropping a malware .", "1481": "There are only two options we can think of here : \uf0b7 Someone from the same company has been targeted with this document .", "1482": "\uf0b7 Someone from another company has been targeted with this document .", "1483": "A computer named CHMXY-PC connected to the c & c via RDP with IP address 58.61.40.5 .", "1484": "The IP is in an ADSL dynamic pool in the Gangzhou area ( Guangdong province ) : A few connections to the c & c were done by a computer named TIEWEISHIPC with IP address 27.16.139.143 .", "1485": "Some connections to the c & c originated from a computer named FLY-THINK with several IP addresses , all located in Fuqing ( Fujian province ) .", "1486": "The IP addresses are in an ADSL dynamic pool : Most of the connections to the c & c server were coming from a computer named 50PZ80C- 1DFDCB8 with several IP addresses .", "1487": "The two computers FLY-THINK and 50PZ80C-1DFDCB8 have used distinct IP addresses to connect to the c & c , yet some of these IP addresses come from the same IP range : We mapped these RDP connections to have a graphical view : We found that a member of this group of attackers used some tools on his own system , for testing purposes .", "1488": "He launched some tests with the CT RAT we exposed earlier : Here we can see a user '' Toot '' from a machine named '' toot-2a601225a8 '' logging in the CT RAT and executing some commands .", "1489": "After these tests , we could see some real connections to a victim using this RAT .", "1490": "Please note that at this point , the attacker has at least the privileges of a local administrator , since he is allowed to write content in the system32 folder of a Windows XP system .", "1491": "He could also gain the credentials to a sensitive e-mail account .", "1492": "The c & c servers used by the attackers revealed a lot of interesting files stored in various folders : This is quite the usual arsenal for a group of APT attackers : What is rare to find is the controller part of those tools .", "1493": "Not only is it one more indicator of a probable Chinese origin , but also an indicator that this server was probably used as a test base , in addition to being operational and controlling infected machines from different targets .", "1494": "A script named ipc.bat uses a file named user.txt to try to brute-force a shared folder access : The user.txt file contains thousands of lines , each one being a couple of one particular username and one password attempt : This user.txt file has been anonymized , yet we wanted to give you the feel for it .", "1495": "Information relating to the tools used by the attackers has been leveraged for attribution : The IP addresses used for the hosting of the c & c domains are mainly located in Taipei ( Ta\u00efwan ) and Hong Kong City ( Hong Kong Special Administrative Region , PRC ) : Most RDP connections to the c & c infrastructure come from Chinese IP ranges in Fuqing ( Fujian province , PRC ) .", "1496": "Pitty Tiger is effective and mature in the use of targeted malware , the use of known exploits to infect computers with their malware and the creation of an infrastructure to efficiently conduct APT attacks .", "1497": "They are quite unprofessional in their way of using their infrastructure : they do launch vulnerability scanners directly from a c & c server and also use their connection for personal activities ( downloading pornographic material for example , as we have seen a whole folder on a c & c server full of xxx torrent links ) .", "1498": "The report illuminates a wide set of tools in use by the actors , including several Remote Access Tools ( RATs ) .", "1499": "The RATs are used by the PUTTER PANDA actors to conduct intelligence-gathering operations with a significant focus on the space technology sector .", "1500": "This toolset provides a wide degree of control over a victim system and can provide the opportunity to deploy additional tools at will .", "1501": "They focus their exploits against popular productivity applications such as Adobe Reader and Microsoft Office to deploy custom malware through targeted email attacks .", "1502": "\u2794 \u0007They focus their exploits against popular productivity applications such as Adobe Reader and Microsoft Office to deploy custom malware through targeted email attacks .", "1503": "Although some of the domains used for command and control of the tools described later in this report appear to be legitimate sites that have been compromised in some way , many of them appear to have been originally registered by the operators .", "1504": "These are shown in Table 3 , and may be used for command and control of PUTTER PANDA tools .", "1505": "Several RATs are used by PUTTER PANDA .", "1506": "Two droppers have been associated with the PUTTER PANDA toolset ; these are also briefly examined below .", "1507": "The operation of this RAT is described in detail in other CrowdStrike reporting , but is useful to revisit here to highlight the characteristics of the RAT : \u2022 C2 occurs over HTTP , after connectivity has been verified by making a distinctive request ( to the URI / search ? qu= at www.google.com ) .", "1508": "\u2022 A victim identifier is generated from the infected machine 's hard disk serial number , XOR'ed with the key ldd46 ! yo , and finally nibble-wise encoded as upper-case ASCII characters in the range ( A-P ) \u2013 e.g. , the byte value 0x1F becomes '' BP '' .", "1509": "\u2022 A series of HTTP requests characterizes the RAT 's C2 .", "1510": "The initial beacon uses a request with four parameters ( h1 , h2 , h3 , and h4 ) \u2013 as shown in Figure 8 \u2013 to register the implant with the C2 server .", "1511": "\u2022 Communication to and from the C2 server is obfuscated using a 1-byte XOR with the key 0xBE .", "1512": "\u2022 The commands supported by the RAT enable several capabilities , including : The 3PARA RAT was described in some detail in other CrowdStrike reporting , which examined a DLL-based sample with an exported filename of ssdpsvc.dll .", "1513": "On startup , the RAT attempts to create a file mapping named & *SDKJfhksdf89*DIUKJDSF & *sdfsdf78sdfsdf .", "1514": "This is used to prevent multiple instances of the RAT being executed simultaneously .", "1515": "The RAT will then use a byte-wise subtraction- based algorithm ( using a hard-coded modulo value ) to decode C2 server details consisting of a server hostname and port number , in this example nsc.adomhn . com , port 80 .", "1516": "Several threads are used to handle different stages of the C2 protocol , such as receiving data from the server , decrypting data , and processing commands .", "1517": "Once running , the RAT will load a binary representation of a date/time value from a file C : \\RECYCLER\\restore.dat , and it will sleep until after this date/time has passed .", "1518": "Database provides a mechanism for the operators to allow the RAT to remain dormant until a fixed time , perhaps to allow a means of regaining access if other parts of their toolset are removed from a victim system .", "1519": "As with the 4H RAT , the C2 protocol used by the 3PARA RAT is HTTP based , using both GET and POST requests .", "1520": "An initial request is made to the C2 server ( illustrated in Figure 11 above ) , but the response value is effectively ignored ; it is likely that this request serves only as a connectivity check , as further C2 activity will only occur if this first request is successful .", "1521": "In this case , the RAT will transmit some basic victim information to the C2 server along with a 256-byte hash of the hard-coded string HYF54 & % 9 & jkMCXuiS .", "1522": "It is likely that this request functions as a means to authenticate the RAT to the C2 server and register a new victim machine with the controller .", "1523": "If this request is also successful , the RAT will attempt to retrieve tasking from the controller using a further distinctive HTTP request shown in Figure 13 , repeating this request every two seconds until valid tasking is returned .", "1524": "Output data produced by tasking instructions is encrypted in the same manner as it was decrypted and sent back to the C2 server via HTTP POST request to a URI of the form /microsoft/errorpost/ default.aspx ? ID= , where the ID value is a random number in decimal representation \u2013 as with the initial request shown in Figure 4 .", "1525": "The set of commands supported by the RAT is somewhat limited , indicating that perhaps the RAT is intended to be used as a second-stage tool , or as a failsafe means for the attackers to regain basic access to a compromised system ( which is consistent with its support for sleeping until a certain date/time ) .", "1526": "Initially , the malware will perform a connectivity check to a hard-coded URL ( http : //www.microsoft.com ) , using a constant user agent Mozilla/4.0 ( Compatible ; MSIE 6.0 ; ) .", "1527": "If this request fails , the malware will attempt to extract proxy details and credentials from Windows Protected Storage , and from the IE Credentials Store using publicly known methods15 , using the proxy credentials for subsequent requests if they enable outbound HTTP access .", "1528": "An initial request is then made to the hard-coded C2 server and initial URI \u2013 forming a URL of the form ( in this sample ) http : //login.stream-media.net/files/xx11/index.asp ? 95027775 , where the numerical parameter represents a random integer .", "1529": "The malware will then attempt to download content from the specified URL to the filename within the user 's temporary directory , and then execute this file via the WinExec API .", "1530": "If this execution attempt succeeds , a final C2 request will be made \u2013 in this case to a URL using the same path as the initial request ( and a similarly random parameter ) , but with a filename of success.asp .", "1531": "Finally , the malware will delete the content saved from the first request , and exit .", "1532": "The limited functionality , and lack of persistence of this tool , implies that it is used only as a simple download- and-execute utility .", "1533": "Like pngdowner , the httpclient malware is a simple tool that provides a limited range of functionality and uses HTTP for its C2 channel .", "1534": "This malware also initially performs a connectivity check to www.microsoft.com using the hard-coded user agent Mozilla/4.0 ( Compatible ; MSIE 6.0 ; ) , although in this variant no attempt is made to extract proxy credentials .", "1535": "The malware will then connect to its configured C2 infrastructure ( file.anyoffice.info ) and perform a HTTP request of the form shown in Figure 14 below : Content returned from the C2 server is deobfuscated by XOR'ing the content with a single byte , 0x12 .", "1536": "If this string is not present , the C2 request is repeated every 0.5 seconds .", "1537": "Otherwise , a shell process is started ( i.e. , cmd.exe ) , with input/output redirected over the C2 channel .", "1538": "If the session is ended , two other commands are supported : m2b ( upload file ) and b2m ( download file ) .", "1539": "Other CrowdStrike reporting describes a dropper used by PUTTER PANDA ( abc.scr ) to install the 4H RAT .", "1540": "This dropper uses RC4 to decrypt an embedded payload from data in an embedded resource before writing the payload to disk and executing it .", "1541": "Another dropper has been observed , exclusively installing the pngdowner malware ( example MD5 hash 4c50457c35e2033b3a03fcbb4adac7b7 ) .", "1542": "The executable and DLL are both contained within the .data", "1543": "section of the dropper , obfuscated with a 16-byte XOR key ( consisting of the bytes 0xA0 \u2013 0xAF ) .", "1544": "Both the document and executable are written to disk and the executed via the ShellExecute API ( using the verb '' open '' ) .", "1545": "The executable is also installed into the ASEP registry key HKCU\\Software\\Microsoft\\Windows\\ CurrentVersion\\Run , with a value named McUpdate .", "1546": "Finally , the dropper deletes itself via a batch file .", "1547": "The dropped executable ( MD5 hash 38a2a6782e1af29ca8cb691cf0d29a0d ) primarily aims to inject the specified DLL ( McUpdate.dll , MD5 hash 08c7b5501df060ccfc3aa5c8c41b452f ) into a process that would normally be accessing the network , likely in order to disguise the malicious activity .", "1548": "If Internet Explorer is used , then the malware will attempt to terminate processes corresponding to two components of Sophos Anti-Virus ( SAVAdminService.exe and SavService.exe ) .", "1549": "Four examples of these droppers were located , using a mixture of decoy PDF and Microsoft Word documents ( shown below in Figures 15-18 ) .", "1550": "Although some of their tools are simplistic , taken as a whole their toolset provides a wide degree of control over a victim system and can provide the opportunity to deploy additional tools at will .", "1551": "Regin is an extremely complex piece of software that can be customized with a wide range of different capabilities which can be deployed depending on the target .", "1552": "It is built on a framework that is designed to sustain long-term intelligence-gathering operations by remaining under the radar .", "1553": "It goes to extraordinary lengths to conceal itself and its activities on compromised computers .", "1554": "The main purpose of Regin is intelligence gathering and it has been implicated in data collection operations against government organizations , infrastructure operators , businesses , academics , and private individuals .", "1555": "The modular design also makes analysis of the threat difficult , as all components must be available in order to fully understand it .", "1556": "APTs typically seek specific information , usually intellectual property .", "1557": "It is used for the collection of data and continuous monitoring of targeted organizations or individuals .", "1558": "Regin has a wide range of standard capabilities , particularly around monitoring targets and stealing data .", "1559": "Regin is capable of installing a large number of additional payloads , some highly customized for the targeted computer .", "1560": "The threat 's standard capabilities include several remote access Trojan ( RAT ) features , such as capturing screenshots and taking control of the mouse 's point-and-click functions .", "1561": "Regin is also configured to steal passwords , monitor network traffic , and gather information on processes and memory utilization .", "1562": "It can also scan for deleted files on an infected computer and retrieve them .", "1563": "For example , one module was designed to monitor network traffic to Microsoft Internet Information Services ( IIS ) web servers , another was designed to collect administration traffic for mobile telephony base station controllers , while another was created specifically for parsing mail from Exchange databases .", "1564": "Regin goes to some lengths to hide the data it is stealing .", "1565": "Valuable target data is often not written to disk .", "1566": "Targets may be tricked into visiting spoofed versions of well- known websites and the threat may be installed through a web browser or by exploiting an application .", "1567": "On one computer , log files show that Regin originated from Yahoo ! Instant Messenger through an unconfirmed exploit .", "1568": "The initial stages involve the installation and configuration of the threat 's internal services .", "1569": "All other stages are stored as encrypted data blobs , as a file or within a non-traditional file storage area such as the registry , extended attributes , or raw sectors at the end of disk .", "1570": "Symantec believes that once the dropper is executed on the target 's computer , it will install and execute Stage 1 .", "1571": "It 's likely that Stage 0 is responsible for setting up various extended attributes and/or registry keys and values that hold encoded versions of stages 2 , 3 , and potentially stages 4 and onwards .", "1572": "Stage 1 is the initial load point for the threat .", "1573": "There are two known Stage 1 file names : These are kernel drivers that load and execute Stage 2 .", "1574": "These kernel drivers may be registered as a system service or may have an associated registry key to load the driver while the computer is starting up .", "1575": "Stage 1 simply reads and executes Stage 2 from a set of NTFS extended attributes .", "1576": "If no extended attributes are found , Stage 2 is executed from a set of registry keys .", "1577": "Stage 2 is a kernel driver that simply extracts , installs and runs Stage 3 .", "1578": "Stage 2 is not stored in the traditional file system , but is encrypted within an extended attribute or a registry key blob .", "1579": "Stage 2 can be found encrypted in : This stage can also hide running instances of Stage 1 .", "1580": "Similar to previous stages , Stage 2 finds and loads an encrypted version of Stage 3 from either NTFS extended attributes or a registry key blob .", "1581": "Stage 2 can also monitor the state of the threat .", "1582": "This stage drops the file msrdc64.dat , which appears to always be 512 bytes in size .", "1583": "Instead , this file is encrypted within an extended attribute or registry key blob .", "1584": "In addition to loading and executing Stage 4 , Stage 3 offers a framework for the higher level stages .", "1585": "The files for Stage 4 , which are loaded by Stage 3 , consist of a user-mode orchestrator and multiple kernel payload modules .", "1586": "When the attackers who operated Regin cleaned up compromised computers once they were finished with them , they often failed to remove Stage 4 and 5 artifacts from the system .", "1587": "The files for Stage 5 are injected into services.exe by Stage 4 .", "1588": "Example payload functionality seen to date includes : Regin stores data files and payloads on disk in encrypted virtual file system files .", "1589": "Files stored inside EVFS containers are encrypted with a variant of RC5 , using 64-bit blocks and 20 rounds .", "1590": "The encryption mode is reverse cipher feedback ( CFB ) .", "1591": "As explained above , the files are encrypted .", "1592": "Regin 's C & C operations are extensive .", "1593": "These backchannel operations are bidirectional , which means either the attackers can initiate communications with compromised computers on the border network or the compromised computers can initiate communications with the attacker .", "1594": "Furthermore , compromised computers can serve as a proxy for other infections and command and control can also happen in a peer-to-peer fashion .", "1595": "All communications are strongly encrypted and can happen in a two-stage fashion where the attacker may contact a compromised computer using one channel to instruct it to begin communications on a different channel .", "1596": "Four transport protocols are available for C & C : \u2022 ICMP : Payload information can be encoded and embedded in lieu of legitimate ICMP/ping data .", "1597": "\u2022 HTTP : Payload information can be encoded and embedded within cookie data under the names SESSID , SMSWAP , TW , WINKER , TIMESET , LASTVISIT , AST.NETSessionId , PHPSESSID , or phpAdsd .", "1598": "The C & C operations are undertaken by various modules , including major groups C373h , 19h , 9 , as well as Stage 5 payloads , such as C375h and 1Bh .", "1599": "Regin logs data to the ApplicationLog.dat file .", "1600": "This file is not an encrypted container , but it is encrypted and compressed .", "1601": "Regin can be distributed with various payload modules or receive payload modules after infection .", "1602": "The IIS web server log stealing module , 27E9h , is an example of a payload module that was installed after the initial infection and was specifically deployed for a particular target .", "1603": "We also recovered files from infected computers that may or may not be associated with 64-bit Regin , including several variants of svcsstat.exe , a file that aims to retrieve binary data over pipes or sockets and execute the data .", "1604": "Instead , Stage 1 is a user mode DLL loaded as a Winsock helper when the computer is starting up .", "1605": "Rather than loading Stage 2 from an NTFS extended attribute , Stage 1 looks for the last partition ( in terms of physical location ) on disk and searches for the payload in the raw sectors in this area of the disk .", "1606": "Regin is a highly-complex threat which has been used for large-scale data collection or intelligence gathering campaigns .", "1607": "Regin was found on infected internal computer systems and email servers at Belgacom , a partly state-owned Belgian phone and internet provider , following reports last year that the company was targeted in a top-secret surveillance operation carried out by British spy agency Government Communications Headquarters , industry sources told The Intercept .", "1608": "The malware , which steals data from infected systems and disguises itself as legitimate Microsoft software , has also been identified on the same European Union computer systems that were targeted for surveillance by the National Security Agency .", "1609": "'' In a hacking mission codenamed Operation Socialist , GCHQ gained access to Belgacom 's internal systems in 2010 by targeting engineers at the company .", "1610": "The malicious LinkedIn page launched a malware attack , infecting the employees ' computers and giving the spies total control of their systems , allowing GCHQ to get deep inside Belgacom 's networks to steal data .", "1611": "The implants allowed GCHQ to conduct surveillance of internal Belgacom company communications and gave British spies the ability to gather data from the company 's network and customers , which include the European Commission , the European Parliament , and the European Council .", "1612": "One of the keys to Regin is its stealth : To avoid detection and frustrate analysis , malware used in such operations frequently adhere to a modular design .", "1613": "The following Regin components have been identified : The first stage are drivers which act as loaders for a second stage .", "1614": "When started , this stage simply loads and executes Stage 2 .", "1615": "The Regin loaders that are disguised as Microsoft drivers with names such as : Mimicking Microsoft drivers allows the loaders to better disguise their presence on the system and appear less suspicious to host intrusion detection systems .", "1616": "When launched , it cleans traces of the initial loader , loads the next part of the toolkit and monitors its execution .", "1617": "On failure , Stage 2 is able to disinfect the compromised device .", "1618": "The malware zeroes out its PE ( Portable Executable , the Windows executable format ) headers in memory , replacing '' MZ '' with its own magic marker 0xfedcbafe .", "1619": "It initializes the core components of the architecture and loads the next parts of the malware .", "1620": "These modules can include data collectors , a self-defense engine which detects if attempts to detect the toolkit occur , functionality for encrypted communications , network capture programs , and remote controllers of different kinds .", "1621": "The Intercept 's investigation revealed a sample uploaded on VirusTotal on March 14th 2012 that presents the unique 0xfedcbafe header , which is a sign that it might have been loaded by a Regin driver and it appears to provide stealth functionality for the tool kit .", "1622": "In order to access information stored in the computer 's memory , programs use objects that reference specific locations in memory called pointers .", "1623": "This binary file contains some of such pointers initialized , which corroborates the hypothesis that the file was dumped from memory during a forensic analysis of a compromised system .", "1624": "In addition , when freeing memory using ExFreePool ( ) , the driver zeroes the content , probably to avoid leaving traces in pool memory .", "1625": "The driver also contains routines to check for specific builds of the Windows kernel in use , including very old versions such as for Windows NT4 Terminal Server and Windows 2000 , and then adapts its behavior accordingly .", "1626": "This Regin driver recurrently checks that the current IRQL ( Interrupt Request Level ) is set to PASSIVELEVEL using the KeGetCurrentIrql ( ) function in many parts of the code , probably in order to operate as silently as possible and to prevent possible IRQL confusion .", "1627": "Upon execution of the unload routine ( located at 0xFDEFA04A ) , the driver performs a long sequence of steps to remove remaining traces and artifacts .", "1628": "The attacks we have documented usually involve the use of malicious links or e-mail attachments , designed to obtain information from a device .", "1629": "On the one hand , we have observed attacks using a wide range of off-the-shelf spyware , as well as publicly available third-party services , like iplogger.org .", "1630": "On the other hand , some at- tacks use so-called '' lawful intercept '' trojans and related equip- ment , purportedly sold exclusively to governments by compa- nies like Gamma International and Hacking Team .", "1631": "Yet , the attacks are noteworthy for their careful social engineering , their links to governments , and their real-world impact .", "1632": "In some cases the attackers employed expensive and '' government exclusive '' malware , while in other cases , attackers used cheap and readily available RATs .", "1633": "Across these cases we find that clever social engineering often plays a central role , which is strong evidence of a well-informed ad- versary .", "1634": "In general , the attacks we find are not well- detected by anti-virus programs .", "1635": "The first involved malicious e-mails containing FinSpy , a '' lawful intercept '' trojan sold exclusively to governments .", "1636": "The second involved specially crafted IP spy links and e-mails de- signed to reveal the IP addresses of operators of pseudonymous accounts .", "1637": "We found that some of the attachments contained a PE ( .exe ) file designed to appear as an image .", "1638": "Their filenames contained a Uni- code right-to-left override ( RLO ) character , causing Windows to render a filename such as gpj.1bajaR.exe instead as exe.Rajab1.jpg .", "1639": "The other .rar files contained a Word document with an embedded ASCII-encoded PE file containing a custom macro set to automatically run upon document startup .", "1640": "The executables used virtualized obfusca- tion , which appeared to be custom-designed .", "1641": "This executable contained a similar string , except it identi- fied itself as FinSpy v3.00 , and attempted to connect to tiger.gamma-international.de , a domain registered to Gamma International GmbH .", "1642": "Analysis of capabilities : We found that the spyware has a modular design , and can download additional modules from a command & control ( C & C ) server , including password cap- ture ( from over 20 applications ) and recording of screenshots , Skype chat , file transfers , and input from the computer 's micro- phone and webcam .", "1643": "To exfiltrate data back to the C & C server , a module encrypts and writes it to disk in a special folder .", "1644": "The spyware period- ically probes this folder for files that match a certain naming convention , then sends them to the C & C server .", "1645": "It then over- writes the files , renames them several times , and deletes them , in an apparent effort to frustrate forensic analysis .", "1646": "Analysis of encryption : Because the malware employed myriad known anti-debugging and anti-analysis techniques , it thwarted our attempts to attach debuggers .", "1647": "We found that FinSpy encrypts data using a custom imple- mentation of AES-256-CBC .", "1648": "The 32 byte AES key and 16 byte IV are generated by repeatedly reading the low-order-4-bytes of the Windows clock .", "1649": "The key and IV are encrypted using an em- bedded RSA-2048 public key , and stored in the same file as the data .", "1650": "Finally , FinSpy 's wire protocol for C & C commu- nication uses the same type of encryption , and thus is subject to the same brute force attack on AES keys .", "1651": "C & C server : The samples communicated with 77.69.140.194 , which belongs to a subscriber of Batelco , Bahrain 's main ISP .", "1652": "We then infected the VM with FinSpy and allowed it to connect to the Bahrain C & C server .", "1653": "In an IP spy attack , the attacker aims to discover the IP address of a victim who is typically the opera- tor of a pseudonymous social media or e-mail account .", "1654": "The at- tacker sends the pseudonymous account a link to a webpage or an e-mail containing an embedded remote image , using one of many freely-available services .", "1655": "When the victim clicks on the link or opens the e-mail , their IP address is revealed to the at- tacker .", "1656": "'' Red Sky had earlier targeted other users with IP spy links shortened using the al9mood bit.ly account .", "1657": "'' An account linked to al9mood sent Je- had Abdulla an IP spy link on 10/2/12 in a public message .", "1658": "@ YLUBH received at least three IP spy links in late 2012 , sent via public Twitter mes sages .", "1659": "Use of embedded remote images : We identified several targets who received spoofed e-mails containing embedded remote images .", "1660": "The attacker sent the e-mails using ReadNotify.com , which records the user 's IP address upon their mail client downloading the remote image .", "1661": "Attackers often used ( 1 ) accounts of promi- nent or trusted but jailed individuals like '' Red Sky , '' ( 2 ) fake personas ( e.g. , attractive women or fake job seekers when tar- geting a labor union ) , or ( 3 ) impersonations of legitimate ac- counts .", "1662": "As summarized in Table 3 , the attacks often include fake or ma- liciously packaged security tools ; intriguing , or ideological , or movement-relevant content ( e.g . lists of wanted persons ) .", "1663": "While the RATs are cheaper and less sophisticated than FinSpy and RCS , they share the same ba- sic functionality , including screen capture , keylogging , remote monitoring of webcams and microphones , remote shell , and file exfiltration .", "1664": "In the most common attack sequence we observed , illus- trated with three examples in Figure 3 , the attacker seeds mal- ware via private chat messages , posts in opposition-controlled social media groups , or e-mail .", "1665": "These techniques often limit the world-visibility of malicious files and links , slowing their detection by common AV products .", "1666": "Typically , targets receive either ( 1 ) a PE in a .zip or .rar , ( 2 ) a file download link , or ( 3 ) a link that will trigger a drive-by download .", "1667": "The messages usually include text , often in Arabic , that attempts to persuade the target to execute the file or click the link .", "1668": "The first attacks in Figure 3 date to 2012 , and use bait files with a DarkComet RAT payload .", "1669": "These attacks share the same C & C , 216.6.0.28 , a Syrian IP address belonging to the Syr- ian Telecommunications Establishment , and publicly reported as a C & C of Syrian malware since February 2012 .", "1670": "The first bait file presents to the victim as a PDF containing infor- mation about a planned uprising in Aleppo .", "1671": "In fact the file is a Windows Screensaver ( .scr", "1672": ") that masquerades as a PDF using Unicode RLO , rendering a name such as '' .fdp.scr", "1673": "'' The second bait file is a dummy program containing DarkComet while masquerading as a Skype call encryption program , playing to opposition para- noia about government backdoors in common software .", "1674": "The third attack in Figure 3 , observed in October 2013 , entices tar- gets with e-mails purporting to contain or link to videos about the current conflict , infecting victims with Xtreme RAT , and using the C & C tn1.linkpc.net .", "1675": "For seeding , the attackers typically use compromised ac- counts ( including those of arrested individuals ) or fake iden- tities masquerading as pro-opposition .", "1676": "Member C and NGO Worker D ( here , actual victims , not abstract ) , targeting was by e-mail from domains apparently belonging to opposition groups , in- dicating a potential compromise .", "1677": "Opp . Member C received a malicious file as an e-mail attachment , while NGO Worker D was sent a shortened link ( url [ . ] no/Uu5 ) to a download from a directory of Mrconstrucciones [ . ] net , a site that may have been com- promised .", "1678": "Both attacks resulted in an Xtreme RAT infection .", "1679": "While dis- tracted by this meaningless interaction , the victim 's machine is infected with DarkComet 3.3 [ , ] .", "1680": "The first attacks we observed in the UAE involved a government-grade '' lawful interception '' trojan known as Re- mote Control System ( RCS ) , sold by the Italian company Hack- ing Team .", "1681": "The exploit loaded shellcode that downloaded a second stage from ar-24.com , which in turn downloaded spyware from ar-24.com .", "1682": "The C & C server also ran on ar-24.com .", "1683": "The document used the same exploit and attempted to download a second stage from rcs-demo.hackingteam.it , which was unavailable at the time of testing .", "1684": "One difference was in the vectors used to install the spyware .", "1685": "We located additional samples ( see \u00a7 5 ) , some of which were embedded in a .jar file that installs an OS-appropriate version of RCS ( Windows or OSX ) , option- ally using an exploit .", "1686": "We also saw instances of the 3-Stage Exploit Kit where the first stage contained a Flash exploit ; in some cases , we could obtain all stages and confirm that these installed RCS .", "1687": "Some samples were packed with the MPress packer , and some Windows samples were obfuscated to look like the PuTTY SSH client .", "1688": "For example , the RCS sample sent to Ahmed adds a Run registry key , whereas the FinSpy samples used in Bahrain overwrite the hard disk 's boot sector to modify the boot process ; the spyware is loaded be- fore the OS , and injects itself into OS processes as they start .", "1689": "The RCS samples we examined also had the ability to propa- gate to other devices , including into inactive VMWare virtual machines by modifying the disk image , onto USB flash drives , and onto Windows Mobile phones .", "1690": "Ahmed subsequently noted several suspicious ac- cesses to his GMail account using IMAP .", "1691": "Even after he changed his password , the accesses continued .", "1692": "While corresponding with Ahmed on his compromised account , an author of this pa- per discovered that the attackers had installed an application- specific password in Ahmed 's GMail account , a secondary password that they apparently used to access his account even after he changed his main password .", "1693": "Two weeks after this correspondence with Ahmed , one of us ( Author in Figure 5 ) received a targeted e-mail with a link to a file hosted on Google Docs containing a commercial off-the- shelf RAT , Xtreme RAT .", "1694": "The instance of Xtreme RAT sent to Author used owner.no-ip.biz for its C & C , one of the domains men- tioned in a report published by Norman about a year-long cam- paign of cyberattacks on Israeli and Palestinian targets carried out by a group that Norman was unable to identify .", "1695": "Three months after Author was targeted , Ahmed received an e-mail containing an attachment with Xtreme RAT that talked to the same C & C server ( Figure 5 ) , suggesting that the attackers who infected Ahmed with RCS may have provided a list of interest- ing e-mail addresses to another group for further targeting .", "1696": "( Interestingly , spyware subse- quently sent to others has used bait content about Ahmed .", "1697": ") Further attacks : In October 2012 , UAE Journalist A and Human Rights activist B ( per Figure 6 ) forwarded us suspi- cious e-mails they had received that contained a Word docu- ment corresponding to the first stage of 3-Stage Exploit Kit ( Figure 5 ) .", "1698": "The attachment contained an embedded Flash file that exploited a vulnerability fixed in Adobe Flash 11.4 , loading shell code to download a second stage from faddeha.com .", "1699": "The SpyNet sample communicated with the C & C hamas.sytes.net .", "1700": "The exploit downloaded a second stage , which in turn downloaded a sam- ple of SpyNet from maile-s.com .", "1701": "This sample of SpyNet communicated with the same C & C hamas.sytes.net .", "1702": "When run , the sample unpacks a compiled Visual Basic project that loads , via the RunPE method , an executable packed with UPX .", "1703": "These individuals received e-mails containing a link to a web page hosted on cedarkeyrv.com impersonat- ing YouTube .", "1704": "'' The page redirected to a YouTube video a few seconds later , but first loaded a Java exploit -a known vulnerability with no patch at the time that the e-mails were sent .", "1705": "The attack downloaded an instance of SpyNet from isteeler.com ( which from our inspection did not appear to have any legitimate content ) , which used the C & C storge.myftp.org .", "1706": "An unidentified dropper using this C & C targeted Journalist F ; a SpyNet attack on Relative of political detainee D also used this C & C .", "1707": "In that latter case , the sample arrived via e-mail in a .rar attachment that contained an .scr file disguised as a Word document .", "1708": "The .scr file was a self-extracting archive that decompressed and ran both the bait document and the payload .", "1709": "In all , these totaled 17 distinct hashes of documents , and 10 distinct hashes of payloads ( some documents that differed in their hash downloaded the same pay- load ) .", "1710": "The exploits primarily downloaded instances of SpyNet from upload.bz , which for the most part communicated with C & C at sn.all-google.com .", "1711": "This domain was also used for C & C in other attacks , including that on Journalist C. Two of the other CVE-2012-0158 exploits down- loaded DarkComet from www.getmedia.us and www.technopenta.com after posting system infor- mation to random123.site11.com .", "1712": "Gamma documentation advertises that an operator of FinSpy can obscure the location of the C & C server ( called the mas- ter ) by setting up a proxy known as a relay .", "1713": "We located a version of FinSpy that does not use the normal FinSpy handshake , but instead uses a protocol based on HTTP POST requests for communication with the C & C server .", "1714": "We also similarly obtained and analyzed sam- ples of FSBSpy , a piece of malware that can report system information , upload screenshots , and drop and execute more malware .", "1715": "This address was un- reachable when we probed it ; a researcher pointed us to an FS- BSpy sample that contained an Arabic-language bait document about Omani poetry , which talked to a C & C in the UK .", "1716": "We grouped servers by the SSL certificates they returned , and found that each group forwarded to only a sin- gle server , except for one case where a group forwarded to two different IPs ( both in Morocco ) .", "1717": "We also found two groups that forwarded to the same address .", "1718": "Two RCS and 5 FSBSpy samples from VirusTo- tal communicated with various servers in the group .", "1719": "The RCS samples also communicated with domains with lapsed registra- tions , so we registered them to observe incoming traffic .", "1720": ") A sample of FSBSpy apparently installed from an exploit on a Turkish server talked to one of the servers in this group .", "1721": "We also found server groups containing servers in Uzbek- istan and Kazakhstan ; we found FSBSpy samples on Virus- Total uploaded from these countries that communicated with servers in these groups .", "1722": "The attacks include spyware for ongoing monitoring and the use of '' IP spy '' links to deanonymize those who voice dissent .", "1723": "The attacks , while sometimes incorporating effective so- cial engineering , in general lack novel technical elements .", "1724": "They use highly sophisticated malware tools to maintain persistent access to their targets .", "1725": "These tools can be used for covert communications in a number of different modes , some of which present significant challenges for traditional security technologies to detect .", "1726": "We have identified two distinct variants , both highly flexible but with two different techniques for establishing and maintaining a presence on the target system .", "1727": "It is designed to covertly install a backdoor on a compromised system , hide the presence of its components , provide a communication mechanism with its C & C servers , and enable an effective data exfiltration mechanism .", "1728": "In the first model , the network communications are carried out from the userland - i.e .", "1729": "In another model , the network communications are handled by a kernel mode driver - i.e .", "1730": "The choice of what architecture should be used may depend on a specific target 's environment , allowing the Snake operators to choose the most suitable architecture to be deployed .", "1731": "In both architectures there is a kernel mode driver installed and a usermode DLL injected by the driver into the system processes .", "1732": "With this architecture , the Snake driver is mainly used to load the DLL module into the usermode processes , and then use that module for the communications .", "1733": "When first executed , the driver creates device named \\Device\\vstor32 with a symbolic link \\DosDevices\\vstor32 .", "1734": "This device is used for userland/kernel communications .", "1735": "Next , it drops a DLL into the % windows % directory - the DLL is carried in the body of the driver as a binary chunk with XOR 0xAA applied on top of it , so the driver decrypts it first .", "1736": "Depending on the variant , the DLL is dropped either under a random name or a hard-coded name , such as mscpx32n.dll .", "1737": "The purpose of this DLL is to be injected into the user-mode processes .", "1738": "Some variants of Snake carry the DLL modules that can be installed as a service , to be run within taskhost.exe or services.exe processes .", "1739": "Next , the driver sets up the hooks for the following kernel-mode APIs : After that , it calls PsSetCreateProcessNotifyRoutine ( ) in order to be notified whenever a new process is started .", "1740": "The handlers of the hooks above along with the notification callback allow Snake to stay persistent on a system , being able to infect any newly created processes , and restore its driver file in case it gets deleted .", "1741": "Another set of hooks it sets is designed to hide the presence of the Snake components on the system : The driver then watches for all userland processes to see if they load any web pages .", "1742": "As long as the user is not using the Internet , Snake stays dormant too , as there is no process that communicates with the web servers .", "1743": "However , as soon as the user goes online , the driver intercepts that event and then immediately injects the malicious DLL module into the process that initiated connection ( the browser ) .", "1744": "Once injected , the module initiates polling from one of the hard-coded C & C servers .", "1745": "The purpose of this behaviour is to blend Snake 's traffic with the browser traffic , bypassing the firewalls , and keeping a low profile at the same time .", "1746": "Hiding a few DNS/HTTP requests among busy network traffic allows Snake rootkit to stay unnoticed .", "1747": "As soon as the tool made its first GET requests , the driver immediately injected a malicious DLL module in it , and that module started producing the following traffic : \u2193 The domain names of the C & C servers it relies on are hard-coded in the body of the malware .", "1748": "Some examples are given below , and a full list of known domains is given in the Appendix D : As seen in the traffic dump above , the malware first resolves the domain name of its C & C .", "1749": "Next , it fetches a file /D/pub.txt , and expects the server to respond with a string '' 1 '' , acknowledging it 's active : Once acknowledged , it asks the server for a command , and the server returns a new command to execute : The command it receives from C & C above ( swim.onlinewebshop.net ) is encrypted .", "1750": "In order to decrypt it , the malware first applies the XOR mask to the bytes that start from offset 0x40 : An identical XOR mask was also used by Agent.BTZ .", "1751": "Next , it calculates and confirms a CRC32 checksum within the command , further decrypts the data by using the Number Theory Library ( NTL ) , and makes sure the command is destined to the current host by matching the ID field in it .", "1752": "Once decrypted , the malware interprets the received command , as reflected in the malware log below ( the new C & C server address is highlighted in it ) : After that , the malware connects to the new C & C , asking it for another command : The command it receives is called UpLoad , so it uploads all the collected logs to the server , and then cleans out those logs : The files it uploads are stored inside its home directory % windows % \\ $ NtUninstallQ [ random ] $ , where [ random ] is a random number .", "1753": "The files within that directory are used by the rootkit to store configuration and log data .", "1754": "When decrypted with the same XOR key that was used by Agent.BTZ , these files expose the following contents : Analysis of the sample reveals that it supports 3 modes of fetching C & C commands .", "1755": "\u2022 In the first mode , it relies on Windows Internet ( WinINet ) APIs , such as HttpOpenRequest ( ) , HttpSendRequest ( ) , InternetReadFile ( ) , etc .", "1756": "\u2022 In the second mode , it uses Windows Sockets 2 ( Winsock ) APIs , such as WSAStartup ( ) , socket ( ) , connect ( ) , send ( ) , etc .", "1757": "\u2022 In the third mode , it works in the 'pipe server ' mode , when it passes the web requests it is interested in ( as a client ) to the pipe server that runs within Windows Explorer ( explorer.exe ) and/or Internet Explorer ( iexplore.exe ) processes .", "1758": "The diagram below demonstrates the last , 'pipe server ' mode of Snake operation : The diagram illustrates the operation steps 1-4 : 1 First , the malicious driver with the embedded DLL module injects that DLL into a system process , such as services.exe ; once loaded , the DLL will function in the 'pipe server ' mode .", "1759": "2 As soon as the driver detects a usermode process that goes online ( e.g . a browser ) , it will inject malicious DLL module into it ; depending on the operational mode , the DLL may start communicating with C & C directly .", "1760": "3 In the 'pipe mode ' of operation , the injected DLL will start communicating with the pipe server by sending messages into the established inter-process communication pipes .", "1761": "4 Once the task of communication with C & C is delegated to the pipe server , it will start communicating with the C & C , bypassing the host-based firewalls that keep an infected system process in a white-list .", "1762": "The reason behind the pipes usage is to 'legitimise ' the outbound web requests , forcing them to originate from the host firewall- friendly system services .", "1763": "In order to switch into that mode , a dedicated thread is spawned to listen for IPC messages received through the pipes .", "1764": "The memory pipes used by Snake are named as : Apart from GET / POST requests , the pipe clients ( infected usermode processes ) may also ask the pipe server to perform other operations on their behalf , such as saving data into a temporary file , copy / delete files , save configuration data into the registry under the aforementioned ShellCore value .", "1765": "This delegation of tasks is designed to keep infected processes under the radar of the behavioural analysis tools for as long as possible .", "1766": "Another reason is to overcome account restrictions imposed on a browser process in order to be able to write into files / registry .", "1767": "To delegate different types of tasks , the clients send messages to the pipe server using the following task identification headers : The usermode component of Snake communicates with its kernel-mode driver via a device called \\\\.\\vstor32 ( created under kernel as \\Device\\vstor32 ) .", "1768": "To write data , it opens the device with CreateFile ( '' \\\\.\\vstor32 '' ) , then calls DeviceIoControl ( ) API on its handle with IOCTL code of 0x222038 .", "1769": "Configuration parameters along with the initial set of domain names are hard-coded within the body of the DLL .", "1770": "Analysis of the commands performed by the malware suggests the following capabilities : Together , these commands provide complete backdoor functionality , allowing remote attacker full control over the compromised system .", "1771": "The ability to update the driver and then rely on its communication capabilities means that the components of Snake are flexible , making possible the existence of the hybrid ( kernel-centric and usermode-centric ) architectures .", "1772": "For example , the virtual partitions are used by kernel-centric Snake variants , where the kernel-mode driver is responsible for the communications .", "1773": "If such a driver is installed via an update , the usermode component can be instructed to delegate the file upload task to the driver by copying all the necessary logs into the shared virtual partition , physically located on the compromised host and thus , accessible from kernel .", "1774": "This particular architecture relies on a kernel-mode driver to carry out the network communications .", "1775": "The usermode DLLs are still injected into the system processes to perform high-level tasks .", "1776": "The delivery mechanism is not known : it may be distributed via a thumb-drive , a phishing email attachment , or be delivered via an exploit across the network ( e.g .", "1777": "Infection starts from a dropper penetrating into the compromised system where it is allowed to run .", "1778": "Once executed , the dropper installs the kernel mode driver in a pre-defined location .", "1779": "On a 32-bit OS , it will install a 32-bit driver .", "1780": "On a 64-bit OS , it will install a 64-bit driver .", "1781": "The analysed 32-bit dropper creates a driver in the following location : However , different samples may use a different path and driver file name .", "1782": "The registration is ensured with creation of the following registry entries : The driver then flags the following events with the notification purposes : The rootkit then places a number of the hooks .", "1783": "The first API it hooks is IoCreateDevice ( ) .", "1784": "The installed hook handler calls the original API and then checks if the name of the device is netbt or afd .", "1785": "If so , it will install a TDI filter driver .", "1786": "If the device name is Null , Beep , tcpip or Nsiproxy , it will activate itself by enabling its hooks designed to hide the presence of Snake on a system , set up its access control lists and the messaging system .", "1787": "In order to hide its components , the driver hooks the following APIs : For example , the hook handlers of the registry-related APIs will block access to the registry entries that contain the name of the driver .", "1788": "In one example , the rootkit blocks access to registry entries that contain the strings '' Ultra3 '' and '' ~ROOT '' .", "1789": "The ZwReadFile ( ) hook handler will block access to the home directory where the rootkit keeps its file .", "1790": "In one of the analysed kernel-centric Snake samples the home directory was hard-coded as % windows % \\ $ NtUninstallQ817473 $ , so it blocked file read access from that directory .", "1791": "The ZwClose ( ) hook handler is used to inject the DLL module into the userland processes .", "1792": "The hook handler for ZwTerminateProcess ( ) checks if the process being shut down is svchost.exe .", "1793": "If so , it considers it to be a system shutdown , so it unloads its usermode DLL and deactivates its own network drivers , just like it does when its ZwShutdownSystem ( ) hook handler gets invoked .", "1794": "The ObOpenObjectByName ( ) hook is designed to hide the presence of its virtual partitions ( described later ) .", "1795": "To encrypt data stored on its virtual partitions , the driver sets a hook for another API : To re-infect the usermode process svchost.exe and to re-enable its network drivers , the rootkit hooks these APIs : Snake then proceeds to the task of deep packet inspection and modification .", "1796": "In order to accomplish it , it registers a callout driver for Windows Filtering Platform ( WFP ) , an architecture first introduced with Windows Vista and nowadays normally used by antivirus and/or intrusion detection systems to inspect/block malicious traffic .", "1797": "Snake sets filters at the layers FWPMLAYERSTREAMV4 and FWPMLAYERALEFLOWESTABLISHEDV4 in the TCP/ IP stack , so that its callout driver is notified whenever a TCP connection is established by a browser .", "1798": "When that happens , the rootkit triggers an event named \\BaseNamedObjects\\wininetactivate .", "1799": "When the data arrives , it is intercepted with the FwpsCopyStreamDataToBuffer0 ( ) API , and then scanned for the presence of the hidden commands from C & C .", "1800": "The driver inspects bidirectional network data on a per stream basis , as it 's located right on the stream data path .", "1801": "An ability to manipulate data streams is provided with the packet injection logic below , allowing Snake to covertly insert traffic destined to its C & C servers : In order to qualify as a browser , the usermode process must have any of the following names : In addition to WFP , Snake also hooks the Transport Driver Interface ( TDI ) network routines by setting itself up as a TDI filter driver .", "1802": "Being registered as a TDI driver on the device stack , Snake hooks TCP calls .", "1803": "This way it intercepts all requests along with their parameters via IRP ( IO request package ) hooks .", "1804": "By 'sniffing ' all the requests , it can now inspect the traffic , looking for and then parsing GET / POST HTTP requests and also SMTP communications , in order to distinguish commands addressed to itself .", "1805": "If the rootkit detects that the OS version is pre-Vista ( e.g . Windows XP ) or Windows Server 2008 ( e.g . Windows Server 2003 ) , it will invoke FwpsStreamInjectAsync0 ( ) API in order to generate outbound requests .", "1806": "Whenever the client establishes connections , the TDI driver will also 'pulse ' the \\BaseNamedObjects\\wininetactivate event , just like the WPF driver 's component of it , in order to notify the userland service about the event .", "1807": "The data that the driver intercepts , along with the important notifications , is passed to the userland DLL to be processed .", "1808": "If the data contains commands from C & C , the DLL module is expected to execute them and report results back to the driver to be delivered back to C & C .", "1809": "For NDIS versions 5.X , Snake rootkit contains code that installs NDIS filter intermediate driver .", "1810": "This driver is set up above a miniport driver ( a driver that communicates with the physical device ) and below a protocol driver ( a driver that implements a protocol , e.g .", "1811": "The driver is registered with NdisIMRegisterLayeredMiniport ( ) API .", "1812": "After that , the drivers hooks the following exports within ndis.sys : The rootkit contains code that installs NDIS filter driver for NDIS 6.0 and above : NDIS filter driver configuration is stored in the registry entry : The driver is registered with NdisFRegisterFilterDriver ( ) API .", "1813": "After that , the drivers hooks the following exports within ndis.sys ( for NDIS 6.0 ) : Another set of exports it attempts to hook in ndis.sys ( for NDIS 6.0 ) is : With the hooks installed , whenever the network adapter driver attempts to register to NDIS , or whenever there is an attempt to install NDIS intermediate driver or NDIS filter driver , the hook handlers will register Snake 's own MiniportXxx functions with the NDIS library .", "1814": "With its own miniport handler functions , it can send / receive data by using a private TCP/IP stack , bypassing all firewall hooks , and making its open ports invisible to scanners .", "1815": "The Snake rootkit registers itself as Network Driver Interface Specification ( NDIS ) protocol driver .", "1816": "Whenever the underlying miniport driver receives data from the network , it calls NDIS by invoking a data receive indication function NdisMIndicateReceiveNetBufferLists ( ) .", "1817": "When that happens , NDIS invokes Snake 's hook function ( ProtocolReceiveNetBufferLists ) to process the received data .", "1818": "To send the data back , the protocol driver defines the data in a list of NETBUFFERLIST structures , and then passes them to NDIS by calling NdisSendNetBufferLists ( ) .", "1819": "NDIS , in turn , calls the miniport driver's MiniportSendNetBufferLists ( ) function to forward the data to an underlying miniport driver .", "1820": "Being able to fully manipulate traffic at 3 different levels ( NDIS protocol driver , TDI Driver , and WPF callout driver ) , Snake is able to 'inject ' the traffic into existing communications to reach out to external components , and at the same time parse all incoming traffic to detect traffic addressed to itself : As the driver intercepts all connections ( e.g .", "1821": "on TDIRECEIVE TDI event or ClientEventReceive ( ) event notification triggered through its TDI Filter Driver ) , it parses all incoming HTTP and SMTP traffic to see if it can be authenticated as Snake traffic .", "1822": "The authentication is implemented by decrypting the data and making sure it starts with the markers 0xDEADBEAF and 0xC001BA5E ( which appear to derive from 'DEAD BEEF ' and 'COOL BASE ' ) .", "1823": "Here are specific steps : By observing such behaviour , one might wonder why the driver is expecting HTTP or SMTP clients ? Why does it act like HTTP/SMTP server processing client traffic , and serving back normal responses as per the protocol ? For example , in HTTP the driver will respond with messages like '' HTTP/1.1 200 OK '' or '' HTTP/1.1 500 Server Error '' .", "1824": "The reason behind such behaviour is that the driver is acting in this mode like a proxy , routing requests from other infected hosts to a remote C & C server .", "1825": ": Once the incoming data is authenticated and decrypted , the driver passes it to the DLL by using memory pipes .", "1826": "For example , on HTTP traffic arrival it may send traffic data into a memory pipe \\Device\\NamedPipe\\isapihttp , and then , send a received peer-2-peer command message writepeernfo= [ IPADDRESS : PORT ] 0fragnoscrambling=Y0 into another memory pipe called \\Device\\NamedPipe\\isapidg .", "1827": "In order to log its activity , the driver writes log data into the pipe \\Device\\NamedPipe\\isapilog , so that the DLL could log the data into the log files .", "1828": "Full list of the named pipes used for communications is provided below : Messages submitted into the pipes are wrapped into the structures .", "1829": "The structures appear to contain headers to allow the pipe server , that runs within an infected userland module , to identify the messages first and then unwrap the structures accordingly .", "1830": "For example , the message headers could be : Once received from the pipes and unwrapped/decoded , the data is then handled by the usermode DLL as per the data intention - whether it 's a traffic sniffing task , a peer-2-peer client logic , a logging task , or a task of saving received files into the virtual volumes .", "1831": "The driver creates virtual file volumes for encrypted storage of its files and configuration data : The volumes are mounted from the virtual file systems RawDisk1 and RawDisk2 .", "1832": "The first partition is created with the following steps : The hook installed by the rootkit on IofCallDriver ( ) API provides on-the-fly data encryption/decryption whenever that data is written to or read from the volume .", "1833": "The encryption algorithm is based on CAST-128 , with the hard-coded key stored in the rootkit body .", "1834": "As a result , whenever the data is saved into the volume Hd1 , it will be scrambled on-the-fly , and reflected in the persistent storage file hotfix.dat , which is physically located within the rootkit 's 'home ' directory : Analysis of the hotfix.dat file contents reveals it 's a fully encrypted file with flat entropy .", "1835": "The data stored in \\\\.\\Hd2 is encrypted the same way the first volume 's data .", "1836": "Both volumes appear to be set up as FAT volumes .", "1837": "An attempt to read the data from these volumes with the code below : This will produce the following results : For \\\\.\\Hd1 : For \\\\.\\Hd2 : The ability to keep its data on TrueCrypt-like volumes provides Snake with a powerful ability to exchange data with the usermode DLL , as these volumes are accessible both from usermode and kernel mode .", "1838": "Static analysis of the code reveals that the Snake driver uses virtual volumes to store its data and additional files on it .", "1839": "For example , it stores its message queue in a file called : The message queue indicates an asynchronous communication model between kernel mode driver and a usermode DLL , e.g .", "1840": "Other files that may also be found on the virtual volume are : klog , conlog , dump , rknginst.exe , where rknginst.exe could be the name of the original dropper , and other log files could potentially contain executed command outputs , intercepted keystrokes , and other output logs .", "1841": "The Snake dropper contains both 32-bit and 64-bit unsigned drivers , and it can successfully load its unsigned 64-bit driver on a 64-bit version of Windows XP \u2013 as driver signing is not enforced it does not have to resort to any tricks under this OS version .", "1842": "In this case , in order to ensure the driver is loaded automatically at startup , the dropper can install the 64-bit driver on 64-bit Windows XP in the same way it installs a 32-bit driver on a 32-bit version of Windows XP .", "1843": "On 64-bit versions of Windows Vista and above it behaves differently .", "1844": "Firstly , the 64-bit unsigned driver file is created as usual : However , the driver is not registered ; what is registered instead is the dropper itself .", "1845": "To do that , the dropper first copies itself as : The dropper then registers itself as a service to ensure it starts every time Windows is booted , by creating the values : Now comes the most interesting part : does the dropper manage to load its 64-bit unsigned driver under 64-bit versions of Windows Vista and later versions , such as 64-bit Windows 7/8 ? The answer : Yes , it does .", "1846": "As there are no validations made for the UserBuffer an attacker can craft such input parameters that will define address within kernel memory to patch and the data to patch it with : Now that the vulnerable driver can be used as a weapon to patch kernel memory , all the malware needs to do is to patch the content of the variable nt ! gCiEnabled , a boolean variable '' Code Integrity Enabled '' that marks whether the system was booted in WinPE mode .", "1847": "When running in WinPE mode there is no Code Integrity control , therefore by enabling this mode by patching only one bit , Code Integrity verification is disabled so that the unsigned 64-bit driver can be loaded .", "1848": "In order to find the variable in kernel memory , the Snake dropper loads a copy of the NT core image ( ntoskrnl.exe ) , locates the import of CI.dll 's function CiInitialize ( ) , and then SepInitializeCodeIntegrity ( ) within it .", "1849": "Then it parses the function 's code to locate the offset of the variable .", "1850": "Once located , the content of the variable nt ! gCiEnabled is patched in kernel memory and the 64-bit unsigned driver is loaded .", "1851": "This explains why Snake dropper registers itself as a service to start each time Windows starts : in order to install the vulnerable VBox driver first , then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl ( ) API call , and finally , load the driver .", "1852": "In order to be able to perform the steps above , the dropper must first obtain Administrator privileges .", "1853": "It attempts to do this by running MS09-025 and MS10-015 exploits on the target system .", "1854": "Other resources embedded within the dropper are the 32-bit and 64-bit builds of its driver , a tool for creating NTFS file systems , and the initial message queue file which is written into the virtual volume .", "1855": "The message queue file contains configuration data and the libraries that will be injected into usermode processes .", "1856": "The usermode DLLs injected by the kernel-mode driver into the userland system process ( e.g .", "1857": "explorer.exe ) are : The rkctlWin32.dll/rkctlx64.dll module uses the following hard-coded named pipe for communications : The remote commands it receives appear to be designed to control other components of Snake : The injsnakeWin32.dll/injsnakex64.dll module exports 61 functions .", "1858": "It is designed to perform the high-level tasks such as : When the DLL activates , it reads configuration parameters from the configuration queue , that the driver creates on a virtual volume .", "1859": "One of the parameters defines the pipe name ( s ) that the DLL should use for its communications .", "1860": "The remote commands received by this Snake DLL module are designed to set up various communication parameters : To post the data , the DLL can use the following User-Agent string '' Mozilla/4.0 ( compatible ; MSIE 6.0 ) '' .", "1861": "It may rely on the following Internet Media types ( MIME types ) for data exfiltration : Request type it uses can either be POST of GET , and C & C server resource name is /default.asp .", "1862": "One of the Snake components that could have been downloaded from a remote C & C server , was identified as a network reconnaissance tool .", "1863": "When run as a command line tool , with its logic defined with the command line switches , this tool enumerates other network hosts and detects what Windows RPC services are enabled at the endpoints .", "1864": "It carries a list of interface identifiers associated with the named pipes .", "1865": "It then uses these identifiers to write a message to and read a message from the associated named pipes .", "1866": "By knowing what RPC services are running , it can successfully fingerprint all network hosts by mimicking the Metasploit 's logic of OS fingerprinting via SMB .", "1867": "The fingerprinting allows it to reveal the following characteristics for each host found in the network : The data it retrieves is encrypted and saved into a configuration file % system % \\vtmon.bin .", "1868": "This file is then further encrypted with an NTL-based ( Number Theory Library ) algorithm and is uploaded by the usermode-centric Snake rootkit to the C & C server , along with other configuration files , such as mtmon.sdb , mtmon32.sdb , gstatsnd.bin , gstat.bin , gstat32.bin , and other log files found in the % windows % \\ $ NtUninstallQ [ random ] $ directory .", "1869": "By using this function the remote attacker can identify any potentially exploitable hosts located in the same network as the victim .", "1870": "The attacker may then craft an exploit against those hosts , possibly by using the Metasploit framework , and then deliver the generated shellcode back to the reconnaissance tool to be applied against the identified hosts by running the tool with the 'expos ' switch .", "1871": "If the tool successfully delivers the payload and exploits the remote host ( s ) , it will replicate the infection across the network , taking control over new hosts , thus repeating the infection cycle all over again and spreading the infection further .", "1872": "Unlike traditional worm techniques , this process is rather manual , but its danger is in the fact that the attacker can flexibly craft new attack methods , adjusting them to the hosts present within the network , thus preying on the weakest ( least updated , most vulnerable ) victims along its path .", "1873": "It 's worth noting that Agent.BTZ used the same XOR key for its logs as the most recent variants : Log files created by the latest samples of Snake , compiled in 2013 and 2014 , were successfully decrypted with the same XOR key .", "1874": "It is also sophisticated , using complex techniques for evading host defences and providing the attackers covert communication channels .", "1875": "One approach is to delegate the network communication engine to usermode code , backed up by a usermode rootkit .", "1876": "Another approach is to carry out all of the communications from the kernel-mode driver , which is a very challenging task by itself .", "1877": "When most of the infected hosts are cut off from the outside world , it only needs one host to be connected online .", "1878": "The traffic is then routed through that host to make external control and data exfiltration still possible .", "1879": "The presence of the reconnaissance tool in the Snake operators ' framework suggests the existence of an arsenal of infiltration tools , designed to compromise a system , then find a way to replicate into other hosts , infect them , and spread the infection even further .", "1880": "As demonstrated , the backdoor commands allow Snake to provide remote attackers with full remote access to the compromised system .", "1881": "Its ability to hibernate , staying fully inactive for a number of days , makes its detection during that time very difficult .", "1882": "The analysed code suggests that even file system and registry operations can be delegated by an infected module to another module in order to stay unnoticed by behaviour analysis engines of the antivirus products , and to overcome account restrictions of the browser processes so that the injected module could still write into files and into the sensitive registry hives .", "1883": "The logs and dumps it creates on the hidden virtual volumes contributes to its stealthiness too .", "1884": "A great deal of attention has also been given to keep its network communications as quiet as possible .", "1885": "Its ability to generate malicious traffic whenever the user goes online and start loading the web pages allows it to 'blend in ' with the legitimate communications .", "1886": "This SMB Worm Tool is equipped with a Listening Implant , Lightweight Backdoor , Proxy Tool , Destructive Hard Drive Tool , and Destructive Target Cleaning Tool .", "1887": "SMB Worm Tool : This worm uses a brute force authentication attack to propagate via Windows SMB shares .", "1888": "It connects home every five minutes to send log data back to command and control ( C2 ) infrastructure if it has successfully spread to other Windows hosts via SMB port 445 .", "1889": "The tool also accepts new scan tasking when it connects to C2 .", "1890": "There are two main threads : the first thread calls home and sends back logs ( a list of successful SMB exploitations ) , and the second thread attempts to guess passwords for SMB connections .", "1891": "If the password is correctly guessed , a file share is established and file is copied and run on the newly-infected host .", "1892": "'' Additionally , this implant listens for connections on TCP port 195 ( for '' sensvc.exe '' and '' msensvc.exe '' ) and TCP port 444 ( for '' netcfg.dll '' ) .", "1893": "Each message sent to and from this implant is preceded with its length , then XOR encoded with the byte 0x1F .", "1894": "Upon initial connection , the victim sends the string , '' HTTP/1.1 GET /dns ? \\x00 . '' The controller then responds with the string '' 200 www.yahoo.com ! \\x00 '' ( for '' sensvc.exe '' and '' msensvc.exe '' ) or with the string '' RESPONSE 200 OK ! ! '' ( for '' netcfg.dll '' ) .", "1895": "The controller sends the byte '' ! '' ( 0x21 ) to end the network connection .", "1896": "Lightweight Backdoor : This is a backdoor listener that is designed as a service DLL .", "1897": "It includes functionality such as file transfer , system survey , process manipulation , file time matching and proxy capability .", "1898": "The listener can also perform arbitrary code execution and execute commands on the command line .", "1899": "This tool includes functionality to open ports in a victim host 's firewall and take advantage of universal Plug and Play ( UPNP ) mechanisms to discover routers and gateway devices , and add port mappings , allowing inbound connections to victim hosts on Network Address Translated ( NAT ) private networks .", "1900": "Proxy Tool : Implants in this malware family are typically loaded via a dropper installed as a service , then configured to listen on TCP port 443 .", "1901": "This proxy tool has basic backdoor functionality , including the ability to fingerprint the victim machine , run remote commands , perform directory listings , perform process listings , and transfer files .", "1902": "Destructive Hard Drive Tool : This tool is a tailored hard-drive wiping tool that is intended to destroy data past the point of recovery and to complicate the victim machine 's recovery .", "1903": "If the CNE operator has administrator-level privileges on the host , the program will over-write portions of up-to the first four physical drives attached , and over-write the master boot record ( MBR ) with a program designed to cause further damage if the hard drive is re-booted .", "1904": "This further results in the victim machine being non-operational with irrecoverable data .", "1905": "( There is a caveat for machines installed with the windows 7 operating system : windows 7 machines will continue to operate in a degraded state with the targeted files destroyed until after reboot , in which the infected MBR then wipes the drive .", "1906": ") If the actor has user-level access , the result includes specific files being deleted and practically irrecoverable , but the victim machine would remain usable .", "1907": "Destructive Target Cleaning Tool : This tool renders victim machines inoperable by overwriting the Master Boot Record .", "1908": "The tool is dropped and installed by another executable and consists of three parts : an executable and a dll which contain the destructive components , and an encoded command file that contains the actual destruction commands to be executed .", "1909": "Network Propagation Wiper : The malware has the ability to propagate throughout the target network via built-in Windows shares .", "1910": "Based on the username/password provided in the configuration file and the hostname/IP address of target systems , the malware will access remote network shares in order to upload a copy of the wiper and begin the wiping process on these remote systems .", "1911": "The malware uses several methods to access shares on the remote systems to begin wiping files .", "1912": "Checking for existing shares via '' \\\\hostname\\admin $ \\system32 '' and '' \\\\hostname\\shared $ \\system32 '' or create a new share '' cmd.exe /q /c net share shared $ = % SystemRoot % /GRANT : everyone , FULL '' .", "1913": "Once successful , the malware uploads a copy of the wiper file '' taskhostXX.exe '' , changes the file-time to match that of the built-in file '' calc.exe '' , and starts the remote process .", "1914": "The remote process is started via the command '' cmd.exe /c wmic.exe /node : hostname /user : username /password : pass PROCESS CALL CREATE '' .", "1915": "Afterwards , the remote network share is removed via '' cmd.exe /q /c net share shared $ /delete '' .", "1916": "Once the wiper has been uploaded , the malware reports its status back to one of the four C2 IP addresses .", "1917": "This tool contains five components \u2013 a listening implant , lightweight backdoor , proxy tool , destructive hard drive tool , and destructive target cleaning tool .", "1918": "The SMB worm propagates throughout an infected network via brute-force authentication attacks , and connects to a C2 infrastructure .", "1919": "This file serves as a dropper .", "1920": "It drops destructive malware : '' igfxtrayex.exe '' .", "1921": "When the dropper file was executed , it started a second instance of itself with '' -i '' as an argument , and then terminated .", "1922": "The second instance of the dropper file installed itself as the '' WinsSchMgmt '' service with '' -k '' as a command line argument , started the service , and then terminated .", "1923": "The '' WinsSchMgmt '' service executed the file with '' -k '' as an argument , which started another instance of the file using '' -s '' as an argument .", "1924": "The '' -s '' instance dropped and executed '' igfxtrayex.exe '' , created '' netver.dat '' , and began generating network traffic over TCP ports 445 and 139 to victim IP addresses .", "1925": "This is a log file created by the dropper , and appended to as the scans progress .", "1926": "This file is destructive malware : a disk wiper with network beacon capabilities .", "1927": "If '' igfxtrayex.exe '' is run with no parameters , it creates and starts a copy of itself with the '' \u2013i '' argument .", "1928": "After 10 minutes , the '' igfxtrayex.exe '' makes three copies of itself and places them in the same directory from which it was executed .", "1929": "These copies are then executed , each with a different argument ( one being '' -m '' , one being '' -d '' and the other '' -w '' ) .", "1930": "Network connection attempts are made to one of three hard-coded IP addresses in a random order to port 8080 or 8000 .", "1931": "If a connection to the IP address can not be made , it attempts to connect to another of the three IP addresses , until connections to all three IP addresses have been attempted .", "1932": "A 120-minute ( 2 hour ) sleep command is issued after which the computer is shut down and rebooted .", "1933": "This file , when executed , starts a listener on localhost port 80 .", "1934": "It has 3 files contained in the resource section ; all xor 'd with 0x63 .", "1935": "It is dropped from resource ID 0x81 of '' igfxtrayex.exe '' .", "1936": "It is dropped from resource ID 0x83 of '' igfxtrayex.exe '' .", "1937": "It is also clear that the energy sector is not exempt from the generic attacks that every company faces , such as ransomware that locks PCs or financial Trojans that attempt to steal passwords and credit card details .", "1938": "These attacks can include nonspecific data breaches where employee or customer records get stolen , as happened to the US Department of Energy in July 2013 .", "1939": "This allows malware to spread into such isolated networks as demonstrated many times by threats such as Stuxnet .", "1940": "However , sabotage attacks that damage equipment are definitely possible , as has already been demonstrated .", "1941": "There have already been proof of concept attacks that demonstrate how smart meters could be manipulated to send back false information or report incorrect billing IDs , leading to power theft .", "1942": "In 2008 , Tom Donahue , a senior Central Intelligence Agency ( CIA ) official told a meeting of utility company representatives that cyberattacks had taken out power equipment in multiple cities outside the United States .", "1943": "In 2003 the safety monitoring system of the Ohio nuclear power plant apparently went offline for several hours due to a Slammer worm infection .", "1944": "At the beginning of 2003 a marine terminal in Venezuela was targeted by a sabotage attack .", "1945": "Details of this attack are scarce and vague , but it seems that during a strike an attacking group managed to get access to the SCADA network of the oil tanker loading machinery and overwrote programmable logic controllers ( PLCs ) with an empty program module .", "1946": "This halted machinery , preventing oil tankers from loading for eight hour till the unaffected backup code was reinstalled on the PLCs .", "1947": "The attackers used a Trojan to gain access to the control for the gas pipelines .", "1948": "As far as we know today , the Stuxnet operation began in November 2005 with the registration of the command and control ( C & C ) servers used in the attacks .", "1949": "Stuxnet is the first known autonomous threat to target and sabotage industrial control systems to such an extent .", "1950": "Stuxnet is a sophisticated piece of malware , which uses seven vulnerabilities to spread and infect its targets .", "1951": "Spreading through infected portable media drives allowed it to also infect networks isolated by air gaps that are unreachable from the Internet .", "1952": "In addition , it is able to infect Step7 project files , which are used to control Programmable Logic Controllers ( PLCs ) .", "1953": "This allowed the worm to infect computers whenever the engineer exchanged the project files .", "1954": "Besides this , it also spread through network shares , a printer spooler vulnerability , an old Windows RPC ( remote procedure calls ) vulnerability and a known password in the WinCC database .", "1955": "Part of the malware code was signed with stolen digital certificates making it harder to detect by security tools .", "1956": "To hide its activity even further , Stuxnet executed slightly different infection routines depending on the security software installed on the target .", "1957": "On the USB drive itself , the malware would hide its own files and even delete itself from it after three successful propagations .", "1958": "Tricks like these , to make the detection of the malware more difficult , are now frequently used in modern targeted attacks .", "1959": "The sabotage payload disrupted and partially destroyed the cascaded high frequency gas centrifuges .", "1960": "The early version of Stuxnet targeted the S7- 417 PLCs and modified its valve settings .", "1961": "The later version of the threat focused on the S7-315 PLCs , manipulating the spinning frequency of the rotating motors .", "1962": "The payload would only become active if the fingerprint in the found PLC setup matched a given configuration setup .", "1963": "To avoid detection by personnel monitoring the human machine interface ( HMI ) of the plant , the threat recorded measurement readings during normal operation and played those back in a loop .", "1964": "The attacks started in late 2009 and were directed at finding project details and financial information about oil and gas field exploration and bids .", "1965": "The attackers started by compromising public facing Web servers through SQL injection and installing Web shells on them .", "1966": "Once they had control over the server they used common hacking tools to harvest local passwords , dump password hashes , sniff authentication messages and exploit internal active directory configuration .", "1967": "This allowed them to move on to other internal computers using the gathered passwords .", "1968": "In addition , spear phishing messages were used to compromise additional computers .", "1969": "On compromised computers a common Backdoor.Trojan was installed that communicated back to the C & C server , allowing remote access to the computer .", "1970": "This allowed the attacker to find and extract valuable information .", "1971": "The dropper component is responsible for creating all the required files on the system , registering a service called '' TrkSvr '' in order to start itself with Windows .", "1972": "It also attempts to copy itself to accessible network shares and execute itself remotely if successfully copied .", "1973": "The module then drops a legitimate and digitally signed device driver that provides low level disk access from user space .", "1974": "The malware collects file names and starts overwriting them with a JPEG image or 192KB blocks of random data .", "1975": "At the end Disttrack finishes the computer off by wiping the master boot record with the same data .", "1976": "The reporter component is responsible for sending back a HTTP GET request to the C & C server .", "1977": "It reports the domain name , IP address and number of files overwritten .", "1978": "By acquiring user credentials and gaining access to the domain controller the attackers were able to push the malware on to many systems before they triggered the destructive payload .", "1979": "Disttrack 's secondary goal may have been to steal valuable information from infected computers , but the main intent was to render the computers unusable by wiping the operating system and master boot record , causing disruption and downtime at the targeted company .", "1980": "Although wiping is also frequently used to destroy evidence of the attack and make forensics more difficult .", "1981": "Spear phishing is , along with watering hole attacks , one of the most common attack vectors used to attack companies .", "1982": "This is followed by the incursion phase of breaking in and compromising computers .", "1983": "After that comes the discovery phase , where the attacker gathers passwords and maps the internal network .", "1984": "The final stage is capture and exfiltration , where the valuable information is copied and sent back to the attacker .", "1985": "A wave of spear phishing emails were sent from two Freemailer accounts to 291 individuals at the targeted company .", "1986": "All of the emails contained the same Trojan.Dropper disguised as an attachment with the filename AVP.dll .", "1987": "The malware itself drops a malicious Downloader '' clbcatq.dll '' into a newly created '' wuauclt '' directory , posing as Windows update and taking advantage of the DLL search order hijack weakness in order to load the malicious code in Windows .", "1988": "The back door provided full access to the compromised computers .", "1989": "It is unknown if the attackers successfully retrieved the information they were seeking , if they installed other back door Trojans or gained passwords that allowed them to directly access the computers , or if they have given up on the target .", "1990": "The spear phishing emails came from 234 spoofed addresses .", "1991": "They were made to appear to be linked to the company in relation to the subject and attachment chosen .", "1992": "The emails all contained malicious attachments .", "1993": "The malware chosen was a variant of the Poison Ivy Trojan Backdoor.Darkmoon and , in some minor cases , Trojan droppers that would download additional malware .", "1994": "The social engineering messages concentrated mainly around the following two themes : Once installed , the back door would create a registry run key in order to restart with Windows and connect to one of three C & C servers located in Greece .", "1995": "The last C & C server has been used since 2010 in similar attacks against other companies .", "1996": "The chosen names of the C & C server domains imitates legitimate services in a bid to be overlooked by the system administrators when checking their logs .", "1997": "The back door provides full remote access to the compromised computers , allowing for extraction of any data .", "1998": "As an example , the subject line '' Wage Data 2012 '' was used in 944 emails , sent from 26 different email addresses to targets in nine different sectors .", "1999": "The attack was carried out over eight days and used the same infected Microsoft Word document in every instance .", "2000": "The attacker usually compromises the network by delivering targeted malware to vulnerable systems or employees .", "2001": "One is to send spear phishing emails , where a link to a malicious website or a malicious attachment is delivered using social engineering techniques .", "2002": "The second method , which is gaining traction , is watering hole attacks , where the attacker infects a website that has a high likelihood of being visited by the intended victim .", "2003": "By using IP address filters before infecting any visitor of such sites , the attacker can reduce the number of infected systems and bring it to a manageable quantity which can be assessed manually at another time .", "2004": "Some groups carefully plan watering hole attacks .", "2005": "A few days later the group resumed the watering hole attack again , this time using a different exploit .", "2006": "These can be performed either at the same physical location , posing as a genuine Wi-Fi hotspot or through supply chain attacks .", "2007": "This can enable the attacker to swap an update of legitimate software for a maliciously crafted version .", "2008": "Once the victim installs the genuine looking update , the attacker effectively gains control over the computer .", "2009": "Sometimes a regular off-the-shelf back door Trojan is used .", "2010": "With more specialized teams of attackers , we can often observe that the infected system is first analyzed to ensure that it is of interest to them .", "2011": "One of the obvious tasks performed by attackers is to install key loggers , dump local credentials , search local storage for saved accounts and sniff the network for passwords .", "2012": "Often small scripts or even manual commands are used to comb through local files and create network mappings .", "2013": "Simple system commands can help the attacker to learn about installed security tools , saved links to internal platforms and local address books .", "2014": "In some instances they might even use zero-day vulnerabilities to spread further into the network .", "2015": "One method which is gaining more relevance is the hijacking of local software distribution systems for further distribution .", "2016": "Once the attackers have successfully managed to create and distribute their own package , they can easily infect all connected systems at once .", "2017": "If the target is assumed to be in a separated network not connected to the Internet , the malware used might try and autonomously infect removable drives , like USB sticks , or project files for PLCs .", "2018": "This could allow the malware to be manually introduced to the destination network , without the knowledge of the carrier , essentially jumping air gaps into isolated networks .", "2019": "At the end of the discovery phase the attackers should know the internals of the infected networks and have identified systems with interesting data or with connected industrial control systems .", "2020": "In this phase the interesting data is gathered and sent back to the attackers .", "2021": "The simple attacks compress the files and upload them through FTP or through a HTTP POST request to a remote drop server .", "2022": "More sophisticated attackers obfuscate the data by XOR-ing it , encrypting it with proper asymmetric encryption or embedding it into media files using steganography to hide the data from traffic inspection .", "2023": "For example , some malware samples will send the data in smaller bursts so as not to swamp the network or generate network spikes that might attract attention .", "2024": "Since most employees use laptops , the malware can use location awareness to detect if the compromised computer is outside of the corporate network and send the data once it 's directly connected to the Internet , such as from a Wi-Fi hotspot at an airport .", "2025": "This might allow the traffic to bypass perimeter security and receive less scrutiny .", "2026": "In such cases , a previously compromised computer in the DMZ can act as a proxy , forwarding all the collected data .", "2027": "The malware deletes all files on a computer and then deletes the master boot record , rendering the computer unusable .", "2028": "This section describes a highly targeted attack sent to an e-mail address belonging to RSS .", "2029": "The attack took the form of an unsolicited e-mail containing a download link to a decoy file .", "2030": "The file contained custom malware that profiled the victim 's computer and beaconed its IP address to an e-mail account under the attacker 's control .", "2031": "The unsolicited message below was sent to RSS at the end of November 2014 from a Gmail email address .", "2032": "However , we note that the attacker also attempts to social engineer the identity of individuals working with RSS , by requesting a personal Facebook page .", "2033": "The custom malware used in this attack infects a user who views the decoy '' slideshow , '' and beacons home with the IP address of the victim 's computer and details about his or her system each time the computer restarts .", "2034": "Unlike Syrian regime-linked malware , it contains no Remote Access Trojan ( RAT ) functionality , suggesting it is intended for identifying and locating a target .", "2035": "Further , because the malware sends data captured by the malware to an e-mail address , it does not require that the attackers maintain a command-and-control server online .", "2036": "Examples of images in the slideshow as follows : When opened , the '' slideshow.zip '' file writes and executes several files : '' AdobeR1.exe '' is malicious , while '' pictures.exe '' is the genuine slideshow displayed to the victim .", "2037": "When the slideshow is closed both AdobeR1.exe and pictures.exe are deleted .", "2038": "The AdobeR1 file writes a series of executable files that perform information collection and communication functions , including : The program sequence of data collection and sending is somewhat unusual , with each program performing a single task and communicating via markers left in the registry .", "2039": "First , the program nvidrv adds itself to autorun : It also creates a series of registry keys that the individual programs use to communicate : Registry keys and programs using them : It then runs GooglUpd , which cleans up the program files if they exist , and runs AdbrRader .", "2040": "AdbrRader ( communicating through registry key '' 2 '' ) writes the file vgadmysadm.tmp with the name of another registry key '' 2 '' with startup info .", "2041": "Next , nvidrv runs GoogleUpate , which collects system information and writes it to : Then nvidrv runs nvisdvr ( registry key '' 4 '' ) that collects a list of running processes , which are written to : Finally , nvidrv runs svhosts , which tests Internet connectivity by doing a DNS query for windowsupdate.microsoft.com .", "2042": "It then runs rundl132 if it has not before , by checking whether registry key name '' 6 '' is present .", "2043": "It sets the key to '' 0 '' and runs it .", "2044": "Next , '' rundl132.exe '' performs an HTTP GET request to myexternalip.com and collects the external IP of the infected machine : Next , rundl132 writes : Then rundl132 writes the external IP to : Finally , rundl132 runs AdobeIns , which zips the contents of the win32.tmp folder .", "2045": "Program '' AdobeIns.exe '' takes the files written by the other programs and zips them in an encrypted , password- protected file : Data is transmitted by e-mail to an account presumably controlled by the attacker .", "2046": "AdobeIns connects to an account at the online e-mail provider inbox.com via smtp using hardcoded credentials .", "2047": "The malware then sends an e-mail to the same inbox containing the text '' Hello '' and with mxtd file attached .", "2048": "SMTP traffic generated by the malware to inbox.com ( with redactions ) The malware seen in this case study is unusual as it relies on a half-dozen separate executable files , each with a single task , and each communicating via markers dropped in the Registry .", "2049": "The malware is also interesting because it does not provide remote access , but only sends an e-mail containing the victim 's IP address and miscellaneous system information .", "2050": "The malware resends the information each time the computer is restarted , but it does not refresh the sent information on restart ( which may be a bug ) .", "2051": "This behaviour strongly suggests that the function of this malware is to serve as a beacon .", "2052": "The system information could be used to identify processes to exploit in the future , however since the attacker has already triggered the execution of a file on the victim 's system , it is surprising that more was not taken , or that a RAT ( custom or widely available ) was not used .", "2053": "A RAT would have provided much greater access alongside IP information By not providing remote access and other RAT functionality , the program looks less like malware , and may attract less attention from endpoint protection tools and scanners .", "2054": "It registered only 6/55 detections by anti virus scanners , or a 10 % detection rate .", "2055": "Transmitting the malware via e-mail also provides a degree of obscurity , and has the additional advantage of providing a layer of abstraction between the attacker and the target : there is no need to maintain a RAT command-and-control server .", "2056": "The malware transmits autonomously , leaving the material in an inbox for the attacker to collect at a later time .", "2057": "Nevertheless , we believe that the author of the program is aware of certain techniques to reduce the visibility of malware on a network , including transmitting data via encrypted e-mail communications .", "2058": "In addition , the malware uses the old PKWARE implementation of zip encryption , which is not particularly secure .", "2059": "This attack , which has little technical sophistication ( i.e. , it uses no exploits , code obfuscation , or techniques to frustrate reversing , etc .", "2060": ") , nevertheless has carefully developed social engineering in the seeding materials and bait document .", "2061": "Although targeted , the malware seeding often aims at classes of people ( e.g. , people interested in 'shocking ' news about a fighter , or 'leaked ' information about the Assad regime ) rather than carefully written spear phishing targeting a single individual or small group .", "2062": "Use of widely available RATs ( njRAT , Xtreme Rat , ShadowTech Rat , DarkComet RAT , and Blackshades RAT , among others ) .", "2063": "At least one command-and-control server located within Syrian IP space ( often from a limited range of addresses ) .", "2064": "Use of '' crypters '' to obscure the binary .", "2065": "Not only is it exceptionally targeted , but it is also not a commonly available RAT .", "2066": "The function of the malware appears to be : identify and unmask the IP address of target ( s ) , and resend them to the attacker with each reboot .", "2067": "In addition , data is sent to an Internet e-mail address , and no crypter is used to obscure the binary .", "2068": "We are aware of only one previous case in Syria in which e-mail was used to transmit data , and that we believed was regime linked .", "2069": "That incident , observed in 2012 , also used hardcoded e-mail to exfiltrate .", "2070": "However , that malware had substantially more functionality than this case : not only did it drop a second stage from a compromised site , but was also included a mechanism for exfiltrating credentials from Facebook and hooking programs like Skype .", "2071": "For example : The malware beacons location but does not provide RAT functionality .", "2072": "The seeding attempts to obtain a 'private ' Facebook identity from RSS through social engineering .", "2073": "The malware exfiltrates to an online e-mail account , thus not requiring the attacker to maintain a command-and- control server online .", "2074": "This attack was exceptionally targeted , and clearly reflected the work of an actor familiar with the operations of the targeted organization .", "2075": "The primary backdoor used in the Epic attacks is also known as '' WorldCupSec '' , '' TadjMakhal '' , '' Wipbot '' or '' Tavdig '' .", "2076": "Our analysis indicates that victims are infected via a sophisticated multi-stage attack , which begins with the Epic Turla .", "2077": "In time , as the attackers gain confidence , this is upgraded to more sophisticated backdoors , such as the Carbon/Cobra system .", "2078": "Sometimes , both backdoors are run in tandem , and used to '' rescue '' each other if communications are lost with one of the backdoors .", "2079": "Once the attackers obtain the necessary credentials without the victim noticing , they deploy the rootkit and other extreme persistence mechanisms .", "2080": "Contact : intelreports @ kaspersky.com The attacks in this campaign fall into several different categories depending on the vector used in the initial compromise : The attackers use both direct spearphishing and watering hole attacks to infect their victims .", "2081": "Currently , the Epic attackers run a vast network of watering holes that target visitors with surgical precision .", "2082": "Injected websites load a remote JavaScript into the victim 's browser : The script '' sitenavigatoin.js '' is a Pinlady-style browser and plugin detection script , which in turn , redirects to a PHP script sometimes called main.php or wreq.php .", "2083": "Sometimes , the attackers register the .JPG", "2084": "extension with the PHP handler on the server , using '' JPG '' files to run PHP scripts : The main exploitation script '' wreq.php '' , '' main.php '' or '' main.jpg '' performs a numbers of tasks .", "2085": "We have located several versions of this script which attempt various exploitation mechanisms .", "2086": "One version of this script attempts to exploit Internet Explorer versions 6 , 7 and 8 : Unfortunately , the Internet Explorer exploits have not yet been retrieved .", "2087": "Another more recent version attempts to exploit Oracle Sun Java and Adobe Flash Player : Although the Flash Player exploits could n't be retrieved , we did manage to obtain the Java exploits : The Java files exploit a popular vulnerability , CVE-2012-1723 , in various configurations .", "2088": "The payload dropped by these Java exploits is the following : The Java exploit use a special loader that attempts to inject the final Epic backdoor payload into explorer.exe .", "2089": "The backdoor extracted from the Java exploits has the following C & C hardcoded inside : This C & C is still online at the moment although it redirects to a currently suspended page at '' hxxp : //busandcoachdirectory.com [ .", "2090": "Most recently , we observed them using yet another technique coupled with watering hole attacks .", "2091": "This takes advantage of social engineering to trick the user into running a fake Flash Player ( MD5 : 030f5fdb78bfc1ce7b459d3cc2cf1877 ) : In at least one case , they tried to trick the user into downloading and running a fake Microsoft Security Essentials app ( MD5 : 89b0f1a3a667e5cd43f5670e12dba411 ) : The fake application is signed by a valid digital certificate from Sysprint AG : This file was distributed from the Ministry of Foreign Affairs of Tajikistan 's website , at '' hxxp : //mfa [ . ] tj/upload/security.php '' .", "2092": "The file is a .NET", "2093": "application that contains an encrypted resource .", "2094": "This drops the malicious file with the MD5 7731d42b043865559258464fe1c98513 .", "2095": "This is an Epic backdoor which connects to the following C & Cs , with a generic internal ID of 1156fd22- 3443-4344-c4ffff : A full list with all the C & C server URLs that we recovered from the samples can be found in the technical Appendix .", "2096": "The Epic backdoors are commanded by a huge network of hacked servers that deliver command and control functionality .", "2097": "The huge network commanded by the Epic Turla attackers serves multiple purposes .", "2098": "For instance , the motherships function as both exploitation sites and command and control panels for the malware .", "2099": "Here 's how the big picture looks like : The first level of command and control proxies generally talk to a second level of proxies , which in turn , talk to the '' mothership '' server .", "2100": "The mothership server is generally a VPS , which runs the Control panel software used to interact with the victims .", "2101": "The mothership also work as the exploitation servers used in the watering hole attacks , delivering Java , IE or fake applications to the victim .", "2102": "It runs a control panel which is password protected : Once logged into the Control panel , the attackers can see a general overview of the system including the number of interesting potential targets : A very interesting file on the servers is task.css , where the attackers define the IP ranges they are interested in .", "2103": "Depending on the '' tasks '' , they will decide whether to infect the visitors or not .", "2104": "In this case , we found they targeted two ranges belonging to : It should be noted though , the fact that the attackers were targeting these ranges does n't necessarily mean they also got infected .", "2105": "There are three possible values : These are the '' do n't meet the conditions '' reasons observed in the logs : For this first stage of the attack , the threat actor uses a custom backdoor .", "2106": "In some cases , the backdoor is packaged together with the CVE-2013-5065 EoP exploit and heavily obfuscated .", "2107": "The CVE-2013-5065 exploit allows the backdoor to achieve administrator privileges on the system and run unrestricted .", "2108": "The main backdoor is about 60KB in size and implements a C & C protocol on top of normal HTTP requests .", "2109": "The communication protocol uses requests in the C & C replies , which the malware decrypts and processes .", "2110": "The replies are sent back to the C & C through the same channel .", "2111": "The configuration can also be updated on the fly by the attackers , via the C & C .", "2112": "The backdoor attempts to identify the following processes and , if found , it will terminate itself : It contains an internal unique ID , which is used to identify the victim to the C & C .", "2113": "Once a victim is confirmed as '' interesting '' , the attackers upload another Epic backdoor which has a unique ID used to control this specific victim .", "2114": "During the first C & C call , the backdoor sends a pack with the victim 's system information .", "2115": "All further information sent to the C & C is encrypted with a public key framework , making decryption impossible .", "2116": "The commands from the C & C are encrypted in a simpler manner and can be decrypted if intercepted because the secret key is hardcoded in the malware .", "2117": "Through monitoring , we were able to capture a large amount of commands sent to the victims by the attackers , providing an unique view into this operation .", "2118": "Here 's a look at one of the encrypted server replies : Once a victim is infected and '' checks in '' with the server , the attackers send a template of commands : Next , the attackers try to move through the victim 's network using pre-defined or collected passwords : Listing all .doc", "2119": "These include searches for : In this case , the attackers were interested to find e-mails related to '' NATO '' , '' Energy Dialogue within European Unition '' and so on .", "2120": "For some of the C & C servers , the attackers implemented RSA encryption for the C & C logs , which makes it impossible to decrypt them .", "2121": "Once a victim is compromised , the attackers upload several tools that are used for lateral movement .", "2122": "One such tool observed in the attacks and saved as '' C : \\Documents and Settings\\All users\\Start Menu\\Programs\\Startup\\winsvclg.exe '' is : This is a keylogger tool that creates % temp % \\~DFD3O8.tmp .", "2123": "For instance , another tool often uploaded by the attackers to the victim 's machine is '' winrs.exe '' : This is an UPX packed binary , which contains the genuine '' dnsquery.exe '' tool from Microsoft , unpacked MD5 : c0c03b71684eb0545ef9182f5f9928ca .", "2124": "This backdoor is more sophisticated and belongs to the next level of cyber-espionage tools called the '' Carbon system '' or Cobra by the Turla attackers .", "2125": "Other packages delivered to the victims include : These top level packages deploy both updated Epic backdoors and Turla Carbon system backdoors to confirmed victims , effectively linking the Epic and Turla Carbon operations together .", "2126": "The Turla Carbon dropper from these packages has the following properties : This is called internally by the authors '' Carbon System '' , part of the '' Cobra '' project , as it can be seen from the debug path inside : This acts as a dropper for the following modules , both 32 and 64 bit : The Carbon system is in essence an extensible platform , very similar to other attack platforms such as the Tilded platform or the Flame platform .", "2127": "The payload recovered from one of the mothership servers ( at newsforum.servehttp [ .", "2128": "] com/wordpress/wp-includes/css/img/upload.php , MD5 : 4dc22c1695d1f275c3b6e503a1b171f5 , Compiled : Thu Sep 06 14:09:55 2012 ) contains two modules , a loader/injector and a backdoor .", "2129": "There are other indications that the attackers are not native English language speakers : The sample e9580b6b13822090db018c320e80865f that was delivered to several Epic victims as an upgraded backdoor , has the compilation code page language set to '' LANGRUSSIAN '' .", "2130": "In February 2014 we observed the Miniduke threat actor using the same backdoor on their hacked servers , although using a much stronger password .", "2131": "On some of the C & C servers used in the Epic attacks , we were able to identify detailed victim statistics , which were saved for debugging purposes by the attackers .", "2132": "This is used to gain a foothold and validate the high profile victim .", "2133": "If the victim is interesting , they get upgraded to the Turla Carbon system .", "2134": "Among other items , staff training documents and more than 40,000 emails were stored on the machine and thought to be harvested by the attacker .", "2135": "The attack appears to have been the result of the attackers having compromised the 'GOM Player ' update server and having it act as a 'watering hole ' , meaning that machines which access the site are delivered malware .", "2136": "Technical analysis of the implant on the compromised machine has shown it to be a variant of a Trojan which has been in the wild for some years now and continues to be effective .", "2137": "Based on open source reporting , it appears that the intrusion took place via the compromise of the GOM Player update server ( app.gomlab.com ) , where attackers may have gained entry via a PHP-based webshell , hidden within an image , present on the host since October 2011 .", "2138": "The observed malicious activity relates to the modification of a file that controls GOM Player updates , spanning the date range 27th December 2013 to 16th January 2014 , during which time these alterations are reported to have only manifested themselves for visitors on certain IP ranges ; evidence supporting this claim has not yet been made public .", "2139": "The modified file redirected the GOM Player update process to another compromised server ( www.fudousankaitori.jp ( 203.189.101.35 ) ) , where a file containing both the legitimate update and the malware was deliver to the victim .", "2140": "Deployed to the system via a compressed bundle containing the official GOM Player setup binary and a self-extracting RAR archive containing the malicious files , the malware consists of a number of individual pieces .", "2141": "Upon extraction from the RAR archive , the installer component ( 0ae82fd94836815a1e8d284ccb75109d ) is automatically launched alongside the GOM Player update , distracting victims from the malicious activity taking place .", "2142": "The installer component is referred to by the author as 'miansha ' which , according to an East Asia Cyber Threat Intelligence Researcher , is likely Mi\u01censh\u0101 ( \u514d\u6740 ) , a phrase commonly used by People 's Republic of China ( PRC ) hackers to mean 'anti Antivirus detection ' or 'Antivirus avoidance ' ; Symantec have named the detection for this code 'Backdoor.Miancha ' , where Mi\u01cench\u00e1 ( \u514d\u67e5 , likely shorthand for \u514d\u6740\u67e5 ) similarly means 'Antivirus avoidance ' .", "2143": "The installer is responsible for the malware persistence mechanism , adding entries to the registry in the following locations , depending on Windows Version : The installer will also determine the system architecture ( 32- or 64-bit ) and then deobfuscate the relevant loader DLL to the path 'C : \\Windows\\temp\\install.ocx ' , ensuring the malware is launched on system start-up .", "2144": "The main implant code is stored in files named instructions.pdf and instructions64.pdf ; not PDF documents but instead DLLs obfuscated with a one-byte XOR with 0x14 , similar to the malware loader DLLs .", "2145": "The loader , referred to by the malware author as \u58f3 ( shell ) , reads and deobfuscates the main implant code which then communicates with the attacker-controlled server at testqweasd.tk ( 211.43.220.89 ) on TCP port 443 .", "2146": "The main implant code is referred to as \u767d\u52a0\u9ed1 ( 'Black on White ' ) , a term used in the PRC hacking community to denote the act of Antivirus avoidance through the loading of malicious 'black ' code via non-malicious or trusted 'white ' code .", "2147": "This is a practice recently illustrated through the deployment of the PlugX trojan , utilising DLL load order hijacking alongside a signed ( trusted ) executable .", "2148": "This specific variant shows similarities to that used during the VOHO campaign , where Gh0st RAT was spread via watering hole attacks utilising vulnerable websites belonging to financial services and technology companies .", "2149": "In addition to delivering system-specific details back to the attacker , Gh0st RAT provides the capability to deploy additional malware , enabling the harvesting of sensitive data and enabling the further propagation throughout the infected network .", "2150": "Furthermore , the attackers also shared a C & C domain .", "2151": "The latest version of ComRAT known to us ( v3.26 ) uses a new key and does not create the installation log file , in order to complicate the analysis and to disguise the link between the two cases .", "2152": "Another very interesting fact : the attackers use COM Object hijacking , the same persistence mechanism as COMpfun , which we described recently .", "2153": "The first task of the malware is to install the file credprov.tlb in % APPDATA % \\Microsoft\\ .", "2154": "The dropper executes the following command in order to install a second file : The second file is shdocw.tlp .", "2155": "To be started during the boot process of the infected machine , the malware creates the following registry key : This registry key is used to associate the library shdocvw.tlp to the object 42aedc87-2188-41fd-b9a3-0c966feabec1 as previously explained in the article about COMpfun .", "2156": "The purpose is to load the library into each and every process executed on the infected system .", "2157": "If the version of the malware is older than 3.26 , the dropper creates an additional file called winview.ocx .", "2158": "The file is xored with the following obfuscation key ( used by both , Uroburos and Agent.BTZ ) : Here is the decoded log file content : We can notice that the malware checks if an older version is installed on the system and if this is the case , the dropper removes the older version .", "2159": "In contrast to this , in our Uroburos analysis , we found out that Uroburos does not install itself in case a version of Agent.BTZ was found on a system .", "2160": "During the startup of the infected machine , the shdocvw.tlp library is loaded into all processes .", "2161": "If the process is explorer.exe , this library will load the other library called credprov.tlb .", "2162": "Its features are common for a Remote Administration Tool ( RAT ) : ComRAT 's communication to the command and control server is performed by the browser process and not by explorer.exe in order to avoid being blocked by a firewall on the system or any additional security products .", "2163": "The communication between the processes is performed by named pipe .", "2164": "Two log files are created during the malware execution : mskfp32.ocx and msvcrtd.tlb .", "2165": "The command and control server information is stored in the registry , not in an XML , and encoded : For example , in the analyzed sample the CC is : weather-online.hopto.org .", "2166": "If the malware version in lower than 3.26 , the XML log file contains the command and control server information : Let us summarize the similarities and differences between Agent.BTZ , Uroburos and ComRAT as far as we can : Some parts of the code are exactly the same ( appears to be copy & paste ) .", "2167": "Command and control server domains are shared between Uroburos and ComRAT .", "2168": "Agent.BTZ is a common RAT , a simple library executed on an infected machine .", "2169": "The malware is loaded into each and every process of the infected machine and the main part ( payload ) of the malware is only executed in explorer.exe .", "2170": "Furthermore , the C & C communication blends into the usual browser traffic and the malware communicates to the browser by named pipe .", "2171": "We suspect that this date is spoofed in order to disguise that this is in fact a newer version .", "2172": "\u2022 The threat actors utilized a hosting provider that is a Pakistani-based company with subleased VPS space within the U.S. for command and control ( C2 ) .", "2173": "\u2022 The customized malware ( BITTERBUG ) used by these threat actors has only been observed hosted on and communicating with two IP addresses operated by a Pakistan-based hosting provider .", "2174": "To our knowledge this customized malware has only ever been observed hosted on and communicating with two command and control nodes : 199.91.173.43 and 199.91.173.45 .", "2175": "The following is a summary of the relationships between the hosting organizations and Tranchulas : \u2022 VPNSOC IP space was used as command and control nodes for attackers using variants of the BITTERBUG malware that contained build strings that referenced '' Tranchulas '' and a Tranchulas employee .", "2176": "While the author field of '' hp '' does n't conclusively prove a relationship , it contributes to the body of circumstantial evidence which links properties of the official Tranchulas response to the properties of decoy documents that were used in conjunction with BITTERBUG targeting campaigns .", "2177": "FireEye analyzed the malware , which they call BITTERBUG , and determined it to be a custom backdoor .", "2178": "The backdoor relies on various support components , including the non-malicious , publically available Libcurl for installation , launch , and communications .", "2179": "In some variants , BITTERBUG has the ability to automatically target and exfiltrate files with extensions such as .doc , .xls , .pdf , .ppt , .egm , and .xml", "2180": "One of these samples was probably used in attacks in late summer 2013 , using a '' leaked report '' lure which contained a decoy document related to Pakistan 's alleged inability to locate Osama Bin Laden .", "2181": "Interestingly , the samples compiled following the blog publication used entirely new and generic debug paths ( Figure 11 ) as well as a compilation tactic to conceal the C2 address from static analysis .", "2182": "Between December 2013 and late March 2014 , we observed several new lures used in BITTERBUG self-extracting RAR ( SFXRAR ) files .", "2183": "One from December contained several BITTERBUG variants and used a decoy PDF document ( Figure 12 ) related to the December arrest of Devyani Khobragade , an Indian diplomat in the United States .", "2184": "In spring 2014 , we observed a SFXRAR file with a filename lure related to the March 2014 disappearance of Malaysis Airlines Flight 370 ( cast as a Pakistan-related hijacking ) .", "2185": "Interestingly , this SFXRAR 's filename was the only lure element related to the MH370 event ; it did not contain a decoy document .", "2186": "BITTERBUG continued to rely on the same network behaviors to communicate with its C2s .", "2187": "Connections to its C2 nodes relied on PHP and used communications that included '' .php ? compname= '' and '' .php ? srs= '' , as well as direct file/component retrieval from the C2s .", "2188": "Though many of the samples that we have observed use direct IPs for HTTP communications , we have observed more limited use of a No-IP domain .", "2189": "The threat actor appears to have exclusively used VPSNOC , a probable Pakistan-based VPS service provider who leased U.S. hosting services , for both the delivery and C2 phases of attack .", "2190": "Many of the notable characteristics of the BITTERBUG activity suggest that this is indeed part of a Pakistan-based cyber exploitation effort that has apparently attempted to obfuscate its malware characteristics and origins ( behind U.S. infrastructure ) , before and after public disclosure in August 2013 .", "2191": "BITTERBUG is a backdoor executable capable of uploading and downloading files , listing running processes , generating file listings , and automatically transferring selected files to its command and control ( C2 ) server .", "2192": "BITTERBUG appears to be virtual machine aware and may not execute on a VMWare or VirtualBox VM .", "2193": "We have observed BITTERBUG installed by a self-extracting RAR archive disguised as a screensaver .", "2194": "Upon execution , the self-extracting RAR archive may extract configuration files , dependency DLLs , and the BITTERBUG executable .", "2195": "Upon execution the self-extracting RAR may install < BITTERBUG > .exe and the following DLLs : The self-extracting RAR may install the following benign configuration files : BITTERBUG first may execute the following Windows Management Instrumentation ( WMI ) command to detect the presence of a virtual machine ( VM ) : BITTERBUG then may open recovery.txt and check for the presence of strings VBox or VMware .", "2196": "The backdoor then may enter an infinite sleep loop if recovery.txt contains either one of the aforementioned strings ( Example in Figure 13 ) .", "2197": "Next BITTERBUG typically will beacon to the C2 server by sending the computer name and username of the compromised system .", "2198": "BITTERBUG then may perform an HTTP GET request for the following URI : If the C2 server responds with a filename , the filename received is deleted from % APPDATA % \\Microsoft < FILENAMEFROM C2 > .", "2199": "The purpose of this command might be to delete older versions of BITTERBUG , although we have not observed this command occurring in the wild .", "2200": "BITTERBUG then may attempt to download the files listed in Table 1 .", "2201": "The final two files are downloaded to the user 's Startup directory and executed at startup in order to maintain persistence .", "2202": "Next , BITTERBUG may scan through each drive letter and search recursively for files with the following file extensions : BITTERBUG then typically creates a file list containing all documents ( excluding those whose filename contains MediaUtils ) to the following locations : BITTERBUG may also write a list of all running processes to : Finally , BITTERBUG typically uploads the running process list , document file list , and all documents to the following URI : BITTERBUG may be extracted along with the following embedded files : The malware may create the following files : \u2022 The malware typically communicates on TCP port 80 : \u2022 The malware may perform HTTP requests for the following URIs : We observed other interesting operational security-oriented challenges in the post-blog post samples .", "2203": "Analysis of metadata within two benign decoy documents that were originally used within July 2013 BITTERBUG operations , Report.docx and NaxalitesFundedbyPakistan.docx , both maintained the author properties of '' hp '' ."}